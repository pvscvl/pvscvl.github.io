<HTML
><HEAD
>
<TITLE>Recipe 16.1. Gathering Output from a Program (Perl Cookbook)</TITLE>
<META
NAME="DC.title"
CONTENT="Perl Cookbook"><META
NAME="DC.creator"
CONTENT="Tom Christiansen &amp; Nathan Torkington"><META
NAME="DC.publisher"
CONTENT="O'Reilly &amp; Associates, Inc."><META
NAME="DC.date"
CONTENT="1999-07-02T01:43:37Z"><META
NAME="DC.type"
CONTENT="Text.Monograph"><META
NAME="DC.format"
CONTENT="text/html"
SCHEME="MIME"><META
NAME="DC.source"
CONTENT="1-56592-243-3"
SCHEME="ISBN"><META
NAME="DC.language"
CONTENT="en-US"><META
NAME="generator"
CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINK
REV="made"
HREF="mailto:online-books@oreilly.com"
TITLE="Online Books Comments"><LINK
REL="up"
HREF="ch16_01.htm"
TITLE="16. Process Management and Communication"><LINK
REL="prev"
HREF="ch16_01.htm"
TITLE="16.0. Introduction"><LINK
REL="next"
HREF="ch16_03.htm"
TITLE="16.2. Running Another Program"></HEAD
><BODY
BGCOLOR="#FFFFFF"><img alt="Book Home" border="0" src="gifs/smbanner.gif" usemap="#banner-map" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.htm" alt="Perl Cookbook"><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.htm" alt="Search this book" /></map><div class="navbar"><p>
<TABLE
WIDTH="684"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="228"
><A
CLASS="sect1"
HREF="ch16_01.htm"
TITLE="16.0. Introduction"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 16.0. Introduction"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="228"
><B
><FONT
FACE="ARIEL,HELVETICA,HELV,SANSERIF"
SIZE="-1"
><A
CLASS="chapter"
REL="up"
HREF="ch16_01.htm"
TITLE="16. Process Management and Communication"
></A
></FONT
></B
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="228"
><A
CLASS="sect1"
HREF="ch16_03.htm"
TITLE="16.2. Running Another Program"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 16.2. Running Another Program"
BORDER="0"></A
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="sect1"
><H2
CLASS="sect1"
><A
CLASS="title"
NAME="ch16-17269"
>16.1. Gathering Output from a Program</A
></H2
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="ch16-pgfId-760"
>Problem<A
CLASS="indexterm"
NAME="ch16-idx-1000006238-0"
></A
><A
CLASS="indexterm"
NAME="ch16-idx-1000006238-1"
></A
><A
CLASS="indexterm"
NAME="ch16-idx-1000006238-2"
></A
></A
></H3
><P
CLASS="para"
>You want to run a program and collect its output into a variable.</P
></DIV
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="ch16-pgfId-766"
>Solution</A
></H3
><P
CLASS="para"
>Either use backticks: <A
CLASS="indexterm"
NAME="ch16-idx-1000006244-0"
></A
><A
CLASS="indexterm"
NAME="ch16-idx-1000006244-1"
></A
></P
><PRE
CLASS="programlisting"
>$output = `program args`;   # collect output into one multiline string
@output = `program args`;   # collect output into array, one line per element</PRE
><P
CLASS="para"
>Or use <A
CLASS="xref"
HREF="ch16_05.htm"
TITLE="Reading or Writing to Another Program"
>Recipe 16.4</A
>:</P
><PRE
CLASS="programlisting"
>open(README, &quot;program args |&quot;) or die &quot;Can't run program: $!\n&quot;;
while(&lt;README&gt;) {
    $output .= $_;
}
close(README);</PRE
></DIV
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="ch16-pgfId-788"
>Discussion</A
></H3
><P
CLASS="para"
>The backticks are a convenient way to run other programs and gather their output. The backticks do not return until the called program exits. Perl goes to some trouble behind the scenes to collect the output, so it is inefficient to use the backticks and ignore their return value:</P
><PRE
CLASS="programlisting"
>`fsck -y /dev/rsd1a`;       # BAD AND SCARY</PRE
><P
CLASS="para"
>Both the <CODE
CLASS="literal"
>open</CODE
> function and the backtick operator call the shell to run their commands. This makes them unsafe when used in a program with special privileges.</P
><P
CLASS="para"
>A high-level workaround is given in <A
CLASS="xref"
HREF="ch19_07.htm"
TITLE="Executing Commands Without Shell Escapes"
>Recipe 19.6</A
>. Here's a low-level workaround, using <CODE
CLASS="literal"
>pipe</CODE
>, <CODE
CLASS="literal"
>fork</CODE
>, and <CODE
CLASS="literal"
>exec</CODE
>:</P
><PRE
CLASS="programlisting"
>use POSIX qw(:sys_wait_h);

pipe(README, WRITEME);
if ($pid = fork) {
    # parent
    $SIG{CHLD} = sub { 1 while ( waitpid(-1, WNOHANG)) &gt; 0 };
    close(WRITEME);
} else {
    die &quot;cannot fork: $!&quot; unless defined $pid;
    # child
    open(STDOUT, &quot;&gt;&amp;=WRITEME&quot;)      or die &quot;Couldn't redirect STDOUT: $!&quot;;
    close(README);
    exec($program, $arg1, $arg2)    or die &quot;Couldn't run $program : $!\n&quot;;
}

while (&lt;README&gt;) {
    $string .= $_;
    # or  push(@strings, $_);
}
close(README);<A
CLASS="indexterm"
NAME="ch16-idx-1000006247-0"
></A
><A
CLASS="indexterm"
NAME="ch16-idx-1000006247-1"
></A
><A
CLASS="indexterm"
NAME="ch16-idx-1000006247-2"
></A
></PRE
></DIV
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="ch16-pgfId-1000006053"
>See Also</A
></H3
><P
CLASS="para"
>The section on <A
CLASS="olink"
HREF="../prog/ch06_03.htm"
>"Cooperating with Strangers"</A
> in <A
CLASS="olink"
HREF="../prog/ch06_01.htm"
>Chapter 6</A
> of <A
CLASS="citetitle"
HREF="../prog/index.htm"
TITLE="Programming Perl"
><CITE
CLASS="citetitle"
>Programming Perl</CITE
></A
>, or <I
CLASS="filename"
>perlsec </I
>(1); <A
CLASS="xref"
HREF="ch16_03.htm"
TITLE="Running Another Program"
>Recipe 16.2</A
>; <A
CLASS="xref"
HREF="ch16_05.htm"
TITLE="Reading or Writing to Another Program"
>Recipe 16.4</A
>; <A
CLASS="xref"
HREF="ch16_11.htm"
TITLE="Communicating Between Related Processes"
>Recipe 16.10</A
>; <A
CLASS="xref"
HREF="ch16_20.htm"
TITLE="Avoiding Zombie Processes"
>Recipe 16.19</A
>; <A
CLASS="xref"
HREF="ch19_07.htm"
TITLE="Executing Commands Without Shell Escapes"
>Recipe 19.6</A
></P
></DIV
></DIV
><DIV
CLASS="htmlnav"
><P
></P
><HR
ALIGN="LEFT"
WIDTH="684"
TITLE="footer"><TABLE
WIDTH="684"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="228"
><A
CLASS="sect1"
HREF="ch16_01.htm"
TITLE="16.0. Introduction"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 16.0. Introduction"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="228"
><A
CLASS="book"
HREF="index.htm"
TITLE="Perl Cookbook"
><IMG
SRC="../gifs/txthome.gif"
ALT="Perl Cookbook"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="228"
><A
CLASS="sect1"
HREF="ch16_03.htm"
TITLE="16.2. Running Another Program"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 16.2. Running Another Program"
BORDER="0"></A
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="228"
>16.0. Introduction</TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="228"
><A
CLASS="index"
HREF="index/index.htm"
TITLE="Book Index"
><IMG
SRC="../gifs/index.gif"
ALT="Book Index"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="228"
>16.2. Running Another Program</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="684"
TITLE="footer"><FONT
SIZE="-1"
></DIV<!-- LIBRARY NAV BAR --> <img src="../gifs/smnavbar.gif" usemap="#library-map" border="0" alt="Library Navigation Links"><p> <a href="copyrght.htm">Copyright &copy; 2002</a> O'Reilly &amp; Associates. All rights reserved.</font> </p> <map name="library-map"> <area shape="rect" coords="1,0,85,94" href="../index.htm"><area shape="rect" coords="86,1,178,103" href="../lwp/index.htm"><area shape="rect" coords="180,0,265,103" href="../lperl/index.htm"><area shape="rect" coords="267,0,353,105" href="../perlnut/index.htm"><area shape="rect" coords="354,1,446,115" href="../prog/index.htm"><area shape="rect" coords="448,0,526,132" href="../tk/index.htm"><area shape="rect" coords="528,1,615,119" href="index.htm"><area shape="rect" coords="617,0,690,135" href="../pxml/index.htm"></map> </BODY
></HTML
>
