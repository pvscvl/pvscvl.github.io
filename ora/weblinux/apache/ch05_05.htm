<?label 5.5. New Order Form?><html><head><title>New Order Form (Apache: The Definitive Guide)</title><link href="../style/style1.css" type="text/css" rel="stylesheet" />

<meta name="DC.Creator" content="Ben Laurie and Peter Laurie" /><meta scheme="MIME" content="text/xml" name="DC.Format" /><meta content="en-US" name="DC.Language" /><meta content="O'Reilly & Associates, Inc." name="DC.Publisher" /><meta scheme="ISBN" name="DC.Source" content="1565925289L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Apache: The Definitive Guide" /><meta content="Text.Monograph" name="DC.Type" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" alt="Book Home" usemap="#banner-map" border="0" /><map name="banner-map"><area alt="Apache: The Definitive Guide" href="index.htm" coords="0,0,466,65" shape="rect" /><area alt="Search this book" href="jobjects/fsearch.htm" coords="467,0,514,18" shape="rect" /></map>

<div class="navbar"><table border="0" width="515"><tr><td width="172" valign="top" align="left"><a href="ch05_04.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td width="171" valign="top" align="center"><a href="index.htm">Apache: The Definitive Guide</a></td><td width="172" valign="top" align="right"><a href="ch05_06.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>
<hr align="left" width="515" />


<h2 class="sect1">5.5. New Order Form</h2>





<p>
<a name="INDEX-588" /> <a name="INDEX-589" /> <a name="INDEX-590" />We want
this to be our state-of-the-art, showcase site, so we will employ our
order form for users and make up a similar one for salespeople. We
copy and edit our customers' form <em class="filename">...
/main_docs/form_summer.html</em> to produce <em class="filename">...
/main_docs/form_summer_sales.html</em>, reflecting the cynical
language used internally by the sales department and removing the
request for a credit card number:</p>





<blockquote><pre class="code">&lt;html&gt; 
&lt;body&gt; 
&lt;FORM METHOD=GET ACTION="/cgi-bin/mycgi.cgi"&gt;
&lt;h1&gt;Welcome to the great rip-off of '97: Butterthlies Inc&lt;/h1&gt; 
&lt;p&gt; 
All our worthless cards are available in packs of 20 
at $1.95 a pack. WHAT A FANTASTIC DISCOUNT! There is an amazing 
FURTHER 10% discount if you order more than 100. 
&lt;/p&gt; 
&lt;/p&gt; &lt;hr&gt; &lt;p&gt; Style 2315
&lt;p align=center&gt; &lt;img src="bench.jpg" alt="Picture of a bench"&gt; 
&lt;p align=center&gt; Be BOLD on the bench 
&lt;p&gt;How many packs of 20 do you want? 
&lt;INPUT NAME="2315_order" TYPE=int&gt; 
&lt;hr&gt; 
&lt;p&gt; 
Style 2316 
&lt;p align=center&gt; 
&lt;img src="hen.jpg" ALT="Picture of a hencoop like a pagoda"&gt; 
&lt;p align=center&gt; 
Get SCRAMBLED in the henhouse 
&lt;p&gt;How many packs of 20 do you want? 
&lt;INPUT NAME="2316_order" TYPE=int&gt; 
&lt;HR&gt; 
&lt;p&gt; 
Style 2317 
&lt;p align=center&gt; 
&lt;img src="tree.jpg" alt="Very nice picture of tree"&gt; 
&lt;p align=center&gt; 
Get HIGH in the treehouse 
&lt;p&gt;How many packs of 20 do you want? &lt;INPUT NAME="2317_order" TYPE=int&gt; 
&lt;hr&gt; 
&lt;p&gt; 
Style 2318 
&lt;p align=center&gt; 
&lt;img src="bath.jpg" alt="Rather puzzling picture of a bathtub"&gt; 
&lt;p align=center&gt; 
Get DIRTY in the bath 
&lt;p&gt;How many packs of 20 do you want? &lt;INPUT NAME="2318_order" TYPE=int&gt; 
&lt;hr&gt; 
&lt;p align=right&gt; 
Postcards designed by Harriet@alart.demon.co.uk 
&lt;hr&gt; 
&lt;br&gt; 
Butterthlies Inc, Hopeful City, Nevada 99999 
&lt;/br&gt; 
&lt;p&gt;&lt;INPUT TYPE=submit&gt;&lt;INPUT TYPE=reset&gt; 
&lt;/FORM&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre></blockquote>





<p>We have to edit <em class="filename">...
/site.authent/htdocs/customers/index.html </em>:</p>





<blockquote><pre class="code">&lt;html&gt; 
&lt;head&gt; 
&lt;title&gt;Index to Butterthlies Catalogs&lt;title&gt; 
&lt;/head&gt; 
&lt;body&gt; 
&lt;ul&gt; 
&lt;li&gt;
&lt;A href="form_summer.html"&gt;Summer order form &lt;/A&gt; 
&lt;/ul&gt; 
&lt;hr&gt; 
&lt;br&gt; 
Butterthlies Inc, Hopeful City, Nevada 99999 
&lt;/br&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre></blockquote>





<p>And we also have to edit <em class="filename">...
/site.authent/htdocs/salesmen</em>:</p>





<blockquote><pre class="code">&lt;html&gt; 
&lt;head&gt; 
&lt;title&gt;Salesman's Index to Butterthlies Catalogs&lt;/title&gt; 
&lt;/head&gt; 
&lt;body&gt; 
&lt;ul&gt; 
&lt;li&gt;
&lt;A href="form_summer_sales.html"&gt;Summer order form &lt;/A&gt; 
&lt;/ul&gt; 
&lt;hr&gt; 
&lt;br&gt; 
Butterthlies Inc, Hopeful City, Nevada 99999 
&lt;/br&gt; 
&lt;/body&gt; 
&lt;/html&gt;</pre></blockquote>





<p>All this works satisfactorily. When you access
<em class="emphasis">www.butterthlies.com,</em> you get the
customers' order form as before. When you go to
<em class="emphasis">sales.butterthlies.com,</em> you are told:</p>





<blockquote><pre class="code">Enter username for darkness at sales.butterthlies.com</pre></blockquote>





<p>The realm name <tt class="literal">darkness</tt> was specified when we set
up the passwords. You enter <tt class="literal">bill</tt>
and then his password,
<tt class="literal">theft</tt><em class="emphasis">,</em> and there you are with
the salespeople's order form. You can now experiment with
different <tt class="literal">require</tt> directives by stopping Apache
and editing <em class="filename">conf/httpd.conf</em>, then restarting
Apache with <tt class="literal">./go</tt> and logging in again.</p>





<p>You may find that logging in again is a bit more elaborate than you
would think. We found that Netscape was annoyingly helpful in
remembering the password used for the last login and using it again.
To make sure you are really exercising the security features, you
have to get out of Netscape each time and reload it to get a fresh
crack.</p>





<p>You might like to try the effect of:</p>





<blockquote><pre class="code">#require valid-user 
#require user daphne bill 
require group cleaners 
#require group directors</pre></blockquote>





<p>or:</p>





<blockquote><pre class="code">#require valid-user 
require user daphne bill 
#require group cleaners 
#require group directors</pre></blockquote>





<a name="ch05-9-fm2xml" /><div class="sect2">
<h3 class="sect2">5.5.1. DBM Files on Unix</h3>





<p>
<a name="INDEX-591" /> <a name="INDEX-592" /> <a name="INDEX-593" /> <a name="INDEX-594" /> <a name="INDEX-595" />Although
searching a file of usernames and passwords works perfectly well, it
is apt to be rather slow once the list gets up to a couple of hundred
entries. To deal with this, Apache provides a better way of handling
large lists: turning them into a database. You need one of the
modules that appear in the <em class="filename">Configuration</em> file
as:</p>





<blockquote><pre class="code">#Module db_auth_module  mod_auth_db.o 
Module dbm_auth_module mod_auth_dbm.o</pre></blockquote>





<p>Bear in mind that they correspond to different directives:
<tt class="literal">AuthDBMUserFile</tt>
<a name="INDEX-596" /> or
<tt class="literal">AuthDBUserFile</tt>
<a name="INDEX-597" />. A Perl script to manage both types
of database,
<em class="filename">dbmmanage</em>
<a name="INDEX-598" />, is supplied with Apache in
<em class="emphasis">.../src/support.</em> To decide which type to use,
you need to discover the capabilities of your Unix. Explore these by
going to the command prompt and typing first:</p>





<blockquote><pre class="code"><tt class="userinput"><b>% man db</b></tt></pre></blockquote>





<p>and then:</p>





<blockquote><pre class="code"><tt class="userinput"><b>% man dbm</b></tt></pre></blockquote>





<p>Whichever method first produces a manpage is the one you should use.
You can also use an SQL database, employing
<em class="emphasis">MySQL</em>
or a
third-party package to manage it.</p>





<p>Once you have decided which method to use, edit
<em class="emphasis">Configuration</em> to include the appropriate module,
and then type:</p>





<blockquote><pre class="code">% <b class="emphasis-bold">./Configure</b></pre></blockquote>





<p>and:</p>





<blockquote><pre class="code">% <b class="emphasis-bold">make</b></pre></blockquote>





<p>We now have to create a database of our users:
<em class="emphasis">bill</em>, <em class="emphasis">ben</em>,
<em class="emphasis">sonia</em>, and <em class="emphasis">daphne</em>. Go to
<em class="filename">... /apache/src/support,</em> find the utility
<em class="emphasis">dbmmanage,</em> and copy it into <em class="emphasis">
/usr/local/bin</em> or something similar to put it on your
path. This utility may be distributed without execute permission set,
so, before attempting to run it, we may need to change the
permissions:</p>





<blockquote><pre class="code">% <b class="emphasis-bold">chmod +x dbmmanage</b></pre></blockquote>





<p>You may find, when you first try to run
<em class="emphasis">dbmmanage</em>, that it complains rather puzzlingly
that some unnamed file can't be found. This is probably Perl, a
text-handling language, and if you have not installed it, you
should. It may also be necessary to change the first line of
<em class="emphasis">dbmmanage</em> to the correct path for Perl, if it is
installed somewhere other than <em class="filename">/usr/local/bin</em>.</p>





<p>We use <em class="emphasis">dbmmanage</em> in the following way:</p>





<blockquote><pre class="code">% <b class="emphasis-bold">dbmmanage</b> <em class="replaceable">dbmfile command username</em></pre></blockquote>





<p>The possible commands are as follows:</p>





<ul><li><p><tt class="literal">add</tt></p></li><li><p><tt class="literal">adduser</tt></p></li><li><p><tt class="literal">check</tt></p></li><li><p><tt class="literal">delete</tt></p></li><li><p><tt class="literal">import</tt></p></li><li><p><tt class="literal">update</tt></p></li><li><p><tt class="literal">view</tt></p></li></ul>
<p>
<a name="INDEX-599" />So, to add
our four users to a file <em class="filename">/usr/www/ok_dbm/users</em>,
we type:</p>





<blockquote><pre class="code">% <b class="emphasis-bold">dbmmanage /usr/www/ok_dbm/users.db adduser bill</b> 
New password:<b class="emphasis-bold">theft</b>
Re-type new password:<b class="emphasis-bold">theft</b>
User bill added with password encrypted to vJACUCNeAXaQ2</pre></blockquote>





<p>Perform the same service for <em class="emphasis">ben, sonia,
</em> and <em class="emphasis">daphne.</em> The file <em class="filename">...
/users</em> is not editable directly, but you can see the
results by typing:</p>





<blockquote><pre class="code">% <b class="emphasis-bold">dbmmanage /usr/www/ok_dbm/users view</b>

bill:vJACUCNeAXaQ2
ben:TPsuNKAtLrLSE
sonia:M9x731z82cfDo
daphne:7DBV6Yx4.vMjc</pre></blockquote>





<p>You can build a group file with
<em class="emphasis">dbmmanage</em><em class="emphasis">,</em> but, because of
faults in the script that we hope will have been rectified by the
time readers of this edition use it, the results seem a bit odd. To
add the user <em class="emphasis">fred</em> to the group
<em class="emphasis">cleaners,</em> type:</p>





<blockquote><pre class="code"><b class="emphasis-bold">% dbmmanage /usr/www/ok_dbm/group add fred cleaners</b></pre></blockquote>





<p>(Note: Do not use <tt class="literal">adduser</tt>.)
<em class="emphasis">dbmmanage</em> rather puzzlingly
responds with the following message:</p>





<blockquote><pre class="code">User fred added with password encrypted to cleaners</pre></blockquote>





<p>When we test this with:</p>





<blockquote><pre class="code">% <b class="emphasis-bold">dbmmanage  /usr/www/ok_dbm/group view</b></pre></blockquote>





<p>we see:</p>





<blockquote><pre class="code">fred:cleaners</pre></blockquote>





<p>which is correct, because in a group file the name of the group goes
where the encrypted password would go in a password file.</p>





<p>Since we have a similar file structure, we invoke DBM authentication
in <em class="filename"> ... /conf/httpd.conf</em> by commenting out:</p>





<blockquote><pre class="code">#AuthUserFile /usr/www/ok_users/sales
#AuthGroupFile /usr/www/ok_users/groups</pre></blockquote>





<p>and inserting:</p>





<blockquote><pre class="code">AuthDBMUserFile /usr/www/ok_dbm/sales 
AuthDBMGroupFile /usr/www/ok_dbm/sales</pre></blockquote>





<p><tt class="literal">AuthDBMGroupFile</tt>
<a name="INDEX-600" /> <a name="INDEX-601" /> is set to the same<em class="emphasis">
</em>file as the <tt class="literal">AuthDBMUserFile</tt>. What
happens is that the username becomes the key in the DBM file, and the
value associated with the key is
<em class="replaceable">password</em><tt class="literal">:</tt><em class="replaceable">group</em>.
To create a separate group file, a database with usernames as the key
and groups as the value (with no colons in the value) would be
<a name="INDEX-602" />
<a name="INDEX-603" />
<a name="INDEX-604" />needed.<a name="INDEX-605" /> <a name="INDEX-606" /> <a name="INDEX-607" /> <a name="INDEX-608" /> <a name="INDEX-609" /></p>
</div>


<hr align="left" width="515" />
<div class="navbar"><table border="0" width="515"><tr><td width="172" valign="top" align="left"><a href="ch05_04.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td width="171" valign="top" align="center"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td width="172" valign="top" align="right"><a href="ch05_06.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td width="172" valign="top" align="left">5.4. Passwords Under Win32</td><td width="171" valign="top" align="center"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td width="172" valign="top" align="right">5.6. Order, Allow, and Deny</td></tr></table></div>
<hr align="left" width="515" />

<img src="../gifs/navbar.gif" alt="Library Navigation Links" usemap="#library-map" border="0" />
<p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2001</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area href="../index.htm" coords="1,1,83,102" shape="rect" /><area href="../lnut/index.htm" coords="81,0,152,95" shape="rect" /><area href="../run/index.htm" coords="172,2,252,105" shape="rect" /><area href="index.htm" coords="238,2,334,95" shape="rect" /><area href="../sql/index.htm" coords="336,0,412,104" shape="rect" /><area href="../dbi/index.htm" coords="415,0,507,101" shape="rect" /><area href="../cgi/index.htm" coords="511,0,601,99" shape="rect" /></map>

</body></html>