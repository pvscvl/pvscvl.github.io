<?label 2.5. Setting Up a Win32 Server?><html><head><title>Setting Up a Win32 Server (Apache: The Definitive Guide)</title><link href="../style/style1.css" type="text/css" rel="stylesheet" />

<meta name="DC.Creator" content="Ben Laurie and Peter Laurie" /><meta scheme="MIME" content="text/xml" name="DC.Format" /><meta content="en-US" name="DC.Language" /><meta content="O'Reilly & Associates, Inc." name="DC.Publisher" /><meta scheme="ISBN" name="DC.Source" content="1565925289L" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Apache: The Definitive Guide" /><meta content="Text.Monograph" name="DC.Type" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" alt="Book Home" usemap="#banner-map" border="0" /><map name="banner-map"><area alt="Apache: The Definitive Guide" href="index.htm" coords="0,0,466,65" shape="rect" /><area alt="Search this book" href="jobjects/fsearch.htm" coords="467,0,514,18" shape="rect" /></map>

<div class="navbar"><table border="0" width="515"><tr><td width="172" valign="top" align="left"><a href="ch02_04.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td width="171" valign="top" align="center"><a href="index.htm">Apache: The Definitive Guide</a></td><td width="172" valign="top" align="right"><a href="ch03_01.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>
<hr align="left" width="515" />


<h2 class="sect1">2.5. Setting Up a Win32 Server</h2>








<p>
<a name="INDEX-213" /> <a name="INDEX-214" /> <a name="INDEX-215" />There is no point trying to run Apache
unless <a name="INDEX-216" /> <a name="INDEX-217" />TCP/IP is set up and running on your
machine. In our experience, if it isn't, Apache will crash
Windows 95. A quick test is to <em class="emphasis">ping</em> some
IP -- and if you can't think of a real one, <em class="emphasis">ping
</em>yourself:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">ping 127.0.0.1</b></pre></blockquote>








<p>If TCP/IP is working, you should see some collaborative message like:</p>








<blockquote><pre class="code">Pinging 127.0.0.1 with 32 bytes of data: 
Reply from 127.0.0.1: bytes=32 time&lt;10ms TTL=32
....</pre></blockquote>








<p>If you don't see something along these lines, defer further
operations until TCP/IP is working.</p>








<p>It is important to remember that internally, Windows Apache is
essentially the same as the Unix version and that it uses Unix-style
forward slashes ("/") rather than MS-DOS- and
Windows-style backslashes ("\") in its file and directory
names as specified in various files.</p>








<p>
<a name="INDEX-218" />
<a name="INDEX-219" />There
are several ways of running Apache under Win32. Under NT, you can run
it as a service, operating in the background. First you have to
install it as a service by running the "Install Apache as a
Service" option from the Start menu. Alternatively, click on
the MS-DOS prompt to get a DOS session window. Go to the <em class="filename">
/Program Files/Apache</em> directory (or wherever else you
installed Apache) with:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">cd "\Program Files\apache"</b></pre></blockquote>








<p>Apache can be installed as an NT service with:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">apache -i</b></pre></blockquote>








<p>and uninstalled with:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">apache -u</b></pre></blockquote>








<p>Once this is done, you can open the Services window in the Control
Panel, select Apache, and click on Start. Apache then runs in the
background until you click on Stop. Alternatively, you can open a
console window and type:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">net start apache</b>
&gt;<b class="emphasis-bold">net stop apache</b></pre></blockquote>








<p>To run Apache from a console window, select the Apache server option
from the Start menu.</p>








<p>Alternatively -- and under Win95, this is all you can
do -- click on the MS-DOS prompt to get a DOS session window. Go
to the <em class="emphasis">/Program Files/Apache</em> directory with:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">cd "\Program Files\apache"</b></pre></blockquote>








<p>The Apache executable, <em class="emphasis">apache.exe</em>,
is sitting here, and we can start it running, to see what
happens, with:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">apache -s</b></pre></blockquote>








<p>You might want to automate your Apache startup by putting the
necessary line into a file called <em class="emphasis">go.bat.</em> You
then only need to type:</p>








<blockquote><pre class="code"><b class="emphasis-bold">go</b>[RETURN]</pre></blockquote>








<p>Since this is the same as for the Unix version, we will simply say
"type <tt class="literal">go</tt>" throughout the book when
Apache is to be started, and thus save lengthy explanations.</p>








<p>When we ran Apache, we received the following lines:</p>








<blockquote><pre class="code">Apache/&lt;version number&gt;
Syntax error on line 44 of /apache/conf/httpd.conf
ServerRoot must be a valid directory</pre></blockquote>








<p>To deal with the first complaint, we looked at the file
<em class="emphasis">\Program Files\apache\conf \httpd.conf.</em> This
turned out to be a formidable document that, in effect, compresses
all the information we try to convey in the rest of this book into a
few pages. We could edit it down to something more lucid, but a
sounder and more educational approach is to start from nothing and
see what Apache asks for. The trouble with simply editing the
configuration files as they are distributed is that the process
obscures a lot of default settings. If and when someone new has to
wrestle with it he or she may make fearful blunders because it
isn't clear what has been changed from the defaults. Rename
this file if you want to look at it:</p>








<blockquote><pre class="code"><b class="emphasis-bold">&gt;ren httpd.conf *.cnk</b></pre></blockquote>








<p>Otherwise, delete it, and delete <em class="emphasis">srm.conf</em> and
<em class="emphasis">access.conf</em> :</p>








<blockquote><pre class="code"><b class="emphasis-bold">&gt;del srm.conf</b> 
<b class="emphasis-bold">&gt;del access.conf</b></pre></blockquote>








<p>When you run Apache now, you see:</p>








<blockquote><pre class="code">Apache/&lt;version number&gt;
fopen: No such file or directory
httpd: could not open document config file apache/conf/httpd.conf</pre></blockquote>








<p>And we can hardly blame it. Open <em class="emphasis">edit
</em>:<a href="#FOOTNOTE-23">[23]</a></p><blockquote>







<a name="FOOTNOTE-23" /><p>[23]Paradoxically, you have to use
what looks like an MS-DOS line editor, <em class="emphasis">edit</em>,
which you might think limited to the old MS-DOS 8.3 filename format,
to generate a file with the four-letter extension
<em class="emphasis">.conf</em>. The Windows editors, such as
<em class="emphasis">Notepad</em> and <em class="emphasis">WordPad</em>, insist
on adding <em class="emphasis">.txt</em> at the end of the
filename.</p>







</blockquote>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">edit httpd.conf</b></pre></blockquote>








<p>and insert the line:</p>








<blockquote><pre class="code"># new config file</pre></blockquote>








<p>The "<tt class="literal">#</tt>" makes this a comment without
effect, but it gives the editor something to save. Run Apache again.
We now see something sensible:</p>








<blockquote><pre class="code">...
httpd: cannot determine local host name
use ServerName to set it manually</pre></blockquote>








<p>What Apache means is that you should put a line in the
<em class="filename">httpd.conf</em> file:</p>








<blockquote><pre class="code"><a name="INDEX-220" />ServerName <em class="replaceable">your_host_name</em></pre></blockquote>








<p>Now when you run Apache you see:</p>








<blockquote><pre class="code">&gt;<b class="emphasis-bold">apache -s</b>

Apache/&lt;version number&gt;
_</pre></blockquote>








<p>The "_" here is meant to represent a blinking cursor,
showing that Apache is happily running. Unlike other programs in an
MS-DOS window, Apache keeps on going even after the screen saver has
kicked in.</p>








<p>You will notice that throughout this book, the Config files always
have the following lines:</p>








<blockquote><pre class="code">...
User webuser
Group webgroup
...</pre></blockquote>








<p>These are necessary for Unix security and, happily, are ignored by
the Win32 version of Apache, so we have avoided tedious explanations
by leaving them in throughout. Win32 users can include them or not as
they please.</p>








<p>You can now get out of the MS-DOS window and go back to the desktop,
fire up your favorite browser, and access <em class="emphasis">http://yourmachinename/</em>. You should see a
cheerful screen entitled "It Worked!," which is actually
<em class="emphasis">\apache\htdocs\index.html</em>.</p>








<p>When you have had enough, hit CTRL-C in the Apache window.</p>








<p>Alternatively, under Win95 and from Apache Version 1.3.3 on, you can
open another DOS session window and type:</p>








<blockquote><pre class="code"><b class="emphasis-bold">apache -k shutdown</b></pre></blockquote>








<p>This does a graceful shutdown, in which Apache allows any
transactions currently in process to continue to completion before it
exits. In addition, using:</p>








<blockquote><pre class="code">apache -k restart</pre></blockquote>








<p>performs a graceful restart, in which Apache rereads the
configuration files while allowing transactions in progress to
complete.</p>








<a name="ch02-13-fm2xml" /><div class="sect2">
<h3 class="sect2">2.5.1. Security Under Win32</h3>








<p>
<a name="INDEX-221" />
<a name="INDEX-222" />Although
<a name="INDEX-223" />NT has an
extensive and complex security infrastructure, it is poorly
documented and understood. Consequently, there is currently little
code in the Windows version of Apache to interface with it. Besides,
NT seems to suffer from a variety of more mundane problems: the
<em class="emphasis">README</em> file that comes with Apache v1.3.1 says,
in part:</p>









<p>Versions of Apache on Win32 prior to version 1.3.1 are vulnerable to a number of security holes common to several Win32 servers. The problems that impact Apache include:</p>








<ul>
<li><p>trailing "."s are ignored by the file system.  This allowed certain types of access restrictions to be bypassed.</p></li>
<li><p>directory names of three or more dots (e.g. "...") are considered to be valid similar to "...". This allowed people to gain access to files outside of the configured document trees.</p></li>
</ul>
<p>There have been at least four other similar instances of the same basic problem: on Win32, there is more than one name for a file. Some of these names are poorly documented or undocumented, and even Microsoft's own IIS has been vulnerable to many of these problems. This behavior of the Win32 file system and API makes it very difficult to ensure future security; problems of this type have been known about for years, however each specific instance has been discovered individually. It is unknown if there are other, yet unpublicized, filename variants. As result, we recommend that you use extreme caution when dealing with access restrictions on all Win32 servers.</p>









<p>In plain English, this means, once again, that Win32 is not an
adequate platform for running a web server that has any need for
<a name="INDEX-224" />
<a name="INDEX-225" />
<a name="INDEX-226" />security.</p>
</div>


<hr align="left" width="515" />
<div class="navbar"><table border="0" width="515"><tr><td width="172" valign="top" align="left"><a href="ch02_04.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td width="171" valign="top" align="center"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td width="172" valign="top" align="right"><a href="ch03_01.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td width="172" valign="top" align="left">2.4. Setting Up a Unix Server </td><td width="171" valign="top" align="center"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td width="172" valign="top" align="right">3. Toward a Real Web Site</td></tr></table></div>
<hr align="left" width="515" />

<img src="../gifs/navbar.gif" alt="Library Navigation Links" usemap="#library-map" border="0" />
<p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2001</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area href="../index.htm" coords="1,1,83,102" shape="rect" /><area href="../lnut/index.htm" coords="81,0,152,95" shape="rect" /><area href="../run/index.htm" coords="172,2,252,105" shape="rect" /><area href="index.htm" coords="238,2,334,95" shape="rect" /><area href="../sql/index.htm" coords="336,0,412,104" shape="rect" /><area href="../dbi/index.htm" coords="415,0,507,101" shape="rect" /><area href="../cgi/index.htm" coords="511,0,601,99" shape="rect" /></map>

</body></html>