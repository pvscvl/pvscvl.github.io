<?label D.3. Preparing to Boot LinuxPPC?><html><head><title>Preparing to Boot LinuxPPC (Running Linux)</title><link href="../style/style1.css" type="text/css" rel="stylesheet" />

<meta name="DC.Creator" content="" /><meta scheme="MIME" content="text/xml" name="DC.Format" /><meta content="en-US" name="DC.Language" /><meta content="O'Reilly & Associates, Inc." name="DC.Publisher" /><meta scheme="ISBN" name="DC.Source" content="" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="" /><meta content="Text.Monograph" name="DC.Type" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" alt="Book Home" usemap="#banner-map" border="0" /><map name="banner-map"><area alt="Running Linux" href="index.htm" coords="0,0,466,65" shape="rect" /><area alt="Search this book" href="jobjects/fsearch.htm" coords="467,0,514,18" shape="rect" /></map>

<div class="navbar"><table border="0" width="515"><tr><td width="172" valign="top" align="left"><a href="appd_02.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td width="171" valign="top" align="center"><a href="index.htm" /></td><td width="172" valign="top" align="right"><a href="appd_04.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>
<hr align="left" width="515" />


<h2 class="sect1">D.3. Preparing to Boot LinuxPPC</h2>

<p><a name="INDEX-179" />
<a name="INDEX-180" />
<a name="INDEX-181" />
<a name="INDEX-182" />
<a name="INDEX-183" />
To get LinuxPPC installed on your Mac, you will have to partition your
hard disk, install the OS, and configure your system for dual-booting
LinuxPPC.  Each step will be explained in detail later.</p>

<p>Booting LinuxPPC was revolutionized in 1998 when Benjamin
Herrenschmidt released a utility called BootX, which gave PowerMac
owners easy dual-boot capability.  The BootX utility runs in the Mac
OS as an application and comes with an extension that runs at system
startup.  Prior to BootX, the only way to boot PowerMacs was to edit
their Open Firmware settings, which was a tricky proposition, at
best. BootX also provides basic video support for machines that don't
have video drivers.</p>

<p>With the BootX system, the Linux kernel is stored on the Macintosh
hard disk.  When the user gives the command to boot into Linux, BootX
issues shutdown commands to the Mac OS.  Just when the Mac is about to
restart, the Mac OS is kicked out of the computer's RAM, and Linux
begins to boot.</p>

<div class="sect2">
<h3 class="sect2">D.3.1. Getting the Mac Ready for Linux</h3>

<p>Before you can see how fast your Mac really is, you have to do some
work.  You'll need a hard disk or removable disk, preferably a
gigabyte or larger, that you can repartition.  If you have only one
hard disk, you'll need to get either an external hard drive or
additional internal drive (if your machine has room for one) or
erase the internal hard disk and repartition it! Unfortunately, there
isn't any non-destructive partition software for the Macintosh.</p>

<p>If you have a LinuxPPC CD-ROM, you can boot from the CD-ROM straight into
the Red Hat installer.  The installer can run the
<a name="INDEX-184" />
<a name="INDEX-185" />
<tt class="command">fdisk</tt> utility (just a more familiar name for the
LinuxPPC partitioning utility called <tt class="command">pdisk</tt>), which
you can use to partition your hard disk.</p>

<blockquote><h4 class="objtitle">NOTE</h4>
<p>If you don't have a CD-ROM, but do have a fast Internet connection, you
can perform an FTP-based installation of LinuxPPC. Instructions for
FTP installation are at <a href="../../../../../../www.linuxppc.org/userguide/ftpinstall.shtml">http://www.linuxppc.org/userguide/ftpinstall.shtml</a>.
You need to have a direct connection with a static IP number.</p>
</blockquote>
</div>




<div class="sect2">
<h3 class="sect2">D.3.2. Partitioning the Hard Disk</h3>

<p><a name="INDEX-186" />
<a href="ch02_01.htm">Chapter 2, "Preparing to
 Install Linux"</a>, discusses the reasons for
partitioning and general concepts behind it, while<a href="ch03_01.htm">Section 3.1.2, "Drives and Partitions Under Linux"</a>" in <a href="ch03_01.htm">Chapter 3, "Installation
 and Initial
 Configuration"</a>, explains the names and
sizes typically used for Linux partitions. Read those sections for
background; here I discuss information specific to LinuxPPC.</p>

<p>A full installation of LinuxPPC takes up about 650 MB.  You'll want to
have more available for adding files and software. For a robust
installation, we recommend devoting at least one gigabyte
partition. Give it more if you can spare the disk space. It is
possible to pare down the installation to fit on a 100 MB ZIP disk,
but there's not much you can fit on there.</p>

<p>Before partitioning a disk, make a complete backup of
the disk. Once you partition the hard disk, all of the data on the
<img src="figs/bomb.gif">&nbsp;&nbsp;
disk will be destroyed, and it will not be possible to recover it
after it has been partitioned.</p>

<p>If you only have one hard disk, back up the whole disk! After you've
backed up your data, boot the computer from the Mac OS CD-ROM that
came with the machine, and use Apple's Drive Setup utility to format
and partition the hard disk into two HFS partitions. Then install the
Mac OS on the first partition, reboot into the Mac OS, restore your
data, and resume the partitioning and installation
<?troff \p?> process.</p>

<p>In this sample installation, we will use a 4 GB hard drive
that has been split into two partitions of 2 GB each. The
first will become an Apple HFS partition and will need to be
installed on that partition.  The second will be further partitioned
into a pair of Linux partitions.</p>

<p>To partition the hard disk, you'll need the Mac OS version
<a name="INDEX-187" />
of <tt class="command">pdisk</tt>, the disk partition utility.
This is provided by the Red Hat installer under the name
<tt class="command">fdisk</tt> and can also be grabbed from ftp://ftp.linuxppc.org /pub/linuxppc/linuxppc-R4/RedHat/tools/pdisk.hqx.
(Please use an FTP mirror site to lighten the load on the LinuxPPC
system, especially if you're not in the United States.  The mirror
list is at <a href="../../../../../../ www.linuxppc.org /mirrors.shtml">http:// www.linuxppc.org&thinsp;/mirrors.shtml</a>.)</p>

<p>Unlike most Mac OS programs, <tt class="command">pdisk</tt> is entirely
text-based.  It's also a very literal program, in that it will do
exactly what you tell it to do.  It won't delete your hard disk--unless you tell it to. To
<?troff .ne 10?> make it harder to accidentally wipe
everything out, <tt class="command">pdisk</tt> has a few safeguards built
in:</p>

<ul><li><p>It won't save any changes unless you specifically tell it to do so.</p></li><li><p>If you quit the program (In the File menu, choose Quit), it will not save the changes
you've made to your hard disk.  You have to tell it to save the
changes with the <tt class="command">w</tt> (write) command.</p></li></ul><p>The <tt class="command">pdisk</tt> commands are shown in <a href="appd_03.htm">Table D-1</a>.</p>

<a name="x-100-3-table-pdisk-commands" /><h4 class="objtitle">Table D-1. pdisk Partitioning Commands</h4><table border="1">

<tr>
<th>Command</th>
<th>Purpose</th>
</tr>




<tr>
<td rowspan="0"><tt class="command">e</tt></td>
<td rowspan="0">Edits a device's map.  A "device" is a hard disk.</td>
</tr>

<tr>
<td rowspan="0"><tt class="command">h</tt></td>
<td rowspan="0">Prints the available commands.</td>
</tr>

<tr>
<td rowspan="0"><tt class="command">l</tt></td>
<td rowspan="0">Lists a device's partition map.</td>
</tr>

<tr>
<td rowspan="0"><tt class="command">L</tt></td>
<td rowspan="0">Lists all devices' maps.</td>
</tr>

<tr>
<td rowspan="0"><tt class="command">q</tt></td>
<td rowspan="0">Quits the program.</td>
</tr>

<tr>
<td rowspan="0"><tt class="command">v</tt></td>
<td rowspan="0">Prints the version number and release date.</td>
</tr>


</table>

<p>When you use <tt class="command">pdisk</tt>, you're actually editing your
hard disk's partition map.  The partition map is a scary sounding name
for a file that contains a list of all the partitions on your hard
disk.  The partition map is stored on a partition all
its own.</p>

<p>When you're in the Mac OS, you see only one partition, which you think
of as your hard disk.  The other four partitions are invisible, and
you don't have any reason to directly interact with them.  (Unless
you've decided to go and install Linux.)  The first partition holds
the partition map.  The next three are device drivers, pieces of
software that tells the Mac how to use the hard disk and where to
look for the Mac OS partition.  Your Mac OS software and the OS are
stored on the fifth partition, which is an Apple HFS or HFS Plus
partition.</p>

<blockquote><h4 class="objtitle">NOTE</h4>
<p>As of this writing, LinuxPPC cannot read HFS Extended (also known as
HFS Plus) disks, including hard disks.  Research is under way to get
HFS Plus support working, but there isn't a date set for when we'll
have HFS Plus compatibility.  Check on <a href="../../../../../../www.linuxppc.org/">http://www.linuxppc.org</a> for an announcement.</p>
</blockquote>

<p>When you start up <tt class="command">pdisk</tt>, it presents you with a text prompt:
<?troff-ps_indent0?>
<blockquote><pre class="code">Top level command (? for help):</pre></blockquote>

<?troff .ne 10?>
Now what?  Type <tt class="literal">L</tt> and press Return.  The
system will print out a list of every SCSI and IDE device attached to
your computer, including hard disks, CD-ROM drive, ZIP drive, and so on:

<blockquote><pre class="code">Top level command (? for help): <tt class="userinput"><b>L</b></tt>
pdisk: can't open file '/dev/sda'  (No such device)
pdisk: can't open file '/dev/sdb'  (No such device)
pdisk: can't open file '/dev/sdc'  (No such device)
pdisk: can't open file '/dev/sde'  (No such device)
pdisk: can't open file '/dev/sdf'  (No such device)
pdisk: can't open file '/dev/sdg'  (No such device)

Partition map (with 512 byte blocks) on '/dev/hda'
 #:                type name             length   base    ( size )
 1: Apple_partition_map Apple                63 @ 1
 2:      Apple_Driver43*Macintosh            54 @ 64
 3:      Apple_Driver43*Macintosh            74 @ 118
 4:    Apple_Driver_ATA*Macintosh            54 @ 192
 5:    Apple_Driver_ATA*Macintosh            74 @ 246
 6:       Apple_Patches Patch Partition     512 @ 320
 7:           Apple_HFS untitled        4194304 @ 832     (  2.0G)
 8:           Apple_HFS untitled        4256944 @ 4195136 (  2.0G)</pre></blockquote>


If you don't have any SCSI devices on your machine, you'll see a bunch of error messages go whizzing by that say things similar to:

<blockquote><pre class="code">pdisk: can't open file '/dev/sda'  (No such device)
pdisk: can't open file '/dev/sdb'  (No such device)</pre></blockquote>


The <tt class="literal">can't open file</tt> messages are <tt class="command">pdisk</tt>'s cryptic
way of reporting that it didn't find any device attached to your
computer at that address.  Instead of referring to a device as <tt class="literal">CD-ROM
Drive at SCSI ID 4</tt> or <tt class="literal">ATAPI HD 1</tt>, <tt class="command">pdisk</tt> uses
Linux's device name format.  To Linux, everything is a device. Your
modem, your hard disk, the floppy drive, even the RAM are considered devices.</p>

<p><a name="INDEX-188" />
The name of a hard disk depends on whether it's an IDE or SCSI hard disk.  IDE disks are
referred to as <em class="filename">/dev/hd</em><em class="replaceable">x</em>,
and SCSI disks are <em class="filename">/dev/sd</em><em class="replaceable">x</em>.
The variable <em class="replaceable">x</em> is one of the letters
<tt class="literal">a</tt>, <tt class="literal">b</tt>, <tt class="literal">c</tt>,
<tt class="literal">d</tt>, <tt class="literal">e</tt>, <tt class="literal">f</tt>, or
<tt class="literal">g</tt>.  The letter on the end of the name is how Linux
distinguishes between drives.</p>

<p><a name="INDEX-189" />
<a name="INDEX-190" />
Did you notice that IDE drives are <tt class="literal">hd</tt> and SCSI drives are <tt class="literal">sd</tt>?
Those letters just denote which bus the devices are on.  The letter
after <tt class="literal">hd</tt> or <tt class="literal">sd</tt> is what you really need to pay attention to.  If
your computer has one IDE hard disk in it, it will be listed as
<em class="filename">/dev/hda</em>.  You also will get an error on
<em class="filename">/dev/hdb</em>, which is your CD-ROM drive.  Don't
worry about it, though.  (Trust me!)</p>

<p>If you have SCSI drives in your computer, <tt class="command">pdisk</tt>
will first display their names with "fake" SCSI names in the format
<em class="filename">/dev/scsi</em><em class="replaceable">bus</em>.<em class="replaceable">scsi_id</em>, such as <em class="filename">/dev/sdc1.5</em>.
Fortunately, it also lists their device name in proper
<em class="filename">/dev/sd</em><em class="replaceable">letter</em> format.
Linux refers to SCSI devices with the
<em class="filename">/dev/sd</em><em class="replaceable">letter</em> scheme, so
use that format when working with the device.</p>

<p><a name="INDEX-191" />
If you have an Ultra/Wide SCSI card by Adaptec or Apple, and you're
planning on installing Linux on the hard disk attached to the card, prepare
to be a little confused.  Linux might say that your hard disk is in a
different place than <tt class="command">pdisk</tt> says it's in. This is
because when Linux boots, it looks at the names of the devices
attached to it.  The Adaptec and Apple Ultra-Wide SCSI cards show up
on the letter A.  The Mac's SCSI controller is
called the MESH chip, which is alphabetically after "Adaptec."</p>

<p>A hard disk on an Adaptec card will be at
<em class="filename">/dev/sda</em>. Devices on the regular internal SCSI
bus will follow at <em class="filename">/dev/sdb</em> and
<em class="filename">/dev/sdc</em>. If your machine has only one device on
the SCSI card, you're in the clear.  If you have other devices
attached to it, the naming game can get a little hairy.</p>

<p>And now, we partition:</p>

<ol><li><p>Choose the partition you're going to edit.  In
<tt class="command">pdisk</tt>, type the letter <tt class="literal">e</tt>:

<blockquote><pre class="code">Top level command (? for help): <tt class="userinput"><b>e</b></tt>
Name of device: /dev/hda
Edit /dev/hda -
Command (? for help):</pre></blockquote></p></li><li><p>Delete the second HFS partition.  You have to delete the partition in order
to create free space, which you will use to make Linux partitions. Looking at the partition map, the seventh partition is the HFS
partition, which will be erased.  To delete a partition, type the letter
<tt class="literal">d</tt> followed by the number of the partition you wish
to delete:

<blockquote><pre class="code">Command (? for help): <tt class="userinput"><b>d8</b></tt>
Command (? for help): <tt class="userinput"><b>p</b></tt></pre></blockquote>


Typing <tt class="literal">p</tt> again will display the partition map.  The Apple HFS
partition has turned into free space, which you can use to make new partitions:

<blockquote><pre class="code"> 7:           Apple_HFS untitled        4194304 @ 832     (  2.0G)
 8:          Apple_Free Extra           4256944 @ 4195136 (  2.0G)</pre></blockquote></p></li><li><p><a name="INDEX-192" />
<a name="INDEX-193" />
Create the swap partition:

<blockquote><pre class="code">Command (? for help): <tt class="userinput"><b>c</b></tt>  <em class="emphasis">"c" is the command to make a new partition.</em>
First block: <tt class="userinput"><b>8p</b></tt>  <em class="emphasis">"8p": Use the first block of the free space partition,
                       which is the eighth partition.</em>
Length in blocks: <tt class="userinput"><b>30m</b></tt>  <em class="emphasis">Make it 30MB. k = kb, m = mb, g = gb</em>
Name of partition: <tt class="userinput"><b>swap</b></tt>  <em class="emphasis">The partition will be called swap.</em>
Command (? for help):</pre></blockquote></p></li></ol><p>There! You've created your swap partition.  Print out the partition map again.  Examine the eighth and ninth partitions:

<blockquote><pre class="code"> 8:     Apple_UNIX_SVR2 swap              61440 @ 4195136 ( 30.0M)
 9:       Apple_Free Extra           4195504 @ 4256576 (  2.0G)</pre></blockquote>

<?troff .Nd 10?>
The free space is now the ninth partition, and the new swap partition
is at <em class="filename">/dev/hda7</em>.  Next, make the root partition.  Once you make root, you will be done partitioning.</p>

<p>When creating the root partition, instead of typing the length in
megabytes, use the free-space partition's length in blocks. In this
example, the Apple_Free partition is 4,195,504 blocks long, which is
roughly 2 GB.  By typing the partition's exact length in blocks, you
will use up all the available disk space and not have wasted space left over after partitioning:</p>

<blockquote><pre class="code">Command (? for help): <tt class="userinput"><b>c</b></tt>
First block: <tt class="userinput"><b>9p</b></tt>
Length in blocks: <tt class="userinput"><b>4195504</b></tt>
Name of partition: <tt class="userinput"><b>root</b></tt>
Command (? for help): <tt class="userinput"><b>p</b></tt>

Partition map (with 512 byte blocks) on '/dev/hda'
 #:                type name             length   base    ( size )
 1: Apple_partition_map Apple                63 @ 1
 2:      Apple_Driver43*Macintosh            54 @ 64
 3:      Apple_Driver43*Macintosh            74 @ 118
 4:    Apple_Driver_ATA*Macintosh            54 @ 192
 5:    Apple_Driver_ATA*Macintosh            74 @ 246
 6:       Apple_Patches Patch Partition     512 @ 320
 7:           Apple_HFS untitled        4194304 @ 832     (  2.0G)
 8:     Apple_UNIX_SVR2 swap              61440 @ 4195136 ( 30.0M)
 9:     Apple_UNIX_SVR2 root            4195504 @ 4256576 (  2.0G)</pre></blockquote>

<p>In this example, partition <em class="filename">/dev/hda9</em> will become your root
device. Write down which partition is your root device.  You will
need to know that later. If you have a SCSI hard disk, it would be
<em class="filename">/dev/sda7</em>. Also note that if you are planning on
installing Linux on a drive other than your startup disk, you don't
have to have the Apple_HFS partition on the disk. You can devote the
entire drive to Linux.</p>

<p>When you're done partitioning, type <tt class="literal">w</tt>:

<blockquote><pre class="code">Command (? for help): <tt class="userinput"><b>w</b></tt>
Writing the partition map will permanently save changes.
Save changes? (y/N): <tt class="userinput"><b>y</b></tt></pre></blockquote>


<tt class="command">pdisk</tt> will come back to the <tt class="literal">Top level
command</tt> prompt.  At this point, the changes to your hard
disk will have been saved. Type <tt class="literal">q</tt> to quit <tt class="command">pdisk</tt>.</p>

<p>Tips for partitioning include the following:</p>

<ul><li><p>If you make a mistake, it's not fatal.  You can quit
<tt class="command">pdisk</tt> at any time without saving changes.</p></li><li><p>Changes are not final until you tell <tt class="command">pdisk</tt> to write
the new partition map with the <tt class="command">w</tt> command.</p></li></ul><a name="INDEX-194" />
</div>




<div class="sect2">
<h3 class="sect2">D.3.3. Installing BootX</h3>

<p><a name="INDEX-195" />
<a name="INDEX-196" />
The BootX software makes it very easy to boot LinuxPPC. It consists of
three files, which need to go in specific places on your hard
disk. The software includes the following:</p>

<dl>
<dt><b>The BootX application</b></dt><dd><p>This is called Boot LinuxPPC on LinuxPPC
CD-ROMs. The application can go anywhere on your hard disk.  You can
make multiple copies of it and place them in convenient locations.</p></dd>


<dt><b>The BootX Extension</b></dt><dd><p>Place this in your Mac's Extensions folder. (The
Extensions folder is inside the System folder.)</p></dd>


<dt><b><a name="INDEX-197" />
The vmlinux file (which is the Linux kernel)</b></dt><dd><p>This needs to go directly inside the System folder--not the
Extensions folder.</p></dd>

</dl>

<p>After you have placed the <em class="filename">vmlinux</em> file and BootX
Extension in their respective places, double-click the BootX application.
Make sure that the No Video Driver and Use RAM Disk boxes are
checked.  You don't need to enter anything in the <tt class="literal">Root
Device</tt> or <tt class="literal">More Kernel Arguments</tt> field.</p>

<p>Make sure that the LinuxPPC CD-ROM is in the CD-ROM drive, and click
the Linux button, and LinuxPPC will boot into the Red Hat installer.</p>
</div>




<a name="INDEX-198" /><a name="INDEX-199" /><a name="INDEX-200" /><a name="INDEX-201" /><a name="INDEX-202" />


<hr align="left" width="515" />
<div class="navbar"><table border="0" width="515"><tr><td width="172" valign="top" align="left"><a href="appd_02.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td width="171" valign="top" align="center"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td width="172" valign="top" align="right"><a href="appd_04.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td width="172" valign="top" align="left">D.2. Kernel and Library Issues</td><td width="171" valign="top" align="center"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td width="172" valign="top" align="right">D.4. Using the Red Hat Installer</td></tr></table></div>
<hr align="left" width="515" />

<img src="../gifs/navbar.gif" alt="Library Navigation Links" usemap="#library-map" border="0" />
<p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2001</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map"><area href="../index.htm" coords="1,1,83,102" shape="rect" /><area href="../lnut/index.htm" coords="81,0,152,95" shape="rect" /><area href="index.htm" coords="172,2,252,105" shape="rect" /><area href="../apache/index.htm" coords="238,2,334,95" shape="rect" /><area href="../sql/index.htm" coords="336,0,412,104" shape="rect" /><area href="../dbi/index.htm" coords="415,0,507,101" shape="rect" /><area href="../cgi/index.htm" coords="511,0,601,99" shape="rect" /></map>

</body></html>