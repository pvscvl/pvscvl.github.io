<html><head>
<title>[Chapter 14] Email Connectivity</TITLE>
<meta name="DC.title" content="Perl in a Nutshell"><meta name="DC.creator" content="Ellen Siever, Stephen Spainhour &amp; Nathan Patwardhan"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-07-02T01:56:28Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-286-7" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="part06.htm" title="VI. Network Programming"><link rel="prev" href="ch13_02.htm" title="13.2 The IO::Socket Module"><link rel="next" href="ch14_02.htm#PNUT-CH-14-SECT-2.3" title="14.2 The Mail Modules"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Perl in a Nutshell" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,71" href="index.htm" alt="Perl in a Nutshell"><area shape="RECT" coords="467,0,514,18" href="../search/nsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch13_02.htm" title="13.2 The IO::Socket Module"><img src="../gifs/txtpreva.gif" alt="Previous: 13.2 The IO::Socket Module" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 14</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch14_02.htm#PNUT-CH-14-SECT-2.3" title="14.2 The Mail Modules"><img src="../gifs/txtnexta.gif" alt="Next: 14.2 The Mail Modules" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="CHAPTER"><h1 class="chapter"><a class="title" name="PNUT-CH-14">14. Email Connectivity</A
></H1
><div class="htmltoc"><p><b>Contents:</B
><br><a class="SECT1" href="#PNUT-CH-14-SECT-1" title="14.1 The Net Modules">The Net Modules</A
><br><a class="SECT1" href="ch14_02.htm#PNUT-CH-14-SECT-2.3" title="14.2 The Mail Modules">The Mail Modules</A
></P
><p></P
></DIV
><p class="para"></P
><p class="para">Electronic mail is arguably the most essential Internet application.
In fact, for many people, it's their introduction to the Internet.  Thus the
Perl modules that deal with email are among the most useful modules.
There are two major groups of modules that provide email capabilities. The 
first group is<a class="indexterm" name="AUTOID-28792"></A
><a class="indexterm" name="PNUT-CH-14-IX-EMAIL"></A
><a class="indexterm" name="PNUT-CH-14-IX-NETWORKING-EMAIL"></A
><a class="indexterm" name="AUTOID-28799"></A
><a class="indexterm" name="PNUT-CH-14-IX-NET-MODULES"></A
>
Graham Barr's <em class="emphasis">libnet</EM
> collection, which contains packages 
for developing client-side applications over the Internet in Perl.
<a class="xref" href="#PNUT-CH-14-TAB-0" title="Protocols Implemented by the libnet Modules">Table 14.1</A
> lists some of the protocols implemented by the <em class="emphasis">libnet</EM
> modules.</P
><br><table class="table" border="1" cellpadding="3"><caption class="table"><a class="title" name="PNUT-CH-14-TAB-0">Table 14.1: Protocols Implemented by the libnet Modules</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Protocol</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Module</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Description</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">POP3</TD
><td class="entry" rowspan="1" colspan="1">Net::POP3</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Post Office Protocol, for reading email</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">SMTP</TD
><td class="entry" rowspan="1" colspan="1">Net::SMTP</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Simple Mail Transfer Protocol, for sending email</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">FTP</TD
><td class="entry" rowspan="1" colspan="1">Net::FTP</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">File Transfer Protocol, for transferring files between hosts</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">NNTP</TD
><td class="entry" rowspan="1" colspan="1">Net::NNTP</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Network News Transfer Protocol, for reading Usenet news</P
></TD
></TR
></TBODY
></TABLE
><p class="para">In this chapter, we discuss Net::SMTP and Net::POP3.  <a class="xref" href="ch15_01.htm" title="Usenet News">Chapter 15, <cite class="chapter">Usenet News</CITE
></A
>,
talks about Net::NNTP, and <a class="xref" href="ch16_01.htm" title="FTP">Chapter 16, <cite class="chapter">FTP</CITE
></A
>, discusses Net::FTP. Other
<em class="emphasis">libnet</EM
> modules, such as Net::SNPP and Net::Time, are not described<a class="indexterm" name="AUTOID-28839"></A
>
here, but you can get information about them from CPAN or with the
<em class="emphasis">perldoc</EM
> command if <em class="emphasis">libnet</EM
> is installed on your system.</P
><p class="para">The second group of mail-related modules are the Mail modules, many of
which were also written by Graham Barr. They can be found on CPAN as the<a class="indexterm" name="AUTOID-28845"></A
><a class="indexterm" name="AUTOID-28848"></A
><a class="indexterm" name="AUTOID-28850"></A
>
MailTools collection. The Mail modules also include
Mail::Folder and its subclasses, written 
by Kevin Johnson,<a class="indexterm" name="AUTOID-28852"></A
><a class="indexterm" name="AUTOID-28854"></A
>
and Mail::POP3Client, by Sean Dowd. This chapter describes the
following subset of the Mail modules:</P
><dl class="variablelist"><dt class="term">Mail::Send</DT
><dd class="listitem"><p class="para">Built on top of Mail::Mailer, providing better control of mail headers.</P
></DD
><dt class="term">Mail::Mailer</DT
><dd class="listitem"><p class="para">Interacts with external mail programs to send mail.</P
></DD
><dt class="term">Mail::Folder</DT
><dd class="listitem"><p class="para">Provides a base class and subclasses to work with mail folders.</P
></DD
><dt class="term">Mail::Internet</DT
><dd class="listitem"><p class="para">Provides functions to manipulate a mail message.</P
></DD
><dt class="term">Mail::Address</DT
><dd class="listitem"><p class="para">Extracts and manipulates RFC 822-compliant mail addresses.</P
></DD
><dt class="term">Mail::POP3Client</DT
><dd class="listitem"><p class="para">Provides an interface to a POP3 server, based on RFC 1081.</P
></DD
></DL
><p class="para">The rest of this chapter describes the modules; first the Net modules
and then the Mail modules.</P
><div class="sect1"><h2 class="sect1"><a class="title" name="PNUT-CH-14-SECT-1">14.1 The Net Modules</A
></H2
><p class="para">Net::SMTP and Net::POP3 are the modules for sending and receiving email via the SMTP and POP3 protocols. When you use these
modules, you are working at the socket level; they directly 
implement the Internet
protocols for sending and receiving mail as defined in the relevant RFCs&nbsp;- RFC 821 for SMTP and RFC 1081 for POP3.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="PNUT-CH-14-SECT-1.1">14.1.1 Send Email with Net::SMTP</A
></H3
><p class="para"><a class="indexterm" name="PNUT-CH-14-IX-SMTP-PROTOCOL-INTERFACE-TO"></A
><a class="indexterm" name="PNUT-CH-14-IX-NET-MODULES-NETSMTP-MODULE"></A
><a class="indexterm" name="PNUT-CH-14-IX-EMAIL-SENDING-NETSMTP-MODULE"></A
><a class="indexterm" name="PNUT-CH-14-IX-SIMPLE-MAIL-TRANSPORT-PROTOCOL-SMTP"></A
><a class="indexterm" name="PNUT-CH-14-IX-SENDING-EMAIL-MESSAGES"></A
>The Simple Mail Transfer Protocol, or SMTP, is responsible for clients
negotiating RCPT (&quot;to&quot;) and FROM (&quot;from&quot;) requests with an SMTP server,
sending data to the SMTP server, and then sending an end-of-data indicator. 
Net::SMTP is a subclass of Net::Cmd and IO::Socket::INET that
implements an interface to the SMTP and ESMTP protocols.  These
protocols send mail
by talking to an SMTP server through a socket, as described in RFC 821.</P
><p class="para">When would you want to use Net::SMTP instead of sending mail with an
external program? Since socket communications don't involve 
spawning an external program, your programs won't suffer from the overhead 
associated with running an extra process. Talking to SMTP is convenient for
sending a volume of mail messages. Naturally, 
your server must have an SMTP server running or a remote mailhost must allow 
you to talk to it; otherwise you won't be able to use this module. That's 
when you can turn to Mail::Mailer or Mail::Send and let them provide an 
interface to an external mail program for you.  This is the case, for
example, with home computers, which don't generally run their own SMTP server.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PNUT-CH-14-SECT-1.2">14.1.2 The SMTP Protocol and the SMTP Session</A
></H3
><p class="para">The SMTP protocol defines the set of commands a client sends to an SMTP 
server, which is generally bound to port 25 of a mailhost.
Requests and responses are negotiated between client and server.</P
><p class="para">When a client negotiates an SMTP session with a server, the server tells 
the client that it's listening. Once you're
connected, you introduce yourself to the server by issuing a HELO <a class="indexterm" name="AUTOID-28905"></A
>
command. The HELO command accepts one parameter&nbsp;- your hostname&nbsp;- and defaults to your remote hostname if you don't specify one. If the
command is successful, the server sends a 250 response, as follows:


<blockquote class="screen"><pre class="screen">HELO
250 mail.somename.com Hello some-remote-host.com [127.0.0.1], pleased to meet 
you</PRE
></BLOCKQUOTE
>

<a class="indexterm" name="AUTOID-28908"></A
>
After you've been greeted by the server, send the MAIL command to
tell the server who the message is from.  The MAIL command takes the 
string <code class="literal">From: user@hostname</CODE
> as an argument, and the server responds
with a 250 message to indicate success:


<blockquote class="screen"><pre class="screen">MAIL From: &lt;realuser@realhost.com&gt;
250 realuser@realhost.com ... Sender ok</PRE
></BLOCKQUOTE
>

<a class="indexterm" name="AUTOID-28912"></A
>
Then you send the RCPT command to tell the server who the recipient is:


<blockquote class="screen"><pre class="screen">RCPT To: &lt;nospam@rid-spam-now.com&gt;
250 nospam@rid-spam-now.com ... Recipient ok</PRE
></BLOCKQUOTE
>

<a class="indexterm" name="AUTOID-28915"></A
>
Now you're ready to send the body of your message to the server. The 
DATA command tells the server that all data until a <code class="literal">.</CODE
> on a line 
by itself is to be treated as the body of the mail message:


<blockquote class="screen"><pre class="screen">DATA
354 Enter mail, end with &quot;.&quot; on a line by itself
Subject: Hi, just thought you'd be interested ...

Hi, this is the text of my mail message that I'm going to 
send with Net::SMTP to show you how it works.
.
250 VAA09505 Message accepted for delivery</PRE
></BLOCKQUOTE
>


Once again you get a 250 response, indicating that the message
has been accepted for delivery. At that point, you can exit the SMTP <a class="indexterm" name="AUTOID-28919"></A
>
session with the QUIT command, which returns 221 on success:


<blockquote class="screen"><pre class="screen">QUIT
221 mail.somename.com closing connection
Connection closed by foreign host.</PRE
></BLOCKQUOTE
>
&#13;</P
><div class="sect3"><h4 class="sect3"><a class="title" name="PNUT-CH-14-SECT-1.2.1">14.1.2.1 Net::SMTP Methods</A
></H4
><p class="para">The following methods are defined by Net:SMTP:
<ul class="nutlist"><li class="term"><a class="nutentry" href="c14_001.htm" title="Reference: new">new</A
></LI
><li class="term"><a class="nutentry" href="c14_002.htm" title="Reference: data">data</A
></LI
><li class="term"><a class="nutentry" href="c14_003.htm" title="Reference: dataend">dataend</A
></LI
><li class="term"><a class="nutentry" href="c14_004.htm" title="Reference: datasend">datasend</A
></LI
><li class="term"><a class="nutentry" href="c14_005.htm" title="Reference: domain">domain</A
></LI
><li class="term"><a class="nutentry" href="c14_006.htm" title="Reference: expand">expand</A
></LI
><li class="term"><a class="nutentry" href="c14_007.htm" title="Reference: hello">hello</A
></LI
><li class="term"><a class="nutentry" href="c14_008.htm" title="Reference: help">help</A
></LI
><li class="term"><a class="nutentry" href="c14_009.htm" title="Reference: mail">mail</A
></LI
><li class="term"><a class="nutentry" href="c14_010.htm" title="Reference: quit">quit</A
></LI
><li class="term"><a class="nutentry" href="c14_011.htm" title="Reference: recipient">recipient</A
></LI
><li class="term"><a class="nutentry" href="c14_012.htm" title="Reference: reset">reset</A
></LI
><li class="term"><a class="nutentry" href="c14_013.htm" title="Reference: to">to</A
></LI
><li class="term"><a class="nutentry" href="c14_014.htm" title="Reference: verify">verify</A
></LI
></UL
><a class="indexterm" name="AUTOID-29124"></A
><a class="indexterm" name="AUTOID-29125"></A
><a class="indexterm" name="AUTOID-29126"></A
><a class="indexterm" name="AUTOID-29127"></A
><a class="indexterm" name="AUTOID-29128"></A
></P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PNUT-CH-14-SECT-1.3">14.1.3 Retrieving Email with Net::POP3</A
></H3
><p class="para"><a class="indexterm" name="PNUT-CH-14-IX-EMAIL-RETRIEVING-NETPOP3-MODULE"></A
><a class="indexterm" name="PNUT-CH-14-IX-NET-MODULES-NETPOP3-MODULE"></A
><a class="indexterm" name="PNUT-CH-14-IX-POP3-PROTOCOL-INTERFACE-TO"></A
><a class="indexterm" name="PNUT-CH-14-IX-POST-OFFICE-PROTOCOL-POP3"></A
><a class="indexterm" name="PNUT-CH-14-IX-RETRIEVING-EMAIL-MESSAGES"></A
>You can use SMTP to send mail, but not to retrieve it.  For retrieving 
messages, use 
the Post Office Protocol version 3 (POP3), described in RFC 1081. One way 
to do this is to use the Net::POP3 module. POP3 provides
commands for interacting with the POP server, typically
bound to port 110. Net::POP3 automates
the transfer of email from a remote server to the local machine. </P
><p class="para">The POP server retrieves messages from a specified
spooling directory on the remote system. 
The messages are stored in a file named for the username;<a class="indexterm" name="AUTOID-29145"></A
><a class="indexterm" name="AUTOID-29147"></A
><a class="indexterm" name="AUTOID-29149"></A
>
anonymous logins are not permitted.  Authentication is based on
username and password and is done by sending the USER and PASS commands
to the POP server. For example, identification of 
user <code class="literal">foo</CODE
> with password <code class="literal">bar</CODE
> looks like this:


<blockquote class="screen"><pre class="screen">USER foo
PASS bar</PRE
></BLOCKQUOTE
>

<a class="indexterm" name="AUTOID-29154"></A
><a class="indexterm" name="AUTOID-29157"></A
><a class="indexterm" name="AUTOID-29159"></A
>
Net::POP3 has <code class="literal">user</CODE
> and <code class="literal">pass</CODE
>
methods but may also authenticate users with <code class="literal">login</CODE
>, which
takes both username and password arguments. If authentication fails, the user
cannot retrieve, delete, or alter any messages from the mail server.
<code class="literal">login</CODE
> returns the number of messages on the POP server for
the user, or <code class="literal">undef</CODE
> if authentication fails.</P
><p class="para">Authenticated users can retrieve information
about their mailboxes, and they can get specific messages by message number. </P
><p class="para">A POP session to retrieve a mail message is negotiated with the server
like this:</P
><ol class="orderedlist"><li class="listitem"><p class="para">Connect to the POP server (the default port is 110).</P
></LI
><li class="listitem"><p class="para">Send USER command.</P
></LI
><li class="listitem"><p class="para">Send PASS command.</P
></LI
><li class="listitem"><p class="para">If authenticated, receive number of messages.</P
></LI
><li class="listitem"><p class="para">Send RETR &lt;<em class="emphasis">message number</EM
>&gt; command to retrieve a specific message.</P
></LI
><li class="listitem"><p class="para">Send QUIT command to end session.</P
></LI
></OL
><p class="para">The following methods are defined by Net:POP3:
<ul class="nutlist"><li class="term"><a class="nutentry" href="c14_015.htm" title="Reference: new">new</A
></LI
><li class="term"><a class="nutentry" href="c14_016.htm" title="Reference: apop">apop</A
></LI
><li class="term"><a class="nutentry" href="c14_017.htm" title="Reference: delete">delete</A
></LI
><li class="term"><a class="nutentry" href="c14_018.htm" title="Reference: get">get</A
></LI
><li class="term"><a class="nutentry" href="c14_019.htm" title="Reference: last">last</A
></LI
><li class="term"><a class="nutentry" href="c14_020.htm" title="Reference: list">list</A
></LI
><li class="term"><a class="nutentry" href="c14_021.htm" title="Reference: login">login</A
></LI
><li class="term"><a class="nutentry" href="c14_022.htm" title="Reference: pass">pass</A
></LI
><li class="term"><a class="nutentry" href="c14_023.htm" title="Reference: popstat">popstat</A
></LI
><li class="term"><a class="nutentry" href="c14_024.htm" title="Reference: quit">quit</A
></LI
><li class="term"><a class="nutentry" href="c14_025.htm" title="Reference: reset">reset</A
></LI
><li class="term"><a class="nutentry" href="c14_026.htm" title="Reference: top">top</A
></LI
><li class="term"><a class="nutentry" href="c14_027.htm" title="Reference: uidl">uidl</A
></LI
><li class="term"><a class="nutentry" href="c14_028.htm" title="Reference: user">user</A
></LI
></UL
><a class="indexterm" name="AUTOID-29365"></A
><a class="indexterm" name="AUTOID-29366"></A
><a class="indexterm" name="AUTOID-29367"></A
><a class="indexterm" name="AUTOID-29368"></A
><a class="indexterm" name="AUTOID-29369"></A
><a class="indexterm" name="AUTOID-29370"></A
></P
></DIV
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch13_02.htm" title="13.2 The IO::Socket Module"><img src="../gifs/txtpreva.gif" alt="Previous: 13.2 The IO::Socket Module" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Perl in a Nutshell"><img src="../gifs/txthome.gif" alt="Perl in a Nutshell" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch14_02.htm#PNUT-CH-14-SECT-2.3" title="14.2 The Mail Modules"><img src="../gifs/txtnexta.gif" alt="Next: 14.2 The Mail Modules" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">13.2 The IO::Socket Module</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">14.2 The Mail Modules</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.html" title="The Perl CD Bookshelf">Library Home</A
> | <a href="index.htm" title="Perl in a Nutshell">Perl in a Nutshell</A
> | <a href="../learn/index.htm" title="Learning Perl">Learning Perl</A
> | <a href="../learn32/index.htm" title="Learning Perl on Win32 Systems">Learning Perl on Win32</A
> | <a href="../prog/index.htm" title="Programming Perl">Programming Perl</A
> | <a href="../advprog/index.htm" title="Advanced Perl Programming">Advanced Perl Programming</A
> | <a href="../cookbook/index.htm" title="Perl Cookbook">Perl Cookbook</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
