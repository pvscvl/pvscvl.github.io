<html><head>
<title>[Chapter 8] Other Oddments</TITLE>
<meta name="DC.title" content="Programming Perl"><meta name="DC.creator" content="Larry Wall, Tom Christiansen &amp; Randal L. Schwartz"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-07-02T02:06:38Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-149-6" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="index.htm" title="Programming Perl"><link rel="prev" href="ch07_02.htm" title="7.2 Library Modules"><link rel="next" href="ch08_02.htm#PERL2-CH-8-SECT-2.4" title="8.2 Common Goofs for Novices"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Programming Perl" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="Programming Perl"><area shape="RECT" coords="467,0,514,18" href="../search/psrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_02.htm" title="7.2 Library Modules"><img src="../gifs/txtpreva.gif" alt="Previous: 7.2 Library Modules" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 8</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch08_02.htm#PERL2-CH-8-SECT-2.4" title="8.2 Common Goofs for Novices"><img src="../gifs/txtnexta.gif" alt="Next: 8.2 Common Goofs for Novices" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="CHAPTER"><h1 class="chapter"><a class="title" name="PERL2-CH-8">8. Other Oddments</A
></H1
><div class="htmltoc"><p><b>Contents:</B
><br><a class="SECT1" href="#PERL2-CH-8-SECT-1" title="8.1 The Perl Debugger">The Perl Debugger</A
><br><a class="SECT1" href="ch08_02.htm#PERL2-CH-8-SECT-2.4" title="8.2 Common Goofs for Novices">Common Goofs for Novices</A
><br><a class="SECT1" href="ch08_03.htm#PERL2-CH-8-SECT-3.1" title="8.3 Efficiency">Efficiency</A
><br><a class="SECT1" href="ch08_04.htm" title="8.4 Programming with Style">Programming with Style</A
><br><a class="SECT1" href="ch08_05.htm#PERL2-CH-8-SECT-5.1" title="8.5 Distribution and Installation">Distribution and Installation</A
><br><a class="SECT1" href="ch08_06.htm" title="8.6 Perl Poetry">Perl Poetry</A
><br><a class="SECT1" href="ch08_07.htm" title="8.7 History Made Practical">History Made Practical</A
></P
><p></P
></DIV
><p class="para">Did you ever have a junk drawer?  You know, one of those drawers
where you put everything important enough to keep (like the spare key
to the back door), but not important enough to have a place of its own
(like the back door itself).</P
><p class="para">Well, this chapter is the junk drawer of the book.  We stuffed many
important (and a few not-so-important) things in this chapter.  Read on.</P
><div class="sect1"><h2 class="sect1"><a class="title" name="PERL2-CH-8-SECT-1">8.1 The Perl Debugger</A
></H2
><p class="para"><a class="indexterm" name="CH08.DEBUG1"></A
><a class="indexterm" name="CH08.DEBUG2"></A
><a class="indexterm" name="CH08.DEBUG3"></A
><a class="indexterm" name="AUTOID-27790"></A
>First of all, have you tried using the <b class="emphasis.bold">-w</B
> switch?</P
><p class="para">If you invoke Perl with the <b class="emphasis.bold">-d</B
> switch,
your script runs under the Perl debugger.  This works like an
interactive Perl environment, prompting for debugger commands that let
you examine source code, set breakpoints, dump out your function-call
stack, change the values of variables, and so on.  Any command not
recognized by the debugger[<a class="footnote" href="#AUTOID-27796">1</A
>] is directly executed
(<a class="xref" href="ch03_032.htm#PERL2-CMD-EVAL" title="eval"><b class="xref.cmd">eval</B
></A
>'d) as Perl code in the current
package.[<a class="footnote" href="#AUTOID-27800">2</A
>] This is so wonderfully
convenient that you often fire up the debugger all by itself just to
test out Perl constructs interactively to see what they do.  Here's a
common way to get that:</P
><blockquote class="footnote"><div class="footnote"><p class="para"><a class="footnote" name="AUTOID-27796">[1]</A
>  Leading whitespace before
a command would cause the debugger to think it's
<em class="emphasis">not</EM
> a command for it, but rather for Perl, so be
careful not to do that.  </P
></DIV
><div class="footnote"><p class="para"><a class="footnote" name="AUTOID-27800">[2]</A
>  The debugger uses the DB package for its
own state information.  </P
></DIV
></BLOCKQUOTE
><pre class="programlisting">perl -d -e 42</PRE
><p class="para">In Perl, the debugger is not a separate program as it usually is in a
typical programming environment.  Instead, the <b class="emphasis.bold">-d</B
> flag tells the compiler to insert source
information into the parse trees it's about to hand off to the
interpreter.  That means your 
code must first compile correctly for
the debugger to work on it.  Then when the interpreter starts up, it
pre-loads a Perl library file containing the debugger itself.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.1">8.1.1 Debugger Commands</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-27808"></A
>The debugger understands the following commands:</P
><dl class="variablelist"><dt class="term"><code class="literal">h</CODE
> [<code class="replaceable"><i>command</I
></CODE
>]</DT
><dd class="listitem"><p class="para">Prints out a help message.  </P
><p class="para"><a class="indexterm" name="AUTOID-27819"></A
>If you supply another debugger command as an argument to the <code class="literal">h</CODE
>
command, it prints out the description for just that command.  The command &quot;<code class="literal">h h</CODE
>&quot; produces a more compact help listing designed to
fit on one screen.  If the output of the <code class="literal">h</CODE
> command (or any command,
for that matter) scrolls past your screen, just precede the command with a
leading pipe symbol so it's run through your pager:</P
><pre class="programlisting">DB&lt;1&gt; |h</PRE
></DD
><dt class="term"><code class="literal">p</CODE
> <code class="replaceable"><i>expr</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27831"></A
><a class="indexterm" name="AUTOID-27833"></A
><a class="indexterm" name="AUTOID-27836"></A
>Same as &quot;<code class="literal">print DB::OUT</CODE
> <code class="replaceable"><i>expr</I
></CODE
>&quot; in the current package.  In particular,
since this is just Perl's own <a class="xref" href="ch03_110.htm#PERL2-CMD-PRINT" title="print"><b class="xref.cmd">print</B
></A
> function, this means that nested
data structures and objects are not dumped, unlike with the <code class="literal">x</CODE
> command.
The <code class="literal">DB::OUT</CODE
> handle is opened to <em class="emphasis">/dev/tty</EM
> (or perhaps an editor
window) no matter where standard output may have been redirected to.</P
></DD
><dt class="term"><code class="literal">x</CODE
> <code class="replaceable"><i>expr</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27851"></A
>Evals its expression in a list context and dumps out the result 
in a pretty-printed fashion.  Nested data structures are printed out
recursively, unlike with the print command above.</P
></DD
><dt class="term"><code class="literal">V</CODE
> [<code class="replaceable"><i>pkg</I
></CODE
> [<code class="replaceable"><i>vars</I
></CODE
>]]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27860"></A
><a class="indexterm" name="AUTOID-27862"></A
>Display all (or some) variables in package (defaulting to the main
package) using a data pretty-printer.  (Hashes show their keys and values so
you see what's what, control characters are made printable, nested data
structures print out in a legible fashion, and so on.)  Make sure you type
the identifiers without a type specifier such as <code class="literal">$</CODE
> or
<code class="literal">@</CODE
>, like this:</P
><pre class="programlisting">V DB filename line</PRE
><p class="para">In place of a variable name, you can use
<code class="literal">~</CODE
><code class="replaceable"><i>pattern</I
></CODE
> or
<code class="literal">!</CODE
><code class="replaceable"><i>pattern</I
></CODE
> to print existing variables
whose names either match or don't match the specified regular
expression.</P
></DD
><dt class="term"><code class="literal">X</CODE
> [<code class="replaceable"><i>vars</I
></CODE
>]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27879"></A
>Same as <code class="literal">V</CODE
> <code class="replaceable"><i>currentpackage</I
></CODE
>
[<code class="replaceable"><i>vars</I
></CODE
>].  </P
></DD
><dt class="term"><code class="literal">T</CODE
>   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27889"></A
>Produce a stack backtrace.  See below for details on its output.</P
></DD
><dt class="term"><code class="literal">s</CODE
> [<code class="replaceable"><i>expr</I
></CODE
>]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27897"></A
><a class="indexterm" name="AUTOID-27899"></A
>Single step.  Executes until it reaches the beginning of another
statement, descending into subroutine calls.  If an expression is
supplied that includes function calls, it, too, will be single-stepped.</P
></DD
><dt class="term"><code class="literal">n</CODE
>   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27906"></A
>Next.  Executes over subroutine calls, until it reaches the beginning
of the next statement at this same level.</P
></DD
><dt class="term"><code class="literal">&lt;CR&gt;</CODE
></DT
><dd class="listitem"><p class="para">Repeat last <code class="literal">n</CODE
> or <code class="literal">s</CODE
> command.</P
></DD
><dt class="term"><code class="literal">c</CODE
> [<code class="replaceable"><i>line</I
></CODE
>]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27921"></A
>Continue, optionally inserting a one-time-only breakpoint
at the specified line.</P
></DD
><dt class="term"><code class="literal">l</CODE
>   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27928"></A
>List next few lines.</P
></DD
><dt class="term"><code class="literal">l</CODE
> <code class="replaceable"><i>min+incr</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27936"></A
><a class="indexterm" name="AUTOID-27938"></A
><a class="indexterm" name="AUTOID-27941"></A
>List <code class="replaceable"><i>incr</I
></CODE
><code class="literal">+1</CODE
> lines starting at
<code class="replaceable"><i>min</I
></CODE
>.</P
></DD
><dt class="term"><code class="literal">l</CODE
> <code class="replaceable"><i>min-max</I
></CODE
></DT
><dd class="listitem"><p class="para">List lines <code class="replaceable"><i>min</I
></CODE
> through <code class="replaceable"><i>max</I
></CODE
>.</P
></DD
><dt class="term"><code class="literal">l</CODE
> <code class="replaceable"><i>line</I
></CODE
></DT
><dd class="listitem"><p class="para">List a single line.</P
></DD
><dt class="term"><code class="literal">l</CODE
> <code class="replaceable"><i>subname</I
></CODE
></DT
><dd class="listitem"><p class="para">List first few lines from subroutine.</P
></DD
><dt class="term"><code class="literal">-</CODE
>   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27971"></A
>List previous few lines.</P
></DD
><dt class="term"><code class="literal">w</CODE
> [<code class="replaceable"><i>line</I
></CODE
>]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27980"></A
>List window (a few lines) around the given <code class="replaceable"><i>line</I
></CODE
>, or
the current one if no <code class="replaceable"><i>line</I
></CODE
> is supplied.</P
></DD
><dt class="term">.   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-27988"></A
>Return debugger pointer to the last-executed line and
print it out.</P
></DD
><dt class="term"><code class="literal">f</CODE
> <code class="replaceable"><i>filename</I
></CODE
></DT
><dd class="listitem"><p class="para">Switch to viewing a different file.<a class="indexterm" name="AUTOID-27997"></A
></P
></DD
><dt class="term">/<code class="replaceable"><i>pattern</I
></CODE
>/</DT
><dd class="listitem"><p class="para">Search forward for <code class="replaceable"><i>pattern</I
></CODE
>; final / is optional.<a class="indexterm" name="AUTOID-28005"></A
><a class="indexterm" name="AUTOID-28007"></A
><a class="indexterm" name="AUTOID-28009"></A
></P
></DD
><dt class="term">?<code class="replaceable"><i>pattern</I
></CODE
>?</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28017"></A
><a class="indexterm" name="AUTOID-28019"></A
><a class="indexterm" name="AUTOID-28021"></A
>Search backward for <code class="replaceable"><i>pattern</I
></CODE
>; final ? is optional.</P
></DD
><dt class="term"><code class="literal">L</CODE
>   </DT
><dd class="listitem"><p class="para">List all breakpoints and actions for the current file.<a class="indexterm" name="AUTOID-28030"></A
></P
></DD
><dt class="term"><code class="literal">S</CODE
> [[!]<code class="replaceable"><i>pattern</I
></CODE
>]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28038"></A
>List subroutine names matching (or not matching with &quot;!&quot;) <code class="replaceable"><i>pattern</I
></CODE
>.
If no <code class="replaceable"><i>pattern</I
></CODE
> is given, all subroutines are listed.</P
></DD
><dt class="term"><code class="literal">t</CODE
>   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28047"></A
>Toggle trace mode.</P
></DD
><dt class="term"><code class="literal">t</CODE
> <code class="replaceable"><i>expr</I
></CODE
></DT
><dd class="listitem"><p class="para">Trace through execution of <code class="replaceable"><i>expr</I
></CODE
>.  </P
></DD
><dt class="term"><code class="literal">b</CODE
> [<code class="replaceable"><i>line</I
></CODE
>] [<code class="replaceable"><i>condition</I
></CODE
>]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28063"></A
><a class="indexterm" name="AUTOID-28065"></A
>Set a breakpoint at <code class="replaceable"><i>line</I
></CODE
>.  If <code class="replaceable"><i>line</I
></CODE
> is omitted, set a
breakpoint on the line that is about to be executed.  <code class="replaceable"><i>condition</I
></CODE
>,
if given, is evaluated each time the statement is reached, and a
breakpoint is taken only if <code class="replaceable"><i>condition</I
></CODE
> is true.  Breakpoints
may only be set on lines
that begin an executable statement.  Conditions don't use <b class="emphasis.bold">if</B
>:</P
><pre class="programlisting">b 237 $x &gt; 30
b 33 /pattern/i</PRE
><p class="para"></P
></DD
><dt class="term"><code class="literal">b</CODE
> <code class="replaceable"><i>subname</I
></CODE
> [<code class="replaceable"><i>condition</I
></CODE
>]</DT
><dd class="listitem"><p class="para">Set a (possibly conditional) breakpoint at the first line of the named
subroutine.</P
></DD
><dt class="term"><code class="literal">d</CODE
> [<code class="replaceable"><i>line</I
></CODE
>]</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28087"></A
><a class="indexterm" name="AUTOID-28089"></A
>Delete a breakpoint at the specified <code class="replaceable"><i>line</I
></CODE
>.  If
<code class="replaceable"><i>line</I
></CODE
> is omitted, deletes the breakpoint on the line
that is about to be executed.</P
></DD
><dt class="term"><code class="literal">D</CODE
>   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28099"></A
>Delete all installed breakpoints.</P
></DD
><dt class="term"><code class="literal">a</CODE
> [<code class="replaceable"><i>line</I
></CODE
>] <code class="replaceable"><i>command</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28108"></A
>Set an action to be done before the <code class="replaceable"><i>line</I
></CODE
> is
executed.  The sequence of steps taken by the debugger is:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">Check for a breakpoint at this line.</P
></LI
><li class="listitem"><p class="para">Print the line if necessary (tracing).</P
></LI
><li class="listitem"><p class="para">Do any actions associated with that line.</P
></LI
><li class="listitem"><p class="para">Prompt the user if at a breakpoint or in single-step.</P
></LI
><li class="listitem"><p class="para">Evaluate the line.</P
></LI
></UL
><p class="para">For example, this will print out <code class="literal">$foo</CODE
> every time line
53 is passed:</P
><pre class="programlisting">a 53 print &quot;DB FOUND $foo\n&quot;</PRE
><p class="para"></P
></DD
><dt class="term"><code class="literal">A</CODE
>   </DT
><dd class="listitem"><p class="para">Delete all installed actions.</P
></DD
><dt class="term"><code class="literal">O</CODE
><code class="literal"> [</CODE
><code class="replaceable"><i>opt</I
></CODE
><code class="literal">[=</CODE
><code class="replaceable"><i>val</I
></CODE
><code class="literal">]]</CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28141"></A
>Set or query values of options.  <code class="replaceable"><i>val</I
></CODE
> defaults to
1.  <code class="replaceable"><i>opt</I
></CODE
> can be abbreviated to the shortest unique
string, which is why some options are uppercase and others are
lowercase.  Options are:</P
><table class="informaltable" border="1" cellpadding="3"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Option</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Value</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">recallCommand ShellBang</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">The characters used to recall command or spawn shell.  By
default, these are both set to &quot;!&quot; (see below).</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">pager</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Program to use for output of pager-piped commands (those
beginning with a <code class="literal">|</CODE
> character). By default,
<code class="literal">$ENV{PAGER}</CODE
> will be used.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">PrintRet</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Enables printing of return value after <code class="literal">r</CODE
> command.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">frame</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Enables printing messages on entry and exit from subroutines.</P
></TD
></TR
></TBODY
></TABLE
><p class="para">The following options affect what happens with <code class="literal">V</CODE
>,
<code class="literal">X</CODE
>, and <code class="literal">x</CODE
> commands:</P
><table class="informaltable" border="1" cellpadding="3"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Option</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Value</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">arrayDepth hashDepth</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Print only to depth <code class="replaceable"><i>n</I
></CODE
> (&quot;&quot; for all).</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">compactDump veryCompact</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Change style of array and hash dump.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">globPrint</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Whether to print contents of globs.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">DumpDBFiles</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Dump arrays holding debugged files.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">DumpPackages</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Dump symbol tables of packages.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">quote HighBit undefPrint</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Change style of string dump.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">tkRunning</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Run Tk while prompting (with ReadLine).[<a class="footnote" href="#AUTOID-28224">3</A
>]</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">signalLevel warnLevel dieLevel</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Level of verbosity.</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><div class="footnote"><p class="para"><a class="footnote" name="AUTOID-28224">[3]</A
> A Perl application is
usually frozen when sitting at the debugger prompt. Tk
support keeps the event loop of Tk running while reading the prompt.</P
></DIV
></BLOCKQUOTE
><p class="para">During startup, options are initialized from
<code class="literal">$ENV{PERLDB_OPTS}</CODE
>.  You can put additional
initialization options <code class="literal">TTY</CODE
>,
<code class="literal">noTTY</CODE
>, <code class="literal">ReadLine</CODE
>, and
<code class="literal">NonStop</CODE
> there.  Here's an example using the
<code class="literal">$ENV{PERLDB_OPTS}</CODE
> variable:</P
><pre class="programlisting">$ PERLDB_OPTS=&quot;N f=2&quot; perl -d myprogram</PRE
><p class="para">This will run the script <code class="literal">myprogram</CODE
> without human intervention,
printing out the call tree with entry and exit points.  Note that
&quot;<code class="literal">N&nbsp;f=2</CODE
>&quot; is equivalent to
&quot;<code class="literal">NonStop=1 frame=2</CODE
>&quot;.</P
></DD
><dt class="term">&lt; <code class="replaceable"><i>command</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28248"></A
>Set an action to happen before every debugger prompt.  A multi-line
<code class="replaceable"><i>command</I
></CODE
> may be entered by backslashing the newlines.  <code class="replaceable"><i>command</I
></CODE
>
should be Perl code.</P
></DD
><dt class="term">&gt; <code class="replaceable"><i>command</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28258"></A
>Set an action to happen after the prompt when you've just given a
command to return to executing the script.  A multi-line <code class="replaceable"><i>command</I
></CODE
> may be
entered by backslashing the newlines.  <code class="replaceable"><i>command</I
></CODE
> should be Perl
code.</P
></DD
><dt class="term">! <code class="replaceable"><i>number</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28268"></A
>Redo a previous command (defaults to previous command).</P
></DD
><dt class="term">! -<code class="replaceable"><i>number</I
></CODE
></DT
><dd class="listitem"><p class="para">&#13;
Redo <code class="replaceable"><i>number</I
></CODE
>'th-to-last command.</P
></DD
><dt class="term">! <code class="replaceable"><i>pattern</I
></CODE
></DT
><dd class="listitem"><p class="para">Redo last command that started with <code class="replaceable"><i>pattern</I
></CODE
>.
See &quot;<code class="literal">O recallCommand</CODE
>&quot;, too.</P
></DD
><dt class="term">!! <code class="replaceable"><i>cmd</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28289"></A
>Run <code class="replaceable"><i>cmd</I
></CODE
> in a subprocess (which will read from
<code class="literal">DB::IN</CODE
>, write to <code class="literal">DB::OUT</CODE
>).
See &quot;<code class="literal">O shellBang</CODE
>&quot;, too.</P
></DD
><dt class="term"><code class="literal">H -</CODE
><code class="replaceable"><i>number</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28302"></A
>Display last <code class="replaceable"><i>number</I
></CODE
> commands.  Only commands longer
than one character are listed.  If <code class="replaceable"><i>number</I
></CODE
> is omitted,
lists them all.</P
></DD
><dt class="term"><code class="literal">q</CODE
> or <code class="literal">^D</CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28312"></A
><a class="indexterm" name="AUTOID-28314"></A
>Quit.  (&quot;<code class="literal">quit</CODE
>&quot; doesn't quite work for this.)</P
></DD
><dt class="term"><code class="literal">R</CODE
>   </DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28323"></A
>Restart the debugger by <a class="xref" href="ch03_033.htm#PERL2-CMD-EXEC" title="exec"><b class="xref.cmd">exec</B
></A
>ing a new session.  It tries to maintain
your history across this, but internal settings and command line options
may be lost.</P
></DD
><dt class="term">|<code class="replaceable"><i>dbcmd</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28331"></A
>Run debugger command, piping <code class="literal">DB::OUT</CODE
> to <code class="literal">$ENV{PAGER}</CODE
>.</P
></DD
><dt class="term">||<code class="replaceable"><i>dbcmd</I
></CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28341"></A
>Same as |<code class="replaceable"><i>dbcmd</I
></CODE
> but <code class="literal">DB::OUT</CODE
>
is temporarily <b class="emphasis.bold">select</B
>ed as well.
Often used with commands that would otherwise produce long
output, such as</P
><pre class="programlisting">|V main</PRE
><p class="para"></P
></DD
><dt class="term"><code class="literal">= [</CODE
><code class="replaceable"><i>alias value</I
></CODE
><code class="literal">]</CODE
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-28356"></A
>Define a command alias, or list current aliases.</P
></DD
><dt class="term"><code class="replaceable"><i>command</I
></CODE
></DT
><dd class="listitem"><p class="para">Execute <code class="replaceable"><i>command</I
></CODE
> as a Perl statement.  A semicolon is
not needed at the end.</P
></DD
></DL
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.2">8.1.2 Using the Debugger</A
></H3
><p class="para">If you have any compile-time executable statements (code within a
<code class="literal">BEGIN</CODE
> block or a <code class="literal">use</CODE
> statement),
they will not be stopped by the debugger,
although <a class="xref" href="ch03_123.htm#PERL2-CMD-REQUIRE" title="require"><b class="xref.cmd">require</B
></A
>s will.</P
><p class="para">The debugger prompt is something like:</P
><pre class="programlisting">DB&lt;8&gt;</PRE
><p class="para">or even:</P
><pre class="programlisting">DB&lt;&lt;17&gt;&gt;</PRE
><p class="para"><a class="indexterm" name="AUTOID-28376"></A
><a class="indexterm" name="AUTOID-28379"></A
><a class="indexterm" name="AUTOID-28381"></A
>where that number is the command number.  A <em class="emphasis">csh</EM
>-like history
mechanism allows you to access previous commands by number.  For example,
<code class="literal">!17</CODE
> would repeat
command number 17.  The number of angle brackets indicates the depth of
the debugger.  You get more than one set of brackets, for example, if
you're already at a breakpoint and then print out the result of a
function call that itself also has a breakpoint.</P
><p class="para"><a class="indexterm" name="AUTOID-28387"></A
>If you want to enter a multi-line command, such as a subroutine
definition with several statements, you may escape the newline that would
normally end the debugger command with a backslash.  Here's an example:</P
><pre class="programlisting">DB&lt;1&gt; <b class="emphasis.bold">for (1..4) {         \</B
>
  cont:     <b class="emphasis.bold">print &quot;ok\n&quot;;    \</B
>
  cont: <b class="emphasis.bold">}</B
>
  ok
  ok
  ok
  ok</PRE
><p class="para">Note that this business of escaping a newline is specific to interactive
commands typed into the debugger.</P
><p class="para">Let's say you want to fire up the debugger on a little program 
of yours (let's call it <em class="emphasis">camel_flea</EM
>), and stop it as soon 
as it gets down to a function named <code class="literal">infested</CODE
>.  Here's how
you'd do that:
&#13;</P
><pre class="programlisting"><code class="replaceable"><i>shell_prompt%</I
></CODE
> <b class="emphasis.bold">perl -d camel_flea</B
>
Stack dump during die enabled outside of evals.

Loading DB routines from perl5db.pl patch level 0.94
Emacs support available.

Enter h or `h h' for help.

main::(camel_flea:3):   $a = 1;
  DB&lt;1&gt;</PRE
><p class="para">The debugger halts your program right before the first run-time
executable statement (but see above regarding compile-time statements) and
asks you to enter a command.  Contrary to popular expectations,
whenever the debugger stops to show you a line of code, it 
displays the line it's <em class="emphasis">about</EM
> to execute, not the one it
just executed.</P
><p class="para">Now, you'd like to stop as soon as your program gets to the
<code class="literal">infested</CODE
> function, so you enter a breakpoint there like so:</P
><pre class="programlisting">DB&lt;1&gt; <b class="emphasis.bold">b infested</B
>
DB&lt;2&gt; <b class="emphasis.bold">c</B
></PRE
><p class="para">The debugger now continues until it hits that function, at which point
it does this:</P
><pre class="programlisting">main::infested(camel_flea:12):      my bugs;</PRE
><p class="para">It might be nice to look at a window of source code around the
breakpoint, so you use the <code class="literal">w</CODE
> command:<a class="indexterm" name="AUTOID-28412"></A
></P
><pre class="programlisting">DB&lt;2&gt; <b class="emphasis.bold">w</B
>
9:      } 
10:
11:     sub infested {
12==&gt;b      my $bugs;
13:         return 3.5;
14:     } 
DB&lt;2&gt;</PRE
><p class="para">As you see, your current line is line 12, and it has a breakpoint
on it.</P
><p class="para">Now, you'd like to see who called whom, so you ask for a stack 
backtrace:</P
><pre class="programlisting">DB&lt;2&gt; <b class="emphasis.bold">T</B
>
$ = main::infested called from file `Ambulation.pm' line 10
@ = Ambulation::legs(1, 2, 3, 4) called from file `camel_flea' line 7
$ = main::pests('bactrian', 4) called from file `camel_flea' line 4</PRE
><p class="para"><a class="indexterm" name="AUTOID-28421"></A
><a class="indexterm" name="AUTOID-28424"></A
><a class="indexterm" name="AUTOID-28427"></A
><a class="indexterm" name="AUTOID-28430"></A
>The left-hand character up there (<code class="literal">$</CODE
> or <code class="literal">@</CODE
>)
tells whether the function was called in a scalar or list context (we bet you
can tell which is which).  There are three lines because you were three
functions deep when you ran the stack backtrace.  Here's what each line means:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">Line number one says you were in the function <code class="literal">main::infested</CODE
> when
you ran the stack dump.  It tells you the function was called in a scalar
context from line 10 of the file <em class="emphasis">Ambulation.pm</EM
>.  It also shows that
it was called without any arguments whatsoever, meaning it was called as
<code class="literal">&amp;infested</CODE
>.</P
></LI
><li class="listitem"><p class="para">Line number two shows that the function <code class="literal">Ambulation::legs</CODE
> was
called in a list context from the <em class="emphasis">camel_flea</EM
> file with four
arguments.</P
></LI
><li class="listitem"><p class="para">Line number three shows that <code class="literal">main::pests</CODE
> was called in a scalar
context, also from <em class="emphasis">camel_flea</EM
>, but from line 4.</P
></LI
></UL
><p class="para"><a class="indexterm" name="AUTOID-28450"></A
><a class="indexterm" name="AUTOID-28453"></A
>Limited control over the Perl debugger can also be managed from within your Perl
script itself.  You might do this, for example, to set an automatic breakpoint
at a certain subroutine whenever a particular program is run under the debugger.
Setting <code class="literal">$DB::single</CODE
> to 1 will stop at the next statement as
though you'd used the debugger's <code class="literal">s</CODE
> command.  If you set
<code class="literal">$DB::single</CODE
> to 2, it's equivalent to having just typed the
<code class="literal">n</CODE
> command.  The <code class="literal">$DB::trace</CODE
> variable can be
set to 1 to simulate having typed the <code class="literal">t</CODE
> command.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.3">8.1.3 Debugger Customization</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-28465"></A
><a class="indexterm" name="AUTOID-28467"></A
><a class="indexterm" name="AUTOID-28470"></A
><a class="indexterm" name="AUTOID-28472"></A
>To modify the debugger, copy <em class="emphasis">perl5db.pl</EM
> from the Perl
library to another file and modify it as necessary.  You'll also want
to set your <code class="literal">PERL5DB</CODE
> environment variable to say something like this:</P
><pre class="programlisting">BEGIN { require &quot;myperl5db.pl&quot; }</PRE
><p class="para"><a class="indexterm" name="AUTOID-28479"></A
>You can do some customization by setting up a <em class="emphasis">.perldb</EM
> file with
initialization code.  For instance, you could make aliases
like these (the last one is one people expect to be there):</P
><pre class="programlisting">$DB::alias{'len'}  = 's/^len(.*)/p length($1)/';
$DB::alias{'stop'} = 's/^stop (at|in)/b/';
$DB::alias{'ps'}   = 's/^ps\b/p scalar /';
$DB::alias{'quit'} = 's/^quit\b.*/exit/';</PRE
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.4">8.1.4 Readline Support</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-28486"></A
><a class="indexterm" name="AUTOID-28488"></A
>As shipped, the only command-line history mechanism supplied is a simplistic one
that checks for leading exclamation points.  This is fine for casual use.
However, if you install the Term::ReadKey and Term::ReadLine modules from CPAN,
you will have full editing capabilities much like GNU
<em class="emphasis">readline</EM
>(3) provides.  Look for these in the
<em class="emphasis">modules/by-module/Term</EM
> directory on CPAN.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.5">8.1.5 Editor Support for Debugging</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-28495"></A
><a class="indexterm" name="AUTOID-28497"></A
>If you have GNU <em class="emphasis">emacs</EM
> installed on your system, it can
interact with the Perl debugger to provide an integrated software development
environment reminiscent of its interactions with C debuggers.</P
><p class="para">Perl is also delivered with a start file for making <em class="emphasis">emacs</EM
>
act like a syntax-directed editor that understands (some of) Perl's syntax.
Look in the <em class="emphasis">emacs/</EM
> directory of the Perl source
distribution.</P
><p class="para"><a class="indexterm" name="AUTOID-28504"></A
>(Historically, a similar setup for interacting with <em class="emphasis">vi</EM
> and the
X11 window system had also been available, but at the time of this
writing, no debugger support for <em class="emphasis">vi</EM
> currently exists.)
 
 </P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.6">8.1.6 Debugger Internals</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-28511"></A
>When you call the <a class="xref" href="ch03_010.htm#PERL2-CMD-CALLER" title="caller"><b class="xref.cmd">caller</B
></A
> function from
package DB, Perl sets the <code class="literal">@DB::args</CODE
> array to the arguments
that stack frame was called with.  It also maintains other magical internal
variables, such as <code class="literal">@DB::dbline</CODE
>, an array of the source code
lines for the currently selected (with the debugger's <code class="literal">f</CODE
>
command) file.  Perl effectively inserts a call to the function
<code class="literal">DB::DB</CODE
>(<code class="replaceable"><i>linenum</I
></CODE
>) in front of every
place that can have a breakpoint. Instead of a subroutine call it calls
<code class="literal">DB::sub</CODE
>, setting <code class="literal">$DB::sub</CODE
> to the name of
the called subroutine. It also inserts a <code class="literal">BEGIN {require
'perl5db.pl'}</CODE
> before the first line, since no subroutine call is
possible until <code class="literal">&amp;DB::sub</CODE
> is defined (for subroutines
defined outside this file).  In fact, the same is true if
<code class="literal">$DB::deep</CODE
> (how many levels of recursion deep into the
debugger you are) is not defined.</P
><p class="para">At the start, the debugger reads your config file
(<em class="emphasis">./.perldb</EM
> or <em class="emphasis">~/.perldb</EM
> under
UNIX), which can set important options.  This file may define a subroutine
<code class="literal">&amp;afterinit</CODE
> to be executed after the debugger is
initialized.</P
><p class="para">After the config file is processed, the debugger consults the environment variable
PERLDB_OPTS and parses it as arguments to the <code class="literal">O</CODE
>
<code class="replaceable"><i>opt=val</I
></CODE
> debugger command.</P
><p class="para">The following options can only be specified at startup.  To set them in your
config file, call <code class="literal">&amp;parse_options(&quot;</CODE
><code class="replaceable"><i>opt</I
></CODE
><code class="literal">=</CODE
><code class="replaceable"><i>val</I
></CODE
><code class="literal">&quot;)</CODE
>.</P
><dl class="variablelist"><dt class="term">TTY</DT
><dd class="listitem"><p class="para">The TTY to use for debugging I/O.</P
></DD
><dt class="term">noTTY</DT
><dd class="listitem"><p class="para">If set, goes in <code class="literal">NonStop</CODE
> mode.  On an interrupt, if TTY is
not set, it uses the value of <code class="literal">noTTY</CODE
> or <em class="emphasis">/tmp/perldbtty$$</EM
> to find
TTY using <code class="literal">Term::Rendezvous</CODE
>.  The current variant is to have the
name of TTY in this file.</P
></DD
><dt class="term">ReadLine</DT
><dd class="listitem"><p class="para">If false, a dummy ReadLine is used so that you can debug
ReadLine applications.</P
></DD
><dt class="term">NonStop</DT
><dd class="listitem"><p class="para">If true, no interaction is performed until an interrupt.</P
></DD
><dt class="term">LineInfo</DT
><dd class="listitem"><p class="para">File or pipe to print line number info to.  If it's a
pipe, then a short, <em class="emphasis">emacs</EM
>-like message is used.

Example config file:</P
><pre class="programlisting">&amp;parse_options(&quot;NonStop=1 LineInfo=db.out&quot;);
sub afterinit { $trace = 1; }</PRE
><p class="para">The script will run without human intervention, putting trace information
into the file <em class="emphasis">db.out</EM
>.  (If you interrupt it, you had better reset
<code class="literal">LineInfo</CODE
> to something &quot;interactive&quot;!)</P
></DD
></DL
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.7">8.1.7 Debugger Bugs</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-28570"></A
>If your program <a class="xref" href="ch03_035.htm#PERL2-CMD-EXIT" title="exit"><b class="xref.cmd">exit</B
></A
>s or 
<a class="xref" href="ch03_027.htm#PERL2-CMD-DIE" title="die"><b class="xref.cmd">die</B
></A
>s, so too does the debugger.</P
><p class="para">You cannot get the stack frame information or otherwise debug functions
that were not compiled by Perl, such as C or C++ extensions.</P
><p class="para"><a class="indexterm" name="AUTOID-28577"></A
><a class="indexterm" name="AUTOID-28580"></A
>If you alter your <b class="emphasis.bold">@_</B
> arguments in a
subroutine (such as with <a class="xref" href="ch03_143.htm#PERL2-CMD-SHIFT" title="shift"><b class="xref.cmd">shift</B
></A
> or
<a class="xref" href="ch03_108.htm#PERL2-CMD-POP" title="pop"><b class="xref.cmd">pop</B
></A
>), the stack backtrace will not show
the original values.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.8">8.1.8 Alternative Debuggers: The Perl Profiler</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-28589"></A
><a class="indexterm" name="AUTOID-28592"></A
><a class="indexterm" name="AUTOID-28594"></A
><a class="indexterm" name="AUTOID-28596"></A
>If you wish to supply an alternative debugger for Perl to run, just invoke
your script with the <code class="literal">-d:</CODE
><em class="emphasis">module</EM
> switch.
One of the most popular alternative debuggers for Perl is
DProf, the Perl profiler.   As of this writing, DProf was not
included with the standard Perl distribution, but it is expected to be
included &quot;real soon now.&quot;</P
><p class="para">Meanwhile, you can fetch the Devel::DProf module from CPAN.  Assuming
it's properly installed on your system, you can use it to profile the
Perl program in <em class="emphasis">mycode.pl</EM
> by typing:</P
><pre class="programlisting">perl -d:DProf mycode.pl</PRE
><p class="para">When the script terminates, the profiler will dump the profile
information to a file called <em class="emphasis">tmon.out</EM
>.  A tool
like <em class="emphasis">dprofpp</EM
> (also supplied with the Devel::DProf
package) interprets the profile.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PERL2-CH-8-SECT-1.9">8.1.9 Other Debugging Resources</A
></H3
><p class="para">You did try the <b class="emphasis.bold">-w</B
> switch, didn't you?</P
><a class="indexterm" name="AUTOID-28610"></A
><a class="indexterm" name="AUTOID-28611"></A
><a class="indexterm" name="AUTOID-28612"></A
></DIV
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_02.htm" title="7.2 Library Modules"><img src="../gifs/txtpreva.gif" alt="Previous: 7.2 Library Modules" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Programming Perl"><img src="../gifs/txthome.gif" alt="Programming Perl" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch08_02.htm#PERL2-CH-8-SECT-2.4" title="8.2 Common Goofs for Novices"><img src="../gifs/txtnexta.gif" alt="Next: 8.2 Common Goofs for Novices" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">7.2 Library Modules</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">8.2 Common Goofs for Novices</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.html" title="The Perl CD Bookshelf">Library Home</A
> | <a href="../perlnut/index.htm" title="Perl in a Nutshell">Perl in a Nutshell</A
> | <a href="../learn/index.htm" title="Learning Perl">Learning Perl</A
> | <a href="../learn32/index.htm" title="Learning Perl on Win32 Systems">Learning Perl on Win32</A
> | <a href="index.htm" title="Programming Perl">Programming Perl</A
> | <a href="../advprog/index.htm" title="Advanced Perl Programming">Advanced Perl Programming</A
> | <a href="../cookbook/index.htm" title="Perl Cookbook">Perl Cookbook</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
