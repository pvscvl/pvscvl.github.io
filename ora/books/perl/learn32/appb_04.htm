<html><head>
<title>[Appendix B] B.4 Win32 Extensions</TITLE>
<meta name="DC.title" content="Learning Perl on Win32 Systems"><meta name="DC.creator" content="Randal L. Schwartz, Erik Olson &amp; Tom Christiansen"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-07-02T01:38:09Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-324-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="appb_01.htm" title="B. Libraries and Modules"><link rel="prev" href="appb_03.htm" title="B.3 CPAN: Beyond the Standard Library"><link rel="next" href="appc_01.htm" title="C. Networking Clients"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Learning Perl on Win32 Systems" usemap="#srchmap" border="0"></H1
><map name="srchmindex.htmlap"><area shape="RECT" coords="0,0,466,54" href="index.htm" alt="Learning Perl on Win32 Systems"><area shape="RECT" coords="467,0,514,18" href="../search/wsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="sect1" href="appb_03.htm" title="B.3 CPAN: Beyond the Standard Library"><img src="../gifs/txtpreva.gif" alt="Previous: B.3 CPAN: Beyond the Standard Library" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1"><a class="appendix" rel="up" href="appb_01.htm" title="B. Libraries and Modules">Appendix B<br>Libraries and Modules</A
></FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="appendix" href="appc_01.htm" title="C. Networking Clients"><img src="../gifs/txtnexta.gif" alt="Next: C. Networking Clients" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="sect1"><h2 class="sect1"><a class="title" name="appb-pgfId-1000002316">B.4 <a class="indexterm" name="appb-idx-1000002672-0"></A
>Win32 Extensions</A
></H2
><p class="para"><a class="indexterm" name="appb-idx-1000004324-0"></A
><a class="indexterm" name="appb-idx-1000004324-1"></A
>We've said that extensions consist of a module written in Perl, and a library written in C or C++. Win32 extensions are valuable tools because they provide Windows-specific functionality that otherwise wouldn't be present in the base language. The following list details the extensions included with the ActiveState distribution (these are also available for the standard distribution via the <em class="emphasis">libwin32</EM
> distribution, available from CPAN).</P
><dl class="variablelist"><dt class="term"><b class="emphasis.bold">OLE </B
><em class="emphasis">(</EM
><a class="indexterm" name="appb-idx-1000002680-0"></A
><a class="indexterm" name="appb-idx-1000002680-1"></A
><b class="emphasis.bold">Win32::OLE </B
><em class="emphasis">in the</EM
> <b class="emphasis.bold">libwin32 </B
><em class="emphasis">distribution)</EM
></DT
><dd class="listitem"><p class="para">Access to OLE automation and OLE variants</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002673-0"></A
><a class="indexterm" name="appb-idx-1000002673-1"></A
>Win32::Process</DT
><dd class="listitem"><p class="para">Access to extended Win32 process creation and management; includes methods to kill, suspend, resume, and set the priorities of processes</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002681-0"></A
><a class="indexterm" name="appb-idx-1000002681-1"></A
>Win32::Semaphore</DT
><dd class="listitem"><p class="para">Provides access to Win32 semaphores and synchronization</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002682-0"></A
><a class="indexterm" name="appb-idx-1000002682-1"></A
>Win32::IPC</DT
><dd class="listitem"><p class="para">Provides sychronization for objects of type Semaphore, Mutex, Process, or ChangeNotify</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002683-0"></A
><a class="indexterm" name="appb-idx-1000002683-1"></A
>Win32::Mutex</DT
><dd class="listitem"><p class="para">Provides access to Win32 mutex objects</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002684-0"></A
><a class="indexterm" name="appb-idx-1000002684-1"></A
>Win32::ChangeNotify</DT
><dd class="listitem"><p class="para">Provides access to Win32 change-notification objects, letting you do things like monitor changes to directory trees</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002685-0"></A
><a class="indexterm" name="appb-idx-1000002685-1"></A
>Win32::EventLog</DT
><dd class="listitem"><p class="para">Provides access to the Windows NT event log</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002686-0"></A
><a class="indexterm" name="appb-idx-1000002686-1"></A
>Win32::Registry</DT
><dd class="listitem"><p class="para">Provides access to the Windows NT registry</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002687-0"></A
><a class="indexterm" name="appb-idx-1000002687-1"></A
>Win32::NetAdmin</DT
><dd class="listitem"><p class="para">Lets you manipulate users and groups</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002688-0"></A
><a class="indexterm" name="appb-idx-1000002688-1"></A
>Win32::File</DT
><dd class="listitem"><p class="para">Lets you get and set file attributes</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002689-0"></A
><a class="indexterm" name="appb-idx-1000002689-1"></A
>Win32::Service</DT
><dd class="listitem"><p class="para">Provides a service control interface: lets you start, pause, resume, and stop services</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002690-0"></A
><a class="indexterm" name="appb-idx-1000002690-1"></A
>Win32::NetResource</DT
><dd class="listitem"><p class="para">Lets you work with shares, both as a client and a server</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002691-0"></A
><a class="indexterm" name="appb-idx-1000002691-1"></A
>Win32::FileSecurity</DT
><dd class="listitem"><p class="para">Lets you work with file permissions on NTFS</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002692-0"></A
><a class="indexterm" name="appb-idx-1000002692-1"></A
>Win32::Error</DT
><dd class="listitem"><p class="para">Provides an interface to the system error codes and messages</P
></DD
></DL
><p class="para">The following Win32 extensions are not included in (but are readily available for) the ActiveState distribution, and are included with the <em class="emphasis">libwin32</EM
> distribution.</P
><dl class="variablelist"><dt class="term"><a class="indexterm" name="appb-idx-1000002693-0"></A
><a class="indexterm" name="appb-idx-1000002693-1"></A
>Win32::Internet</DT
><dd class="listitem"><p class="para">Provides an interface to HTTP and FTP</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002694-0"></A
><a class="indexterm" name="appb-idx-1000002694-1"></A
>Win32::ODBC</DT
><dd class="listitem"><p class="para">Provides an interface to ODBC data sources</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002695-0"></A
><a class="indexterm" name="appb-idx-1000002695-1"></A
>Win32::Shortcut</DT
><dd class="listitem"><p class="para">Lets you create Explorer (shell) shortcuts</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002696-0"></A
><a class="indexterm" name="appb-idx-1000002696-1"></A
>Win32::Sound</DT
><dd class="listitem"><p class="para">Plays <em class="emphasis">.wav</EM
> files or uses system sounds</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002697-0"></A
><a class="indexterm" name="appb-idx-1000002697-1"></A
>Win32::AdminMisc</DT
><dd class="listitem"><p class="para">Provides an extension of <code class="literal">Win32::NetAdmin</CODE
> that adds user impersonation, password manipulation, and DNS administration</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002698-0"></A
><a class="indexterm" name="appb-idx-1000002698-1"></A
>Win32::Clipboard</DT
><dd class="listitem"><p class="para">Accesses the Windows NT clipboard</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002699-0"></A
><a class="indexterm" name="appb-idx-1000002699-1"></A
>Win32::Console</DT
><dd class="listitem"><p class="para">Interfaces to console screen drawing; lets you do colors, boxes, etc.</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002700-0"></A
><a class="indexterm" name="appb-idx-1000002700-1"></A
>Win32::Pipe</DT
><dd class="listitem"><p class="para">Provides access to named pipes on Windows NT</P
></DD
></DL
><p class="para">In addition to these extensions, a Win32 extension is included with the ActiveState distribution, and is available as part of <em class="emphasis">libwin32</EM
>. The Win32 extension provides the following list functions (we've given a brief code snippet to illustrate how you might code each one):</P
><dl class="variablelist"><dt class="term"><a class="indexterm" name="appb-idx-1000002701-0"></A
><a class="indexterm" name="appb-idx-1000002701-1"></A
>Win32::GetLastError </DT
><dd class="listitem"><p class="para">Returns the last error value generated by a call to a Win32 API function:</P
><pre class="programlisting">use Win32;
$err = Win32::GetLastError();
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002702-0"></A
><a class="indexterm" name="appb-idx-1000002702-1"></A
>Win32::BuildNumber </DT
><dd class="listitem"><p class="para">Returns the build number of Perl for Win32:</P
><pre class="programlisting">use Win32:
$build = Win32::BuildNumber(); # $build has 306 (or whatever it is)
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002703-0"></A
><a class="indexterm" name="appb-idx-1000002703-1"></A
>Win32::LoginName </DT
><dd class="listitem"><p class="para">Returns the username of the owner of the current perl process:</P
><pre class="programlisting">use Win32;
$user = Win32::LoginName();   # $user has eriko (account name of 
    current user)
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002704-0"></A
><a class="indexterm" name="appb-idx-1000002704-1"></A
>Win32::NodeName </DT
><dd class="listitem"><p class="para">Returns the Microsoft Network node name of the current machine:</P
><pre class="programlisting">use Win32;
$node = Win32::NodeName(); # $node has machine name 
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002705-0"></A
><a class="indexterm" name="appb-idx-1000002705-1"></A
>Win32::DomainName </DT
><dd class="listitem"><p class="para">Returns the name of the Microsoft Network domain that the owner of the current perl process is logged into:</P
><pre class="programlisting">use Win32;
$domain = Win32::Domain();  # $domain has network domain name (not 
    TCP/IP domain name)
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002706-0"></A
><a class="indexterm" name="appb-idx-1000002706-1"></A
>Win32::FsType </DT
><dd class="listitem"><p class="para">Returns a string naming the filesystem type of the currently active drive:</P
><pre class="programlisting">use Win32;
$fs = Win32::FsType();     # $fs contains fs type, like NTFS or FAT
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002707-0"></A
><a class="indexterm" name="appb-idx-1000002707-1"></A
>Win32::GetCwd </DT
><dd class="listitem"><p class="para">Returns the current active drive and directory; this function does not return a UNC path:</P
><pre class="programlisting">use Win32;
$cwd = Win32::GetCwd();      # $cwd has current working directory
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002708-0"></A
><a class="indexterm" name="appb-idx-1000002708-1"></A
>Win32::SetCwd NEW_DIRECTORY</DT
><dd class="listitem"><p class="para">Sets the current active drive and directory; this function does not work with UNC paths:</P
><pre class="programlisting">use Win32;
Win32::SetCwd(&quot;c:/temp&quot;) || die &quot;SetCwd: $!&quot;;
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002709-0"></A
><a class="indexterm" name="appb-idx-1000002709-1"></A
>Win32::GetOSVersion </DT
><dd class="listitem"><p class="para">Returns an array (<code class="literal">$string</CODE
>, <code class="literal">$major</CODE
>, <code class="literal">$minor</CODE
>, <code class="literal">$build</CODE
>, and <code class="literal">$id</CODE
>). <code class="literal">$string</CODE
> is a descriptive string, <code class="literal">$major</CODE
> is the major version of the operating system, <code class="literal">$minor</CODE
> is the minor version of the operating system, <code class="literal">$build</CODE
> is the build number of the OS, and <code class="literal">$id</CODE
> is a digit that denotes the operating system variety (zero for Win32s, one for Windows 95, and two for Windows NT):</P
><pre class="programlisting">use Win32;
($string, $major, $minor, $build, $id) = Win32::GetOSVersion();
@os = qw(Win32s, Win95, WinNT);
print &quot;$os[$id] $major\.$minor $string (Build $build)\n&quot;;
</PRE
><p class="para">The output on a Windows NT 4.0 system is:</P
><pre class="programlisting">WinNT 4.0 Service Pack 3 (Build 1381)
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002710-0"></A
><a class="indexterm" name="appb-idx-1000002710-1"></A
>Win32::FormatMessage ERROR_CODE</DT
><dd class="listitem"><p class="para">Converts the supplied Win32 error bitmap (returned by <code class="literal">GetLastError</CODE
>) to a descriptive string:</P
><pre class="programlisting">use Win32;
use Win32::WinError;  # for error constants
$msg = Win32::FormatMessage(ERROR_INTERNAL_ERROR);
# $msg contains the string: There is not enough space on disk
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002711-0"></A
><a class="indexterm" name="appb-idx-1000002711-1"></A
>Win32::Spawn COMMAND, ARGS, PID </DT
><dd class="listitem"><p class="para">Spawns a new process using the supplied <code class="literal">COMMAND</CODE
>, passing in arguments in the string ARGS; the pid of the new process is stored in <code class="literal">PID</CODE
>:</P
><pre class="programlisting">use Win32;
Win32::Spawn('c:/nt/system32/notepad.exe', undef, $pid); # $pid has
    new pid of notepad</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002712-0"></A
><a class="indexterm" name="appb-idx-1000002712-1"></A
>Win32::LookupAccountName SYSTEM, ACCOUNT, DOMAIN, SID, SIDTYPE </DT
><dd class="listitem"><p class="para">Looks up <code class="literal">ACCOUNT</CODE
> on <code class="literal">SYSTEM</CODE
> and returns the domain name, <code class="literal">SID</CODE
>, and <code class="literal">SID</CODE
> type</P
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002713-0"></A
><a class="indexterm" name="appb-idx-1000002713-1"></A
>Win32::LookupAccountSID SYSTEM, SID, ACCOUNT, DOMAIN, SIDTYPE</DT
><dd class="listitem"><p class="para">Looks up <code class="literal">SID</CODE
> (Security ID) on <code class="literal">SYSTEM</CODE
> and returns the account name, domain name, and <code class="literal">SID</CODE
> type:</P
><pre class="programlisting">use Win32;
Win32::LookupAccountSID(undef, $some_sid, $acct, $domain, $sidtype);
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002714-0"></A
><a class="indexterm" name="appb-idx-1000002714-1"></A
>Win32::InitiateSystemShutdown MACHINE, MESSAGE, TIMEOUT, FORCECLOSE, REBOOT </DT
><dd class="listitem"><p class="para">Shuts down the specified <code class="literal">MACHINE</CODE
> (<code class="literal">undef</CODE
> means local machine), notifying users with the supplied <code class="literal">MESSAGE</CODE
>, within the specified <code class="literal">TIMEOUT</CODE
> (in seconds) interval. Forces closing of all documents without prompting the user if <code class="literal">FORCECLOSE</CODE
> is true, and reboots the machine if <code class="literal">REBOOT</CODE
> is true (be careful experimenting with this one):</P
><pre class="programlisting">use Win32;
Win32::InitiateSystemShutdown(undef, &quot;Bye&quot;,  15, undef, 1);
# try to shut down local machine
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002715-0"></A
><a class="indexterm" name="appb-idx-1000002715-1"></A
>Win32::AbortSystemShutdown MACHINE </DT
><dd class="listitem"><p class="para">Aborts a shutdown on the specified <code class="literal">MACHINE</CODE
>:</P
><pre class="programlisting">use Win32;
Win32::AbortSystemShutdown(undef);  
# stop a shutdown on local machine
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002716-0"></A
><a class="indexterm" name="appb-idx-1000002716-1"></A
>Win32::GetTickCount </DT
><dd class="listitem"><p class="para">Returns the Win32 tick count, which is the number of milliseconds that have elasped since the system started:</P
><pre class="programlisting">use Win32;
$tick = Win32::GetTickCount();  
# tick has number of milliseconds since system start
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002717-0"></A
><a class="indexterm" name="appb-idx-1000002717-1"></A
>Win32::IsWinNT </DT
><dd class="listitem"><p class="para">Returns nonzero if the operating system is Windows NT:</P
><pre class="programlisting">use Win32;
$winnt = Win32::IsWinNT();  # true if running on Windows NT
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002718-0"></A
><a class="indexterm" name="appb-idx-1000002718-1"></A
>Win32::IsWin95 </DT
><dd class="listitem"><p class="para">Returns nonzero if the operating system is Windows 95:</P
><pre class="programlisting">use Win32;
$win95 = Win32::IsWin95(); # true if running on Windows 95
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002719-0"></A
><a class="indexterm" name="appb-idx-1000002719-1"></A
>Win32::ExpandEnvironmentStrings STRING </DT
><dd class="listitem"><p class="para">Takes the <code class="literal">STRING</CODE
> and builds a return string that has environment-variable strings replaced with their defined values:</P
><pre class="programlisting">use Win32;
$path = Win32::ExpandEnvironmentStrings('%PATH%'); # $path contains expanded PATH
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002720-0"></A
><a class="indexterm" name="appb-idx-1000002720-1"></A
>Win32::GetShortPathName LONGPATHNAME </DT
><dd class="listitem"><p class="para">Returns the short (8.3) pathname for <code class="literal">LONGPATHNAME</CODE
>:</P
><pre class="programlisting">use Win32;
$short = Win32::GetShortPathName('words.secret');   # $short now has 8.3 name (WORDS~1.SEC)
</PRE
></DD
><dt class="term"><a class="indexterm" name="appb-idx-1000002721-0"></A
><a class="indexterm" name="appb-idx-1000002721-1"></A
>Win32::GetNextAvailDrive </DT
><dd class="listitem"><p class="para">Returns a string in the form of <code class="literal">&lt;d&gt;:\</CODE
> where <code class="literal">&lt;d&gt;</CODE
> is the first available drive letter:</P
><pre class="programlisting">use Win32;
$drive = Win32::GetNextAvailDrive();  # $drive has first drive (e.g,. B:)</PRE
></DD
></DL
><pre class="programlisting"><a class="indexterm" name="appb-idx-1000004327-0"></A
><a class="indexterm" name="appb-idx-1000004327-1"></A
></PRE
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="sect1" href="appb_03.htm" title="B.3 CPAN: Beyond the Standard Library"><img src="../gifs/txtpreva.gif" alt="Previous: B.3 CPAN: Beyond the Standard Library" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Learning Perl on Win32 Systems"><img src="../gifs/txthome.gif" alt="Learning Perl on Win32 Systems" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="appendix" href="appc_01.htm" title="C. Networking Clients"><img src="../gifs/txtnexta.gif" alt="Next: C. Networking Clients" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">B.3 CPAN: Beyond the Standard Library</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">C. Networking Clients</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.html" title="The Perl CD Bookshelf">Library Home</A
> | <a href="../perlnut/index.htm" title="Perl in a Nutshell">Perl in a Nutshell</A
> | <a href="../learn/index.htm" title="Learning Perl">Learning Perl</A
> | <a href="index.htm" title="Learning Perl on Win32 Systems">Learning Perl on Win32</A
> | <a href="../prog/index.htm" title="Programming Perl">Programming Perl</A
> | <a href="../advprog/index.htm" title="Advanced Perl Programming">Advanced Perl Programming</A
> | <a href="../cookbook/index.htm" title="Perl Cookbook">Perl Cookbook</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
