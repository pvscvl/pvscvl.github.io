<html><head>
<title>[Chapter 9] 9.3 Network Information Service </TITLE>
<meta name="DC.title" content="TCP/IP Network Administration"><meta name="DC.creator" content="Craig Hunt"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T01:37:29Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-322-7" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch09_01.htm" title="9. Configuring Network Servers "><link rel="prev" href="ch09_02.htm#TCP2-CH-9-SECT-2.1" title="9.2 Line Printer Daemon "><link rel="next" href="ch09_04.htm" title="9.4 A BOOTP Server "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="TCP/IP Network Administration" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="TCP/IP Network Administration"><area shape="RECT" coords="467,0,514,18" href="../search/tsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch09_02.htm#TCP2-CH-9-SECT-2.1" title="9.2 Line Printer Daemon "><img src="../gifs/txtpreva.gif" alt="Previous: 9.2 Line Printer Daemon " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 9<br>Configuring Network Servers </FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch09_04.htm" title="9.4 A BOOTP Server "><img src="../gifs/txtnexta.gif" alt="Next: 9.4 A BOOTP Server " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="TCP2-CH-9-SECT-3">9.3 Network Information Service </A
></H2
><p class="para"><a class="indexterm" name="TCP2-CH-9-IX-NETWORK-INFORMATION-SERVICE-NIS"></A
>The <em class="emphasis">Network Information Service</EM
> (NIS)
[9]
is an administrative database that provides central control and
automatic dissemination of important administrative files. NIS converts
several standard UNIX files into databases that can be queried over the
network. The databases are called <em class="emphasis">NIS maps</EM
>. Some maps are created
from files that you're familiar with from system administration, such
as the password file (<em class="emphasis">/etc/passwd</EM
>) and the groups file<a class="indexterm" name="AUTOID-11509"></A
><a class="indexterm" name="AUTOID-11512"></A
><a class="indexterm" name="AUTOID-11514"></A
><a class="indexterm" name="AUTOID-11517"></A
>
(<em class="emphasis">/etc/group</EM
>).  Others are derived from files related to
network administration:</P
><blockquote class="footnote"><p class="para">[9] NIS was formerly called the &quot;Yellow Pages,&quot; or <em class="emphasis">yp</EM
>. Although the name
has changed, the abbreviation <em class="emphasis">yp</EM
> is still used.</P
></BLOCKQUOTE
><dl class="variablelist"><dt class="term"><em class="emphasis">/etc/ethers</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-11526"></A
><a class="indexterm" name="AUTOID-11529"></A
>Creates the NIS maps <em class="emphasis">ethers.byaddr</EM
> and <em class="emphasis">ethers.byname</EM
>. The
<em class="emphasis">/etc/ethers</EM
> file is used by RARP (see <a class="xref" href="ch02_01.htm" title="Delivering the Data">Chapter 2, <cite class="chapter">Delivering the Data</CITE
></A
>).<a class="indexterm" name="AUTOID-11535"></A
></P
></DD
><dt class="term"><em class="emphasis">/etc/hosts</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-11543"></A
><a class="indexterm" name="AUTOID-11546"></A
>Produces the maps <em class="emphasis">hosts.byname</EM
> and <em class="emphasis">hosts.byaddr</EM
>
(see <a class="xref" href="ch03_01.htm" title="Network Services">Chapter 3, <cite class="chapter">Network Services</CITE
></A
>).</P
></DD
><dt class="term"><em class="emphasis">/etc/networks</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-11556"></A
><a class="indexterm" name="AUTOID-11559"></A
>Produces the maps <em class="emphasis">networks.byname</EM
> and <em class="emphasis">networks.byaddr</EM
>
(see <a class="xref" href="ch03_01.htm" title="Network Services">Chapter 3</A
>).</P
></DD
><dt class="term"><em class="emphasis">/etc/protocols</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-11569"></A
><a class="indexterm" name="AUTOID-11572"></A
>Creates the two maps <em class="emphasis">protocols.byname</EM
> and <em class="emphasis">protocols.byaddr</EM
>
(see <a class="xref" href="ch02_01.htm" title="Delivering the Data">Chapter 2</A
>).</P
></DD
><dt class="term"><em class="emphasis">/etc/services</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-11582"></A
><a class="indexterm" name="AUTOID-11585"></A
>Produces a single map called <em class="emphasis">services.byname</EM
> (see <a class="xref" href="ch02_01.htm" title="Delivering the Data">Chapter 2</A
>).</P
></DD
><dt class="term"><em class="emphasis">/etc/aliases</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-11594"></A
><a class="indexterm" name="AUTOID-11597"></A
>Defines electronic mail aliases and produces the maps
<em class="emphasis">mail.aliases</EM
> and <em class="emphasis">mail.byaddr</EM
> (see <a class="xref" href="ch10_01.htm" title="sendmail ">Chapter 10</A
>).</P
></DD
></DL
><p class="para">Check the maps available on your server with the <b class="emphasis.bold">ypcat -x</B
><a class="indexterm" name="AUTOID-11604"></A
>
command. This command produced the same map list on both our Solaris and
Linux sample systems. Your server may display a longer list. Here is
the list from my Solaris system:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>ypcat -x</B
></CODE
>
Use &quot;passwd&quot;    for map &quot;passwd.byname&quot;
Use &quot;group&quot;     for map &quot;group.byname&quot;
Use &quot;networks&quot;  for map &quot;networks.byaddr&quot;
Use &quot;hosts&quot;     for map &quot;hosts.byname&quot;
Use &quot;protocols&quot; for map &quot;protocols.bynumber&quot;
Use &quot;services&quot;  for map &quot;services.byname&quot;
Use &quot;aliases&quot;   for map &quot;mail.aliases&quot;
Use &quot;ethers&quot;    for map &quot;ethers.byname&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">The advantage of using NIS is that these important administrative files
can be maintained on a central server, and yet completely accessible
to every workstation on the network. All of the maps are stored on a
master server that runs the NIS server process <b class="emphasis.bold">ypserv</B
>. The maps<a class="indexterm" name="AUTOID-11612"></A
>
are queried remotely by client systems. Clients run <b class="emphasis.bold">ypbind</B
> to<a class="indexterm" name="AUTOID-11615"></A
>
locate the server.</P
><p class="para">The NIS server and its clients are a <em class="emphasis">NIS domain</EM
>&nbsp;- a term NIS
shares with DNS. The NIS domain is identified by a NIS domain name.<a class="indexterm" name="AUTOID-11619"></A
>
The only requirement for the name is that different NIS domains accessible
through the same local network must have different names. Although NIS
domains and DNS domains are distinct entities, Sun recommends using the
DNS domain name as the NIS domain name to simplify administration and
reduce confusion.</P
><p class="para">NIS uses its domain name to create a directory within <em class="emphasis">/var/yp</EM
> where
the NIS maps are stored. For example, the DNS domain of our imaginary
network is <em class="emphasis">nuts.com</EM
>, so we also use this as our NIS domain name.
NIS creates a directory named <em class="emphasis">/var/yp/nuts.com</EM
> and stores the
NIS maps in it.</P
><p class="para">While the NIS protocols and commands were originally defined by Sun<a class="indexterm" name="AUTOID-11628"></A
>
Microsystems, the service is now widely implemented. To illustrate
this, the majority of examples in this section come from Linux&nbsp;- not
from Solaris. The syntax of the commands is very similar from system
to system.</P
><p class="para"><a class="indexterm" name="AUTOID-11631"></A
>The command <b class="emphasis.bold">domainname</B
> checks or sets the NIS domain name. The<a class="indexterm" name="AUTOID-11634"></A
>
superuser can make <em class="emphasis">nuts.com</EM
> the NIS domain name by entering:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>domainname nuts.com</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The NIS domain name is normally configured at startup by placing
the <b class="emphasis.bold">domainname</B
> command in one of the startup files. On Linux
and Solaris systems, the value for the NIS domain name is taken from<a class="indexterm" name="AUTOID-11642"></A
><a class="indexterm" name="AUTOID-11645"></A
>
the <em class="emphasis">/etc/defaultdomain</EM
> file. This file is used as input to a
<b class="emphasis.bold">domainname</B
> command in one of the startup files. As shown below,
<em class="emphasis">defaultdomain</EM
> contains only the name of the NIS domain.</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>cat /etc/defaultdomain</B
></CODE
>
nuts.com</PRE
></BLOCKQUOTE
></P
><p class="para">Initialize the NIS server and build the initial maps with <b class="emphasis.bold">make</B
>.
The <em class="emphasis">/var/yp/Makefile</EM
> contains the instructions needed to build<a class="indexterm" name="AUTOID-11656"></A
>
the maps. As noted above, it creates a directory using the NIS domain
name. The Makefile reads the files in the <em class="emphasis">/etc</EM
> directory and places
maps created from them in the new directory. To initialize a Linux system
as a NIS server:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>domainname nuts.com</B
></CODE
>
# <code class="userinput"><b>cd /var/yp</B
></CODE
> 
# <code class="userinput"><b>make</B
></CODE
>
make[1]: Entering directory '/var/yp/nuts.com'
Updating hosts.byname...
Updating hosts.byaddr...
Updating networks.byaddr...
Updating networks.byname...
Updating protocols.bynumber...
Updating protocols.byname...
Updating rpc.byname...
Updating rpc.bynumber...
Updating services.byname...
Updating passwd.byname...
Updating passwd.byuid...
Updating group.byname...
Updating group.bygid...
Updating netid.byname...
make[1]: Leaving directory '/var/yp/nuts.com'</PRE
></BLOCKQUOTE
></P
><p class="para">After initializing the maps, start the NIS server process
<b class="emphasis.bold">ypserv</B
> and the NIS binder process <b class="emphasis.bold">ypbind</B
>.</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>ypserv</B
></CODE
>
# <code class="userinput"><b>ypbind</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">Our system is now running as both a NIS server and a NIS client. A quick<a class="indexterm" name="AUTOID-11673"></A
>
test with <b class="emphasis.bold">ypwhich</B
> shows that we are bound to the correct server.<a class="indexterm" name="AUTOID-11676"></A
><a class="indexterm" name="AUTOID-11678"></A
>
<b class="emphasis.bold">ypcat</B
> or <b class="emphasis.bold">ypmatch</B
> test that we can retrieve data from the
server.</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>ypwhich</B
></CODE
>
localhost
# <code class="userinput"><b>ypcat hosts</B
></CODE
>
172.16.55.105            cow cow.nuts.com
172.16.55.106            pig pig.nuts.com
172.16.26.36             island.nuts.com island
127.0.0.1                localhost</PRE
></BLOCKQUOTE
></P
><p class="para">The clients need only to define the correct domain name and to run the
binder software <b class="emphasis.bold">ypbind</B
>:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>domainname nuts.com</B
></CODE
> 
# <code class="userinput"><b>ypbind</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">Most NIS clients use <b class="emphasis.bold">ypbind</B
> to locate the server. Using the
NIS domain name, <b class="emphasis.bold">ypbind</B
> broadcasts a request for a server for
that domain. The first  server that responds is the server to which the
client &quot;binds.&quot;  The theory is that the server that responds quickest is
the server with the least workload. Generally this works well. However,
it is possible for the client to bind to an inappropriate system, e.g., a
system that was accidentally configured to run <b class="emphasis.bold">ypserv</B
> or one that
was maliciously configured to be a false server. Because of this
possibility, some systems allow you to explicitly configure the server
to which the client will bind. Linux provides the<a class="indexterm" name="AUTOID-11696"></A
><a class="indexterm" name="AUTOID-11699"></A
>
<em class="emphasis">/etc/yp.conf</EM
> file for this purpose. The syntax of the entries in
different versions of this file varies, so see your system documentation
before attempting to use it.</P
><p class="para">Place the NIS domain name in the <em class="emphasis">/etc/defaultdomain</EM
> file and the<a class="indexterm" name="AUTOID-11704"></A
><a class="indexterm" name="AUTOID-11707"></A
>
<b class="emphasis.bold">ypserv</B
> and <b class="emphasis.bold">ypbind</B
> commands in a startup file so that the
NIS setup will survive the boot. These commands may already be in your
startup file. On our Linux client all we needed to do was uncomment the
appropriate lines in <em class="emphasis">/etc/rc.d/rc.inet2</EM
>. On the Linux NIS server
it was a little more complicated. In addition to uncommenting the lines
for <b class="emphasis.bold">domainname</B
> and <b class="emphasis.bold">ypbind</B
> we added lines to start <b class="emphasis.bold">ypserv</B
>.</P
><p class="para">NIS is a possible alternative to DNS but most systems use both NIS and
DNS. Hostnames can be converted to IP addresses by DNS, NIS, and the host
file. The order in which the various sources are queried is defined in
the <em class="emphasis">nsswitch.conf</EM
> file.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="TCP2-CH-9-SECT-3.0.1">9.3.1 The nsswitch.conf file </A
></H3
><p class="para">The Name Service Switch file (<em class="emphasis">nsswitch.conf</EM
>) defines the order in<a class="indexterm" name="AUTOID-11721"></A
><a class="indexterm" name="AUTOID-11723"></A
>
which the sources of information are searched. Despite its name, it
applies to more than just name service. All of the databases handled by
NIS are covered by the <em class="emphasis">nsswitch.conf</EM
> file, as shown in this example:</P
><p class="para"><blockquote class="screen"><pre class="screen">hosts:      dns  nis  files
networks:   nis  [NOTFOUND=return]  files
services:   nis  files
protocols:  nis  files</PRE
></BLOCKQUOTE
></P
><p class="para">&#13;The first entry in the file says that a hostname lookup is first
passed to DNS for resolution; if DNS fails to find a match, the lookup
is then passed to NIS and finally looked up in the <em class="emphasis">hosts</EM
> file.
The second entry says that network names are looked up through NIS.
The <code class="literal">[NOTFOUND=return]</CODE
> string says to use the <em class="emphasis">networks</EM
> file only if
NIS fails to respond, that is, if NIS is down. In this case, if NIS answers
that it cannot find the requested network name, terminate the search.
The last two entries search for services port and protocol numbers
through NIS and then in the files in the <em class="emphasis">/etc</EM
> directory.<a class="indexterm" name="AUTOID-11733"></A
></P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="TCP2-CH-9-SECT-3.0.2">9.3.2 NIS+ </A
></H3
><p class="para"><a class="indexterm" name="TCP2-CH-9-IX-NIS"></A
>Before leaving the topic of NIS, we should say a word about NIS+.  It
is just a short discussion, because I do not use NIS+ and I do not
know much about it.</P
><p class="para"><a class="indexterm" name="AUTOID-11740"></A
>NIS+ replaces NIS on Sun systems. It is not a new version of NIS, but
a completely new software product that provides all of the functionality
of NIS and some new features. The new features are:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">Improved security. NIS does not authenticate servers, as we noted in the
<b class="emphasis.bold">ypbind</B
> discussion above, or clients. NIS+ provides authentication<a class="indexterm" name="AUTOID-11747"></A
><a class="indexterm" name="AUTOID-11749"></A
>
of users with a secure DES-encrypted authentication scheme. NIS+<a class="indexterm" name="AUTOID-11751"></A
>
also provides various levels of access so that different users have
authority to look at different levels of data. NIS can only provide
the same access to everyone in the NIS domain.</P
></LI
><li class="listitem"><p class="para">A hierarchical, decentralized architecture. NIS+, like DNS, is a
distributed, hierarchical database system.<a class="indexterm" name="AUTOID-11756"></A
>
This allows for a very large
namespace. It also allows distributed management of the information
structure while maintaining consistent access to the data. NIS is a
flat structure. All information about a NIS domain comes from a single
master server and NIS domains are not interrelated.</P
></LI
><li class="listitem"><p class="para">Enhanced data structures. NIS converts ASCII files into simple keyed
files that the NIS+ documentation calls &quot;two-column maps.&quot;  NIS+ builds
multicolumn database <em class="emphasis">tables</EM
>. Tables can be searched in a
variety of ways to retrieve information about an entry. In
addition, NIS+ tables can be linked together to provide related
information about an entry.</P
></LI
></UL
><p class="para">Clearly NIS+ has some excellent new features and advantages over NIS.
So why don't I use it? Good question! The hierarchical architecture
and enhanced data structures are important if you have a very large
network and lots of data in your namespace. However, many sites
evolved using NIS on local subnets and do not see the need to move the
entire enterprise under NIS+.  Improved security seems like a real
winner, but sites with low security requirements don't see the need for
additional security and sites with high security requirements may
already be behind a firewall<a class="indexterm" name="AUTOID-11763"></A
>
that blocks external NIS queries.  Additionally, NIS+ is not available
for as many operating systems as NIS.

Taken together, these reasons have slowed the move to NIS+.</P
><p class="para">To learn more about NIS+ and how to install it on your system, read the
<em class="emphasis">NIS+ Transition Guide</EM
>, the <em class="emphasis">Name Service Configuration Guide</EM
>,
and the <em class="emphasis">Name Service Administration Guide</EM
>. All of these are
available from Sun as part of the Solaris System and Network
Administration manual set.<a class="indexterm" name="AUTOID-11769"></A
></P
><p class="para">NIS and NIS+ provide a wide range of system configuration information
to their clients. However, they cannot provide all of the information
needed to configure a TCP/IP system. In the next two sections, we look
at configuration servers that can do the entire job.&#13;</P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch09_02.htm#TCP2-CH-9-SECT-2.1" title="9.2 Line Printer Daemon "><img src="../gifs/txtpreva.gif" alt="Previous: 9.2 Line Printer Daemon " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="TCP/IP Network Administration"><img src="../gifs/txthome.gif" alt="TCP/IP Network Administration" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch09_04.htm" title="9.4 A BOOTP Server "><img src="../gifs/txtnexta.gif" alt="Next: 9.4 A BOOTP Server " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">9.2 Line Printer Daemon </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">9.4 A BOOTP Server </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
