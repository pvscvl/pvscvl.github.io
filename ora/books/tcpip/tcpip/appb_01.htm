<html><head>
<title>[Appendix B] A gated Reference</TITLE>
<meta name="DC.title" content="TCP/IP Network Administration"><meta name="DC.creator" content="Craig Hunt"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T01:42:45Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-322-7" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="index.htm" title="TCP/IP Network Administration"><link rel="prev" href="appa_03.htm" title="A.3 chat"><link rel="next" href="appb_02.htm" title="B.2 The gated Configuration Language"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="TCP/IP Network Administration" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="TCP/IP Network Administration"><area shape="RECT" coords="467,0,514,18" href="../search/tsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appa_03.htm" title="A.3 chat"><img src="../gifs/txtpreva.gif" alt="Previous: A.3 chat" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Appendix B</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="appb_02.htm" title="B.2 The gated Configuration Language"><img src="../gifs/txtnexta.gif" alt="Next: B.2 The gated Configuration Language" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="APPENDIX"><h1 class="appendix"><a class="title" name="TCP2-AP-2">B. A gated Reference</A
></H1
><div class="htmltoc"><p><b>Contents:</B
><br><a class="SECT1" href="#TCP2-AP-2-SECT-1" title="B.1 The gated Command">The gated Command</A
><br><a class="SECT1" href="appb_02.htm" title="B.2 The gated Configuration Language">The gated Configuration Language</A
><br><a class="SECT1" href="appb_03.htm" title="B.3 Directive Statements">Directive Statements</A
><br><a class="SECT1" href="appb_04.htm" title="B.4 Trace Statements">Trace Statements</A
><br><a class="SECT1" href="appb_05.htm" title="B.5 Options Statements">Options Statements</A
><br><a class="SECT1" href="appb_06.htm" title="B.6 Interface Statements">Interface Statements</A
><br><a class="SECT1" href="appb_07.htm" title="B.7 Definition Statements">Definition Statements</A
><br><a class="SECT1" href="appb_08.htm#TCP2-AP-2-SECT-8.4" title="B.8 Protocol Statements">Protocol Statements</A
><br><a class="SECT1" href="appb_09.htm" title="B.9 static Statements">static Statements</A
><br><a class="SECT1" href="appb_10.htm#TCP2-AP-2-SECT-10.1" title="B.10 Control Statements">Control Statements</A
><br><a class="SECT1" href="appb_11.htm" title="B.11 The Aggregate Statements">The Aggregate Statements</A
></P
><p></P
></DIV
><p class="para"><a class="indexterm" name="TCP2-AP-2-IX-GATEWAY-ROUTING-DAEMON-GATED-TOOLS-REFERENCE"></A
>
This appendix covers the syntax of the <b class="emphasis.bold">gated</B
> command and the
<b class="emphasis.bold">gated</B
> configuration language.  As a reference to the <b class="emphasis.bold">gated</B
>
configuration language, this appendix stands on its own.  But to fully
understand how to configure <b class="emphasis.bold">gated</B
>, use this reference in
conjunction with the sample configuration files in <a class="xref" href="ch07_01.htm" title="Configuring Routing ">Chapter 7, <cite class="chapter">Configuring Routing </CITE
></A
>.</P
><p class="para"><b class="emphasis.bold">gated</B
> is constantly being improved. As it is upgraded, the
command language changes. Refer to the latest manpages for the most
recent information about <b class="emphasis.bold">gated</B
>.</P
><div class="sect1"><h2 class="sect1"><a class="title" name="TCP2-AP-2-SECT-1">B.1 The gated Command</A
></H2
><p class="para"><a class="indexterm" name="TCP2-AP-2-IX-GATEWAY-ROUTING-DAEMON-GATED-COMMAND"></A
>The syntax of the <b class="emphasis.bold">gated</B
> command is:</P
><p class="para"><b class="emphasis.bold">gated</B
> [<b class="emphasis.bold">-c</B
>] [<b class="emphasis.bold">-C</B
>] [<b class="emphasis.bold">-n</B
>] [<b class="emphasis.bold">-N</B
>] [<b class="emphasis.bold">-t</B
>
<code class="replaceable"><i>trace_options</I
></CODE
>] [<b class="emphasis.bold">-f</B
><code class="replaceable"><i> config_file</I
></CODE
>] [<code class="replaceable"><i>trace_file</I
></CODE
>]</P
><p class="para">The <b class="emphasis.bold">-c</B
> and <b class="emphasis.bold">-n</B
> command-line options debug the routing
configuration file without impacting the network or the kernel routing
table. Frequently, these debugging 
options are used with a test configuration
identified by the <b class="emphasis.bold">-f</B
> <code class="replaceable"><i>config_file</I
></CODE
> option:</P
><dl class="variablelist"><dt class="term"><b class="emphasis.bold">-c</B
></DT
><dd class="listitem"><p class="para">Tells <b class="emphasis.bold">gated</B
> to read the configuration file and check for syntax
errors. When
<b class="emphasis.bold">gated</B
> finishes reading the configuration file, it produces a
snapshot of its status and then terminates. It writes the snapshot to
<em class="emphasis">/usr/tmp/gated_dump</EM
>. Running <b class="emphasis.bold">gated</B
> with the <b class="emphasis.bold">-c</B
>
option does not require superuser privilege,<a class="indexterm" name="AUTOID-20744"></A
>
and
it is not necessary to
terminate the active <b class="emphasis.bold">gated</B
> process.</P
></DD
><dt class="term"><b class="emphasis.bold">-C</B
></DT
><dd class="listitem"><p class="para">Checks the configuration file for syntax errors. <b class="emphasis.bold">gated</B
> exits
with a status 1 if there are errors and 0 if there are none. Because
this provides exit status, it is useful for script files.</P
></DD
><dt class="term"><b class="emphasis.bold">-n</B
></DT
><dd class="listitem"><p class="para">Tells <b class="emphasis.bold">gated</B
> not to update the kernel routing table. This is used
to test the routing configuration with real routing data without
interfering with system operation.</P
></DD
><dt class="term"><b class="emphasis.bold">-f</B
> <code class="replaceable"><i>config_file</I
></CODE
></DT
><dd class="listitem"><p class="para">Tells <b class="emphasis.bold">gated</B
> to read the configuration from
<code class="replaceable"><i>config_file</I
></CODE
> instead of from the default configuration
file, <em class="emphasis">/etc/gated.conf</EM
>.  Used in conjunction with the <b class="emphasis.bold">-c</B
>
option, <b class="emphasis.bold">-f</B
> checks a new configuration without interfering with
the currently running <b class="emphasis.bold">gated</B
> configuration.</P
></DD
></DL
><p class="para">The <b class="emphasis.bold">-N</B
> command-line option prevents <b class="emphasis.bold">gated</B
> from running in
background mode as a daemon. This option is used when <b class="emphasis.bold">gated</B
> is
started from <em class="emphasis">inittab</EM
>. By default, <b class="emphasis.bold">gated</B
> runs as a daemon.</P
><p class="para">The command-line arguments <code class="replaceable"><i>trace_options</I
></CODE
> and
<code class="replaceable"><i>trace_file</I
></CODE
> are used for protocol tracing.<a class="indexterm" name="AUTOID-20780"></A
>
The <code class="replaceable"><i>trace_file</I
></CODE
> argument names the file to which the trace
output is written. If a file is not specified, the trace is written to
the standard output. Tracing usually produces a large amount of
output.</P
><p class="para">The command-line options used for tracing are:</P
><dl class="variablelist"><dt class="term"><b class="emphasis.bold">-t</B
></DT
><dd class="listitem"><p class="para">This option turns on tracing. If <b class="emphasis.bold">-t</B
> is specified with no
<code class="replaceable"><i>trace_options</I
></CODE
>, <b class="emphasis.bold">gated</B
> defaults to <b class="emphasis.bold">general</B
> tracing,
which traces normal protocol interactions and routing table changes.
<b class="emphasis.bold">gated</B
> always logs protocol errors even if no tracing is specified.
You can define several different <code class="replaceable"><i>trace_options</I
></CODE
>, all of which
are described later in this appendix. A few <code class="replaceable"><i>trace_options</I
></CODE
>
(<b class="emphasis.bold">detail</B
>, <b class="emphasis.bold">send</B
>, <b class="emphasis.bold">recv</B
>) cannot be specifed on the
<b class="emphasis.bold">gated</B
> command line. Two others are most useful when they are
defined on the command line:
<dl class="variablelist"><dt class="term"><b class="emphasis.bold">symbols</B
></DT
><dd class="listitem"><p class="para">Traces the symbols read from the kernel, which is primarily of interest
to developers debugging the interaction of <b class="emphasis.bold">gated</B
> and the kernel.</P
></DD
><dt class="term"><b class="emphasis.bold">iflist</B
></DT
><dd class="listitem"><p class="para">Traces the list of interfaces read from the kernel. Use this to determine
what interfaces are detected by the kernel interface scan.</P
></DD
></DL
>&#13;</P
></DD
></DL
><p class="para">The advantage of placing a trace option on the command line is
that it can trace activities that happen before the configuration
file is processed. For the two options listed above, this is an
essential advantage. For other options it is not very important.
Most trace options are specified in the configuration file. See the
<b class="emphasis.bold">traceoptions</B
> command later in this appendix for more details.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="TCP2-AP-2-SECT-1.1">B.1.1 Signal Processing</A
></H3
><p class="para"><a class="indexterm" name="TCP2-AP-2-IX-SIGNAL-PROCESSING-IN-GATED"></A
><b class="emphasis.bold">gated</B
> processes the following signals:</P
><dl class="variablelist"><dt class="term">SIGHUP</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-20828"></A
>Tells <b class="emphasis.bold">gated</B
> to reread the configuration file. The new
configuration replaces the one that <b class="emphasis.bold">gated</B
> is currently running.
SIGHUP loads the new configuration file without interrupting
<b class="emphasis.bold">gated</B
> service. SIGHUP is available for quick configuration
changes.
At most sites, the routing configuration changes infrequently. The few
times you need to change to a new configuration, terminate <b class="emphasis.bold">gated</B
>
and rerun it with the new configuration. This is a more accurate test
of how things will run at the next boot.</P
></DD
><dt class="term">SIGINT</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-20838"></A
>Tells <b class="emphasis.bold">gated</B
> to snapshot its current state to the file
<em class="emphasis">/usr/tmp/gated_dump</EM
>.<a class="indexterm" name="AUTOID-20842"></A
><a class="indexterm" name="AUTOID-20845"></A
></P
></DD
><dt class="term">SIGTERM</DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-20851"></A
>Tells <b class="emphasis.bold">gated</B
> to shut down gracefully. All protocols are shut down
following the rules of that protocol. For example, EGP sends a CEASE
message and waits for it to be confirmed. SIGTERM removes from the
kernel routing table all routes learned via the exterior routing
protocols. If you need to preserve those routes while <b class="emphasis.bold">gated</B
> is
out of operation, use SIGKILL.</P
></DD
><dt class="term">SIGKILL</DT
><dd class="listitem"><p class="para">Tells <b class="emphasis.bold">gated</B
> to terminate immediately and dump core. Routes are
not removed from the routing table, and no graceful shutdown is
attempted.</P
></DD
><dt class="term">SIGUSR1</DT
><dd class="listitem"><p class="para">Tells <b class="emphasis.bold">gated</B
> to toggle tracing. If no trace flags are set, SIGUSR1
has no effect. But if tracing is enabled, the first SIGUSR1 causes
<b class="emphasis.bold">gated</B
> to toggle off tracing and to close the trace file. The next
SIGUSR1 turns tracing back on and opens the trace file. When the trace
file is closed, it can be moved or removed without interfering with the
operation of <b class="emphasis.bold">gated</B
>. Use this to periodically empty out the trace
file to prevent it from becoming too large.</P
></DD
><dt class="term">SIGUSR2</DT
><dd class="listitem"><p class="para">Tell <b class="emphasis.bold">gated</B
> to check for changes in the status of the network
interfaces.</P
></DD
></DL
><p class="para">The following is an example of <b class="emphasis.bold">gated</B
> signal handling. First, the
SIGUSR1 signal is passed to the <b class="emphasis.bold">gated</B
> process using the process
ID obtained from the <em class="emphasis">gated.pid</EM
> file (<em class="emphasis">/var/run/gated.pid</EM
> in
this case).</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>kill -USR1 `cat /var/run/gated.pid`</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">Next, the old trace file (<em class="emphasis">/usr/tmp/gated.log</EM
> in this case) is
removed, and <b class="emphasis.bold">gated</B
> is passed another SIGUSR1 signal.</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>rm /usr/tmp/gated.log</B
></CODE
>
# <code class="userinput"><b>kill -USR1 `cat /etc/gated.pid`</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">After receiving the second signal, <b class="emphasis.bold">gated</B
> opens a fresh trace file
(still named <em class="emphasis">/usr/tmp/gated.log</EM
>). An <b class="emphasis.bold">ls</B
> shows that the new
file has been created.</P
><p class="para"><blockquote class="screen"><pre class="screen"># <code class="userinput"><b>ls -l /usr/tmp/gated.log</B
></CODE
>
-rw-rw-r--  1 root          105 Jul  6 16:41 /usr/tmp/gated.log</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-20895"></A
><a class="indexterm" name="AUTOID-20896"></A
><a class="indexterm" name="AUTOID-20897"></A
></P
></DIV
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appa_03.htm" title="A.3 chat"><img src="../gifs/txtpreva.gif" alt="Previous: A.3 chat" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="TCP/IP Network Administration"><img src="../gifs/txthome.gif" alt="TCP/IP Network Administration" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="appb_02.htm" title="B.2 The gated Configuration Language"><img src="../gifs/txtnexta.gif" alt="Next: B.2 The gated Configuration Language" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">A.3 chat</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">B.2 The gated Configuration Language</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
