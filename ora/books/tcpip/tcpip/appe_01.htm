<html><head>
<title>[Appendix E] A sendmail Reference</TITLE>
<meta name="DC.title" content="TCP/IP Network Administration"><meta name="DC.creator" content="Craig Hunt"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T01:44:01Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-322-7" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="index.htm" title="TCP/IP Network Administration"><link rel="prev" href="appd_03.htm" title="D.3 The dhcpd.conf Configuration File"><link rel="next" href="appe_02.htm" title="E.2 The sendmail Command"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="TCP/IP Network Administration" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="TCP/IP Network Administration"><area shape="RECT" coords="467,0,514,18" href="../search/tsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appd_03.htm" title="D.3 The dhcpd.conf Configuration File"><img src="../gifs/txtpreva.gif" alt="Previous: D.3 The dhcpd.conf Configuration File" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Appendix E</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="appe_02.htm" title="E.2 The sendmail Command"><img src="../gifs/txtnexta.gif" alt="Next: E.2 The sendmail Command" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="APPENDIX"><h1 class="appendix"><a class="title" name="TCP2-AP-5">E. A sendmail Reference</A
></H1
><div class="htmltoc"><p><b>Contents:</B
><br><a class="SECT1" href="#TCP2-AP-5-SECT-1" title="E.1 Compiling sendmail">Compiling sendmail</A
><br><a class="SECT1" href="appe_02.htm" title="E.2 The sendmail Command">The sendmail Command</A
><br><a class="SECT1" href="appe_03.htm#TCP2-AP-5-SECT-3.5" title="E.3 m4 sendmail Macros">m4 sendmail Macros</A
><br><a class="SECT1" href="appe_04.htm#TCP2-AP-5-SECT-4.2" title="E.4 More sendmail.cf">More sendmail.cf</A
><br><a class="SECT1" href="appe_05.htm" title="E.5 Sample Configurations">Sample Configurations</A
></P
><p></P
></DIV
><p class="para"><a class="indexterm" name="TCP2-AP-5-IX-SENDMAIL-TOOLS-REFERENCE"></A
>This appendix provides details of the syntax of the <b class="emphasis.bold">sendmail</B
>
command, of the <em class="emphasis">sendmail.cf</EM
> file, and of the <b class="emphasis.bold">m4</B
> macros
that can be used to build that file. It also contains excerpts of the
sample <em class="emphasis">sendmail.cf</EM
> file described in <a class="xref" href="ch10_01.htm" title="sendmail ">Chapter 10, <cite class="chapter">sendmail </CITE
></A
>.  It
describes where to obtain the latest source code for sendmail and how
to compile it. This appendix is a reference, not a tutorial.  Refer to
<a class="xref" href="ch10_01.htm" title="sendmail ">Chapter 10</A
> for a tutorial on sendmail configuration.</P
><p class="para">We start the appendix with information on locating, downloading, and
compiling the latest version of sendmail.</P
><div class="sect1"><h2 class="sect1"><a class="title" name="TCP2-AP-5-SECT-1">E.1 Compiling sendmail</A
></H2
><p class="para"><a class="indexterm" name="TCP2-AP-5-IX-SENDMAIL-COMPILING"></A
>The source code for sendmail is available via anonymous ftp from
<em class="emphasis">ftp.sendmail.org</EM
>, where it is stored in the <em class="emphasis">pub/sendmail</EM
>
directory. When you change to that directory, an information message tells you about the latest version of sendmail.
sendmail is updated constantly.<a class="indexterm" name="AUTOID-26016"></A
>
The following examples are based on
sendmail V8.8.5. Remember that things will change for future releases.
Always read the README files and installation documents that come with
new software before beginning an installation.</P
><p class="para">Download the compressed sendmail <b class="emphasis.bold">tar</B
> file as a binary file.
Uncompress and untar it. Change to the <em class="emphasis">src</EM
> directory in the sendmail
directory created by the <b class="emphasis.bold">tar</B
> file and enter:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="userinput"><b>sh makesendmail</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">According to the documentation, this is all you need to do on most
systems.  This certainly works on BSD 4.4-based systems. However,
it does not work on every system. The two systems used for examples in
this book, Solaris 2.5.1

and Slackware 96 Linux, both have problems. The problem with Solaris
is that it does not have a C compiler. Before even attempting to
install sendmail you must download and install the GNU C compiler,
<b class="emphasis.bold">gcc</B
>. The problem with Slackware is more subtle.  Different
versions of Linux place files in different locations in the
filesystem. Let's look at the details of installing sendmail V8.8.5 on
a Slackware 96 system.</P
><p class="para">First we download the <b class="emphasis.bold">tar</B
> file and put the sendmail source files
into the <em class="emphasis">/usr/src</EM
> directory where Slackware 96 keeps various
source files:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <b class="emphasis.bold">ftp ftp.sendmail.org</B
>
Connected to kohler.CS.Berkeley.EDU.
220 kohler.CS.Berkeley.EDU FTP server ready.
Name (ftp.cs.berkeley.edu:craig): <b class="emphasis.bold">anonymous</B
>
331 Guest login ok, send your complete email address as password.
Password: <b class="emphasis.bold">craig@nuts.com</B
>
230 Guest login ok, access restrictions apply.
ftp&gt; <b class="emphasis.bold">cd pub/sendmail</B
>
250 CWD command successful.
ftp&gt; <b class="emphasis.bold">binary</B
>
200 Type set to I.
ftp&gt; <b class="emphasis.bold">get sendmail.8.8.5.tar.gz</B
>
200 PORT command successful.
150 Opening BINARY mode data connection.
226 Transfer complete.
992815 bytes received in 187 secs (5.2 Kbytes/sec)
ftp&gt; <b class="emphasis.bold">quit</B
>
221 Goodbye.
# <b class="emphasis.bold">gunzip sendmail.8.8.5.tar.gz</B
>
# <b class="emphasis.bold">cp sendmail.8.8.5.tar /usr/src</B
>
# <b class="emphasis.bold">cd /usr/src</B
>
# <b class="emphasis.bold">tar -xvf sendmail.8.8.5.tar</B
></PRE
></BLOCKQUOTE
></P
><p class="para">Next we run <b class="emphasis.bold">makesendmail</B
>.</P
><p class="para"><blockquote class="screen"><pre class="screen"># <b class="emphasis.bold">cd sendmail-8.8.5/src</B
>
# <b class="emphasis.bold">./makesendmail</B
>
Configuration: os=Linux, rel=2.0.0, rbase=2, rroot=2.0, arch=i586, sfx=
Creating obj.Linux.2.0.0.i586 using Makefile.Linux
Making dependencies in obj.Linux.2.0.0.i586
make: Nothing to be done for `depend'.
Making in obj.Linux.2.0.0.i586
cc -I. -O -I/usr/local/include -DNDBM -DNEWDB    -c alias.c -o alias.o
.<br>.<br>.<br>
cc -I. -O -I/usr/local/include -DNDBM -DNEWDB    -c map.c -o map.o
map.c:42: ndbm.h: No such file or directory
make: * [map.o] Error 1</PRE
></BLOCKQUOTE
></P
><p class="para"><b class="emphasis.bold">makesendmail</B
> recognizes this is a Linux system, but the Makefile
it selects is obviously not correct for the Slackware 96 variant
of Linux. All of the Makefiles that <b class="emphasis.bold">makesendmail</B
> uses are
located in the <em class="emphasis">src/Makefiles</EM
> subdirectory. Two of those files,
<em class="emphasis">Makefile.Linux</EM
> and <em class="emphasis">Makefile.Linux.ppc</EM
>, are designed for Linux.
The <em class="emphasis">Makefile.Linux.ppc</EM
> is a

possible solution to our problem.  Move it to <em class="emphasis">Makefile.Linux</EM
> and
rerun <b class="emphasis.bold">makesendmail</B
>:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <b class="emphasis.bold">cd Makefiles</B
>
# <b class="emphasis.bold">mv Makefile.Linux Makefile.Linux.orig</B
>
# <b class="emphasis.bold">cp Makefile.Linux.ppc Makefile.Linux</B
>
# <b class="emphasis.bold">cd ..</B
>
# <b class="emphasis.bold">touch *</B
>
# <b class="emphasis.bold">./makesendmail</B
>
Configuration: os=Linux, rel=2.0.0, rbase=2, rroot=2.0, arch=i586, sfx=
Making in obj.Linux.2.0.0.i586
cc -I. -O -I/usr/local/include -DNEWDB    -c alias.c -o alias.o
cc -I. -O -I/usr/local/include -DNEWDB    -c version.c -o version.o
cc -o sendmail alias.o ... version.o  -L/usr/local/lib -ldb
groff -Tascii -mandoc aliases.5 &gt; aliases.0
groff -Tascii -mandoc sendmail.8 &gt; sendmail.0</PRE
></BLOCKQUOTE
></P
><p class="para">That's more like it! sendmail compiled and linked without problems.</P
><p class="para">A quick look at the differences in the two Makefiles shows that only
four lines have been changed. Of those four lines, only two, DBMDEF
and LIBS, were actually needed to successfully compile sendmail.
Possible values for the database definition (DBMDEF) are shown in 
<a class="xref" href="#TCP2-AP-5-TAB-0" title="DBMDEF Database Arguments">Table 13.4</A
></P
><table class="table"><caption class="table"><a class="title" name="TCP2-AP-5-TAB-0">Table E.1: DBMDEF Database Arguments</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Argument</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Function</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">NDBM</TD
><td class="entry" rowspan="1" colspan="1">The dbm format from BSD 4.3 accessed with ndbm(3).</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">NEWDB</TD
><td class="entry" rowspan="1" colspan="1">The new BSD 4.4 database format accessed with db(3).</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">NIS</TD
><td class="entry" rowspan="1" colspan="1">Sun NIS.</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">NISPLUS</TD
><td class="entry" rowspan="1" colspan="1">Sun NIS+.</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">NETINFO</TD
><td class="entry" rowspan="1" colspan="1">NeXT's NetInfo.</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">HESIOD</TD
><td class="entry" rowspan="1" colspan="1">MIT's Hesiod server.</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">LDAPMAP</TD
><td class="entry" rowspan="1" colspan="1">X500 LDAP lookups.</TD
></TR
></TBODY
></TABLE
><p class="para">The error displayed by the first <b class="emphasis.bold">./makesendmail</B
> run stated that
<em class="emphasis">ndbm.h</EM
> was not found. This indicates that the NDBM argument
on the DBMDEF line is the likely culprit. Further, the comments in
the <em class="emphasis">Makefile.Linux</EM
> file recommend using DNEWDB and the ldb library.
This suggests that a possible solution is to change DBMDEF to <b class="emphasis.bold">DBMDEF=
-DNEWDB</B
> and LIBS to <b class="emphasis.bold">LIBS= -ldb</B
>. This is exactly what Paul
DuBois did when he created the <em class="emphasis">Makefile.Linux.ppc</EM
> file, and it is what
allows sendmail to compile on a Slackware 96 system.</P
><p class="para">He also changed two other lines, neither of which is critical
to the compile, but both of which are indicative of the type of
things customized in a Makefile. Paul changed the STDIR variable
that defines where the <em class="emphasis">sendmail.st</EM
> file is stored to <b class="emphasis.bold">STDIR=
${DESTDIR}/var/log</B
>. The location of files is the most commonly
modified information in a makefile. He also changed BINGRP to <b class="emphasis.bold">BINGRP=
mail</B
> to use the <em class="emphasis">mail</EM
> group defined by the Slackware 96 system
as the group ID for the sendmail binary files.</P
><p class="para">Once sendmail compiles, it is installed with the following command:</P
><p class="para"><blockquote class="screen"><pre class="screen"># ./makesendmail install</PRE
></BLOCKQUOTE
></P
><p class="para">One other thing that should be checked before declaring the installation
complete is the <b class="emphasis.bold">makemap</B
> command.<a class="indexterm" name="AUTOID-26116"></A
>
This is the command that
builds the databases read by sendmail. Given the fact that
sendmail encountered trouble while compiling certain types of
database support, we are suspicious that compiling makemap will
have similar problems.</P
><p class="para">First change to the <em class="emphasis">sendmail-8.8.5/makemap</EM
> directory and look at
the two makefiles located there. One of them, <em class="emphasis">Makefile.dist</EM
>, is the
type of makefile supported by Slackware Linux. Copy <em class="emphasis">Makefile.dist</EM
> to
Makefile and attempt a compile of makemap:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <b class="emphasis.bold">cd ../makemap</B
>
# <b class="emphasis.bold">mv Makefile Makefile.orig</B
>
# <b class="emphasis.bold">cp Makefile.dist Makefile</B
>  
# <b class="emphasis.bold">make</B
>
cc -I. -O -I../src -I/usr/sww/include -DNDBM -DNEWDB    -c makemap.c
   -o makemap.o
makemap.c:53: ndbm.h: No such file or directory
make: *** [makemap.o] Error 1</PRE
></BLOCKQUOTE
></P
><p class="para">Just as we suspected! makemap has the same compile problem as
sendmail. Luckily, Paul DuBois's solution to the sendmail
problem shows us the changes needed for the DBMDEF and LIBS variables.
Additionally, we check all of the directory paths in the Makefile to
ensure they are valid for a Slackware 96 system:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <b class="emphasis.bold">grep -v '^#' Makefile | grep '/'</B
>
SRCDIR= ../src
INCDIRS=-I${SRCDIR} -I/usr/sww/include
LIBDIRS=-L/usr/sww/lib
BINDIR= ${DESTDIR}/usr/sbin
LINKS=  ${DESTDIR}/usr/ucb/newaliases ${DESTDIR}/usr/ucb/mailq
${OBJS}: ${SRCDIR}/conf.h
# <b class="emphasis.bold">ls /usr/sww</B
>
ls: /usr/sww: No such file or directory
# <b class="emphasis.bold">ls /usr/ucb</B
>
ls: /usr/ucb: No such file or directory
# <b class="emphasis.bold">whereis makemap</B
>
makemap: /usr/sbin/makemap
# <b class="emphasis.bold">whereis newaliases</B
>
newaliases: /usr/bin/newaliases
# <b class="emphasis.bold">whereis mailq</B
>
mailq: /usr/bin/mailq</PRE
></BLOCKQUOTE
></P
><p class="para">&#13;These tests show that, in addition to Paul DuBois's corrections,
we need to remove references to the non-existent <em class="emphasis">/usr/sww</EM
> and
<em class="emphasis">/usr/ucb</EM
> directories and insert references to <em class="emphasis">/usr/bin</EM
> where
<b class="emphasis.bold">mailq</B
> and <b class="emphasis.bold">newaliases</B
> really reside. After we make these
changes, a <b class="emphasis.bold">diff</B
> shows the new Makefile code and a rerun of <b class="emphasis.bold">make</B
>
shows that we have fixed the problem:</P
><p class="para"><blockquote class="screen"><pre class="screen"># <b class="emphasis.bold">diff Makefile.dist Makefile</B
>
22c22
&lt; DBMDEF=       -DNDBM -DNEWDB
---
&gt; DBMDEF=       -DNEWDB
30c30
&lt; INCDIRS=-I${SRCDIR} -I/usr/sww/include
---
&gt; INCDIRS=-I${SRCDIR}
36c36
&lt; LIBDIRS=-L/usr/sww/lib
---
&gt; LIBDIRS=
39c39
&lt; LIBS= -ldb -ldbm
---
&gt; LIBS= -ldb
53c53
&lt; LINKS=        ${DESTDIR}/usr/ucb/newaliases ${DESTDIR}/usr/ucb/mailq
---
&gt; LINKS=        ${DESTDIR}/usr/bin/newaliases ${DESTDIR}/usr/bin/mailq
# <b class="emphasis.bold">make</B
>
cc -I. -O -I../src -DNEWDB    -c makemap.c -o makemap.o
cc -o makemap  makemap.o   -ldb</PRE
></BLOCKQUOTE
></P
><p class="para">Run <b class="emphasis.bold">make install</B
> to install the new version of makemap.
We're finished. Compiling sendmail wasn't as easy as the
documentation implies, but wasn't impossible.</P
><p class="para">sendmail is now ready to run. The next section describes the syntax of
the <b class="emphasis.bold">sendmail</B
> command.<a class="indexterm" name="AUTOID-26153"></A
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appd_03.htm" title="D.3 The dhcpd.conf Configuration File"><img src="../gifs/txtpreva.gif" alt="Previous: D.3 The dhcpd.conf Configuration File" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="TCP/IP Network Administration"><img src="../gifs/txthome.gif" alt="TCP/IP Network Administration" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="appe_02.htm" title="E.2 The sendmail Command"><img src="../gifs/txtnexta.gif" alt="Next: E.2 The sendmail Command" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">D.3 The dhcpd.conf Configuration File</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">E.2 The sendmail Command</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
