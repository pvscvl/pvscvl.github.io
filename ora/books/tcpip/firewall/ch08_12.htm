<html><head>
<title>[Chapter 8] 8.12 Network Management Services</TITLE>
<meta name="DC.title" content="Building Internet Firewalls"><meta name="DC.creator" content="D. Brent Chapman &amp; Elizabeth D. Zwicky"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T00:25:49Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-124-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch08_01.htm" title="8. Configuring Internet Services"><link rel="prev" href="ch08_11.htm#FIRE-08-S2-90" title="8.11 syslog"><link rel="next" href="ch08_13.htm#FIRE-08-S2-47" title="8.13 Network Time Protocol (NTP)"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Building Internet Firewalls" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="Building Internet Firewalls"><area shape="RECT" coords="467,0,514,18" href="../search/fsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch08_11.htm#FIRE-08-S2-90" title="8.11 syslog"><img src="../gifs/txtpreva.gif" alt="Previous: 8.11 syslog" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 8<br>Configuring Internet Services</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch08_13.htm#FIRE-08-S2-47" title="8.13 Network Time Protocol (NTP)"><img src="../gifs/txtnexta.gif" alt="Next: 8.13 Network Time Protocol (NTP)" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="FIRE-08-S1-12">8.12 Network Management Services</A
></H2
><p class="para"><a class="indexterm" name="CH08NMS"></A
><a class="indexterm" name="CH08CONFNMS"></A
><a class="indexterm" name="AUTOID-14658"></A
>This section describes a number of protocols that are used by people
and programs to manage and maintain networks: <span class="acronym">SNMP</SPAN
>,
<span class="acronym">RIP</SPAN
>, and <span class="acronym">ICMP</SPAN
>&nbsp;- and, where
appropriate, the tools, such as <em class="emphasis">ping</EM
> and
<em class="emphasis">traceroute</EM
>, that use them.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-08-S2-42">8.12.1 Simple Network Management
Protocol (<span class="acronym">SNMP</SPAN
>)</A
></H3
><p class="para"><a class="indexterm" name="CH08SNMP"></A
><a class="indexterm" name="CH08CONFSNMP"></A
><span class="acronym">SNMP</SPAN
> is a standardized remote monitoring and
management mechanism for network devices like hubs, routers, and
bridges, as well as servers and workstations. The theory is that any
<span class="acronym">SNMP</SPAN
>-capable management station should be able to
monitor and control any <span class="acronym">SNMP</SPAN
>-capable network
device.</P
><p class="para">Normally, <span class="acronym">SNMP</SPAN
> management stations act as clients,
contacting <span class="acronym">SNMP</SPAN
> servers in the various network
devices to request information or to issue commands. Sometimes,
network devices act as <span class="acronym">SNMP</SPAN
> clients to contact
special <span class="acronym">SNMP</SPAN
> servers (known as
<em class="emphasis">trap</EM
> servers) on management stations to report
critical information that can't wait until the next time the
management station polls the device. <span class="acronym">SNMP</SPAN
> trap
servers are separate from regular <span class="acronym">SNMP</SPAN
> servers so
that a given machine can run both&nbsp;- that is, both an
<span class="acronym">SNMP</SPAN
> server (and thus be manageable via
<span class="acronym">SNMP</SPAN
>) and an <span class="acronym">SNMP</SPAN
> trap server
(and thus be a management station and receive traps from other
devices).</P
><p class="para">In general, you don't want someone from the outside to be
able to manage your network via <span class="acronym">SNMP</SPAN
>. Therefore,
you shouldn't allow <span class="acronym">SNMP</SPAN
> to cross your
firewall, and you should carefully configure (or disable)
<span class="acronym">SNMP</SPAN
> on your systems that are outside your firewall
so that attackers can't use it to change that configuration.</P
><p class="para"><a class="indexterm" name="AUTOID-14695"></A
><span class="acronym">SNMP</SPAN
> does support some rudimentary security; when
information is requested, the requester needs to specify a
&quot;community&quot; that it's
in. Different communities
can be shown different information, and a reusable password can be
required for certain communities. At its best, this is quite primitive
security; anybody who's doing packet sniffing can easily discover a
community name and password. </P
><p class="para">Not all <span class="acronym">SNMP</SPAN
> devices
support even this much. Fortunately, the most insecure
<span class="acronym">SNMP</SPAN
> features (for example, allowing
<span class="acronym">SNMP</SPAN
> clients to set parameters) are also the most
complex to implement, and therefore the least often
implemented. <span class="acronym">SNMP</SPAN
> servers that don't implement
passwords probably implement only straightforward queries. That may
still give away information that you'd prefer not be made
public, e.g., the addresses you're communicating with and
presumably trust, or the precise amount of extra traffic you'd have to
generate to bring down a gateway.</P
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-75">8.12.1.1 Packet filtering characteristics of
<span class="acronym">SNMP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-14708"></A
><span class="acronym">SNMP</SPAN
> is a <span class="acronym">UDP</SPAN
>-based
service. <span class="acronym">SNMP</SPAN
> servers (in network devices) listen
on both <span class="acronym">TCP</SPAN
> and <span class="acronym">UDP</SPAN
> port
161. <span class="acronym">SNMP</SPAN
> trap servers (in management stations)
listen on both <span class="acronym">TCP</SPAN
> and <span class="acronym">UDP</SPAN
> port
162. <span class="acronym">SNMP</SPAN
> clients generally use ports above 1023 to
talk to both regular and trap servers.</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Direc-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Pro-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">ACK</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">tion</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tocol</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Set</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Notes</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External management station (client) contacting internal <span class="acronym">SNMP</SPAN
> network
device (server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">SNMP</SPAN
> network device (server) replying to external management
station (client)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[44]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External management station (client) contacting internal <span class="acronym">SNMP</SPAN
> network
device (server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">SNMP</SPAN
> network device (server) replying to external management
station (client)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal management station (client) contacting external <span class="acronym">SNMP</SPAN
> network
device (server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External <span class="acronym">SNMP</SPAN
> network device (server) responding to internal management
station (client)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[44]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal management station (client) contacting external <span class="acronym">SNMP</SPAN
> network
device (server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">161</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External <span class="acronym">SNMP</SPAN
> network device (server) responding to internal management
station (client)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External network device (client) contacting internal <span class="acronym">SNMP</SPAN
> management
station (trap server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">SNMP</SPAN
> management station (trap server) replying to external
network device (client)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[44]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External network device (client) contacting internal <span class="acronym">SNMP</SPAN
> management
station (trap server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">SNMP</SPAN
> management station (trap server) replying to external
network device (client)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal network device (client) contacting external <span class="acronym">SNMP</SPAN
> management
station (trap server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[43]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External <span class="acronym">SNMP</SPAN
> management station (trap server) responding to internal
network device (client)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[44]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal network device (client) contacting external <span class="acronym">SNMP</SPAN
> management
station (trap server)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">162</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External <span class="acronym">SNMP</SPAN
> management station (trap server) responding to internal
network device (client)</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><p class="para">[43] <span class="acronym">UDP</SPAN
> packets do not have <span class="acronym">ACK</SPAN
> bits.</P
><p class="para">[44] <span class="acronym">ACK</SPAN
> will not be set on the first packet of this
type (establishing connection) but will be set on the rest.</P
></BLOCKQUOTE
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-76">8.12.1.2 Proxying characteristics of <span class="acronym">SNMP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15076"></A
><span class="acronym">SNMP</SPAN
> is not commonly used across the Internet, so
proxies for it are not widely available. Although it is a
straightforward single-connection protocol, it's often implemented in
devices (like dedicated routers) for which source code and compilers
are not readily available, making it almost impossible to use with a
modified-client proxy system like <span class="acronym">SOCKS</SPAN
>. It
shouldn't be too difficult to make it work with modified-procedure
proxy systems.<a class="indexterm" name="AUTOID-15082"></A
><a class="indexterm" name="AUTOID-15083"></A
></P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-08-S2-43">8.12.2 Routing Information Protocol
(<span class="acronym">RIP</SPAN
>)</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-15088"></A
><a class="indexterm" name="AUTOID-15091"></A
><a class="indexterm" name="AUTOID-15094"></A
><a class="indexterm" name="AUTOID-15098"></A
><span class="acronym">RIP</SPAN
> is the oldest routing protocol on the
Internet. In fact, it predates <span class="acronym">IP</SPAN
>; it was taken
almost verbatim from the older Xerox Network Services
(<span class="acronym">XNS</SPAN
>) system. It is also still the most commonly
used routing protocol on local area <span class="acronym">IP</SPAN
>
networks. Routers (including general-purpose machines with multiple
interfaces, that can act as routers) use <span class="acronym">RIP</SPAN
> to
periodically broadcast which networks they know how to reach, and how
far away those networks are. By listening to these broadcasts, a
router or host can determine what networks are reachable and choose
the best (shortest) path to each. <span class="acronym">RIP</SPAN
> servers
generally just broadcast this information every 30 seconds or so for
anyone interested to hear, but a <span class="acronym">RIP</SPAN
> client can
request a special update from a <span class="acronym">RIP</SPAN
> server, which
will cause the server to reply directly to the client with the
information requested.</P
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-77">8.12.2.1 Packet filtering characteristics of
<span class="acronym">RIP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15114"></A
><span class="acronym">RIP</SPAN
> is a <span class="acronym">UDP</SPAN
>-based
service. <span class="acronym">RIP</SPAN
> servers listen on port 520 for
broadcasts from other servers and requests from
clients. <span class="acronym">RIP</SPAN
> servers generally send their
broadcasts from port 520. <span class="acronym">RIP</SPAN
> clients generally use
ports above 1023.</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Direc-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Pro-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">ACK</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">tion</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tocol</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Set</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Notes</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[45]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External client request to internal server</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[45]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal server response to external client</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[45]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal client request to external server</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[45]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External server response to internal client</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Broadcast</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[45]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">External server broadcasting to internal servers</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Broadcast</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">520</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[45]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal server broadcasting to external servers</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><p class="para">[45] <span class="acronym">UDP</SPAN
> packets do not have <span class="acronym">ACK</SPAN
> bits.</P
></BLOCKQUOTE
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-78">8.12.2.2 Proxying characteristics of
<span class="acronym">RIP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15274"></A
>Because <span class="acronym">RIP</SPAN
> allows a host to develop
routing tables that are specific to where that host is in the network,
it doesn't make any sense to proxy <span class="acronym">RIP</SPAN
> to another
host elsewhere in the network.</P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-08-S2-45">8.12.3 ping</A
></H3
><p class="para"><a class="indexterm" name="CH08PING"></A
><a class="indexterm" name="AUTOID-15286"></A
><a class="indexterm" name="AUTOID-15290"></A
><a class="indexterm" name="CH08CONFPING"></A
>The <em class="emphasis">ping</EM
> program checks network connectivity. The
<em class="emphasis">ping</EM
> application generates an
<span class="acronym">ICMP</SPAN
> &quot;echo request&quot; packet. The
destination system responds with an <span class="acronym">ICMP</SPAN
>
&quot;echo response&quot; packet. <span class="acronym">ICMP</SPAN
> is
typically implemented in the kernel, so it's the kernel that generates
the &quot;echo response&quot; packet; there is no separate
server for <span class="acronym">ICMP</SPAN
> on most systems. (On some machines,
the echo response is actually generated in the network interface
itself, not in the operating system, and the machine need not even be
fully running to respond to <em class="emphasis">ping</EM
>.) <em class="emphasis">ping</EM
> is not the only program that uses <span class="acronym">ICMP</SPAN
>
echo; others include <em class="emphasis">spray</EM
> and almost any
dedicated network management tool.</P
><p class="para"><em class="emphasis">ping</EM
> is a useful network trouble-shooting
tool, and it is reasonably safe. You'll probably want to allow
<em class="emphasis">ping</EM
> outbound from at least the machines your
network operations staff uses and inbound from at least the network
operations center machines of your network service provider.</P
><p class="para">Because of where it is implemented, it is almost impossible to disable
replies to <em class="emphasis">ping</EM
> on individual hosts; packet
filtering is the only way to control it.</P
><p class="para"><a class="indexterm" name="AUTOID-15313"></A
><a class="indexterm" name="AUTOID-15316"></A
>There are two dangers in allowing <span class="acronym">ICMP</SPAN
>
echo:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">It can be used for a denial of service attack: that is, to flood your
network. Although any protocol you accept can be used in this way,
<span class="acronym">ICMP</SPAN
> echo is particularly tempting, because there
are commonly available programs designed for network testing
(including some versions of <em class="emphasis">ping</EM
>) that let
you flood networks with simple command line options.</P
></LI
><li class="listitem"><p class="para">Anybody who can send <span class="acronym">ICMP</SPAN
> echo requests to and
receive <span class="acronym">ICMP</SPAN
> echo responses from your network can
discover how many machines you have, and what network addresses
they're at; this increases the efficiency of any further
attacks. That's why you want to limit requests to machines that have a
legitimate reason to be probing your network.</P
></LI
></UL
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-79">8.12.3.1 Packet filtering characteristics of
ping</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15333"></A
>Many packet filtering systems let you filter <span class="acronym">ICMP</SPAN
>
packets in much the same way as <span class="acronym">TCP</SPAN
> or
<span class="acronym">UDP</SPAN
> packets: by specifying the
<span class="acronym">ICMP</SPAN
> message type code instead of the
<span class="acronym">TCP</SPAN
> or <span class="acronym">UDP</SPAN
> source or destination
port number. If your packet filtering system has this capability, its
documentation should include a list of the <span class="acronym">ICMP</SPAN
>
numeric codes or keywords that the packet filtering system
understands.</P
><p class="para">To allow the <em class="emphasis">ping</EM
> program to operate outbound
(i.e., <em class="emphasis">ping</EM
>'ing remote hosts), you'll have to
allow <span class="acronym">ICMP</SPAN
> echo request packets outbound and
<span class="acronym">ICMP</SPAN
> echo response packets inbound. To allow
inbound <em class="emphasis">ping</EM
> (i.e., a remote host
<em class="emphasis">ping</EM
>'ing a local host), you'll have to allow
<span class="acronym">ICMP</SPAN
> echo request packets inbound and
<span class="acronym">ICMP</SPAN
> echo response packets outbound.</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Direc-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Pro-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Message</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">tion</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tocol</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Type[46] </TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Notes</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">8</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Incoming <em class="emphasis">ping</EM
></P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">0</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Response to incoming <em class="emphasis">ping</EM
></P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">8</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Outgoing <em class="emphasis">ping</EM
></P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">0</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Response to outgoing <em class="emphasis">ping</EM
></P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><p class="para">[46] <span class="acronym">ICMP</SPAN
> messages do not have source or destination
port numbers; they have a single <span class="acronym">ICMP</SPAN
> message type
field instead. <span class="acronym">ICMP</SPAN
> packets also do not have
<span class="acronym">ACK</SPAN
> bits.</P
></BLOCKQUOTE
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-80">8.12.3.2 Proxying characteristics of ping</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15446"></A
>Because <em class="emphasis">ping</EM
> is neither
<span class="acronym">TCP</SPAN
> nor <span class="acronym">UDP</SPAN
>-based, it won't
work with any widely available generic proxy server for
modified-client proxying. Because <em class="emphasis">ping</EM
> transmits
no user-supplied data to the destination host, modified-procedure
proxying for <em class="emphasis">ping</EM
> is not
possible. Modified-procedure proxying also relies on the ability of 
the proxy server to intercept the request before the machine it's
running on generates a reply, which is difficult with
<em class="emphasis">ping</EM
>. In a pure proxying environment,
<em class="emphasis">ping</EM
> will have to be provided by letting users
connect to the proxying host and run <em class="emphasis">ping</EM
> from
there, as discussed in <a class="xref" href="ch07_01.htm" title="Proxy Systems">Chapter 7</A
>.<a class="indexterm" name="AUTOID-15459"></A
><a class="indexterm" name="AUTOID-15460"></A
></P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-08-S2-44">8.12.4 traceroute</A
></H3
><p class="para"><a class="indexterm" name="CH08TRACEROUTE"></A
><a class="indexterm" name="CH08CONFTRACE"></A
><a class="indexterm" name="AUTOID-15470"></A
><a class="indexterm" name="AUTOID-15473"></A
><em class="emphasis">traceroute</EM
> is an application that shows you the
route that packets take to a particular <span class="acronym">IP</SPAN
>
destination. Because no system typically knows the full path to the
destination 
(merely the next step towards the destination), this is a
neat trick.[47]
<em class="emphasis">traceroute</EM
> works by carefully constructing
special <span class="acronym">UDP</SPAN
> packets. The destination address of the
packets is the remote host; the destination port is an unused (or so
we hope, as we'll discuss below) <span class="acronym">UDP</SPAN
> port on the
remote host. The really special thing about the packets, though, is
that the &quot;time to live&quot; (<span class="acronym">TTL</SPAN
>) fields
are set very low (starting at 1), so that the packets will be rejected
by intermediate routers as if they were looping in the network. By
looking at where the rejections (<span class="acronym">ICMP</SPAN
> &quot;time
to live exceeded&quot; messages) come from,
<em class="emphasis">traceroute</EM
> can determine who the intermediate
routers are.</P
><blockquote class="footnote"><p class="para">[47] <em class="emphasis">traceroute</EM
> is, fundamentally, a &quot;cool
hack.&quot;</P
></BLOCKQUOTE
><p class="para"><em class="emphasis">TTL</EM
> is an <span class="acronym">IP</SPAN
> header that
normally isn't of interest from a firewall point of view. The name is
somewhat misleading; it might be more intuitively called &quot;hops
to live.&quot; When a packet is first created, its
<span class="acronym">TTL</SPAN
> field is set to some value (typically 16, 30,
or 255). Every router that handles the packet along its journey
decrements the <span class="acronym">TTL</SPAN
> field by 1. If the
<span class="acronym">TTL</SPAN
> field ever reaches 0, the packet is assumed to
be in some sort of a loop; it is encapsulated within an
<span class="acronym">ICMP</SPAN
> &quot;time to live exceeded&quot; 
message, and is returned
to the source address.</P
><p class="para">Thus, the first router that handles the first of
<em class="emphasis">traceroute</EM
>'s specially constructed packets (which
has a <span class="acronym">TTL</SPAN
> of 1) will decrement the
<span class="acronym">TTL</SPAN
> field, see that it's 0, and return an
<span class="acronym">ICMP</SPAN
> &quot;time to live exceeded&quot; message, telling
<em class="emphasis">traceroute</EM
> the <span class="acronym">IP</SPAN
> address of
the first router (the source of the <span class="acronym">ICMP</SPAN
> message).</P
><p class="para"><em class="emphasis">traceroute</EM
> then constructs another
<span class="acronym">UDP</SPAN
> packet, this time with a <span class="acronym">TTL</SPAN
>
of 2, and sends it out. This packet gets to the second router before
<span class="acronym">TTL</SPAN
> gets decremented to 0, and
<em class="emphasis">traceroute</EM
> knows that the router that returns the
<span class="acronym">ICMP</SPAN
> &quot;time to live exceeded&quot; for that
packet is the second router along the path to the
destination. <em class="emphasis">traceroute</EM
> then constructs a
<span class="acronym">UDP</SPAN
> packet with a <span class="acronym">TTL</SPAN
> of 3, then
4, and so on, to determine the path to the destination.</P
><p class="para"><em class="emphasis">traceroute</EM
> knows it's finished when it gets
back an <span class="acronym">ICMP</SPAN
> &quot;service unavailable&quot;
message, rather than an <span class="acronym">ICMP</SPAN
> &quot;time to live
exceeded&quot; message from some intermediate router.</P
><p class="para">Most versions of <em class="emphasis">traceroute</EM
> will also note and
display relevant <span class="acronym">ICMP</SPAN
> &quot;host
unreachable&quot;, &quot;network unreachable&quot;, and other
<span class="acronym">ICMP</SPAN
> messages received.</P
><p class="para">If <em class="emphasis">traceroute</EM
> can't reach the destination host
(or can't get anything back from it), it eventually times out.</P
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-81">8.12.4.1 Packet filtering characteristics of
traceroute</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15526"></A
>To allow <em class="emphasis">traceroute</EM
> outbound through your packet
filters (i.e., someone running <em class="emphasis">traceroute</EM
> from
the inside, to an external destination), you have to allow the
constructed <span class="acronym">UDP</SPAN
> packets outbound, and the relevant
<span class="acronym">ICMP</SPAN
> packets (particularly &quot;time to live
exceeded&quot; and &quot;service unavailable&quot; back inbound.</P
><p class="para">To allow <em class="emphasis">traceroute</EM
> inbound, you have to allow
the constructed <span class="acronym">UDP</SPAN
> packets inbound, and the
relevant <span class="acronym">ICMP</SPAN
> messages back outbound. You may wish
to limit this capability to the machines used by the network
operations center of your network service provider, in order to keep a
tight reign on the <span class="acronym">UDP</SPAN
> packets allowed through your
firewall. Doing so protects <span class="acronym">RPC</SPAN
>-based services like
<span class="acronym">NFS</SPAN
> and <span class="acronym">NIS/YP</SPAN
>) and keeps
attackers from using <em class="emphasis">traceroute</EM
> to discover which
addresses at your site are actually assigned to hosts.</P
><p class="para">Some versions of <em class="emphasis">traceroute</EM
> can be told (via a
command line or a compile-time option) which range of
<span class="acronym">UDP</SPAN
> ports to use for the destination. You may need
to establish a convention for your site of what port(s) will
be allowed through the packet filters for use by
<em class="emphasis">traceroute</EM
>. You don't want to allow any more
latitude in your packet filters for <em class="emphasis">traceroute</EM
>
than absolutely necessary (particularly for incoming
<em class="emphasis">traceroute</EM
>). Because
<em class="emphasis">traceroute</EM
> is <span class="acronym">UDP</SPAN
>-based, an
attacker could potentially take advantage of the
<span class="acronym">UDP</SPAN
>-based rules in your packet filtering that are
there to allow <em class="emphasis">traceroute</EM
> in order to attack
other <span class="acronym">UDP</SPAN
>-based services like
<span class="acronym">NFS</SPAN
> and <span class="acronym">NIS/YP</SPAN
>.</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Direc-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Pro-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Message</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">tion</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Addr.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tocol</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port[48]</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port[48]</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Type[48]</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Notes</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[49]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[49]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Outgoing <em class="emphasis">traceroute</EM
> probe</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">11</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Incoming &quot;<span class="acronym">TTL</SPAN
> exceeded&quot;</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Incoming &quot;service unavailable&quot;</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[49]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[49]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Incoming <em class="emphasis">traceroute</EM
> probe</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">11</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Outgoing &quot;<span class="acronym">TTL</SPAN
> exceeded&quot;</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Int</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ext</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ICMP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[48]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Outgoing &quot;service unavailable&quot;</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><p class="para">[48] <span class="acronym">UDP</SPAN
> packets have source and destination ports;
<span class="acronym">ICMP</SPAN
> packets have only message type
fields. Neither <span class="acronym">UDP</SPAN
> nor <span class="acronym">ICMP</SPAN
>
packets have <span class="acronym">ACK</SPAN
> bits.</P
><p class="para">[49] <em class="emphasis">traceroute</EM
> probe packet <span class="acronym">UDP</SPAN
>
source/destination ports vary by implementation, invocation, and/or
command-line arguments. They are generally &gt;32768, but that's about
the only generalization you can make about them. Specific
implementations (particularly in routers and on
non-<span class="acronym">UNIX</SPAN
> platforms) may vary. Destination ports, in
particular, are usually in the range 33434 through 33523.
(Why this is
the case is somewhat complicated, and you should read the comments in
the <span class="acronym">UNIX</SPAN
> <em class="emphasis">traceroute</EM
> source
code if you're perversely curious.)</P
></BLOCKQUOTE
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-82">8.12.4.2 Proxying characteristics of
traceroute</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15730"></A
>Like <em class="emphasis">ping, traceroute</EM
> could easily be supported
by an <span class="acronym">ICMP</SPAN
>-knowledgeable modified-client proxy
server. Unfortunately, no such proxy server is widely
available. Modified-procedure proxying is not possible with
<em class="emphasis">traceroute</EM
>.<a class="indexterm" name="AUTOID-15737"></A
><a class="indexterm" name="AUTOID-15738"></A
></P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-08-S2-92">8.12.5 Other <span class="acronym">ICMP</SPAN
> Packets</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-15743"></A
><a class="indexterm" name="AUTOID-15746"></A
>There are a number of <span class="acronym">ICMP</SPAN
> message types that are
used for network management that don't have programs associated with
them. These are automatically generated and interpreted by various
programs and network devices.</P
><p class="para">What to do with <span class="acronym">ICMP</SPAN
> messages depends on the
message, and the direction it's going in. We've already talked about
&quot;echo request&quot;, &quot;echo reply&quot;,
&quot;destination unreachable&quot;, &quot;service
unavailable&quot; (actually a special type of &quot;destination
unreachable&quot;), and &quot;time to live exceeded&quot;
messages. The other <span class="acronym">ICMP</SPAN
> message types you
probably want to allow, both inbound and outbound, are &quot;source
quench&quot; (used by a receiver to tell a sender to &quot;slow
down,&quot; because it's sending data too fast) and &quot;parameter
problem&quot; (which is sort of a catch-all code to return when there
is a problem with packet headers that can't be reported any other
way).</P
><p class="para">Many other <span class="acronym">ICMP</SPAN
> message types have the potential to
change local information on your hosts (for example,
&quot;redirect&quot; causes changes to a host's routing tables), so
you probably don't want to allow such messages inbound through your
packet filters.</P
><p class="para">In general, you only want to allow <span class="acronym">ICMP</SPAN
> outbound
when it has the chance of doing you some good. Both &quot;source
quench&quot; and &quot;parameter problem&quot; are used to get the
sending host to be nicer to you, and are worth allowing outbound. Any
of the <span class="acronym">ICMP</SPAN
> types that indicates that the
connection can't be made (&quot;destination unavailable&quot;,
&quot;network unavailable&quot;, &quot;service unavailable&quot;,
&quot;destination adminstratively unavailable&quot;, or
&quot;network administratively unavailable&quot;, for example) will
help an attacker probe your network without giving you much benefit,
and you may want to block these outbound.</P
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-08-S3-83">8.12.5.1 Packet filtering characteristics of
<span class="acronym">ICMP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-15762"></A
>As we've said earlier, <span class="acronym">ICMP</SPAN
> packets do not have
source or destination port numbers, but have a single
<span class="acronym">ICMP</SPAN
> message type field instead. Many packet
filtering systems will let you filter <span class="acronym">ICMP</SPAN
> packets
based on that field in the same way they allow you to filter
<span class="acronym">TCP</SPAN
> or <span class="acronym">UDP</SPAN
> packets based on the
source and destination port number fields. Here are some common
<span class="acronym">ICMP</SPAN
> message types, and how you should 
handle them (whether you should allow them through your firewall, or
block them).</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Message</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Type[50] </TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Description</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">0</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Echo reply (reply to <em class="emphasis">ping</EM
>; see <em class="emphasis">ping</EM
> section above).</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">3</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Destination unreachable (see <em class="emphasis">traceroute</EM
> section
above). May indicate host unreachable, network unreachable, port
unreachable, or other.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">4</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Source quench (somebody telling destination &quot;slow down; you're
talking too fast&quot;); should probably be allowed.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">5</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Redirect (somebody telling destination to change a route); is supposed
to be ignored by your systems unless it comes from a directly connected
router, but should probably be blocked anyway. In particular, make sure
the routers that are part of your firewall ignore it.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">8</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Echo request (generated by <em class="emphasis">ping</EM
>; see <em class="emphasis">ping</EM
> section above); should
probably be allowed.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">11</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Time exceeded (packet appears to be looping); should probably be
allowed.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">12</TD
><td class="entry" rowspan="1" colspan="1"><p class="para"> 
Parameter problem (problem with a packet header); should
probably be allowed.</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><p class="para">[50] <span class="acronym">ICMP</SPAN
> messages do not have source or destination
port numbers; they have a single <span class="acronym">ICMP</SPAN
> message type
field instead. <span class="acronym">ICMP</SPAN
> packets also do not have
<span class="acronym">ACK</SPAN
> bits.</P
></BLOCKQUOTE
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-08-S2-48">8.12.6 Summary of Network Management
Recommendations</A
></H3
><ul class="itemizedlist"><li class="listitem"><p class="para">Do not allow <span class="acronym">SNMP</SPAN
> across your firewall from the
Internet. (This may require special <span class="acronym">SNMP</SPAN
>
configurations on your packet filtering routers, which are probably
themselves <span class="acronym">SNMP</SPAN
>-capable devices.)</P
></LI
><li class="listitem"><p class="para">Do not allow routing protocols (<span class="acronym">RIP</SPAN
> or otherwise)
across your firewall to or from the Internet. Routing on the firewall
is generally very simple and accomplished best with static routes.
Simply configure the firewall to direct packets bound for internal
source addresses to an internal router and to direct all other
packets to your Internet connection.</P
></LI
><li class="listitem"><p class="para">Allow <span class="acronym">ICMP</SPAN
> echo requests outbound, but limit
incoming <span class="acronym">ICMP</SPAN
> echo requests to those coming from
machines with a legitimate need to probe your network (such as your
network service provider's network operations center). Allow
<span class="acronym">ICMP</SPAN
> echo responses either way.</P
></LI
><li class="listitem"><p class="para">Allow <em class="emphasis">traceroute</EM
> outbound, but limit incoming
<em class="emphasis">traceroute</EM
> requests to those coming from machines
with a legitimate need to probe your network, and limit the port range
used. </P
></LI
><li class="listitem"><p class="para">Allow only safe <span class="acronym">ICMP</SPAN
> message types, as described above.</P
></LI
></UL
><a class="indexterm" name="AUTOID-15846"></A
><a class="indexterm" name="AUTOID-15847"></A
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch08_11.htm#FIRE-08-S2-90" title="8.11 syslog"><img src="../gifs/txtpreva.gif" alt="Previous: 8.11 syslog" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Building Internet Firewalls"><img src="../gifs/txthome.gif" alt="Building Internet Firewalls" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch08_13.htm#FIRE-08-S2-47" title="8.13 Network Time Protocol (NTP)"><img src="../gifs/txtnexta.gif" alt="Next: 8.13 Network Time Protocol (NTP)" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">8.11 syslog</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_a.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">8.13 Network Time Protocol (NTP)</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
