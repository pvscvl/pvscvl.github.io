<html><head>
<title>[Chapter 5] 5.3 Choosing a Machine</TITLE>
<meta name="DC.title" content="Building Internet Firewalls"><meta name="DC.creator" content="D. Brent Chapman &amp; Elizabeth D. Zwicky"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T00:14:09Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-124-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch05_01.htm" title="5. Bastion Hosts"><link rel="prev" href="ch05_02.htm#FIRE-05-S2-3" title="5.2 Special Kinds of Bastion Hosts"><link rel="next" href="ch05_04.htm" title="5.4 Choosing a Physical Location"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Building Internet Firewalls" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="Building Internet Firewalls"><area shape="RECT" coords="467,0,514,18" href="../search/fsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch05_02.htm#FIRE-05-S2-3" title="5.2 Special Kinds of Bastion Hosts"><img src="../gifs/txtpreva.gif" alt="Previous: 5.2 Special Kinds of Bastion Hosts" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 5<br>Bastion Hosts</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch05_04.htm" title="5.4 Choosing a Physical Location"><img src="../gifs/txtnexta.gif" alt="Next: 5.4 Choosing a Physical Location" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="AUTOID-2507">5.3 Choosing a Machine</A
></H2
><p class="para"><a class="indexterm" name="CH05MACHCHOOS"></A
>The first step in building a bastion host is to decide what kind of
machine to use. You want reliability (if the bastion host goes down,
you lose most of the benefit of your Internet connection),
supportability, and configurability. This section looks at which
operating system you should run, how fast the bastion host needs to be,
and what hardware configuration should be supported.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="AUTOID-2513">5.3.1 What Operating System?</A
></H3
><p class="para"><a class="indexterm" name="CH05OPSYSCHOOS"></A
>The bastion host should be something you're familiar with. You're
going to end up customizing the machine and the operating system
extensively; this is not the time to learn your way around a
completely new system. Because a fully configured bastion host is a
very restricted environment, you'll want to be able to do development
for it on another machine, and it helps a great deal to be able to
exchange its peripherals with other machines you own. (This is partly
a hardware issue, but it doesn't do you any good to be able to plug
your <span class="acronym">UNIX</SPAN
>-formatted <span class="acronym">SCSI</SPAN
> disk
into a Macintosh <span class="acronym">SCSI</SPAN
> chain: the hardware
interoperates, but the data isn't readable.)</P
><p class="para">You need a machine that reliably offers the range of Internet services
you wish to provide your users, with multiple connections
simultaneously active. If your site is completely made up of
<span class="acronym">MS-DOS</SPAN
>, Windows, or Macintosh systems, you may find
yourself needing some other platform (perhaps <span class="acronym">UNIX</SPAN
>,
perhaps Windows <span class="acronym">NT</SPAN
>, perhaps something else) to use
as your bastion host. You may not be able to provide or access all
the services you desire through your native platform, because the
relevant tools (proxy servers, packet filtering systems, or even
regular servers for basic services such as <span class="acronym">SMTP</SPAN
> and
<span class="acronym">DNS</SPAN
>) may not be available for that platform.</P
><p class="para"><a class="indexterm" name="CH05UNIX"></A
><span class="acronym">UNIX</SPAN
> is the operating system that has been most
popular in offering Internet services, and tools are widely available
to make bastion hosts on <span class="acronym">UNIX</SPAN
> systems. If you
already have <span class="acronym">UNIX</SPAN
> machines, you should seriously
consider <span class="acronym">UNIX</SPAN
> for your bastion host. If you have no
suitable platforms for a bastion host and need to learn a new
operating system anyway, we recommend you try <span class="acronym">UNIX</SPAN
>,
because that's where you'll find the largest and most extensive set of
tools for building bastion hosts.</P
><p class="para">If all of your existing multiuser, <span class="acronym">IP</SPAN
>-capable machines
are something other than <span class="acronym">UNIX</SPAN
> machines (such as
<span class="acronym">VMS</SPAN
> systems, for example), you have a hard decision
to make. You can probably use a machine you are familiar with as a
bastion host and get the advantages of familiarity and
interchangeability. On the other hand, solid and extensive tools for
building bastion hosts are not likely to be available to you, and
you're going to have to improvise. You might gain some security through
obscurity (don't count on it; your operating system probably isn't as
obscure as you think), but you may lose as much or more if you don't
have the history that <span class="acronym">UNIX</SPAN
>-based bastion hosts
offer. With <span class="acronym">UNIX</SPAN
>, you have the advantage of
learning through other people's mistakes as well as your own.</P
><p class="para">Most of this chapter assumes that you will be using some kind of
<span class="acronym">UNIX</SPAN
> machine as your bastion host; this chapter is
more <span class="acronym">UNIX</SPAN
>-centric than any other part of this
book. This is because most bastion hosts <em class="emphasis">are</EM
>
<span class="acronym">UNIX</SPAN
> machines, and some of the details are
extremely operating system dependent. The principles will be the same
if you choose to use another operating system, but the details will
vary considerably.</P
><p class="para">If you have a <span class="acronym">UNIX</SPAN
> machine, which version of
<span class="acronym">UNIX</SPAN
> should you choose? Again, you want to balance
what you're familiar with against which tools are available for which
versions. If your site already uses one version of
<span class="acronym">UNIX</SPAN
>, you will most likely use that version. If
your site has some familiarity with several versions of
<span class="acronym">UNIX</SPAN
>, and the relevant tools (discussed throughout
this chapter) are available for all of them, use the
<em class="emphasis">least</EM
> popular one that you still like. Doing so
maximizes your happiness and minimizes the likelihood that attackers
have precompiled ways of attacking your bastion host. If you have no
<span class="acronym">UNIX</SPAN
> familiarity, choose any version you like,
provided that it is in reasonably widespread use (you don't want
&quot;Joe's <span class="acronym">UNIX</SPAN
>, special today $9.95&quot;). As
a rule of thumb, if your chosen version of <span class="acronym">UNIX</SPAN
> has
a user's group associated with it, it's probably well-known enough to
rely on.</P
><p class="para">Although <span class="acronym">UNIX</SPAN
> vendors differ vastly in their
openness about security issues, the difference in the actual security
between different versions of <span class="acronym">UNIX</SPAN
> is much
smaller. Don't assume that the publicity given to security holes
reflects the number of security holes; it's a more accurate reflection
of the popularity of the operating system and the willingness of a
vendor to admit and fix security problems. Ironically, the operating
systems with the most worrisome tales may be the
most secure ones, because they're the ones getting fixed.</P
><div class="sidebar"><h4 class="sidebar"><a class="title" name="AUTOID-2559">Useful <span class="acronym">UNIX</SPAN
> Capabilities</A
></H4
><p class="para">Every operating system has certain special capabilities or features
that can be useful in building a bastion host. We can't describe all
these capabilities for all systems, but we'll tell you about a few
special features of <span class="acronym">UNIX</SPAN
> because it's a common
bastion host platform.

<dl class="variablelist"><dt class="term"><em class="emphasis">setuid/setgid</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-2570"></A
><a class="indexterm" name="AUTOID-2572"></A
>Every <span class="acronym">UNIX</SPAN
> user
has a numeric user identification (<em class="emphasis">uid</EM
>) in
addition to his or her login name, and belongs to one or more groups of
users, also identified by numbers (<em class="emphasis">gid</EM
>s). The
<span class="acronym">UNIX</SPAN
> kernel uses the <em class="emphasis">uid</EM
> and
the various <em class="emphasis">gid</EM
>s of a particular user to
determine what files that user has access to. Normally,
<span class="acronym">UNIX</SPAN
> programs run with the file access permissions
of the user who executes the program. The <em class="emphasis">setuid</EM
>
capability allows a program to be installed so that it always runs
with the permissions of the owner of the program, regardless of which
user is running the program. The <em class="emphasis">setgid</EM
>
capability is similar; it allows the program to temporarily (while
running the program) grant membership in a group to users who are not
normally members of that group.</P
></DD
><dt class="term"><em class="emphasis">chroot</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-2588"></A
>The <em class="emphasis">chroot</EM
> mechanism
allows a program to irreversibly change its view of the filesystem by
changing the program's idea of where the root of the filesystem
is. Once a program <em class="emphasis">chroot</EM
>s to a particular piece
of the filesystem, that piece becomes the whole filesystem as far as
the program is concerned; the rest of the filesystem ceases to exist,
from the program's point of view.</P
></DD
></DL
></P
><p class="para">Environmental modifications, such as those made by
<em class="emphasis">setuid/setgid</EM
> and <em class="emphasis">chroot,</EM
>
are inherited by any subsidiary processes a program starts. A common
way of restricting what the programs on a bastion host can do is to
run the programs under &quot;wrapper&quot; programs; the wrapper
programs do whatever <em class="emphasis">setuid/setgid</EM
>,
<em class="emphasis">chroot</EM
>, or other environmental change work is
necessary, and then start the real
program. <em class="emphasis">chrootuid</EM
> is a wrapper program for this
purpose; <a class="xref" href="appb_01.htm" title="Tools">Appendix B, <cite class="appendix">Tools</CITE
></A
> gives information on how to get
it.<a class="indexterm" name="AUTOID-2599"></A
></P
></DIV
><a class="indexterm" name="AUTOID-2600"></A
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="AUTOID-2601">5.3.2 How Fast a Machine?</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-2604"></A
><a class="indexterm" name="AUTOID-2607"></A
><a class="indexterm" name="AUTOID-2609"></A
><a class="indexterm" name="AUTOID-2611"></A
><a class="indexterm" name="AUTOID-2614"></A
>The bastion host doesn't have to be a fast machine; in fact, it's
better not being especially powerful. There are several good reasons,
besides cost, to make your bastion host as powerful as it needs to be
to do its job, but no more so. It doesn't take much horsepower to
provide the services required of the bastion host.</P
><p class="para">Many people use machines in the 2- to 5-<span class="acronym">MIPS</SPAN
> range
(for example, Sun-3, Micro<span class="acronym">VAX</SPAN
> II, or 80386-based
<span class="acronym">UNIX</SPAN
> platforms) as their bastion hosts. This is
plenty of power for an average site. The bastion host really doesn't
have much work to do. What it needs to do is mostly limited by the
speed of your connection to the outside world, not by the
<span class="acronym">CPU</SPAN
> speed of the bastion host itself. It just
doesn't take that much of a processor to handle mail,
<span class="acronym">DNS</SPAN
>, <span class="acronym">FTP</SPAN
>, and proxy services for
a 56 Kb/s or even a T-1
(1.544 Mb/s) line. You may need more power if you
are running programs that do compression/decompression (e.g.,
<span class="acronym">NNTP</SPAN
> servers) or searches (e.g., full-featured
<span class="acronym">WWW</SPAN
> servers), or if you're providing proxy services
for dozens of users simultaneously.</P
><p class="para">You may also need more power to support requests from the Internet if
your site becomes wildly popular (e.g., if you create
something that everybody and their mothers want to access, like The
Great American Web Page or a popular and well-stocked anonymous
<span class="acronym">FTP</SPAN
> site).[1] At that point, you might also want to start using multiple
bastion hosts, as we describe in <a class="xref" href="ch04_01.htm" title="Firewall Design">Chapter 4</A
>. A large
company with multiple Internet connections and popular services may
need to use multiple bastion hosts <em class="emphasis">and</EM
> large,
powerful machines. (Fortunately, most companies in that position are
also computer manufacturers and buy computers wholesale.)</P
><blockquote class="footnote"><p class="para">[1] If you find yourself (or want to find yourself) in such a position,
see <cite class="citetitle">Managing Internet Information Services</CITE
> by
Cricket Liu, et al (O'Reilly &amp; Associates, 1994). This book
contains lots of helpful information and advice.</P
></BLOCKQUOTE
><p class="para">There are several reasons not to oversize the bastion host:<a class="indexterm" name="AUTOID-2634"></A
></P
><ul class="itemizedlist"><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-2640"></A
>A slower machine is a less inviting target. There's no prestige for
somebody who brags, &quot;Hey, I broke into a Sun 3/60!&quot; or
some other slow (to an attacker, at least) machine. There is far more
prestige involved in breaking into the latest, greatest hardware.
Don't make your bastion host something with high prestige value (a
Cray, for example, would be a poor choice of a bastion host...).</P
></LI
><li class="listitem"><p class="para">If compromised, a slower machine is less useful for attacking internal
systems or other sites. It takes longer to compile code; it's not very
helpful for running dictionary or brute-force password attacks against
other machines; and so on. All of these factors make the machine less
appealing to potential attackers, and that's your goal.</P
></LI
><li class="listitem"><p class="para">A slower machine is less attractive for insiders to
compromise. A fast machine that's spending most of its time waiting for
a slow network connection is effectively wasted, and the pressure from
your own users to use the extra power for other things (for example, as
a compilation server, rendering server, or database server) can be
considerable. You can't maintain the security of a bastion host while
using it for other purposes. Extra capacity on the bastion host is an
accident waiting to happen.</P
></LI
></UL
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="AUTOID-2647">5.3.3 What Hardware Configuration?</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-2650"></A
><a class="indexterm" name="AUTOID-2653"></A
><a class="indexterm" name="AUTOID-2656"></A
><a class="indexterm" name="AUTOID-2658"></A
><a class="indexterm" name="AUTOID-2662"></A
>You want a reliable hardware configuration, so you should select a
base machine and peripherals that aren't the newest thing on the
market. (There's a reason people call it the &quot;bleeding
edge&quot; as well as the &quot;leading edge.&quot;) You also want
the configuration to be supportable, so don't choose something so old
you can't find replacement parts for it. The middle range from your
favorite manufacturer is probably about right.</P
><p class="para">While you don't need sheer <span class="acronym">CPU</SPAN
> power, you do need a
machine that keeps track of a number of connections
simultaneously. This is memory-intensive, so you'll want a large
amount of memory and probably a large amount of swap space as
well. Caching proxies also need a large amount of free disk space to
use for the caches.</P
><p class="para"><a class="indexterm" name="AUTOID-2669"></A
><a class="indexterm" name="AUTOID-2671"></A
>Here are some suggestions about tape and disk needs:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">The bastion host can't reasonably use another host's tape drive
for backups, as we'll discuss later in this chapter, so it needs its
own tape drive of a size suitable to back itself up. </P
></LI
><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-2678"></A
>A <span class="acronym">CD-ROM</SPAN
> drive also comes in handy for operating
system installation and possibly for keeping checksums on (or for
comparing your current files to the original files on the
<span class="acronym">CD-ROM</SPAN
>). You may only need the
<span class="acronym">CD-ROM</SPAN
> drive initially when you first install and
configure the machine, so an external drive that you
&quot;borrow&quot; from another machine temporarily may be
sufficient.</P
></LI
><li class="listitem"><p class="para">You should be able to easily add another disk
temporarily to the configuration for maintenance work.</P
></LI
><li class="listitem"><p class="para">The boot disk should remove easily and attach to
another machine&nbsp;- again, for maintenance work. </P
></LI
></UL
><p class="para">Both of the disk considerations mentioned suggest the bastion host
should use the same type of disks as your other machines. For example,
it should not be the only machine at your site running
<span class="acronym">IPI</SPAN
> disks.</P
><p class="para"><a class="indexterm" name="AUTOID-2690"></A
><a class="indexterm" name="AUTOID-2692"></A
>The bastion host doesn't need interesting graphics, and shouldn't have
them. This is a network services host; nobody needs to see it. Attach
a dumb terminal (the dumber the better) to be the console. Having
graphics will only encourage people to use the machine for other
purposes and might encourage you to install support programs (like the
X Window System and its derivatives) that are insecure.</P
></DIV
><a class="indexterm" name="AUTOID-2695"></A
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch05_02.htm#FIRE-05-S2-3" title="5.2 Special Kinds of Bastion Hosts"><img src="../gifs/txtpreva.gif" alt="Previous: 5.2 Special Kinds of Bastion Hosts" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Building Internet Firewalls"><img src="../gifs/txthome.gif" alt="Building Internet Firewalls" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch05_04.htm" title="5.4 Choosing a Physical Location"><img src="../gifs/txtnexta.gif" alt="Next: 5.4 Choosing a Physical Location" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">5.2 Special Kinds of Bastion Hosts</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_a.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">5.4 Choosing a Physical Location</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
