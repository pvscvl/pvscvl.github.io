<html><head>
<title>[Chapter 9] Two Sample Firewalls</TITLE>
<meta name="DC.title" content="Building Internet Firewalls"><meta name="DC.creator" content="D. Brent Chapman &amp; Elizabeth D. Zwicky"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T00:27:28Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-124-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="part02.htm" title="II. Building Firewalls"><link rel="prev" href="ch08_18.htm" title="8.18 Analyzing Other Protocols"><link rel="next" href="ch09_02.htm#FIRE-09-S3-26" title="9.2 Screened Host Architecture"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Building Internet Firewalls" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="Building Internet Firewalls"><area shape="RECT" coords="467,0,514,18" href="../search/fsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch08_18.htm" title="8.18 Analyzing Other Protocols"><img src="../gifs/txtpreva.gif" alt="Previous: 8.18 Analyzing Other Protocols" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 9</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch09_02.htm#FIRE-09-S3-26" title="9.2 Screened Host Architecture"><img src="../gifs/txtnexta.gif" alt="Next: 9.2 Screened Host Architecture" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="CHAPTER"><h1 class="chapter"><a class="title" name="FIRE-09-CHP">9. Two Sample Firewalls</A
></H1
><div class="htmltoc"><p><b>Contents:</B
><br><a class="SECT1" href="#FIRE-09-S1-1" title="9.1 Screened Subnet Architecture">Screened Subnet Architecture</A
><br><a class="SECT1" href="ch09_02.htm#FIRE-09-S3-26" title="9.2 Screened Host Architecture">Screened Host Architecture</A
></P
><p></P
></DIV
><p class="para"><a class="indexterm" name="CH09FWS"></A
>In this chapter, we describe two sample configurations for basic
firewalls. Almost any real firewall is going to be more complex than
those described in this chapter, but this presentation should give you
some idea of the tasks involved in building a firewall and how the
various pieces fit together.</P
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> We want to emphasize that these examples are just that: examples. You
shouldn't blindly implement one of these examples, without first taking
the time to understand your own needs, your environment, and
the implications and complications of the services you want your
firewall to provide. </P
></BLOCKQUOTE
><p class="para">The services that we're going to provide through these sample
firewalls are just the basics: terminal access, file transfer,
electronic mail, Usenet news, the World Wide Web,
and <span class="acronym">DNS</SPAN
>. See <a class="xref" href="ch08_01.htm" title="Configuring Internet Services">Chapter 8, <cite class="chapter">Configuring Internet Services</CITE
></A
> for a
full discussion of these and other services.</P
><div class="sect1"><h2 class="sect1"><a class="title" name="FIRE-09-S1-1">9.1 Screened Subnet Architecture</A
></H2
><p class="para"><a class="indexterm" name="CH09SSA"></A
><a class="indexterm" name="CH09SSA2"></A
>The screened subnet architecture, described in <a class="xref" href="ch04_01.htm" title="Firewall Design">Chapter 4, <cite class="chapter">Firewall Design</CITE
></A
> and shown in <a class="xref" href="#FIRE-09-FIG-1" title="Screened subnet architecture ">Figure 9.1</A
>,
is probably the most common do-it-yourself firewall architecture. This
architecture provides good security (including multiple layers of
redundancy) at what most sites feel is a reasonable cost.</P
><h4 class="figure"><a class="title" name="FIRE-09-FIG-1">Figure 9.1: Screened subnet architecture </A
></H4
><img class="graphic" src="figs/fire0901.gif" alt="Figure 9.1"><p class="para">There are two-router and single-router variations of the screened subnet
architecture. Basically, you can use either a pair of two-interface
routers or a single three-interface router. The single-router screened
subnet architecture works about as well as the two-router screened
subnet architecture, and is often somewhat cheaper. However, you need to
use a router that can handle both inbound and
outbound packet filtering on each interface. (See the discussion of this
point in <a class="xref" href="ch06_01.htm" title="Packet Filtering">Chapter 6, <cite class="chapter">Packet Filtering</CITE
></A
>.) We're going to use a two-router
architecture as our example in this section because it is conceptually
simpler.</P
><p class="para">The components of this type of firewall include the following:

<ul class="itemizedlist"><li class="listitem"><p class="para">Perimeter network</P
></LI
><li class="listitem"><p class="para">Exterior router</P
></LI
><li class="listitem"><p class="para">Interior router</P
></LI
><li class="listitem"><p class="para">Bastion host</P
></LI
></UL
></P
><p class="para">Let's review briefly the purposes of these various components, presented
originally in <a class="xref" href="ch04_01.htm" title="Firewall Design">Chapter 4</A
>. </P
><dl class="variablelist"><dt class="term"><em class="emphasis">Perimeter network</EM
></DT
><dd class="listitem"><p class="para">Isolates your bastion host from your internal network, so a
security breach on the bastion host won't immediately affect your
internal network. </P
></DD
><dt class="term"><em class="emphasis">Exterior router</EM
></DT
><dd class="listitem"><p class="para">Connects your site to the outside world. If possible, the exterior
router also provides at least some protection for the bastion host,
interior router, and internal network. (This isn't always possible,
because some sites use exterior routers that are managed by their
network service providers and are therefore beyond the site's
control.)  </P
></DD
><dt class="term"><em class="emphasis">Interior router</EM
></DT
><dd class="listitem"><p class="para">Protects the internal network from the world and from the
site's own bastion host. </P
></DD
><dt class="term"><em class="emphasis">Bastion host</EM
></DT
><dd class="listitem"><p class="para">Serves as the site's main point of contact with the
outside world. (It should be set up according to the guidelines in
<a class="xref" href="ch05_01.htm" title="Bastion Hosts">Chapter 5, <cite class="chapter">Bastion Hosts</CITE
></A
>.)</P
></DD
></DL
><p class="para">In addition to the machines that make up the firewall itself, assume
there are machines on the internal network (internal hosts) that
fulfill the following roles. (Note that any given internal machine
might fill any, or even all, of these roles.)

<ul class="itemizedlist"><li class="listitem"><p class="para">Mail server</P
></LI
><li class="listitem"><p class="para">Usenet news server</P
></LI
><li class="listitem"><p class="para"><span class="acronym">DNS</SPAN
> server</P
></LI
><li class="listitem"><p class="para">Client for various Internet services</P
></LI
></UL
></P
><p class="para">Each of these internal services is provided directly (via packet
filtering) or indirectly (via proxy servers running on the bastion
host).</P
><p class="para">We're going to assume (at least for the purposes of this example) that
internal users in our system are trusted not to actively try to
circumvent the firewall, and that there is no particular need to monitor
or log their Internet activities.</P
><p class="para">We're also going to assume that you are using properly assigned and
routed <span class="acronym">IP</SPAN
> addresses (that is, addresses assigned to
your site, and properly routed and advertised to the rest of the
Internet by your service provider) for your internal and perimeter
networks. If you aren't, you have no choice but to use proxies,
because you can't allow packets with those unassigned
<span class="acronym">IP</SPAN
> addresses out onto the Internet; even if you
did, replies would have no way to come back to you.</P
><p class="para">Finally, we're going to assume you're using separate network
numbers for your perimeter net and internal net, so that you can detect
forged packets easily. (See the discussion in &quot;Risks of Filtering
by Source Address&quot; in <a class="xref" href="ch06_01.htm" title="Packet Filtering">Chapter 6</A
>.)</P
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-09-S2-1">9.1.1 Service Configuration</A
></H3
><p class="para">Given the architecture we've just described, how do we provide the basic
Internet services?</P
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-1">9.1.1.1 Telnet</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-16890"></A
><a class="indexterm" name="AUTOID-16894"></A
>Outgoing Telnet could be provided through packet filtering or through
proxies. Which approach should we use?</P
><p class="para">Proxying will require either modified clients or modified user
procedures; either one will be tedious to implement for somebody.
Proxying would allow us to restrict or monitor Telnet usage by user by
forcing our users to authenticate to a proxy server before completing
their requests. However, remember that we have decided to assume
internal users are trustworthy, so there is no need for
authentication.  Proxying would be necessary if we were using
unassigned or unadvertised <span class="acronym">IP</SPAN
> addresses internally,
but that's not the case here, either. Because we have trustworthy
users and proper <span class="acronym">IP</SPAN
> addresses, proxying for Telnet
doesn't provide any advantage over packet filtering, and it's more
difficult to set up and maintain. Therefore, for this example we're
going to provide outgoing Telnet via packet filtering.</P
><p class="para">Incoming Telnet is considerably more difficult to provide safely and
conveniently. If it were necessary, incoming Telnet could be provided on
the bastion host using extra authentication. However, for a site that
is looking for a simple configuration, the reasonable thing to do is to
disallow incoming Telnet altogether. That's what we'll do for this
example.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-2">9.1.1.2 <span class="acronym">FTP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-16906"></A
><a class="indexterm" name="AUTOID-16910"></A
>Unlike Telnet, <span class="acronym">FTP</SPAN
> doesn't lend itself to a pure
packet filtering solution. Because normal mode <span class="acronym">FTP</SPAN
>
requires an incoming connection to an arbitrary port over 1023, trying
to allow it without doing anything else gives attackers access to
all kinds of services running on our internal systems. That leaves us
two choices:

<ul class="itemizedlist"><li class="listitem"><p class="para">Support passive mode via packet filtering</P
></LI
><li class="listitem"><p class="para">Support normal mode via proxies</P
></LI
></UL
></P
><p class="para">In either case, the standard <span class="acronym">FTP</SPAN
> clients shipped
with <span class="acronym">UNIX</SPAN
> operating systems, and most of the
popular, publicly available clients for personal computers, won't work
the normal way. If we use the <span class="acronym">TIS FWTK</SPAN
>
<em class="emphasis">ftp-gw</EM
> proxy gateway (described in <a class="xref" href="ch07_01.htm" title="Proxy Systems">Chapter 7, <cite class="chapter">Proxy Systems</CITE
></A
>), we can use unmodified clients, but at the
cost of teaching the users to follow special procedures. Some
popular <span class="acronym">FTP</SPAN
> clients&nbsp;- the ones built in to Web
browsers like Netscape Navigator or Mosaic&nbsp;- do
use passive mode without being modified, but then again, not all
servers support it well.</P
><p class="para">A reasonable compromise would be to use packet filtering and
proxies, using a proxying gateway like <em class="emphasis">ftp-gw</EM
>
from the <span class="acronym">TIS FWTK</SPAN
> that doesn't require modification
of the clients. Clients that support passive mode will work via the
packet filters. On platforms where we can easily replace the provided
clients, we can provide passive mode clients; on platforms where we
can't easily replace the clients, we can modify user procedures.</P
><p class="para">As we've said, if we wanted to monitor <span class="acronym">FTP</SPAN
> usage,
or if we were using an unassigned or unrouted network number, we'd
have to do exclusively proxying, but that's not the case here. We also
might want to use proxying exclusively if we decided to hide
<span class="acronym">DNS</SPAN
> data&nbsp;- it would save us the trouble of faking
data for double-reverse lookups&nbsp;- but hiding <span class="acronym">DNS</SPAN
>
data is more trouble than it's worth. In a situation where proxying is
used exclusively, we'd have to reconsider which proxy server to
use. Requiring users to modify their procedures makes sense here,
because there are no other options. The balance might come out
differently if everybody were proxying.</P
><p class="para"><a class="indexterm" name="AUTOID-16936"></A
><a class="indexterm" name="AUTOID-16938"></A
>Be aware that in order to use the <span class="acronym">TIS FWTK</SPAN
>
<em class="emphasis">ftp-gw</EM
> proxy server on your bastion host, your
packet filtering will have to allow <span class="acronym">TCP</SPAN
> connections
from ports above 1023 on your bastion host to ports above 1023 on
internal hosts, and from port 20 on external hosts to ports above 1023
on your bastion host, for <span class="acronym">FTP</SPAN
> data channels. (See
the discussion of <span class="acronym">FTP</SPAN
> in <a class="xref" href="ch08_01.htm" title="Configuring Internet Services">Chapter 8</A
>.) This means that someone who breaks in to the
bastion host could easily connect to any server on any internal host
that uses a <span class="acronym">TCP</SPAN
> port above 1023 (for example, an
X11 server on port 6000). Further, any servers that are using such
ports (that is, <span class="acronym">TCP</SPAN
> ports above 1023) on the
bastion host itself are also vulnerable. For this reason, if you allow
these <span class="acronym">FTP</SPAN
> data connections at all for proxying, you
probably want to explicitly block access to internal systems to
<span class="acronym">TCP</SPAN
> ports above 1023 where you know, or have good
cause to suspect, that servers might be listening. At the very least,
such ports probably include 6000 through around 6003 (assuming four or
fewer real or virtual X11 servers per machine; see the discussion of
X11 in <a class="xref" href="ch08_01.htm" title="Configuring Internet Services">Chapter 8</A
>).</P
><p class="para">Keep in mind, however, that blocking specific ports, rather than
blocking all ports by default and then allowing specific ports, is
generally a dangerous strategy. It's hard to develop and
maintain a complete list of ports that need to be blocked at your site. 
It would be better to block everything by default and then allow
only specific ports, but you can't do that with standard (nonpassive)
<span class="acronym">FTP</SPAN
>, because of the way it works.</P
><p class="para">Allowing passive-mode <span class="acronym">FTP</SPAN
> with packet filtering is
a fairly liberal approach, because it allows pretty much any
connection to go through as long as it is initiated by the inside. The
number of servers above port 1023 is very large. This has some
advantages (it lets users access nonstandard <span class="acronym">HTTP</SPAN
>
servers, for example), but it may also allow users to access all kinds
of services that are unsafe. In allowing it, we're assuming that our
users are not only well-intentioned, they're also capable of telling
the difference between a safe and an unsafe connection, or at least
avoiding the temptation to do unexpected things.</P
><p class="para">Because we've denied incoming Telnet, it makes sense to deny incoming
user <span class="acronym">FTP</SPAN
> as well. Both services require
approximately the same security measures, and making one of them
available would make configuring the other trivial.</P
><p class="para">Incoming anonymous <span class="acronym">FTP</SPAN
> is a different matter, and
we'll provide it.  Because we're not a major Internet service
provider, and because we're using the <span class="acronym">TIS FWTK</SPAN
>
already anyway, we can go for security over features and use the
<span class="acronym">TIS FWTK</SPAN
> anonymous <span class="acronym">FTP</SPAN
>
server. If we were going to provide major anonymous
<span class="acronym">FTP</SPAN
>, we'd probably want to use the more
feature-filled <em class="emphasis">wuarchive</EM
> <span class="acronym">FTP</SPAN
>
server (see <a class="xref" href="ch08_01.htm" title="Configuring Internet Services">Chapter 8</A
> for a description of its
capabilities), and run it on a machine that was not the main bastion
host but that was still a bastion host on the perimeter network.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-3">9.1.1.3 <span class="acronym">SMTP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="CH09SMTPCONF"></A
><a class="indexterm" name="CH09CONFSMTP"></A
>There aren't many options for <span class="acronym">SMTP</SPAN
> in
any configuration. We want all external <span class="acronym">SMTP</SPAN
>
connections to go to a single machine with a secured
<span class="acronym">SMTP</SPAN
> server, and we don't trust random internal
machines to have safe <span class="acronym">SMTP</SPAN
> servers. That means 
we'll put a secured <span class="acronym">SMTP</SPAN
> server on the bastion
host and use <span class="acronym">DNS MX</SPAN
> records to direct all incoming
mail to the bastion host, which will then pass all the incoming mail
to a single internal secured <span class="acronym">SMTP</SPAN
> server.</P
><p class="para">What other options do we have? We could put a secure
<span class="acronym">SMTP</SPAN
> server on the internal mail server and direct
incoming mail to it, but if that <span class="acronym">SMTP</SPAN
> server were
compromised, the entire internal net would then be at risk.
Alternatively, we could have the bastion host send mail directly to
machines on the internal network, but once again, we'd be increasing
our vulnerability if the <span class="acronym">SMTP</SPAN
> server on the bastion
host were compromised.  The compromised bastion host would be speaking
to untrustworthy internal <span class="acronym">SMTP</SPAN
> servers, and
compromise of the internal net would quickly follow.  If the bastion
host can speak only to the internal mail server, that narrows the
possible attacks it can make; the internal mail server can run a
secured <span class="acronym">SMTP</SPAN
> server. Furthermore, by making this
choice, messy maintenance tasks are transferred from the
security-critical bastion host to the less vulnerable internal mail
server.</P
><p class="para">How about outgoing mail? It would probably be safe to allow internal
machines to send mail directly to the outside world, but doing so
creates a maintenance headache. (You have to watch the mail
configuration on all the internal machines.) Besides, doing this opens
another direct connection between the internal and external networks.
There aren't any known ways for an <span class="acronym">SMTP</SPAN
>
server to attack an <span class="acronym">SMTP</SPAN
> client, but stranger
things have happened.</P
><p class="para">Allowing internal machines to send mail directly to the outside world
doesn't seem to bring much advantage either. The only difference it
makes is that we'd be able to send mail (but not receive it) when the
bastion host is down. </P
><p class="para">No matter what decision we make, we'll have to configure our mail
clients. (Unlike <span class="acronym">FTP</SPAN
> and Telnet,
<span class="acronym">SMTP</SPAN
> does not work as installed without modifying
configuration files.) In addition, the work to direct the mail to a
server is less than the work to correctly send it to the external
universe.</P
><p class="para">The only real question is whether to direct the outgoing mail from the
internal machines to the internal mail server or to the bastion host.
Directing it to the internal mail server has the same advantages
for incoming mail, but the advantages are much smaller. Sending
outgoing mail presents little risk to start with, so reducing the
risk isn't worth much. Sending outgoing mail also doesn't involve
configurations that change often enough to make it worrisome to maintain
the bastion host. On the other hand, the cost of going through the
internal mail server&nbsp;- in complexity, possible points of failure, and
delay&nbsp;- is just as high for outgoing mail as for incoming mail. It no
longer looks like an attractive bargain, so we'll direct the outgoing
mail to the bastion host without using the internal mail server as an
intermediary.</P
><p class="para">We'll set up <span class="acronym">SMTP</SPAN
>, as outlined in <a class="xref" href="ch08_01.htm" title="Configuring Internet Services">Chapter 8</A
>, with the bastion host acting as a middleman for
incoming and outgoing mail. Here's what to do:

<ul class="itemizedlist"><li class="listitem"><p class="para">Publish <span class="acronym">DNS MX</SPAN
> records that direct incoming mail for
the site to the bastion host.</P
></LI
><li class="listitem"><p class="para">Configure internal machines to send all outgoing mail to the
bastion host.</P
></LI
><li class="listitem"><p class="para">Configure the bastion host to send all incoming mail to a single
internal mail server and to send outgoing mail directly to destination
machines.</P
></LI
></UL
></P
><p class="para">For this example, we're going to assume there is a single internal
mail server for incoming mail, and that internal machines send their
outgoing mail directly to the bastion host (rather than indirectly via
the mail server).<a class="indexterm" name="AUTOID-17013"></A
><a class="indexterm" name="AUTOID-17014"></A
></P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-4">9.1.1.4 <span class="acronym">NNTP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-17019"></A
><a class="indexterm" name="AUTOID-17023"></A
>As we've discussed in <a class="xref" href="ch08_01.htm" title="Configuring Internet Services">Chapter 8</A
>, the most practical
way to set up <span class="acronym">NNTP</SPAN
> across a firewall is to allow
your <span class="acronym">NNTP</SPAN
> service provider(s) to talk directly to
your internal Usenet news host, and vice versa. We'd need an
overwhelming reason to do something else, and it's hard to imagine
one.  Even if we didn't have an existing internal news host, building
one isn't any harder than building a news server on the bastion host,
and it's safer by a vast margin. News servers fail with dreary
regularity; while the problems usually aren't security-related, you
still don't want to install anything high-maintenance on a bastion
host.</P
><p class="para">For this example, we're going to assume a single external
<span class="acronym">NNTP</SPAN
> newsfeed.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-5">9.1.1.5 <span class="acronym">HTTP</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-17036"></A
><a class="indexterm" name="AUTOID-17040"></A
>As with the other services, for <span class="acronym">HTTP</SPAN
> we can use
either packet filtering or proxy servers to provide service to
internal clients. Packet filtering will allow our users to access
<span class="acronym">HTTP</SPAN
> servers only on standard ports; proxying will
allow them to reach all <span class="acronym">HTTP</SPAN
> servers. Which
approach should we take?</P
><p class="para">For Telnet and <span class="acronym">FTP</SPAN
>, the major drawback of proxying
was that it required special clients; for <span class="acronym">HTTP</SPAN
>,
though, standard browsers support <span class="acronym">HTTP</SPAN
>
proxying. Proxying will increase configuration overhead, but that
price seems fair for the increased abilities it offers. On the other
hand, we've already decided to allow internal hosts to create outgoing
connections to any port at or above 1024 in order to allow passive-mode
<span class="acronym">FTP</SPAN
> directly from internal hosts to external
hosts. That will allow access to almost any <span class="acronym">HTTP</SPAN
>
server (any one using a port at or above 1024, anyway). Using pure
packet filtering would lose us only <span class="acronym">HTTP</SPAN
> servers at
nonstandard ports below 1024, and those ports are all supposed to be
reserved anyway.</P
><p class="para">If we use the <span class="acronym">CERN HTTP</SPAN
> server as our proxy server,
the server can also cache Web pages. Doing so can significantly
improve performance for all of the following:

<dl class="variablelist"><dt class="term"><em class="emphasis"><span class="acronym">HTTP</SPAN
> clients</EM
></DT
><dd class="listitem"><p class="para">They obtain pages from the
cache over the internal network, rather than from the original server
over our Internet connection, which is probably much slower.</P
></DD
><dt class="term"><em class="emphasis">Non-<span class="acronym">HTTP</SPAN
> clients</EM
></DT
><dd class="listitem"><p class="para">The <span class="acronym">HTTP</SPAN
> clients won't be using so much of the
bandwidth of our Internet connection.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">HTTP</SPAN
> servers at other sites</EM
></DT
><dd class="listitem"><p class="para">They will only get one request from our site for a given page, rather
than multiple requests.</P
></DD
></DL
></P
><p class="para">The <span class="acronym">CERN</SPAN
> server will also allow us to provide
<span class="acronym">HTTP</SPAN
> service to external sites, so we'll take
advantage of that to publish our site's own public
<span class="acronym">WWW</SPAN
> pages.</P
><p class="para"><a class="indexterm" name="AUTOID-17081"></A
><a class="indexterm" name="AUTOID-17085"></A
><span class="acronym">HTTP</SPAN
> proxying is also trivial to add once you have
other things proxied via <span class="acronym">SOCKS</SPAN
> or
<span class="acronym">TIS FWTK</SPAN
>. If we had <span class="acronym">SOCKS</SPAN
>
running, it would be very tempting to simply proxy through it, because
<span class="acronym">SOCKS</SPAN
> is one of the systems that many of the browsers
support. All of the proxy servers we've already decided to run are
part of the <span class="acronym">TIS FWTK</SPAN
>, however, and we'd have to
install <span class="acronym">SOCKS</SPAN
> just for <span class="acronym">HTTP</SPAN
> if
we wanted to use it. If we used the <span class="acronym">TIS FWTK HTTP</SPAN
>
proxy, we'd have to get the users to modify <span class="acronym">URL</SPAN
>s
they use.  In this case, the proxy servers wouldn't be able to cut and
paste out of their electronic mail when people tell them about cool
new things.  Neither <span class="acronym">SOCKS</SPAN
> nor <span class="acronym">TIS FWTK</SPAN
> makes an attractive option in this situation.</P
><p class="para">However, both proxying (through the <span class="acronym">CERN</SPAN
> server)
and packet filtering appear to be attractive and reasonable
choices. Proxying would definitely be preferable if we weren't already
providing passive-mode <span class="acronym">FTP</SPAN
> directly (which gives
our users the ability to talk to servers on any <span class="acronym">TCP</SPAN
>
port above 1023). On the other hand, packet filtering would definitely
be preferable if we wanted to use clients that didn't come with
built-in support for proxying, or if we wanted not to provide an
<span class="acronym">HTTP</SPAN
> server and had no other services being
proxied.</P
><p class="para">For this example, we're going to assume that we're providing
<span class="acronym">HTTP</SPAN
> service to internal clients via a
<span class="acronym">CERN</SPAN
> proxy server running on the bastion host, and
that we're using the same server to publish our public
<span class="acronym">WWW</SPAN
> pages to the world.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-6">9.1.1.6 <span class="acronym">DNS</SPAN
></A
></H4
><p class="para"><a class="indexterm" name="AUTOID-17114"></A
><a class="indexterm" name="AUTOID-17118"></A
>As discussed in <a class="xref" href="ch08_01.htm" title="Configuring Internet Services">Chapter 8</A
>, <span class="acronym">DNS</SPAN
>
across a firewall is best provided with a pair of servers: one on the
bastion host, the other on an internal host. Like
<span class="acronym">NNTP</SPAN
>, <span class="acronym">DNS</SPAN
> presents a situation
in which the number of rational solutions is clearly limited. We need
to decide whether to use separate internal and external servers to do
information hiding, or whether we should allow the external world to
see all of our host data.  By deciding to allow direct passive-mode
<span class="acronym">FTP</SPAN
>, we've already made that decision
indirectly. Direct passive-mode <span class="acronym">FTP</SPAN
> would require
intricate <span class="acronym">DNS</SPAN
> setup to support information hiding
and still provide valid data for the internal hosts that are
<span class="acronym">FTP</SPAN
> clients.</P
><p class="para">For this example, we're going to assume the
<span class="acronym">DNS</SPAN
> server on the bastion host is a secondary
server for our domain, and the primary server is on an internal
host. We're not going to do any <span class="acronym">DNS</SPAN
> information
hiding.</P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-09-S2-2">9.1.2 Packet Filtering Rules</A
></H3
><p class="para"><a class="indexterm" name="CH09PFEXAMPLERULES"></A
>Based on the configuration decisions we've made in the previous
sections, let's look at the packet filtering rules necessary to
support this configuration. We assume an &quot;ideal&quot; router
(as discussed in &quot;Choosing a Packet Filtering Router&quot; in
<a class="xref" href="ch06_01.htm" title="Packet Filtering">Chapter 6</A
>). If our router were less than ideal in
terms of capabilities, we'd need to modify these rules
accordingly, probably at the cost of security. We might have to
rethink several crucial decisions entirely.  For example, if we
couldn't filter on the <span class="acronym">ACK</SPAN
> bit, direct outbound
passive-mode <span class="acronym">FTP</SPAN
> would no longer be acceptably
safe, and a lot of our other decisions have used that as a major
factor. (See <a class="xref" href="ch06_01.htm" title="Packet Filtering">Chapter 6</A
> for a full discussion of
packet filtering capabilities, and the implications of not having
particular capabilities.)</P
><p class="para">In the packet filtering rules presented below, we assume that the
filtering system: 

<ul class="itemizedlist"><li class="listitem"><p class="para">Can distinguish between incoming and outgoing packets</P
></LI
><li class="listitem"><p class="para">Can filter on source address, destination address, packet type
(<span class="acronym">TCP</SPAN
> or <span class="acronym">UDP</SPAN
>), source port, and
destination port</P
></LI
><li class="listitem"><p class="para">Can filter on whether or not the <span class="acronym">ACK</SPAN
> bit is set (for
<span class="acronym">TCP</SPAN
> packets)</P
></LI
><li class="listitem"><p class="para">Applies rules in the order listed</P
></LI
></UL
></P
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-7">9.1.2.1 Interior Router</A
></H4
><p class="para"><a class="indexterm" name="CH09IRCONF"></A
><a class="indexterm" name="CH09CONFIR"></A
>The purpose of the interior router is to protect the internal network
from the Internet and from your own bastion host. The interior router
needs the following rules to support the outlined configuration. 
Explanations of each rule follow the table.</P
><p class="para"></P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Direc-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Pro-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><span class="acronym">ACK</SPAN
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Rule</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tion</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Address</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Address</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tocol</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Set</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Action</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">Spoof</TD
><td class="entry" rowspan="1" colspan="1">In</TD
><td class="entry" rowspan="1" colspan="1">Internal</TD
><td class="entry" rowspan="1" colspan="1">Any</TD
><td class="entry" rowspan="1" colspan="1">Any</TD
><td class="entry" rowspan="1" colspan="1">Any</TD
><td class="entry" rowspan="1" colspan="1">Any</TD
><td class="entry" rowspan="1" colspan="1">Any</TD
><td class="entry" rowspan="1" colspan="1">Deny</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">Telnet-1</TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">23</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Telnet-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">23</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-5</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-6</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-7</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">6000-6003</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-8</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-9</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">SMTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">SMTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">HTTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">80</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">HTTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">80</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">DNS</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[1]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">DNS</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[1]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">DNS</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">DNS</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-5</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">DNS</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-6</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">DNS</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Default-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Default-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><p class="para">[1] <span class="acronym">UDP</SPAN
> packets 
do not have ACK bits.</P
></BLOCKQUOTE
><p class="para">Here is some additional information about each set of rules in this
table:

<dl class="variablelist"><dt class="term"><em class="emphasis">Spoof</EM
></DT
><dd class="listitem"><p class="para">Blocks incoming packets that claim to have internal
<span class="acronym">IP</SPAN
> addresses (that is, forged packets presumably
sent by an attacker).</P
></DD
><dt class="term"><em class="emphasis">Telnet-1 and Telnet-2</EM
></DT
><dd class="listitem"><p class="para">Allow outgoing Telnet connections.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-1 and <span class="acronym">FTP</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allow outgoing connections to <span class="acronym">FTP</SPAN
> servers, for use
by passive-mode internal clients that are interacting with those
servers directly.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-3 and <span class="acronym">FTP</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow the <span class="acronym">FTP</SPAN
> data channel connections from
passive-mode internal clients to external <span class="acronym">FTP</SPAN
>
servers. Note that these rules actually allow all connections from
internal <span class="acronym">TCP</SPAN
> ports above 1023 to external
<span class="acronym">TCP</SPAN
> ports above 1023. That may be more than you
want to allow, but there's no way to cover passive-mode
<span class="acronym">FTP</SPAN
> with anything less broad, and connections are
at least restricted to those opened from the inside.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-5 and <span class="acronym">FTP</SPAN
>-6</EM
></DT
><dd class="listitem"><p class="para">Allow normal (nonpassive-mode) internal <span class="acronym">FTP</SPAN
>
clients to open an <span class="acronym">FTP</SPAN
> command channel to the proxy
<span class="acronym">FTP</SPAN
> server on the bastion host.  Note that these
rules are actually redundant if you have rules
<span class="acronym">FTP</SPAN
>-1 and <span class="acronym">FTP</SPAN
>-2 in place earlier
in the list, because &quot;Bastion&quot; as a source or destination
(covered by rules <span class="acronym">FTP</SPAN
>-5 and
<span class="acronym">FTP</SPAN
>-6) is a subset of &quot;All&quot; (covered by
rules <span class="acronym">FTP</SPAN
>-1 and <span class="acronym">FTP</SPAN
>-2). Having
these redundant rules is going to impose a slight performance cost,
but makes the rule set easier to understand. It also makes it possible
to change rules <span class="acronym">FTP</SPAN
>-1 and <span class="acronym">FTP</SPAN
>-2
(e.g., if you decide you don't want to support passive-mode
clients) without accidentally breaking normal-mode client access to
the proxy server.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-7 through <span class="acronym">FTP</SPAN
>-9</EM
></DT
><dd class="listitem"><p class="para">Allow <span class="acronym">FTP</SPAN
> data connections from the proxy server on
the bastion host to nonpassive internal clients. The
<span class="acronym">FTP</SPAN
>-7 rule prevents an attacker who has gained
access to the bastion host from attacking internal X11 servers via the
hole created by rules <span class="acronym">FTP</SPAN
>-8 and
<span class="acronym">FTP</SPAN
>-9. If you have other servers internally
listening for connections on <span class="acronym">TCP</SPAN
> ports above 1023,
you should add similar rules for them. Note that trying to list things
that should be denied (as in rule <span class="acronym">FTP</SPAN
>-7) is
generally a losing proposition, because your list will almost always
be incomplete somehow (e.g., because you overlooked or didn't
know about some internal service, or because the service was added
after the filters were established). However, it's the best you can do
in this situation to support normal-mode
<span class="acronym">FTP</SPAN
> clients.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">SMTP</SPAN
>-1 and <span class="acronym">SMTP</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allow outgoing mail from internal hosts to the bastion host.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">SMTP</SPAN
>-3 and <span class="acronym">SMTP</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow incoming mail from the bastion host to your internal mail
server.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">NNTP</SPAN
>-1 and <span class="acronym">NNTP</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allow outgoing Usenet news from your news server to
your service provider's news server.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">NNTP-3</SPAN
> and <span class="acronym">NNTP-4</SPAN
></EM
></DT
><dd class="listitem"><p class="para">Allow incoming Usenet news from your service
provider's news server to your news server.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">HTTP</SPAN
>-1 and <span class="acronym">HTTP</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allow internal <span class="acronym">HTTP</SPAN
> clients to connect to the
<span class="acronym">HTTP</SPAN
> proxy server on your bastion host.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-1</EM
></DT
><dd class="listitem"><p class="para">Allows <span class="acronym">UDP</SPAN
>-based <span class="acronym">DNS</SPAN
> queries and
answers from the internal <span class="acronym">DNS</SPAN
> server to the bastion
host <span class="acronym">DNS</SPAN
> server.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allows <span class="acronym">UDP</SPAN
>-based <span class="acronym">DNS</SPAN
> queries and
answers from the bastion host <span class="acronym">DNS</SPAN
> server to the
internal <span class="acronym">DNS</SPAN
> server. </P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-3 and <span class="acronym">DNS</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow <span class="acronym">TCP</SPAN
>-based <span class="acronym">DNS</SPAN
> queries from
the bastion host <span class="acronym">DNS</SPAN
> server to the internal
<span class="acronym">DNS</SPAN
> server, as well as answers to those queries. Also
allow
zone transfers in which the bastion host <span class="acronym">DNS</SPAN
> server is
the secondary server and the internal <span class="acronym">DNS</SPAN
> server is
the primary server.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-5 and <span class="acronym">DNS</SPAN
>-6</EM
></DT
><dd class="listitem"><p class="para">Allow <span class="acronym">TCP</SPAN
>-based <span class="acronym">DNS</SPAN
> queries from
the internal <span class="acronym">DNS</SPAN
> server to the bastion host
<span class="acronym">DNS</SPAN
> servers, as well as answers to those queries. Also
allow
zone transfers in which the bastion host <span class="acronym">DNS</SPAN
>
server is the primary server and the internal <span class="acronym">DNS</SPAN
>
server is the secondary server.</P
></DD
><dt class="term"><em class="emphasis">Default-1 and Default-2</EM
></DT
><dd class="listitem"><p class="para">Block all packets not specifically allowed by
one of the preceding rules.</P
></DD
></DL
></P
><p class="para">How you translate these abstract rules into specific rules for your
particular filtering system depends on the syntax used by your system. 
Some systems allow you to enter the rules as a single table, much as we
show here in this table. Other systems require you to specify rules
for incoming and outgoing packets in separate rule sets. Splitting
these rules between incoming and outgoing packets is not a problem,
as long as you preserve the order for rules of each type; that is, as
long as all the incoming rules stay in the same order relative to each
other, and all the outgoing rules stay in the same order relative to
each other.<a class="indexterm" name="AUTOID-17987"></A
><a class="indexterm" name="AUTOID-17988"></A
></P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-8">9.1.2.2 Exterior Router</A
></H4
><p class="para"><a class="indexterm" name="CH09ERCONF"></A
><a class="indexterm" name="CH09CONFER"></A
>The purpose of the exterior router is twofold:

<ul class="itemizedlist"><li class="listitem"><p class="para">To connect the perimeter net (and thus your site) to the outside
world</P
></LI
><li class="listitem"><p class="para">To protect the perimeter net and the internal net against the
outside world </P
></LI
></UL
></P
><p class="para">In many circumstances, only the former purpose is possible, because the
exterior router is often provided and managed by your network service
provider. That provider may be unable or unwilling to set up and
maintain packet filtering rules on the exterior router (and unable or
unwilling to let you do it yourself).</P
><p class="para">If you can set up filtering on the exterior router, it's a good idea to
do so. If nothing else, this can serve as a backup to some of the
filtering on the interior router. For this example, you would need to
establish the following rules:</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Direc-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Pro-</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Source</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Dest.</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><span class="acronym">ACK</SPAN
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Rule</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tion</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Address</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Address</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">tocol</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Port</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Set</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Action</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Spoof-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal </P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Spoof-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Perim.</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Telnet-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">23</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Telnet-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">23</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-5</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-6</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-7</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">20</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">6000-6003</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-8</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">20</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-9</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">20</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-10</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In </P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-11</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">21</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-12</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">20</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-13</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">20</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-14</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">FTP</SPAN
>-15</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">SMTP</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">25</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internal <span class="acronym">NNTP</SPAN
> server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">NNTP</SPAN
> feed server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">119</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">HTTP</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">HTTP</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">HTTP</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">80</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">HTTP</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">80</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[2]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[2]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[2]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-4</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">[2]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-5</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-6</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-7</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">DNS</SPAN
>-8</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Bastion</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">TCP</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">53</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&gt;1023</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Yes</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Permit</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Default-1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Out</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Default-2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">In</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Any</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Deny</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="footnote"><p class="para">[2] <span class="acronym">UDP</SPAN
> packets do not have
<span class="acronym">ACK</SPAN
> bits.</P
></BLOCKQUOTE
><p class="para">Here is some additional information about each set of rules in this
table.</P
><dl class="variablelist"><dt class="term"><em class="emphasis">Spoof-1 and Spoof-2</EM
></DT
><dd class="listitem"><p class="para">Block incoming packets that claim to have internal
or perimeter net <span class="acronym">IP</SPAN
> addresses&nbsp;- that is, forged
packets presumably sent by an attacker. Rule Spoof-1 is the same as
the Spoof rule on the interior router; rule Spoof-2 is unique to the
exterior router.</P
></DD
><dt class="term"><em class="emphasis">Telnet-1 and Telnet-2</EM
></DT
><dd class="listitem"><p class="para">Allow outgoing Telnet connections. These are identical to the
corresponding rules on the interior router (as are all rules on the
exterior router that involve internal and external hosts, but nothing
on the perimeter net).</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-1 through <span class="acronym">FTP</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow outgoing passive-mode <span class="acronym">FTP</SPAN
> connections and
are identical to the corresponding rules on the interior router.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-5 and <span class="acronym">FTP</SPAN
>-6</EM
></DT
><dd class="listitem"><p class="para">Allow the <span class="acronym">FTP</SPAN
> proxy server on the bastion host to
open an <span class="acronym">FTP</SPAN
> command channel to
<span class="acronym">FTP</SPAN
> servers on the Internet. Note that, unlike the
corresponding rules on the interior router, these rules are
<em class="emphasis">not </EM
> redundant if you have rules
<span class="acronym">FTP</SPAN
>-1 and <span class="acronym">FTP</SPAN
>-2 in place earlier
in the list. Why? Because &quot;Bastion&quot; as a source or
destination (covered by rules <span class="acronym">FTP</SPAN
>-5 and
<span class="acronym">FTP</SPAN
>-6) is not a subset of &quot;Internal&quot;
(covered by rules <span class="acronym">FTP</SPAN
>-1 and
<span class="acronym">FTP</SPAN
>-2).</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-7 through
<span class="acronym">FTP</SPAN
>-9</EM
></DT
><dd class="listitem"><p class="para"> Allow
<span class="acronym">FTP</SPAN
> data connections from external
<span class="acronym">FTP</SPAN
> servers to the proxy server on the bastion
host. The <span class="acronym">FTP</SPAN
>-7 rule prevents an attacker from
attacking X11 servers on the bastion host via the hole created by
rules <span class="acronym">FTP</SPAN
>-8 and <span class="acronym">FTP</SPAN
>-9. If you
have other servers on the bastion host listening for connections on
<span class="acronym">TCP</SPAN
> ports above 1023, you should add similar rules
for them. Note that trying to list things that should be denied (as in
rule <span class="acronym">FTP</SPAN
>-7) is a losing proposition, because your
list will almost always be incomplete, e.g., because you overlooked or
didn't know about some service, or because the service was added after
the filters were established.  However, it's the best you can do in
this situation, if you must support normal-mode
<span class="acronym">FTP</SPAN
>.  </P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">FTP</SPAN
>-10 through <span class="acronym">FTP</SPAN
>-15</EM
></DT
><dd class="listitem"><p class="para">Allow passive- and normal-mode <span class="acronym">FTP</SPAN
> from external
clients to the anonymous <span class="acronym">FTP</SPAN
> server on the bastion
host. There are no equivalent rules on the internal router because
there are no <span class="acronym">FTP</SPAN
> servers on the internal network
that external clients can access.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">SMTP</SPAN
>-1 and <span class="acronym">SMTP</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allow outgoing mail from the bastion host to the outside world.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">SMTP</SPAN
>-3 and <span class="acronym">SMTP</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow incoming mail from the outside world to the bastion host.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">NNTP</SPAN
>-1 to <span class="acronym">NNTP</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow Usenet news both ways between your Usenet news
server and your service provider's news server. These rules are identical to
the corresponding rules on the interior router.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">HTTP</SPAN
>-1 and <span class="acronym">HTTP</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allow the bastion host <span class="acronym">HTTP</SPAN
> proxy server to connect
to the <span class="acronym">HTTP</SPAN
> servers on any machine on the
Internet. Actually, these rules allow any <span class="acronym">TCP</SPAN
>
client program on the bastion host using a port above 1023 to contact
any server program on any host on the Internet using any port. This is
done so that the <span class="acronym">HTTP</SPAN
> proxy server can contact
<span class="acronym">HTTP</SPAN
> servers on nonstandard port numbers (i.e.,
other than port 80). As broad as these rules are, it's important that
they allow only outgoing connections, by examining the
<span class="acronym">ACK</SPAN
> bit.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">HTTP</SPAN
>-3 and <span class="acronym">HTTP</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow external clients to contact the bastion host
<span class="acronym">HTTP</SPAN
> server. There are no equivalent rules on the
internal router because there are no <span class="acronym">HTTP</SPAN
> servers
on the internal network that external clients can access.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-1</EM
></DT
><dd class="listitem"><p class="para">Allows <span class="acronym">UDP</SPAN
>-based <span class="acronym">DNS</SPAN
> queries and
answers from the bastion host <span class="acronym">DNS</SPAN
> server to
<span class="acronym">DNS</SPAN
> servers in the outside world.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-2</EM
></DT
><dd class="listitem"><p class="para">Allows <span class="acronym">UDP</SPAN
>-based
<span class="acronym">DNS</SPAN
> queries and answers from Internet
<span class="acronym">DNS</SPAN
> servers to the bastion host
<span class="acronym">DNS</SPAN
> server. Note that rule <span class="acronym">DNS</SPAN
>-2
(which allows server-to-server communication) is redundant if rule
<span class="acronym">DNS</SPAN
>-3 (which allows client-to-server communication)
is present.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-3 and <span class="acronym">DNS</SPAN
>-4</EM
></DT
><dd class="listitem"><p class="para">Allow external <span class="acronym">UDP</SPAN
>-based <span class="acronym">DNS</SPAN
>
clients to query the <span class="acronym">DNS</SPAN
> server on the bastion
host and it to answer them.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-5 and <span class="acronym">DNS</SPAN
>-6</EM
></DT
><dd class="listitem"><p class="para">Allow <span class="acronym">TCP</SPAN
>-based <span class="acronym">DNS</SPAN
> queries from
the bastion host to <span class="acronym">DNS</SPAN
> servers on the Internet, as
well as answers to those queries. Also allow zone transfers in which the bastion
host <span class="acronym">DNS</SPAN
> server is the secondary server and an
external <span class="acronym">DNS</SPAN
> server is the primary server.</P
></DD
><dt class="term"><em class="emphasis"><span class="acronym">DNS</SPAN
>-7 and <span class="acronym">DNS</SPAN
>-8</EM
></DT
><dd class="listitem"><p class="para">Allow <span class="acronym">TCP</SPAN
>-based <span class="acronym">DNS</SPAN
> queries from
the outside world to the bastion host <span class="acronym">DNS</SPAN
> server,
as well as answers to those queries. Also allow zone transfers in which
the bastion host <span class="acronym">DNS</SPAN
> server is the primary server
and an external <span class="acronym">DNS</SPAN
> server is the secondary server.</P
></DD
><dt class="term"><em class="emphasis">Default-1 and Default-2</EM
></DT
><dd class="listitem"><p class="para">Block all packets not specifically allowed by one
of the preceding rules, just as the corresponding rules do on the
interior router.</P
></DD
></DL
><a class="indexterm" name="AUTOID-19073"></A
><a class="indexterm" name="AUTOID-19074"></A
><a class="indexterm" name="AUTOID-19075"></A
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-09-S2-3">9.1.3 Other Configuration Work</A
></H3
><p class="para">In addition to setting up the packet filtering rules, we need to do
various other kinds of configuration work, as described below.</P
><dl class="variablelist"><dt class="term"><em class="emphasis">On all of the internal machines</EM
></DT
><dd class="listitem"><p class="para">Configure electronic mail so
that it gets sent to the bastion host. We're also going to need to
install passive mode <span class="acronym">FTP</SPAN
> clients if they're available.</P
></DD
><dt class="term"><em class="emphasis">On the internal mail server</EM
></DT
><dd class="listitem"><p class="para">Install the <em class="emphasis">smap</EM
> and
<em class="emphasis">smapd</EM
> programs from the <span class="acronym">TIS FWTK</SPAN
> and an up-to-date mailer release so that we have a
trusted <span class="acronym">SMTP</SPAN
> server.</P
></DD
><dt class="term"><em class="emphasis">On the internal (primary) name server</EM
></DT
><dd class="listitem"><p class="para">Put in an <span class="acronym">MX</SPAN
>
record for every A record, pointing incoming mail to the bastion host;
further <span class="acronym">MX</SPAN
> records may be necessary for the
internal mail server to direct the traffic internally. We also need
to configure the bastion host as a recognized secondary name server,
and remove any <span class="acronym">TXT</SPAN
> or <span class="acronym">HINFO</SPAN
>
records we don't want the external world to see (i.e., pretty
much any records the external world could possibly make any sense
of).</P
></DD
><dt class="term"><em class="emphasis">On the bastion host</EM
></DT
><dd class="listitem"><p class="para">Do all the standard bastion host configuration
(removing unused servers, adding logging, and so on), as discussed in
<a class="xref" href="ch05_01.htm" title="Bastion Hosts">Chapter 5</A
>. We need to install <span class="acronym">TIS FWTK</SPAN
> and configure <span class="acronym">FTP</SPAN
> proxying,
<em class="emphasis">smap </EM
> and <em class="emphasis">smapd,</EM
> and
anonymous <span class="acronym">FTP</SPAN
> service from it. We also need to
install the <span class="acronym">CERN HTTP</SPAN
> server and configure it to do
proxying, as well as to serve the <span class="acronym">HTTP</SPAN
> pages we
want to show the outside world.</P
></DD
></DL
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-09-S2-4">9.1.4 Analysis</A
></H3
><p class="para">Just how good a firewall is this one we've configured? Let's consider
it in relation to the strategies and principles discussed in <a class="xref" href="ch03_01.htm" title="Security Strategies">Chapter 3, <cite class="chapter">Security Strategies</CITE
></A
>.</P
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-9">9.1.4.1 Least privilege</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-19124"></A
><a class="indexterm" name="AUTOID-19126"></A
>The principle of least privilege is that an object (a program, a
person, a router, or whatever) should have the minimum privileges
necessary to perform its assigned task and no more. A corollary of
this principle is that systems should be configured so they require as
little privilege as possible. You can see this principle in action in
several places in this setup. For example, configuring
<span class="acronym">SMTP</SPAN
> so that outgoing mail goes out via the bastion
host (rather than directly to remote systems) is an application of
least privilege, because it lets you control more tightly how internal
systems connect to external systems. (In this case, it makes it
unnecessary for internal systems to talk directly to external systems
in order to provide this service.)</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-10">9.1.4.2 Defense in depth</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-19133"></A
><a class="indexterm" name="AUTOID-19135"></A
>The principle of defense in depth is something else that you can see in the setup we've described. For example, internal hosts are
protected from the outside world by the exterior and interior
routers. Similarly, the bastion host is protected against attack both
by its own careful configuration and by the exterior router.</P
><p class="para">Several times, we've explicitly made decisions to increase the depth of
defense. For example, that's one of the main purposes of using an
internal mail server between the bastion host and the internal clients.
The interior and exterior routers often deny the same packets. Defense
in depth is almost the only reason for having the interior router deny
packets that it supposedly can't receive (because they've
already been denied by the exterior router). </P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-11">9.1.4.3 Choke point</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-19142"></A
><a class="indexterm" name="AUTOID-19144"></A
>The principle of a choke point is clearly applied in our setup,
because everything between internal clients and the Internet comes
through the perimeter net. Further, much of it comes through the
bastion host, via proxies. Only Telnet and <span class="acronym">FTP</SPAN
> are
provided in ways that leave them relatively open. These services could
have been better choked by using proxies everywhere.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-12">9.1.4.4 Weakest link</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-19151"></A
><a class="indexterm" name="AUTOID-19153"></A
>There is no single obvious weak link to attack in this configuration.
Probably the weakest link is the bastion host, but even a completely
compromised bastion host isn't going to help an attacker when it
comes to attacking the internal systems; there just aren't that many
connections allowed from the bastion host to internal systems. Some of
the weakest links you can see remaining in this setup include
proxy <span class="acronym">FTP</SPAN
> and
<span class="acronym">SMTP</SPAN
> from the bastion host to
the internal mail server.</P
><p class="para">The proxy <span class="acronym">FTP</SPAN
> setup we've described would allow an
attacker who has compromised the bastion host to attack servers on
ports above 1023 (if there are any) on internal hosts. How can you
address this vulnerability? Obtain and use only passive-mode
<span class="acronym">FTP</SPAN
> clients internally, don't run proxy
<span class="acronym">FTP</SPAN
>, and remove the rules allowing proxy
<span class="acronym">FTP</SPAN
> from the filters.</P
><p class="para">Similarly, the <span class="acronym">SMTP</SPAN
> setup we've
described would allow an attacker who has compromised the bastion host
to attack your mail server via <span class="acronym">SMTP</SPAN
>.  How can you
address this vulnerability? Improve the security of the
<span class="acronym">SMTP</SPAN
> server on your mail server, e.g., by
using an up-to-date version of Sendmail, and by using the <span class="acronym">TIS FWTK</SPAN
> <em class="emphasis">smap</EM
> package.</P
><p class="para">You can keep playing this game of thinking &quot;If I were an attacker,
what would I do?&quot;, and then addressing the problems you discover
ad nauseam, or until you run out of time or money. At some point,
though, you (or your management) will probably decide you've done enough
(based on your own site's definition of &quot;enough&quot;).</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-13">9.1.4.5 Fail-safe stance</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-19173"></A
><a class="indexterm" name="AUTOID-19175"></A
>You can see the principle of a fail-safe stance applied through the
packet filtering rules. In general, the rules specify what you're going
to allow, and deny everything else by default. This is a fail-safe
approach, because if something unanticipated comes along (a new service,
for example), it won't be allowed through your firewall; unless, of
course, it mimics or is tunneled through some other service you do
allow. The redundant router rules also provide a fail-safe against
failure of one router or the other. If filtering accidentally or
temporarily gets turned off on one router (causing it to pass all
packets), the other still does most of the same filtering, at
least as far as the outside world is concerned.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-14">9.1.4.6 Universal participation</A
></H4
><p class="para">If this is our site's only connection to the Internet, we have
involuntary universal participation; everybody has to go through the
firewall to get to the Internet. Of course, we'd be much better off
with voluntary universal participation, but that may require some user
education about the goals of and the need for the security measures
we're adopting.</P
><p class="para">To some extent, we're relying on voluntary universal participation.
We've granted free Telnet and <span class="acronym">FTP</SPAN
> access, and in
the process we've allowed any outbound connection to ports at or above
1024 (which is plenty of rope for the users to hang us
with). <span class="acronym">FTP</SPAN
> is by no means the only service above
1024, and Telnet is a perfectly good client to use to get to many of
them.</P
><p class="para">In particular, we've assumed that this is your sole connection to the
Internet and that internal users aren't just going to bypass the
firewall entirely by setting up their own Internet connections. All it
takes is one joker with a modem, a <span class="acronym">PPP</SPAN
> software
package, and an outside phone line, and you too could have an
unprotected back door into your network.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="FIRE-09-S3-15">9.1.4.7 Diversity of defense</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-19189"></A
>There are opportunities in this configuration to apply the principle of
diversity of defense, e.g., using routers from different
vendors for the interior and exterior packet filtering systems. Most
sites will probably conclude that such an approach is not worth the
hassle. However, even if you use similar or identical
hardware, you still might get some diversity by having different people
do at least the initial configuration of the different filtering
systems, and then having them cross-check each other's work.</P
><p class="para">Using different <span class="acronym">SMTP</SPAN
> servers on the internal mail
server and the bastion host would be a fairly major advance in this
configuration, because that's one of the main weak points of your
setup. Even a less secure <span class="acronym">SMTP</SPAN
> server on the
internal mail server is arguably better than one that's going to yield
to the exact same attack that just succeeded on the bastion host. The
more vulnerable the <span class="acronym">SMTP</SPAN
> server you're using, the
more important an issue this is.</P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="FIRE-09-S2-5">9.1.5 Conclusions</A
></H3
><p class="para">There are a lot of advantages offered by a scheme such as the one
we've described in the sections above. The main potential
disadvantages we can see are cost and complexity; but we don't think
that the configuration we've presented is too expensive for most
sites, and we think that it presents the minimum necessary level of
complexity.</P
><p class="para">What if you really need to save some money? It would be feasible to
construct a screened subnet architecture using a single three-interface
router, instead of the pair of two-interface routers we've described
above. The solution would be a little more complex, because you'd have
to merge the two separate filtering sets described above, but doing so
shouldn't be too difficult.</P
><p class="para">It would also be relatively easy to construct a more secure
configuration with the same basic architecture. A less trusting site
would force all Telnet and all <span class="acronym">FTP</SPAN
> through proxies,
which would allow much better logging and remove the nagging holes
created by allowing every outbound connection to ports above 1024. Once
you'd forced Telnet and <span class="acronym">FTP</SPAN
> through proxies, you'd
also find that <span class="acronym">DNS</SPAN
> information hiding would be both
more practical and more reasonable. However, the price of this
increased security would be a more complex and fragile configuration,
and one that presents more annoyance to the users.</P
><p class="para">It would also be possible to increase the services offered without
major architecture changes. For example, incoming Telnet and incoming
user <span class="acronym">FTP</SPAN
> could be supported relatively easily for a
few users on the bastion host or on a dedicated host on the screened
network. Serious anonymous <span class="acronym">FTP</SPAN
> service or
<span class="acronym">HTTP</SPAN
> service could be provided by configuring extra
machines on the screened network. Similarly, you could scale up the
firewall to support a second Internet connection or redundant bastion
hosts to provide more reliable service or service for a much larger
internal network.<a class="indexterm" name="AUTOID-19208"></A
><a class="indexterm" name="AUTOID-19209"></A
></P
></DIV
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch08_18.htm" title="8.18 Analyzing Other Protocols"><img src="../gifs/txtpreva.gif" alt="Previous: 8.18 Analyzing Other Protocols" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Building Internet Firewalls"><img src="../gifs/txthome.gif" alt="Building Internet Firewalls" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch09_02.htm#FIRE-09-S3-26" title="9.2 Screened Host Architecture"><img src="../gifs/txtnexta.gif" alt="Next: 9.2 Screened Host Architecture" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">8.18 Analyzing Other Protocols</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_a.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">9.2 Screened Host Architecture</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
