<html><head>
<title>[Chapter 10] 10.5 The UNIX System Log (syslog) Facility</TITLE>
<meta name="DC.title" content="Practical UNIX &amp; Internet Security"><meta name="DC.creator" content="Simson Garfinkel &amp; Gene Spafford"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T00:07:40Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-148-8" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch10_01.htm" title="10. Auditing and Logging"><link rel="prev" href="ch10_04.htm#PUIS-CHP-10-SECT-4.1" title="10.4 Per-User Trails in the Filesystem"><link rel="next" href="ch10_06.htm#PUIS-CHP-10-SECT-6.2" title="10.6 Swatch: A Log File Tool"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Practical UNIX &amp; Internet Security" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="Practical UNIX &amp; Internet Security"><area shape="RECT" coords="467,0,514,18" href="../search/psrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch10_04.htm#PUIS-CHP-10-SECT-4.1" title="10.4 Per-User Trails in the Filesystem"><img src="../gifs/txtpreva.gif" alt="Previous: 10.4 Per-User Trails in the Filesystem" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 10<br>Auditing and Logging</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch10_06.htm#PUIS-CHP-10-SECT-6.2" title="10.6 Swatch: A Log File Tool"><img src="../gifs/txtnexta.gif" alt="Next: 10.6 Swatch: A Log File Tool" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="PUIS-CHP-10-SECT-5">10.5 The UNIX System Log (syslog) Facility</A
></H2
><p class="para">In <a class="indexterm" name="AUTOID-13631"></A
><a class="indexterm" name="AUTOID-13633"></A
><a class="indexterm" name="AUTOID-13636"></A
>
addition to the various logging
facilities mentioned above, many versions of <span class="acronym">UNIX</SPAN
>
provide a general-purpose logging facility called <em class="emphasis">syslog</EM
>,
originally developed at the University of California at Berkeley
for the Berkeley <em class="emphasis">sendmail</EM
> program. Since then,
<em class="emphasis">syslog</EM
> has been ported to several System V-based
systems, and is now widely available. The uses of <em class="emphasis">syslog</EM
>
have similarly been expanded.</P
><p class="para"><em class="emphasis">syslog</EM
> is a host-configurable, uniform
system logging facility. The system uses a centralized system logging
process that runs the program <em class="emphasis">/etc/syslogd</EM
>
or <em class="emphasis">/etc/syslog</EM
>. Individual programs that need
to have information logged send the information to <em class="emphasis">syslog</EM
>.
The messages can then be logged to various files, devices, or computers,
depending on the sender of the message and its severity.</P
><p class="para">Any program can generate a <em class="emphasis">syslog</EM
> log
message. Each message consists of four parts:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">Program name</P
></LI
><li class="listitem"><p class="para">Facility</P
></LI
><li class="listitem"><p class="para">Priority</P
></LI
><li class="listitem"><p class="para">Log message itself</P
></LI
></UL
><p class="para">For example, the message:</P
><blockquote class="screen"><pre class="screen">login: Root LOGIN REFUSED on ttya</PRE
></BLOCKQUOTE
><p class="para">is a log message generated by the <em class="emphasis">login</EM
>
program. It means that somebody tried to log into an unsecure terminal
as <em class="emphasis">root</EM
>. The messages's facility (authorization)
and error level (critical error) are not shown.</P
><p class="para">The <em class="emphasis">syslog</EM
> facilities are summarized
in <a class="xref" href="#PUIS-CHP-10-TAB-1" title="syslog Facilities">Table 10.1</A
>. Not all facilities are present on all versions of
<span class="acronym">UNIX</SPAN
>.</P
><table class="table"><caption class="table"><a class="title" name="PUIS-CHP-10-TAB-1">Table 10.1: syslog Facilities</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Name</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Facility</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">kern</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Kernel</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">user</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Regular user processes</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">mail</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Mail system</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">lpr</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Line printer system</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">auth</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Authorization system, or programs that
ask for user names and passwords (<kbd class="command">login, su, getty, ftpd,</KBD
> etc.)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">daemon</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Other system daemons</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">news</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">News subsystem</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">uucp</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UUCP</SPAN
> subsystem</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">local0... local7</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Reserved for site-specific use</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">mark</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">A timestamp facility that sends out a
message every 20 minutes</P
></TD
></TR
></TBODY
></TABLE
><p class="para">The <em class="emphasis">syslog</EM
> priorities are summarized
in Table 10-2:</P
><table class="table"><caption class="table"><a class="title" name="PUIS-CHP-10-TAB-2">Table 10.2: syslog Priorities</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Priority</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Meaning</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">emerg</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Emergency condition, such as an imminent
system crash, usually broadcast to all users</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">alert</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Condition that should be corrected immediately,
such as a corrupted system database</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">crit</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Critical condition, such as a hardware
error</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">err</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Ordinary error</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">warning</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Warning</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">notice</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Condition that is not an error, but possibly
should be handled in a special way</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">info</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Informational message</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">debug</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Messages that are used when debugging
programs</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">none</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Do not send messages from the indicated
facility to the selected file. For example, specifying <em class="emphasis">*.debug;mail.none</EM
>
sends all messages except mail messages to the selected file.</P
></TD
></TR
></TBODY
></TABLE
><p class="para">When <em class="emphasis">syslogd</EM
> starts up, it reads its
configuration file, usually <i class="filename">/</I
><em class="emphasis">etc/syslog.conf</EM
>,
to determine what kinds of events it should log and where they should
be logged. <em class="emphasis">syslogd</EM
> then listens for log messages
from three sources, shown in <a class="xref" href="#PUIS-CHP-10-TAB-3" title="Log Message Sources">Table 10.3</A
>.</P
><table class="table"><caption class="table"><a class="title" name="PUIS-CHP-10-TAB-3">Table 10.3: Log Message Sources</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Source</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Meaning</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis">/dev/klog</EM
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Special device, used to read messages
generated by the kernel</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis">/dev/log</EM
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UNIX</SPAN
> domain socket,
used to read messages generated by processes running on the local
machine</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UDP</SPAN
> port 514</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Internet domain socket, used to read
messages generated over the local area network from other machines</P
></TD
></TR
></TBODY
></TABLE
><div class="sect2"><h3 class="sect2"><a class="title" name="PUIS-CHP-10-SECT-5.1">10.5.1 The syslog.conf Configuration File</A
></H3
><p class="para">The <i class="systemitem">/etc/syslog.conf</I
>
file controls where messages are logged. A typical <em class="emphasis">syslog.conf</EM
>
file might look like this:</P
><blockquote class="screen"><pre class="screen">*.err;kern.debug;auth.notice /dev/console
daemon,auth.notice           /var/adm/messages
lpr.*                        /var/adm/lpd-errs
auth.*                       root,nosmis
auth.*                       @prep.ai.mit.edu
*.emerg                      *
*.alert                      |dectalker
mark.*                       /dev/console</PRE
></BLOCKQUOTE
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> <a class="indexterm" name="AUTOID-13849"></A
>The
format of the <i class="filename">syslog.conf</I
> configuration file
may vary from vendor to vendor. Be sure to check the documentation
for your own system.</P
></BLOCKQUOTE
><p class="para">Each line of the file contains two parts:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">A selector that specifies which kind
of messages to log (e.g., all error messages or all debugging messages
from the kernel).</P
></LI
><li class="listitem"><p class="para">An action field that says what should be done with
the message (e.g., put it in a file or send the message to a user's
terminal).</P
></LI
></UL
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> You must use the tab character between the selector
and the action field. If you use a space, it will look the same,
but <i class="filename">syslog </I
>will not work.</P
></BLOCKQUOTE
><p class="para">Message selectors have two parts: a facility and a priority.
<em class="emphasis">kern.debug</EM
>, for example, selects all debug
messages (the priority) generated by the kernel (the facility).
It also selects all priorities that are greater than debug. An asterisk
in place of either the facility or the priority indicates &quot;all.&quot;
(That is, *<em class="emphasis">.debug</EM
> means all debug
messages, while <em class="emphasis">kern.</EM
>* means all messages
generated by the kernel.) You can also use commas to specify multiple
facilities. Two or more selectors can be grouped together by using
a semicolon. (Examples are shown above.)</P
><p class="para">The action field specifies one of five actions:[7]</P
><blockquote class="footnote"><p class="para">[7] Some
versions of <em class="emphasis">syslog</EM
> support additional actions,
such as logging to a proprietary error management system.</P
></BLOCKQUOTE
><ul class="itemizedlist"><li class="listitem"><p class="para">Log to a file or a device. In this
case, the action field consists of a filename (or device name),
which must start with a forward slash (e.g., <em class="emphasis">/var/adm/lpd-errs
or /dev/console).</EM
> [8]</P
><blockquote class="footnote"><p class="para">[8] Beware: logging to
<i class="filename">/dev/console</I
> creates the possibility of a denial
of service attack. If you are logging to the console, an attacker
can flood your console with log messages, rendering it unusable.</P
></BLOCKQUOTE
></LI
><li class="listitem"><p class="para">Send a message to a <a class="indexterm" name="AUTOID-13878"></A
>
user. In this case, the action field consists of a
username (e.g., <em class="emphasis">root</EM
>). You can specify multiple
usernames by separating them with commas (e.g., <em class="emphasis">root,nosmis</EM
>).
The message is written to each terminal where these users are shown
to be logged in, according to the <i class="filename">utmp</I
> file.</P
></LI
><li class="listitem"><p class="para">Send a message to all users. In this case, the action
field consists of an asterisk (e.g., *).</P
></LI
><li class="listitem"><p class="para">Pipe the message to a program. In this case, the
program is specified after the <span class="acronym">UNIX</SPAN
> pipe symbol
(|). [9]</P
><blockquote class="footnote"><p class="para">[9] Some versions of <em class="emphasis">syslog</EM
>
do not support logging to programs.</P
></BLOCKQUOTE
></LI
><li class="listitem"><p class="para">Send the message to the <em class="emphasis">syslog</EM
>
on another host. In this case, the action field consists of a hostname,
preceded by an at sign (e.g.,<em class="emphasis"> </EM
><i class="filename">@prep.ai.mit.edu</I
><em class="emphasis">.</EM
>).</P
></LI
></UL
><p class="para">With the following explanation, understanding the typical
<em class="emphasis">syslog.conf</EM
> configuration file as shown earlier
becomes easy.</P
><dl class="variablelist"><dt class="term"><kbd class="command">*.err;kern.debug;auth.notice
/dev/console</KBD
> </DT
><dd class="listitem"><p class="para">This line causes all error messages, all kernel
debug messages, and all notice messages generated by the authorization
system to be printed on the system console. If your system console
is a printing terminal, this process will generate a permanent hardcopy
that you can file and use for later reference. (Note that <em class="emphasis">kern.debug</EM
>
means all messages of priority <em class="emphasis">debug</EM
> and above.)</P
></DD
><dt class="term"><kbd class="command">daemon,auth.notice           /var/adm/messages</KBD
></DT
><dd class="listitem"><p class="para">This line causes all notice messages from either
the system daemons or the authorization system to be appended to
the file <em class="emphasis">/var/adm/messages</EM
>.</P
><p class="para">Note that this is the second line that mentions
<em class="emphasis">auth.notice</EM
> messages. As a result, <em class="emphasis">auth.notice</EM
>messages will be sent to <em class="emphasis">both</EM
> the
console and the <em class="emphasis">messages</EM
> file.</P
></DD
><dt class="term"><kbd class="command">lpr.*                        /var/adm/lpd-errs</KBD
></DT
><dd class="listitem"><p class="para">This line causes all messages from the line printer
system to be appended to the <em class="emphasis">/var/adm/lpd-errs</EM
>
file.</P
></DD
><dt class="term"><kbd class="command">auth.*                       root,nosmis</KBD
></DT
><dd class="listitem"><p class="para">This line causes all messages from the authorization
system to be sent to the users <em class="emphasis">root</EM
> and <em class="emphasis">nosmis</EM
>.
Note, however, that if the users are not logged in, the messages
will be lost.</P
></DD
><dt class="term"><kbd class="command">auth.*                       @prep.ai.mit.edu</KBD
></DT
><dd class="listitem"><p class="para">This line causes all authorization messages to be
sent to the <em class="emphasis">syslog</EM
> daemon on the computer <i class="filename">prep.ai.mit.edu</I
>.
If you have a cluster of many different machines, you may wish to
have them all perform their loggings on a central (and presumably
secure) computer.</P
></DD
><dt class="term"><kbd class="command">*.emerg                      *</KBD
></DT
><dd class="listitem"><p class="para">This line causes all emergency messages to be displayed
on every user's terminal.</P
></DD
><dt class="term"><kbd class="command">*.alert                      |dectalker</KBD
></DT
><dd class="listitem"><p class="para">This line causes all alert messages to be sent to
a program called <em class="emphasis">dectalker</EM
>, which might broadcast
the message over a public address system.</P
></DD
><dt class="term"><kbd class="command">mark.*                       /dev/console</KBD
></DT
><dd class="listitem"><p class="para">This line causes the time to be printed on the system
console every 20 minutes. This is useful if you have other information
being printed on the console and you want a running clock on the
printout.</P
></DD
></DL
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> By default, <i class="filename">syslog </I
>will accept
log messages from arbitrary hosts sent to the local <i class="filename">syslog</I
> <span class="acronym">UDP</SPAN
> port. This can result in a <a class="indexterm" name="AUTOID-13960"></A
>
denial
of service attack when the port is flooded with messages faster
than the <em class="emphasis">syslog</EM
> daemon can process them. Individuals
can also log fraudulent messages. You must properly screen your
network against outside log messages.<a class="indexterm" name="AUTOID-13964"></A
></P
></BLOCKQUOTE
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PUIS-CHP-10-SECT-5.2">10.5.2 Where to Log</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-13969"></A
>Because
the <em class="emphasis">syslog</EM
> facility provides many different
logging options, this gives individual sites flexibility in setting
up their own logging. Different kinds of messages can be handled
in different ways. For example, most users won't want to
be bothered with most log messages. On the other hand, <kbd class="command">auth.crit</KBD
> messages should be displayed on the system administrator's
screen (in addition to being recorded in a file). This section describes
a few different approaches.</P
><div class="sect3"><h4 class="sect3"><a class="title" name="PUIS-CHP-10-SECT-5.2.1">10.5.2.1 Logging to a printer</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-13977"></A
><a class="indexterm" name="AUTOID-13980"></A
><a class="indexterm" name="AUTOID-13983"></A
>If you have a printer
you wish to devote to system logging, you can connect it to a terminal
port and specify that port name in the <i class="filename">/</I
><em class="emphasis">etc/syslog.conf</EM
>
file.</P
><p class="para">For example, you might connect a special-purpose printer to
the port <i class="filename">/</I
><em class="emphasis">dev/ttya</EM
>. You
can then log all messages from the authorization system (such as
invalid passwords) by inserting the following line in your <em class="emphasis">syslog.conf</EM
>
file:</P
><blockquote class="screen"><pre class="screen">auth.*                 /dev/ttya</PRE
></BLOCKQUOTE
><p class="para">A printer connected in such a way should only be used for
logging. We suggest using dot-matrix printers, rather than laser
printers, because dot-matrix printers allow you to view the log
line by line as it is written, rather than waiting until an entire
page is completed.</P
><p class="para">Logging to a hardcopy device is a very good idea if you think
that your system is being visited by unwelcome intruders on a regular
basis. The intruders can erase log files, but after something is
sent to a printer, they cannot touch the printer output without
physically breaking into your establishment.[10]</P
><blockquote class="footnote"><p class="para">[10] Although
if they have superuser access they can temporarily stop logging
or change what is logged.</P
></BLOCKQUOTE
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> Be sure that you do not log solely to a hardcopy device.
Otherwise, you will lose valuable information if the printer jams
or runs out of paper, the ribbon breaks, or somebody steals the
paper printout.</P
></BLOCKQUOTE
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="PUIS-CHP-10-SECT-5.2.2">10.5.2.2 Logging across the network</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-14001"></A
><a class="indexterm" name="AUTOID-14004"></A
><a class="indexterm" name="AUTOID-14007"></A
>If you have several machines
connected together by a <span class="acronym">TCP/IP</SPAN
> network, you may
wish to have events from all of the machines logged on one (or more)
log machines. If this machine is secure, the result will be a log
file that can't be altered, even if the security on the
other machines is compromised.* To have all of the messages
from one computer sent to another computer, you simply insert this
line in the first computer's <em class="emphasis">syslog.conf</EM
>
file:</P
><blockquote class="screen"><pre class="screen">*.*               @loghost</PRE
></BLOCKQUOTE
><p class="para">This feature can cause a lot of network traffic. Instead,
you limit your log to only &quot;important&quot; messages.
For example, this log file would simply send the hardware and security-related
messages to the remote logging host, but keep some copies on the
local host for debugging purposes:</P
><blockquote class="screen"><pre class="screen">*.err;kern.debug;auth.notice /dev/console
daemon,auth.notice           /var/adm/messages
lpr.*                        @loghost1,@loghost2
auth.*                       @loghost1,@loghost2
*.emerg                      @loghost1,@loghost2
*.alert                      @loghost1,@loghost2
mark.*                       /dev/console&#13;</PRE
></BLOCKQUOTE
><p class="para">Logging to another host adds to your overall system security:
even if people break into one computer and erase its log files,
they will still have to deal with the log messages sent across the
network to the other system. If you do log to a remote host, you
might wish to restrict user accounts on that machine. However, be
careful: if you only log over the network to a single host, then
that one host is a single point of failure. The above example logs
to both <em class="emphasis">loghost1</EM
> and <em class="emphasis">loghost2</EM
>.</P
><p class="para">Another alternative is to use a non<span class="acronym">-UNIX</SPAN
>
machine as the log host. The <em class="emphasis">syslog</EM
> code can
be compiled on other machines with standard C and <span class="acronym">TCP/IP</SPAN
>
libraries. Thus, you can log to a <span class="acronym">DOS</SPAN
> or Macintosh
machine, and further protect your logs. After all, if <em class="emphasis">syslog</EM
>
is the only network service running on those systems, there is no
way for someone to break in from the net to alter the logs!</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="PUIS-CHP-10-SECT-5.2.3">10.5.2.3 Logging everything everywhere</A
></H4
><p class="para">Disks are cheap these days. Sites with sufficient resources
and adequately trained personnel sometimes choose to log everything
that might possibly be useful, and log it in many different places.
For example, clients can create their own log files of <em class="emphasis">syslog</EM
>
events, and also send all logging messages to several different
logging hosts&nbsp;- possibly on different networks.</P
><p class="para">The advantage of logging in multiple places is that it makes
an attacker's attempts at erasing any evidence of his presence
much more difficult. On the other hand, multiple log files will
not do you any good if they are never examined. Furthermore, if
they are never pruned, they may grow so large that they will shut
down your computers.<a class="indexterm" name="AUTOID-14029"></A
></P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PUIS-CHP-10-SECT-5.3">10.5.3 syslog Messages</A
></H3
><p class="para">The <a class="indexterm" name="AUTOID-14035"></A
><a class="indexterm" name="AUTOID-14038"></A
>
following tables[11]
summarize some typical messages available on various versions of
<span class="acronym">UNIX</SPAN
>.:</P
><blockquote class="footnote"><p class="para">[11] A similar list
is not available for System V UNIX, because <em class="emphasis">syslog</EM
>
is part of the Berkeley UNIX offering. Companies that sell <em class="emphasis">syslog</EM
>
with their System V offerings may or may not have modified the additional
programs in their operating systems to allow them to use the <i class="systemitem">syslog</I
> logging facility.</P
></BLOCKQUOTE
><table class="table"><caption class="table"><a class="title" name="PUIS-CHP-10-TAB-4">Table 10.4: Typical Critical Messages</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Program</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Message</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Meaning</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">halt</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">halted by &lt;user&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&lt;user&gt; used the <em class="emphasis">/etc/halt</EM
>
command to shut down the system.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">login</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ROOT</SPAN
> <span class="acronym">LOGIN</SPAN
>
<span class="acronym">REFUSED</SPAN
> <span class="acronym">ON</SPAN
> &lt;tty&gt;
[<span class="acronym">FROM</SPAN
> &lt;hostname&gt;]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis">root</EM
> tried to log
onto a terminal that is not secure.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">login</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">REPEATED</SPAN
> <span class="acronym">LOGIN</SPAN
>
<span class="acronym">FAILURES</SPAN
> <span class="acronym">ON</SPAN
> &lt;tty&gt;
[<span class="acronym">FROM</SPAN
> &lt;hostname&gt;]
&lt;user&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Somebody tried to log in as &lt;user&gt;
and supplied a bad password more than five times.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">reboot</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">rebooted by &lt;user&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&lt;user&gt; rebooted the
system with the <em class="emphasis">/etc/reboot</EM
> command.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">su</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">BAD</SPAN
> <span class="acronym">SU</SPAN
>
&lt;user&gt; on &lt;tty&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Somebody tried to <em class="emphasis">su</EM
>
to the superuser and did not supply the correct password.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">shutdown</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">reboot, halt, or shutdown by &lt;user&gt;
on &lt;tty&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&lt;user&gt; used the <em class="emphasis">/etc/shutdown</EM
>
command to reboot, halt, or shut down the system.</P
></TD
></TR
></TBODY
></TABLE
><p class="para">Other critical conditions that might be present might include
messages about full filesystems, device failures, or network problems.</P
><table class="table"><caption class="table"><a class="title" name="PUIS-CHP-10-TAB-5">Table 10.5: Typical Info Messages</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Program</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Message</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Meaning</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">date</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">date set by &lt;user&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&lt;user&gt; changed the
system date.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">login</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">ROOT</SPAN
> <span class="acronym">LOGIN</SPAN
>
&lt;tty&gt; [<span class="acronym">FROM</SPAN
> &lt;hostname&gt;]</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"></P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">root logged in.</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"></P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">su</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&lt;user&gt; on &lt;tty&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&lt;user&gt; used the <em class="emphasis">su</EM
>
command to become the superuser.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">getty</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">&lt;tty&gt;</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">/bin/getty was unable
to  open &lt;tty&gt;.</P
></TD
></TR
></TBODY
></TABLE
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> <a class="indexterm" name="AUTOID-14178"></A
>For security
reasons, some information should never be logged. For example, although
you should log failed <a class="indexterm" name="AUTOID-14181"></A
><a class="indexterm" name="AUTOID-14184"></A
><a class="indexterm" name="AUTOID-14188"></A
>
password
attempts, you should not log the password that was used in the failed
attempt. Users frequently mistype their own passwords, and logging
these mistyped passwords would help a computer cracker break into
a user's account. Some system administrators believe that
the account name should also not be logged on failed login attempts&nbsp;- especially
when the account typed by the user is nonexistent. The reason is
that users occasionally type their passwords when they are prompted
for their usernames. If invalid accounts are logged, then it might
be possible for an attacker to use those logs to infer people's
passwords.</P
></BLOCKQUOTE
><p class="para">You may want to insert <em class="emphasis">syslog</EM
> calls into
your own programs to record information of importance. Third-party
software also often has a capability to send log messages into the
<i class="filename">syslog</I
> if configured correctly. For example,
Xyplex terminal servers and Cisco routers both can log information
to a network <em class="emphasis">syslog</EM
> daemon; Usenet news and
<span class="acronym">POP</SPAN
> mail servers also log information.</P
><p class="para">If you are writing shell scripts, you can also log to <em class="emphasis">syslog</EM
>.
Usually, systems with <em class="emphasis">syslog</EM
> come with the
<em class="emphasis"><a class="indexterm" name="AUTOID-14200"></A
>logger</EM
>
command. To log a warning message about a user trying to execute
a shell file with invalid parameters, you might include:</P
><blockquote class="screen"><pre class="screen">logger -t ThisProg -p user.notice &quot;Called without required # of parameters&quot;</PRE
></BLOCKQUOTE
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> Prior to 1995, many versions of the <em class="emphasis">syslog</EM
>
library call did not properly check their inputs to be certain that
the data would fit into the function's internal buffers.
Thus, many programs could be coerced to accept input to write arbitrary
data over their stacks, leading to potential compromise. Be certain
that you are running software using a version of <em class="emphasis">syslog</EM
>
that does not have this vulnerability.</P
></BLOCKQUOTE
><div class="sect3"><h4 class="sect3"><a class="title" name="PUIS-CHP-10-SECT-5.3.1">10.5.3.1 Beware false log entries</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-14210"></A
><a class="indexterm" name="AUTOID-14213"></A
>The <span class="acronym">UNIX</SPAN
> <em class="emphasis">syslog</EM
>
facility allows any user to create log entries. This capability
opens up the possibility for false data to be entered into your
logs. An interesting story of such logging was given to us by Alec
<a class="indexterm" name="AUTOID-14218"></A
>
Muffet:</P
><blockquote class="blockquote"><p class="para">A friend of mine&nbsp;- a UNIX sysadmin&nbsp;- enrolled
as a mature student at a local polytechnic in order to secure the
degree which had been eluding him for the past four years.</P
><p class="para">One of the other students on his Computer Science course was
an obnoxious geek user who was shoulder surfing people and generally
making a nuisance of himself, and so my friend determined to take
revenge.</P
><p class="para">The site was running an early version of Ultrix on an 11/750,
but the local operations staff were somewhat paranoid about security,
had removed world execute from &quot;<em class="emphasis">su</EM
>&quot;
and left it group-execute to those in the <i class="filename">wheel</I
>
group, or similar; in short, only the sysadmin staff should have
execute access for <em class="emphasis">su</EM
>.</P
><p class="para">Hence, the operations staff were somewhat worried to see messages
with the following scrolling up the console:</P
></BLOCKQUOTE
><blockquote class="screen"><pre class="screen">		BAD SU: geekuser ON ttyp4 AT 11:05:20
		BAD SU: geekuser ON ttyp4 AT 11:05:24
		BAD SU: geekuser ON ttyp4 AT 11:05:29
		BAD SU: geekuser ON ttyp4 AT 11:05:36
		...</PRE
></BLOCKQUOTE
><blockquote class="blockquote"><p class="para">When the console eventually displayed:</P
></BLOCKQUOTE
><blockquote class="screen"><pre class="screen">		SU: geekuser ON ttyp4 AT 11:06:10</PRE
></BLOCKQUOTE
><blockquote class="blockquote"><p class="para">all hell broke loose: the operations staff panicked
at the thought of an undergrad running around the system as <em class="emphasis">root</EM
>
and pulled the plug (!) on the machine. The system administrator
came into the terminal room, grabbed the geekuser, took him away
and shouted at him for half an hour, asking (a) why was he hacking,
(b) how was he managing to execute <em class="emphasis">su</EM
> and (c)
how he had guessed the <em class="emphasis">root</EM
> password?</P
><p class="para">Nobody had noticed my friend in the corner of the room, quietly
running a script which periodically issued the following command,
redirected into <em class="emphasis">/dev/console</EM
>, which was world-writable:</P
></BLOCKQUOTE
><blockquote class="screen"><pre class="screen">		echo BAD SU: geekuser ON ttyp4 AT `date` </PRE
></BLOCKQUOTE
><blockquote class="blockquote"><p class="para">The moral of course is that you shouldn't
panic, and that you should treat your audit trail with <a class="indexterm" name="AUTOID-14242"></A
><a class="indexterm" name="AUTOID-14245"></A
>
suspicion.
<a class="indexterm" name="AUTOID-14248"></A
><a class="indexterm" name="AUTOID-14250"></A
></P
></BLOCKQUOTE
></DIV
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch10_04.htm#PUIS-CHP-10-SECT-4.1" title="10.4 Per-User Trails in the Filesystem"><img src="../gifs/txtpreva.gif" alt="Previous: 10.4 Per-User Trails in the Filesystem" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Practical UNIX &amp; Internet Security"><img src="../gifs/txthome.gif" alt="Practical UNIX &amp; Internet Security" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch10_06.htm#PUIS-CHP-10-SECT-6.2" title="10.6 Swatch: A Log File Tool"><img src="../gifs/txtnexta.gif" alt="Next: 10.6 Swatch: A Log File Tool" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">10.4 Per-User Trails in the Filesystem</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">10.6 Swatch: A Log File Tool</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
