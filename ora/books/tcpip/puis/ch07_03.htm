<html><head>
<title>[Chapter 7] 7.3 Backing Up System Files</TITLE>
<meta name="DC.title" content="Practical UNIX &amp; Internet Security"><meta name="DC.creator" content="Simson Garfinkel &amp; Gene Spafford"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-02-04T00:05:22Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-148-8" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch07_01.htm" title="7. Backups"><link rel="prev" href="ch07_02.htm" title="7.2 Sample Backup Strategies"><link rel="next" href="ch07_04.htm#PUIS-CHP-7-SECT-4.3" title="7.4 Software for Backups"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="Practical UNIX &amp; Internet Security" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="Practical UNIX &amp; Internet Security"><area shape="RECT" coords="467,0,514,18" href="../search/psrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_02.htm" title="7.2 Sample Backup Strategies"><img src="../gifs/txtpreva.gif" alt="Previous: 7.2 Sample Backup Strategies" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 7<br>Backups</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch07_04.htm#PUIS-CHP-7-SECT-4.3" title="7.4 Software for Backups"><img src="../gifs/txtnexta.gif" alt="Next: 7.4 Software for Backups" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="PUIS-CHP-7-SECT-3">7.3 Backing Up System Files</A
></H2
><p class="para">In <a class="indexterm" name="AUTOID-9498"></A
><a class="indexterm" name="AUTOID-9501"></A
><a class="indexterm" name="AUTOID-9504"></A
>
addition to performing routine backups of your
entire computer system, you may wish to make separate backup copies
of system-critical files on a regular basis. These backups can serve
several functions:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">They can help you quickly recover
if a vital configuration file is unexpectedly erased or modified.</P
></LI
><li class="listitem"><p class="para">They can help you detect unauthorized modifications
to critical files, as well as monitor legitimate modifications.</P
></LI
><li class="listitem"><p class="para">They make installing a new version of your operating
system dramatically easier (especially if you do not wish to use
your vendor's &quot;upgrade&quot; facility) by
isolating all site-dependent configuration files in a single place.</P
></LI
></UL
><p class="para">Ideally, you should back up every file that contains vital
system configuration or account information.</P
><p class="para">Setting-up an automatic system for backing up your system
files is not difficult. You might, for instance, simply have a shell
script that copies the files <i class="filename">/etc/passwd</I
> and <i class="filename">/usr/etc/aliases</I
>
into a specially designated &quot;backup directory&quot;
on a regular basis. Or you might have a more sophisticated system,
in which a particular workstation gathers together all of the configuration
files for every computer on a network, archives them in a directory,
and sends you email each day that describes any modifications. The
choice is up to you and your needs.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="PUIS-CHP-7-SECT-3.1">7.3.1 What Files to Back Up?</A
></H3
><p class="para">If <a class="indexterm" name="AUTOID-9522"></A
>
you
are constructing a system for backing up system files on a regular
basis, you should carefully consider which files you wish to archive
and what you want to do with them.</P
><p class="para">By comparing a copy of the password file with <i class="filename">/etc/passwd</I
>,
for example, you can quickly discover if a new user has been added
to the system. But it is also important to check other files. For
example, if an intruder can modify the <i class="filename">/etc/rc </I
>file,
the commands he inserts will be executed automatically the next
time the system is booted. Modifying <i class="filename">/usr/lib/crontab</I
>
can have similar results. (<a class="xref" href="ch11_01.htm" title="Protecting Against Programmed Threats">Chapter 11, <cite class="chapter">Protecting Against Programmed Threats</CITE
></A
>, describes what you should
look for in these files.)</P
><p class="para">Some files that you may wish to copy are listed in <a class="xref" href="#PUIS-CHP-7-TAB-1" title="Critical System Files That You Should Frequently Back Up">Table 7.1</A
>.</P
><table class="table"><caption class="table"><a class="title" name="PUIS-CHP-7-TAB-1">Table 7.1: Critical System Files That You Should Frequently Back Up</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Filename</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Things to Look for</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/passwd</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">New accounts</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/shadow</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Accounts with no passwords</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/group</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">New groups</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/rc*</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Changes in the system boot sequence</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/ttys, /etc/ttytab</I
>,
or <i class="filename">/etc/inittab</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Configuration changes in terminals</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/usr/lib/crontab, /usr/spool/cron/crontabs/</I
>,
or
<i class="filename">/etc/crontab</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">New commands set to run on a regular
basis</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/usr/lib/aliases</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Changes in mail delivery (especially
email addresses that are redirected to programs.)</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/exports</I
> (<span class="acronym">BSD</SPAN
>)
<i class="filename">/etc/dfs/dfstab</I
>
(<span class="acronym">SVR4</SPAN
>)</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Changes in your <span class="acronym">NFS</SPAN
>
filesystem security</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/netgroups</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Changes in network groups</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/fstab</I
> (<span class="acronym">BSD</SPAN
>)
<i class="filename">/etc/vfstab</I
>
(<span class="acronym">SVR4</SPAN
>)</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Changes in mounting options</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">/etc/inetd.conf</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Changes in network daemons</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><span class="acronym">UUCP</SPAN
> files (in <i class="filename">/usr/lib/uucp</I
>
or <i class="filename">/etc/uucp</I
>)</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"></P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">L.sys</I
> or <span class="acronym">USERFILE</SPAN
></P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Changes in the <span class="acronym">UUCP</SPAN
>
system</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para"><i class="filename">Systems</I
> or <i class="filename">Permissions</I
></P
></TD
><td class="entry" rowspan="1" colspan="1"></TD
></TR
></TBODY
></TABLE
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="PUIS-CHP-7-SECT-3.2">7.3.2 Building an Automatic Backup System</A
></H3
><p class="para">For <a class="indexterm" name="AUTOID-9645"></A
><a class="indexterm" name="AUTOID-9648"></A
><a class="indexterm" name="AUTOID-9651"></A
>
added convenience, keep the backups
of all of the system-critical files in a single directory. Make
certain the directory isn't readable by any user other
than <i class="filename">root</I
>, and make sure it has a nonobvious name&nbsp;- after
all, you want the files to remain hidden in the event that an intruder
breaks into your computer and becomes the superuser! If you have
a local area network, you may wish to keep the copies of the critical
files on a different computer. An even better approach is to store
these files on a removable medium such as a <a class="indexterm" name="AUTOID-9656"></A
>
floppy disk or a cartridge
disk that can be mounted when necessary.</P
><p class="para">You can use <kbd class="command">tar</KBD
> or <a class="indexterm" name="AUTOID-9661"></A
><a class="indexterm" name="AUTOID-9663"></A
>
<kbd class="command">cpio</KBD
>
to store all of the files that you back up in a single
snapshot. Alternatively, you can also use <span class="acronym">RCS</SPAN
><a class="indexterm" name="AUTOID-9667"></A
><a class="indexterm" name="AUTOID-9669"></A
><a class="indexterm" name="AUTOID-9671"></A
><a class="indexterm" name="AUTOID-9673"></A
>
(Revision Control System) or <span class="acronym">SCCS</SPAN
> (Source Code
Control System) to archive these files and keep a revision history.</P
><div class="sidebar"><h4 class="sidebar"><a class="title" name="AUTOID-9676">Never Underestimate the Value of Paper</A
></H4
><p class="para">Keeping
printed <a class="indexterm" name="AUTOID-9679"></A
>
paper copies of your
most important configuration files is a good idea. If something
happens to the online versions, you can always refer to the paper
ones. Paper records are especially important if your system has
crashed in a severe and nontrivial fashion, because in these circumstances
you may not be able to recover your electronic versions. Finally,
paper printouts can prove invaluable in the event that your system
has been penetrated by nefarious intruders, because they form a
physical record. Even the most skilled intruders cannot use a captured
account to alter a printout in a locked desk drawer or other safe
location.</P
></DIV
><p class="para">A single shell script can automate the checking described
above. This script compares copies of specified files with master
copies and prints any differences. The sample script included below
keeps two copies of several critical files and reports the differences.
Modify it as appropriate for your own site.</P
><blockquote class="screen"><pre class="screen">#!/bin/sh 
MANAGER=/u/sysadm 
FILES=&quot;/etc/passwd /etc/group /usr/lib/aliases\ 
/etc/rc* /etc/netgroup /etc/fstab /etc/exports\ 
/usr/lib/crontab&quot; 
cd $MANAGER/private 
for FILE in $FILES 
do  
/bin/echo $FILE  
BFILE=`basename $FILE`  
/usr/bin/diff $BFILE $FILE  
/bin/mv $BFILE $BFILE.bak  
/bin/cp $FILE $BFILE 
done </PRE
></BLOCKQUOTE
><p class="para">You can use <a class="indexterm" name="AUTOID-9685"></A
>
cron
to automate running this daily shell script as follows[7]:</P
><blockquote class="footnote"><p class="para">[7] This
example assumes that you have a version of cron that allows you
to specify the user under which the cron script should be run.</P
></BLOCKQUOTE
><blockquote class="screen"><pre class="screen">0 0 * * * root /bin/sh /u/sysadm/private/daily \  
		<kbd class="command">| mail -s &quot;daily output&quot; sysadm </KBD
></PRE
></BLOCKQUOTE
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> A significant disadvantage of using an automated script
to check your system is that you run the risk that an intruder will
discover it and circumvent it. Nonstandard entries in<i class="filename">/usr/lib/crontab</I
> are prime candidates for further investigations
by experienced system crackers.</P
></BLOCKQUOTE
><p class="para">See <a class="xref" href="ch09_01.htm" title="Integrity Management">Chapter 9, <cite class="chapter">Integrity Management</CITE
></A
>,
for additional information about system checking.<a class="indexterm" name="AUTOID-9697"></A
><a class="indexterm" name="AUTOID-9700"></A
><a class="indexterm" name="AUTOID-9703"></A
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_02.htm" title="7.2 Sample Backup Strategies"><img src="../gifs/txtpreva.gif" alt="Previous: 7.2 Sample Backup Strategies" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="Practical UNIX &amp; Internet Security"><img src="../gifs/txthome.gif" alt="Practical UNIX &amp; Internet Security" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch07_04.htm#PUIS-CHP-7-SECT-4.3" title="7.4 Software for Backups"><img src="../gifs/txtnexta.gif" alt="Next: 7.4 Software for Backups" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">7.2 Sample Backup Strategies</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">7.4 Software for Backups</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
