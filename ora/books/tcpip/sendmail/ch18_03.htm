<html><head>
<title>[Chapter 18] 18.3 Obtain the Source</TITLE>
<meta name="DC.title" content="sendmail"><meta name="DC.creator" content="Bryan Costales &amp; Eric Allman"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-01-06T18:42:18Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-222-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch18_01.htm" title="18. Compile and Install sendmail"><link rel="prev" href="ch18_02.htm" title="18.2 Vendor Versus Compiling"><link rel="next" href="ch18_04.htm#SML2-CH-18-SECT-4-1" title="18.4 Tuning Makefile"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="sendmail" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="sendmail"><area shape="RECT" coords="467,0,514,18" href="../search/ssrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch18_02.htm" title="18.2 Vendor Versus Compiling"><img src="../gifs/txtpreva.gif" alt="Previous: 18.2 Vendor Versus Compiling" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 18<br>Compile and Install sendmail</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch18_04.htm#SML2-CH-18-SECT-4-1" title="18.4 Tuning Makefile"><img src="../gifs/txtnexta.gif" alt="Next: 18.4 Tuning Makefile" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="SML2-CH-18-SECT-3">18.3 Obtain the Source</A
></H2
><p class="para">V8 <em class="emphasis">sendmail</EM
> is available from: </P
><p class="para"><blockquote class="literallayout"><p class="literallayout"><a class="systemitem.url" href="../../../WebStripper/protected.html#link=ftp://ftp.sendmail.org/ucb/sendmail">ftp://ftp.sendmail.org/ucb/sendmail</A
></P
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="SML2-CH-18-IX-SENDMAIL-OBTAINING-SOURCE-CODE"></A
><a class="indexterm" name="SML2-CH-18-IX-OBTAINING-SENDMAIL-SOURCE-CODE"></A
><a class="indexterm" name="SML2-CH-18-IX-SOURCE-CODE-OBTAINING"></A
>When you <em class="emphasis">cd</EM
> into this directory, a banner is displayed that describes
the latest release and available patches. You may choose between two forms
of compressed <em class="emphasis">tar</EM
>(1) distributions. Those that end in <em class="emphasis">.Z</EM
> are
compressed with UNIX <em class="emphasis">compress</EM
>(1); those that end in <em class="emphasis">.gz</EM
>
are compressed with GNU <em class="emphasis">gzip</EM
>(1).
The latter is the preferred form because the file is smaller and quicker to transfer.</P
><p class="para">In addition to the two forms of distribution, each release has associated
with it a PGP signature file. It is a signature of the uncompressed
file, so you need to uncompress the <em class="emphasis">tar</EM
>(1) file before verifying it.
To verify a pre-V8.6 distribution, get Eric Allman's public key by
sending email to 
<em class="emphasis">pgp-public-keys@keys.pgp.net</EM
> with the following subject line:</P
><p class="para"><blockquote class="screen"><pre class="screen">Subject: MGET Allman</PRE
></BLOCKQUOTE
></P
><p class="para">Eric Allman's public key will be mailed back to you a few minutes later.
[2]
Save that returned email to a file, for example <em class="emphasis">/tmp/eric.asc</EM
>, and
add that key to your public &quot;keyring&quot; with the command:</P
><blockquote class="footnote"><p class="para">[2] As an alternative, you can run the command&#13;</P
><p class="para"><blockquote class="screen"><pre class="screen">finger -l eric@finger.sendmail.org &gt; /tmp/eric.asc</PRE
></BLOCKQUOTE
></P
><p class="para">&#13;and use that PGP information in place of the email information.
They are equivalent.</P
></BLOCKQUOTE
><p class="para"><blockquote class="screen"><pre class="screen">pgp -ka /tmp/eric.asc</PRE
></BLOCKQUOTE
></P
><p class="para">For V8.6 and above, you download a special <em class="emphasis">signing key</EM
> from
<em class="emphasis">www.sendmail.org</EM
>, instead of Eric's key. The fingerprint for
the <em class="emphasis">signing key</EM
> is:</P
><p class="para"><blockquote class="screen"><pre class="screen">CA AE F2 94 3B 1D 41 3C  94 7B 72 5F AE 0B 6A 11</PRE
></BLOCKQUOTE
></P
><p class="para">The fingerprint for Eric's key is:</P
><p class="para"><blockquote class="screen"><pre class="screen">C0 28 E6 7B 13 5B 29 02 6F 7E 43 3A 48 4F 45 29</PRE
></BLOCKQUOTE
></P
><p class="para">then execute:</P
><p class="para"><blockquote class="screen"><pre class="screen">pgp <i class="lineannotation">signature file here</I
></PRE
></BLOCKQUOTE
></P
><p class="para">If the uncompressed tar file is good, <em class="emphasis">pgp</EM
>(1) will report the following
or some variation on it:</P
><p class="para"><blockquote class="screen"><pre class="screen">Good signature from user &quot;Eric P. Allman &lt;eric@CS.Berkeley.EDU&gt;&quot;.</PRE
></BLOCKQUOTE
></P
><p class="para">A few things can go wrong here, causing the verification to fail:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">Signature and <em class="emphasis">tar</EM
>(1) files must match each other's versions.
Transfer them again, this time with matching versions.</P
></LI
><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-9685"></A
><a class="indexterm" name="AUTOID-9688"></A
>When transferring the files with <em class="emphasis">ftp</EM
>(1), you must be sure
to use <em class="emphasis">binary</EM
> mode. Transfer them again, this time
with the correct mode.</P
></LI
><li class="listitem"><p class="para">A presumed mirror FTP site might not be as official as you
expect.
If a secondary distribution fails to verify, 
get the official distributions from the official site shown above.</P
></LI
><li class="listitem"><p class="para">The official distribution may appear bad. If it fails to verify,
first check that your copy of <em class="emphasis">pgp</EM
> was correctly installed,
then check that your network connection is clean and that
it has not been compromised. If all else fails (including getting
the distribution anew as above), describe your problem to
the folks at <em class="emphasis">sendmail@sendmail.org</EM
>.</P
></LI
></UL
><p class="para">If your copy of the <em class="emphasis">sendmail</EM
> distribution fails to verify,
<em class="emphasis">don't use it</EM
>!</P
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-18-SECT-3-1">18.3.1 What's Where in the Source</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-9705"></A
>V8.8.6 <em class="emphasis">sendmail</EM
> unpacks by creating a directory, then unpacking
into that directory. The directory name is the same as the compressed
file name but with the first dot a dash instead:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>zcat sendmail.8.8.6.tar.Z | tar xvf -</B
></CODE
>
x sendmail-8.8.6/FAQ, 32312 bytes, 64 tape blocks
x sendmail-8.8.6/KNOWNBUGS, 4714 bytes, 10 tape blocks
x sendmail-8.8.6/Makefile, 1215 bytes, 3 tape blocks
... <i class="lineannotation">and so on</I
></PRE
></BLOCKQUOTE
></P
><p class="para">Inside the newly created directory you will find the full <em class="emphasis">sendmail</EM
>
distribution:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>cd sendmail-8.8.6</B
></CODE
>
% <code class="userinput"><b>ls</B
></CODE
>
FAQ             RELEASE_NOTES   mail.local      rmail
KNOWNBUGS       cf              mailstats       smrsh
Makefile        contrib         makemap         src
READ_ME         doc             praliases       test</PRE
></BLOCKQUOTE
></P
><p class="para">The <em class="emphasis">READ_ME</EM
> and <em class="emphasis">RELEASE_NOTES</EM
> files provide the most up-to-date
information about changes, new features, and bug fixes.
Read the documents in the <em class="emphasis">doc</EM
> directory.
Also note that there are important comments in the <em class="emphasis">src/READ_ME</EM
>
and <em class="emphasis">cf/README</EM
> files.</P
><p class="para">You will find almost everything you need to build <em class="emphasis">sendmail</EM
> 
in the <em class="emphasis">src</EM
> subdirectory.
There are a few exceptions that we will cover in this
chapter.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-18-SECT-3-2">18.3.2 The makesendmail Script</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-9730"></A
>The first step in compiling <em class="emphasis">sendmail</EM
> is to establish an object
directory and a <em class="emphasis">Makefile</EM
> that is appropriate to your machine architecture
and operating system. You do this by running the <em class="emphasis">makesendmail</EM
> script
in the <em class="emphasis">src</EM
> directory:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>cd src</B
></CODE
>
% <code class="userinput"><b>./makesendmail -n</B
></CODE
>
Configuration: os=SunOS, rel=4.1.4, rbase=4, arch=sun4, sfx=
Creating obj.SunOS.4.1.4.sun4 using Makefile.SunOS
Making dependencies in obj.SunOS.4.1.4.sun4
<i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> many more lines here</I
>
%</PRE
></BLOCKQUOTE
></P
><p class="para">Here, <em class="emphasis">makesendmail</EM
> found that ours was a <code class="literal">sun4</CODE
> machine,
running the SunOS 4.1.4 release of UNIX. It created the working
directory <em class="emphasis">obj.SunOS.4.1.4.sun4</EM
>, set up symbolic links to 
all the source files
in that directory, and copied a <em class="emphasis">Makefile</EM
> there.
<a class="indexterm" name="AUTOID-9746"></A
>
The <code class="literal">-n</CODE
> switch
[3]
prevents <em class="emphasis">make</EM
> from actually
building <em class="emphasis">sendmail</EM
>.
Note that, except for the <code class="literal">-m</CODE
> switch, all command-line arguments following
the <em class="emphasis">makesendmail</EM
> are passed to <em class="emphasis">make</EM
>(1) as its own command-line arguments.</P
><blockquote class="footnote"><p class="para">[3] As an alternative, the <code class="literal">-m</CODE
> command-line switch
causes <em class="emphasis">makesendmail</EM
> to print the name of your <em class="emphasis">Makefile</EM
>
without actually creating the <em class="emphasis">obj.*</EM
> subdirectory.<a class="indexterm" name="AUTOID-9755"></A
></P
></BLOCKQUOTE
><p class="para"><a class="indexterm" name="AUTOID-9763"></A
><a class="indexterm" name="AUTOID-9766"></A
>The <em class="emphasis">makesendmail</EM
> script knows how to build <em class="emphasis">sendmail</EM
> on many
versions of UNIX, including offshoots such as OSF/1 and NextStep.
In the unlikely case that your operating system is not supported, you will see
an error message instead of the above output:</P
><p class="para"><blockquote class="screen"><pre class="screen">Configuration: os=EX/Unix, rel=1, rbase=1, arch=sun4, sfx=
Cannot determine how to support sun4.EX/Unix.1</PRE
></BLOCKQUOTE
></P
><p class="para">Here, an experimental version of UNIX called <em class="emphasis">EX/Unix</EM
> on a 
sun4 computer was unrecognized by the <em class="emphasis">makesendmail</EM
>
script. Porting <em class="emphasis">sendmail</EM
> to new operating systems is really
beyond the scope of this book. But we offer a complete listing
of <code class="literal">#define</CODE
> macros in <a class="xref" href="ch18_08.htm" title="Alphabetized Reference">Section 18.8</A
> at the
end of this chapter, and that, as well as
much of the tuning that we discuss here, can also be germane to porting.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-18-SECT-3-3">18.3.3 What to Tune</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-9782"></A
>Before you let <em class="emphasis">makesendmail</EM
> run to completion, you may
need to tune three of <em class="emphasis">sendmail</EM
>'s files for your site:</P
><dl class="variablelist"><dt class="term"><em class="emphasis">Makefile/</EM
><code class="literal">*</CODE
></DT
><dd class="listitem"><p class="para">Specifies where to install the binaries and how to compile them.
<em class="emphasis">Makefile</EM
> is normally the only file you will
have to modify if you are running an already supported operating system</P
></DD
><dt class="term"><em class="emphasis">conf.h</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-9800"></A
>Specifies maximum sizes and other properties that are tunable for porting:</P
></DD
><dt class="term"><em class="emphasis">conf.c</EM
></DT
><dd class="listitem"><p class="para"><a class="indexterm" name="AUTOID-9807"></A
>Specifies C language code to support specific and unusual needs.
Tunable items in <em class="emphasis">conf.c</EM
> include the <em class="emphasis">checkcompat</EM
>()
routine (see <a class="xref" href="ch20_01.htm" title="The checkcompat() Cookbook">Chapter 20, <cite class="chapter">The checkcompat() Cookbook</CITE
></A
>)
and default header behavior (see <a class="xref" href="ch35_05.htm#SML2-CH-35-SECT-5-6" title="Header Behavior in conf.c">Section 35.5, "Header Behavior in conf.c"</A
>).<a class="indexterm" name="AUTOID-9813"></A
><a class="indexterm" name="AUTOID-9814"></A
><a class="indexterm" name="AUTOID-9815"></A
></P
></DD
></DL
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch18_02.htm" title="18.2 Vendor Versus Compiling"><img src="../gifs/txtpreva.gif" alt="Previous: 18.2 Vendor Versus Compiling" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="sendmail"><img src="../gifs/txthome.gif" alt="sendmail" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch18_04.htm#SML2-CH-18-SECT-4-1" title="18.4 Tuning Makefile"><img src="../gifs/txtnexta.gif" alt="Next: 18.4 Tuning Makefile" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">18.2 Vendor Versus Compiling</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">18.4 Tuning Makefile</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
