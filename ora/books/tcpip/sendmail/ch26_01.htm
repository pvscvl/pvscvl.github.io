<html><head>
<title>[Chapter 26] Logging and Statistics</TITLE>
<meta name="DC.title" content="sendmail"><meta name="DC.creator" content="Bryan Costales &amp; Eric Allman"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-01-06T19:40:01Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-222-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="part03.htm" title="III. Administration"><link rel="prev" href="ch25_08.htm" title="25.8 Pitfalls"><link rel="next" href="ch26_02.htm#SML2-CH-26-SECT-2-2" title="26.2 Statistics"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="sendmail" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="sendmail"><area shape="RECT" coords="467,0,514,18" href="../search/ssrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch25_08.htm" title="25.8 Pitfalls"><img src="../gifs/txtpreva.gif" alt="Previous: 25.8 Pitfalls" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 26</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch26_02.htm#SML2-CH-26-SECT-2-2" title="26.2 Statistics"><img src="../gifs/txtnexta.gif" alt="Next: 26.2 Statistics" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="CHAPTER"><h1 class="chapter"><a class="title" name="SML2-CH-26">26. Logging and Statistics</A
></H1
><div class="htmltoc"><p><b>Contents:</B
><br><a class="sect1" href="#SML2-CH-26-SECT-1" title="26.1 Logging with syslog">Logging with syslog</A
><br><a class="sect1" href="ch26_02.htm#SML2-CH-26-SECT-2-2" title="26.2 Statistics">Statistics</A
><br><a class="sect1" href="ch26_03.htm" title="26.3 Signaling the Daemon">Signaling the Daemon</A
><br><a class="sect1" href="ch26_04.htm" title="26.4 Log Transactions with -X">Log Transactions with -X</A
><br><a class="sect1" href="ch26_05.htm" title="26.5 Pitfalls">Pitfalls</A
></P
><p></P
></DIV
><p class="para"></P
><p class="para">The <em class="emphasis">sendmail</EM
> program can keep the system administrator
up-to-date about many aspects of mail delivery and forwarding. It does this
by logging its activities using the <em class="emphasis">syslog</EM
>(3) facility.
It can also gather (or aid in gathering)
statistics about what it is doing. Information about things
like total message volume and site connectivity, for example, can help the
administrator to make <em class="emphasis">sendmail</EM
> more efficient.
Information about the SMTP dialog that was used to send the message
can help the administrator to solve delivery problems.</P
><p class="para">In this chapter we cover these three important aspects of <em class="emphasis">sendmail</EM
>.
First, we explain the use of the <em class="emphasis">syslog</EM
>(3) facility and
illustrate several ways to tune its logging. Second,
we show the built-in means that <em class="emphasis">sendmail</EM
> has for recording
statistics and other information and how 
scripts can be used to extend that information.
Third, we explore ways to tune the performance of <em class="emphasis">sendmail</EM
>.&#13;</P
><div class="sect1"><h2 class="sect1"><a class="title" name="SML2-CH-26-SECT-1">26.1 Logging with syslog</A
></H2
><p class="para"><a class="indexterm" name="SML2-CH-26-IX-LOGGING"></A
><a class="indexterm" name="AUTOID-24304"></A
><a class="indexterm" name="AUTOID-24307"></A
><a class="indexterm" name="AUTOID-24310"></A
>Logging is the process of issuing one-line warnings that will
be either displayed to a human, archived to
a file, or both. The mechanism that <em class="emphasis">sendmail</EM
> uses
to produce these warnings is called <em class="emphasis">syslog</EM
>(3). The <em class="emphasis">sendmail</EM
>
program is concerned only with issuing its warnings.
Once they are issued, the <em class="emphasis">syslog</EM
> facility takes over
and disposes of them in a manner described in
the file <em class="emphasis">/etc/syslog.conf</EM
>. Statements in this file determine
whether a warning is written to a device (such as <em class="emphasis">/dev/console</EM
>),
appended to a file, forwarded to another host, or displayed on
a logged-in user's screen.</P
><p class="para">In the following discussion of <em class="emphasis">syslog</EM
> and <em class="emphasis">syslog.conf</EM
>,
we will describe the BSD 4.4 version. Some versions of UNIX, such as
Ultrix, use the 4.2 version of <em class="emphasis">syslog</EM
>, but because <em class="emphasis">syslog</EM
>
is public domain, 
we recommend upgrading and 
will not cover that old version here.&#13;</P
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-26-SECT-1-1">26.1.1 syslog(3)</A
></H3
><p class="para"><a class="indexterm" name="SML2-CH-26-IX-LOGGING-SYSLOG-UTILITY"></A
><a class="indexterm" name="AUTOID-24331"></A
><a class="indexterm" name="AUTOID-24333"></A
><a class="indexterm" name="AUTOID-24336"></A
><a class="indexterm" name="AUTOID-24339"></A
>The <em class="emphasis">syslog</EM
>(3) facility uses two items of information in
determining how to handle messages: <em class="emphasis">facility</EM
> and <em class="emphasis">level</EM
>.
The facility is the category of program issuing a message.
The <em class="emphasis">syslog</EM
> facility can handle many categories, but
only one, <code class="literal">mail</CODE
>, is used by <em class="emphasis">sendmail</EM
>.
The level is the degree of severity of the warnings.
The <em class="emphasis">sendmail</EM
> program issues
messages with <em class="emphasis">syslog</EM
>(3) at various levels depending on how serious
the warning is.</P
><p class="para">When <em class="emphasis">sendmail</EM
> first starts to run, it opens its connection to
the <em class="emphasis">syslog</EM
> facility with the following C language line:<a class="indexterm" name="AUTOID-24352"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">openlog(&quot;sendmail&quot;, LOG_PID, LOG_MAIL);</PRE
></BLOCKQUOTE
></P
><p class="para">This tells <em class="emphasis">syslog</EM
> three things: </P
><ul class="itemizedlist"><li class="listitem"><p class="para">All messages should
be printed using <code class="literal">sendmail</CODE
> as the name of the
program doing the logging. This means that no matter what name is
used to run <em class="emphasis">sendmail</EM
> (such as <em class="emphasis">newaliases</EM
> or <em class="emphasis">smtpd</EM
>),
the name that is logged will always be <code class="literal">sendmail</CODE
>.</P
></LI
><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-24368"></A
><a class="indexterm" name="AUTOID-24371"></A
>The LOG_PID tells <em class="emphasis">syslog</EM
> that the PID (process identification
number) should be included when each message is written. This is necessary
because <em class="emphasis">sendmail</EM
> forks often, and each parent and child will have
a different PID. Because queue file identifiers are constructed from
PIDs, this record helps to determine which invocation of <em class="emphasis">sendmail</EM
>
created a particular queued file. The PID also allows messages from
the daemon form of <em class="emphasis">sendmail</EM
> to be differentiated from others.</P
></LI
><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-24379"></A
>The facility for <em class="emphasis">sendmail</EM
> (and all mail-handling
programs) is LOG_MAIL. We'll show why this is important
when we discuss the <em class="emphasis">syslog.conf</EM
> file.</P
></LI
></UL
><p class="para"><a class="indexterm" name="AUTOID-24385"></A
>Just before <em class="emphasis">sendmail</EM
> issues a warning,
it looks at the logging level defined by its 
<code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.33, LogLevel (L)</A
>).
If the severity of the warning is greater than the logging level,
nothing is output.
If the severity of the warning that it intends to issue is less than or equal to
the logging level (lower is more serious),
it issues that warning with a C language call like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">syslog(<code class="replaceable"><i>pri, msg</I
></CODE
>);</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-24395"></A
>Here, <code class="replaceable"><i>pri</I
></CODE
> is the <em class="emphasis">syslog</EM
> logging priority, and <code class="replaceable"><i>msg</I
></CODE
>
is the text of the warning message. Note that
the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.33</A
>) level 
is different than the <em class="emphasis">syslog</EM
> priority.
The former is used internally by <em class="emphasis">sendmail</EM
> to decide
whether it should log a message. The latter is used by <em class="emphasis">syslog</EM
>

to determine how it will dispose of the message (if it gets one).</P
><p class="para">The <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option sets a threshold at and below
which <em class="emphasis">sendmail</EM
> will issue warnings. When the
<code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option has a
zero value, nothing is ever issued. When the
<code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option has a low
value, only critical warnings are issued. At higher values,
less critical messages are also issued.</P
><p class="para">The syntax of the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option and the kinds of information
issued for each level are explained in <a class="xref" href="ch34_08.htm" title="">Section 34.8.33</A
>.
For each level, all the information produced at lower levels is also
issued. That is, setting the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option
to 9 causes messages
for levels 1 through 8 also to be issued.</P
><p class="para">The relationship between the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>)
option logging levels and
<em class="emphasis">syslog</EM
> priorities is shown in
<a class="xref" href="#SML2-CH-26-TAB-0" title="L Levels Versus syslog Priorities">Table 26.1</A
>.</P
><table class="table"><caption class="table"><a class="title" name="SML2-CH-26-TAB-0">Table 26.1: L Levels Versus syslog Priorities</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Level</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Priority</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">1</TD
><td class="entry" rowspan="1" colspan="1">LOG_CRIT and LOG_ALERT</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">2-8</TD
><td class="entry" rowspan="1" colspan="1">LOG_NOTICE</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">9-10</TD
><td class="entry" rowspan="1" colspan="1">LOG_INFO</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">11+</TD
><td class="entry" rowspan="1" colspan="1">LOG_DEBUG</TD
></TR
></TBODY
></TABLE
><p class="para"><a class="indexterm" name="AUTOID-24447"></A
></P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-26-SECT-1-2">26.1.2 Tuning syslog.conf</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-24451"></A
><a class="indexterm" name="AUTOID-24454"></A
><a class="indexterm" name="AUTOID-24456"></A
>Although all messages are emitted by <em class="emphasis">sendmail</EM
> using a single
facility, that of <em class="emphasis">syslog</EM
>, they need not all arrive at the
same place. The disposition of messages is tuned by the <em class="emphasis">syslog.conf</EM
>
file.</P
><p class="para">The file <em class="emphasis">syslog.conf</EM
> (usually located in the <em class="emphasis">/etc</EM
> directory)
contains routing commands for use by <em class="emphasis">syslog</EM
>.
That file can be complex, because it is designed to handle messages
from many programs other than <em class="emphasis">sendmail</EM
>, even messages from
the kernel itself. Under SunOS the <em class="emphasis">syslog.conf</EM
> file
is also complex because it is
preprocessed by <em class="emphasis">m4</EM
>(1) when it is read by <em class="emphasis">syslog</EM
>.</P
><p class="para">The file <em class="emphasis">syslog.conf</EM
> is composed of lines of text that
each have the form:</P
><p class="para"><blockquote class="screen"><pre class="screen">facility.level           target</PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">facility</CODE
> is the type of program that may be producing
a message.
The <code class="literal">facility</CODE
> called <code class="literal">mail</CODE
> is the one that <em class="emphasis">sendmail</EM
> uses.
For the complete list, see the online manual for <em class="emphasis">syslog.conf</EM
>(5).</P
><p class="para">The <code class="literal">level</CODE
> indicates the severity at or above which messages
should be handled. These levels correspond to the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>)
option levels shown in
<a class="xref" href="#SML2-CH-26-TAB-0" title="L Levels Versus syslog Priorities">Table 26.1</A
> of <a class="xref" href="#SML2-CH-26-SECT-1-1" title="syslog(3)">Section 26.1.1, "syslog(3)"</A
>. 
The complete list of <em class="emphasis">syslog.conf</EM
> levels used by <em class="emphasis">sendmail</EM
> is shown in
<a class="xref" href="#SML2-CH-26-TAB-1" title="syslog.conf Levels Used by sendmail">Table 26.2</A
>.<a class="indexterm" name="AUTOID-24488"></A
><a class="indexterm" name="AUTOID-24491"></A
><a class="indexterm" name="AUTOID-24494"></A
></P
><table class="table"><caption class="table"><a class="title" name="SML2-CH-26-TAB-1">Table 26.2: syslog.conf Levels Used by sendmail</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Level</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Meaning of Severity (Highest to Lowest)</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">alert</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Conditions requiring immediate correction</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">crit</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Critical conditions for which action may be deferred</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">err</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Other errors</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">warning</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Warning messages</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">notice</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Nonerrors that may require special handling</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">info</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Statistical and informational messages</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">debug</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Messages used only in debugging a program</TD
></TR
></TBODY
></TABLE
><p class="para"><a class="indexterm" name="AUTOID-24533"></A
>The <code class="literal">target</CODE
> is one of the four possibilities shown in 
<a class="xref" href="#SML2-CH-26-TAB-2" title="syslog.conf Targets">Table 26.3</A
>.
It is the <code class="literal">target</CODE
> and the preceding
<code class="literal">level</CODE
> that must be tuned for use by <em class="emphasis">sendmail</EM
>.</P
><table class="table"><caption class="table"><a class="title" name="SML2-CH-26-TAB-2">Table 26.3: syslog.conf Targets</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Target</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Description</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">@<em class="emphasis">host</EM
></TD
><td class="entry" rowspan="1" colspan="1">Forward message to named <em class="emphasis">host</EM
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">/<em class="emphasis">file</EM
></TD
><td class="entry" rowspan="1" colspan="1">Append message to named <em class="emphasis">file</EM
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><em class="emphasis">user</EM
>,<em class="emphasis">user</EM
>,...</TD
><td class="entry" rowspan="1" colspan="1">Write to users' screens, if logged in</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">*</CODE
></TD
><td class="entry" rowspan="1" colspan="1">Write to all logged-in users' screens</TD
></TR
></TBODY
></TABLE
><p class="para">For example, the following <em class="emphasis">syslog.conf</EM
> line causes messages from
&quot;mail&quot; (the <code class="literal">facility</CODE
>) that are at or above severity &quot;info&quot;
(the <code class="literal">level</CODE
>) to be appended to the file
<em class="emphasis">/var/log/syslog</EM
> (the <code class="literal">target</CODE
>):</P
><p class="para"><blockquote class="screen"><pre class="screen">  <i class="lineannotation">facility</I
>                  <i class="lineannotation">target</I
>
  <i class="lineannotation"><img src="../chars/darr.gif" alt="-v"></I
>                      <i class="lineannotation"><img src="../chars/darr.gif" alt="-v"></I
>
mail.info                /var/log/syslog
      <i class="lineannotation"><img src="../chars/uarr.gif" alt="-^"></I
>
      <i class="lineannotation">level</I
></PRE
></BLOCKQUOTE
></P
><p class="para">A typical (albeit much simplified) <em class="emphasis">/etc/syslog.conf</EM
> 
file might look like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">*.err;kern.debug;user.none          /dev/console
*.err;kern.debug;user.none          /var/adm/messages
auth.notice                         @authhost
mail.info                           /var/log/syslog
*.emerg;user.none                   *</PRE
></BLOCKQUOTE
></P
><p class="para">Notice that there may be multiple <code class="literal">facility.level</CODE
> pairs
on the left, each separated from the others by semicolons. The first
two lines handle messages for all facilities at level <code class="literal">err</CODE
>,
all kernel messages (<code class="literal">kern</CODE
>) at level <code class="literal">debug</CODE
> and
above, and none of the levels (<code class="literal">none</CODE
>) for the
facility <code class="literal">user</CODE
>. The first line sends those messages to
the file <code class="literal">/dev/console</CODE
>, the computer's screen. The second
appends its messages to the file <code class="literal">/var/adm/messages</CODE
>.</P
><p class="para">The third line sends authorization messages (such as repeated login failures)
to the host named <code class="literal">authhost</CODE
>.</P
><p class="para">The fourth line appends all messages printed by <em class="emphasis">sendmail</EM
> at
level <code class="literal">info</CODE
> and above (the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option
is level 10 and below)
to the file <code class="literal">/var/log/syslog</CODE
>.</P
><p class="para">The last line is an emergency broadcast facility. A message
to any facility (the
leftmost <code class="literal">*</CODE
>) at the highest level (<code class="literal">emerg</CODE
>), except
for the facility <code class="literal">user</CODE
> (the <code class="literal">.none</CODE
>), will 
be written to the screen of all currently logged-in users (the target
<code class="literal">*</CODE
>).</P
><p class="para">Finally, note that facilities may be listed together by
using a comma:</P
><p class="para"><blockquote class="screen"><pre class="screen">mail,daemon.info</PRE
></BLOCKQUOTE
></P
><p class="para">This causes the level <code class="literal">info</CODE
> to be the level for both
the facilities <code class="literal">mail</CODE
> and <code class="literal">daemon</CODE
>. Only the facility
may be listed this way. The level may not, and (unfortunately)
the target may not.&#13;</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-26-SECT-1-3">26.1.3 syslog's Output</A
></H3
><p class="para"><a class="indexterm" name="SML2-CH-26-IX-OUTPUT-SYSLOG"></A
>When the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option level
is 9 or above (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.33</A
>), <em class="emphasis">sendmail</EM
> logs one line of information for each
envelope sender and one line of information for each recipient delivery or
deferral. As <em class="emphasis">sendmail</EM
> has evolved, these lines of logging information
have grown more complex. Here, we discuss the lines produced by
<em class="emphasis">sendmail</EM
> 8.8.4.</P
><p class="para">Each line of information logged looks something like this:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="replaceable"><i>date host </I
></CODE
>sendmail[<code class="replaceable"><i>pid</I
></CODE
>]: <code class="replaceable"><i>qid</I
></CODE
>: <code class="replaceable"><i>what=value</I
></CODE
>, ...</PRE
></BLOCKQUOTE
></P
><p class="para">Each line of output that <em class="emphasis">syslog</EM
> produces begins with five pieces
of information. The <code class="replaceable"><i>date</I
></CODE
> is the month, day, and time that the
line of information was logged (note that the year is absent).
The <code class="replaceable"><i>host</I
></CODE
> is the name of the host that produced this information
(note that this may differ from the name of the host on which the
log files are kept).
The <code class="literal">sendmail</CODE
> is literal. Because of the LOG_PID argument that is given
to <em class="emphasis">openlog</EM
>(3) by <em class="emphasis">sendmail</EM
> (see <a class="xref" href="#SML2-CH-26-SECT-1-1" title="syslog(3)">Section 26.1.1</A
>),
the process ID of the invocation of <em class="emphasis">sendmail</EM
> that produced
this information is included in square brackets.
Finally, each line includes the <code class="replaceable"><i>qid</I
></CODE
> queue identifier
(see <a class="xref" href="ch23_02.htm#SML2-CH-23-SECT-2-5" title="The Queue Identifier">Section 23.2.1, "The Queue Identifier"</A
>) that uniquely identifies each message on
a given host.</P
><p class="para">This initial information is followed by a comma-separated list of 
<code class="replaceable"><i>what=value</I
></CODE
> equates.
Which equate appears in which line depends on whether the line documents
the sender or the recipient and whether deliver succeed, failed, or was
deferred. In
<a class="xref" href="#SML2-CH-26-TAB-3" title="what= in syslog Output Lines">Table 26.4</A
>
we list the possibilities in alphabetical order. Then, in the sections
that follow, we describe the role that each plays.</P
><table class="table"><caption class="table"><a class="title" name="SML2-CH-26-TAB-3">Table 26.4: what= in syslog Output Lines</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">what=</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Description</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">class=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-1" title="class= the queue class">Section 26.1.3.1, "class= the queue class"</A
></TD
><td class="entry" rowspan="1" colspan="1">The queue class</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">delay=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-2" title="delay= total time to deliver">Section 26.1.3.2, "delay= total time to deliver"</A
></TD
><td class="entry" rowspan="1" colspan="1">Total time to deliver</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">from=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-3" title="from= show envelope sender">Section 26.1.3.3, "from= show envelope sender"</A
></TD
><td class="entry" rowspan="1" colspan="1">Show envelope sender</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">mailer=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-4" title="mailer= the delivery agent used">Section 26.1.3.4, "mailer= the delivery agent used"</A
></TD
><td class="entry" rowspan="1" colspan="1">The delivery agent used</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">msgid=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-5" title="msgid= the Message-ID: identifier">Section 26.1.3.5, "msgid= the Message-ID: identifier"</A
></TD
><td class="entry" rowspan="1" colspan="1">The Message-ID: identifier</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">nrcpts=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-6" title="nrcpts= the number of recipients">Section 26.1.3.6, "nrcpts= the number of recipients"</A
></TD
><td class="entry" rowspan="1" colspan="1">The number of recipients</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">pri=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-7" title="pri= the initial priority">Section 26.1.3.7, "pri= the initial priority"</A
></TD
><td class="entry" rowspan="1" colspan="1">The initial priority</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">proto=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-8" title="proto= the protocol used in transmission">Section 26.1.3.8, "proto= the protocol used in transmission"</A
></TD
><td class="entry" rowspan="1" colspan="1">The protocol used in transmission</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">relay=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-9" title="relay= the host that sent or accepted the message">Section 26.1.3.9, "relay= the host that sent or accepted the message"</A
></TD
><td class="entry" rowspan="1" colspan="1">The host that sent or accepted the message</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">size=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-10" title="size= the size of the message">Section 26.1.3.10, "size= the size of the message"</A
></TD
><td class="entry" rowspan="1" colspan="1">The size of the message</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">stat=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-11" title="stat= status of delivery">Section 26.1.3.11, "stat= status of delivery"</A
></TD
><td class="entry" rowspan="1" colspan="1">Status of delivery</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">to=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-12" title="to= show final recipient">Section 26.1.3.12, "to= show final recipient"</A
></TD
><td class="entry" rowspan="1" colspan="1">The final recipient</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">xdelay=</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-26-SECT-1-3-13" title="xdelay= transaction">Section 26.1.3.13, "xdelay= transaction"</A
></TD
><td class="entry" rowspan="1" colspan="1">Transaction delay for this address only</TD
></TR
></TBODY
></TABLE
><p class="para"></P
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-1">26.1.3.1 class= the queue class</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24739"></A
><a class="indexterm" name="AUTOID-24741"></A
>If the mail message contained a <code class="literal">Precedence:</CODE
> header
(see <a class="xref" href="ch35_08.htm#SML2-CH-35-SECT-8-1" title="Precedence">Section 35.8, "Precedence"</A
>), the <code class="literal">class=</CODE
>
reflects <em class="emphasis">sendmail</EM
>'s interpretation of the keyword
that follows that header. For example, given the configuration command</P
><p class="para"><blockquote class="screen"><pre class="screen">PPlist=-30</PRE
></BLOCKQUOTE
></P
><p class="para">The following header will yield a <code class="literal">class=</CODE
> value of <code class="literal">-30</CODE
>:</P
><p class="para"><blockquote class="screen"><pre class="screen">Precedence: list</PRE
></BLOCKQUOTE
></P
><p class="para">If no <code class="literal">Precedence:</CODE
> header is present in the message, the value shown for
<code class="literal">class=</CODE
> is zero.
The <code class="literal">class=</CODE
> is shown only for sender records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-2">26.1.3.2 delay= total time to deliver</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24761"></A
><a class="indexterm" name="AUTOID-24763"></A
><a class="indexterm" name="AUTOID-24766"></A
>A mail message can be delivered immediately, without ever having
been queued, or it can be queued and retried over and over
again until it either times out or succeeds.
The <code class="literal">delay=</CODE
> shows the total amount of time the message
took to be delivered. This period of time starts when <em class="emphasis">sendmail</EM
>
first receives the message and ends when the message is finally
delivered or bounced. This interval is displayed with the
<code class="literal">delay=</CODE
> <em class="emphasis">syslog</EM
> line equate:</P
><p class="para"><blockquote class="screen"><pre class="screen">delay=<code class="replaceable"><i>days+</I
></CODE
>HH:MM:SS</PRE
></BLOCKQUOTE
></P
><p class="para">The time expression shows the time it took in hours (<code class="literal">HH</CODE
>), minutes (<code class="literal">MM</CODE
>),
and seconds (<code class="literal">SS</CODE
>) to handle delivery or rejection of the message.
If the delay exceeds 24 hours, the time expression is prefixed 

with the number
of days and a plus character.
For example, the following message took 5 seconds to deliver or bounce:</P
><p class="para"><blockquote class="screen"><pre class="screen">delay=00:00:05</PRE
></BLOCKQUOTE
></P
><p class="para">The following message took 4 days, 2 hours, 16 minutes, and 2 seconds to deliver or bounce:</P
><p class="para"><blockquote class="screen"><pre class="screen">delay=4+02:16:02</PRE
></BLOCKQUOTE
></P
><p class="para">Note that the <code class="literal">delay=</CODE
> equate is shown only for recipient records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-3">26.1.3.3 from= show envelope sender</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24790"></A
><a class="indexterm" name="AUTOID-24792"></A
><a class="indexterm" name="AUTOID-24795"></A
>The envelope sender may or may not
appear in any of the sender headers.
The <code class="literal">from=</CODE
> <em class="emphasis">syslog</EM
> line equate shows the envelope sender:</P
><p class="para"><blockquote class="screen"><pre class="screen">from=<code class="replaceable"><i>addr</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="replaceable"><i>addr</I
></CODE
> is the address of the envelope sender with any
RFC822 commentary (see <a class="xref" href="ch35_03.htm#SML2-CH-35-SECT-3-2" title="Comments in the Header Field">Section 35.3.4, "Comments in the Header Field"</A
>) removed. 
This will usually be the address of an actual person, but it can
also be <code class="literal">postmaster</CODE
> or the value of the <code class="literal">$n</CODE
> macro
in the case of a bounced message.
The <code class="literal">from=</CODE
> equate is shown only for sender records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-4">26.1.3.4 mailer= the delivery agent used</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24812"></A
><a class="indexterm" name="AUTOID-24814"></A
>The <em class="emphasis">sendmail</EM
> program does not perform the actual delivery of mail. 
Instead, it calls other programs (called mail delivery agents) to perform
that service.
The <code class="literal">mailer=</CODE
> equate shows the symbolic name (see <a class="xref" href="ch30_01.htm" title="Configuration File Syntax">Section 30.1, "Configuration File Syntax"</A
>)
of the delivery agent that was used to perform delivery to the recipient&quot;</P
><p class="para"><blockquote class="screen"><pre class="screen">mailer=<code class="replaceable"><i>agent</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">A list of symbolic names assigned to delivery agents can be viewed
with the <code class="literal">-d0.15</CODE
> debugging switch (see <a class="xref" href="ch37_05.htm" title="">Section 37.5.4, -d0.15</A
>).
The <code class="literal">mailer=</CODE
> equate is shown only for recipient records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-5">26.1.3.5 msgid= the Message-ID: identifier</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24830"></A
><a class="indexterm" name="AUTOID-24832"></A
><a class="indexterm" name="AUTOID-24834"></A
><a class="indexterm" name="AUTOID-24837"></A
>RFC822 requires that each email message have a unique worldwide
identifier associated with it. That identifier is listed with
the <code class="literal">Message-ID:</CODE
> header (see <a class="xref" href="ch35_10.htm" title="">Section 35.10.19, Message-ID:</A
>)
and often looks something like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">Message-Id: &lt;199605051122.VAA07923@here.us.edu&gt;</PRE
></BLOCKQUOTE
></P
><p class="para">&#13;The information inside, and including,
the angle brackets is the message identifier.
That identifier is what is listed with the <code class="literal">msgid=</CODE
> equate:</P
><p class="para"><blockquote class="screen"><pre class="screen">msgid=&lt;199605051122.VAA07923@here.us.edu&gt;</PRE
></BLOCKQUOTE
></P
><p class="para">If a mail message arrives without a <code class="literal">Message-ID:</CODE
> header, and
if your configuration file correctly includes a definition for
that header, a new identifier will be created and listed with
<code class="literal">msgid=</CODE
>. If a <code class="literal">Message-ID:</CODE
> header is absent, and if
your configuration file incorrectly excludes a definition for
that header, the <code class="literal">msgid=</CODE
> equate will be excluded from
the <em class="emphasis">syslog</EM
> report.</P
><p class="para">The <code class="literal">msgid=</CODE
> equate is shown only for sender records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-6">26.1.3.6 nrcpts= the number of recipients</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24859"></A
><a class="indexterm" name="AUTOID-24862"></A
>The <code class="literal">nrcpts=</CODE
> equate shows the number of recipients
<em class="emphasis">after</EM
> all aliasing has been performed. If the
original message was addressed to <em class="emphasis">root</EM
>,  if <em class="emphasis">root</EM
>
was aliased like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">root: bob, hans</PRE
></BLOCKQUOTE
></P
><p class="para">and if <em class="emphasis">bob</EM
>'s <em class="emphasis">~/.forward</EM
> file contained this:</P
><p class="para"><blockquote class="screen"><pre class="screen">\bob
|&quot;/usr/ucb/vacation bob&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">then the <code class="literal">nrcpts=</CODE
> equate would show three recipients.</P
><p class="para">Note that <code class="literal">nrcpts=</CODE
> is included only with the sender record
and that record is emitted when the message is first processed.
Any later changes in aliasing that may happen while the message
is queued are not reported. Aliasing on remote machines 
(as would be the case with exploder mailing lists)
is also not reported for obvious reasons.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-7">26.1.3.7 pri= the initial priority</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24882"></A
><a class="indexterm" name="AUTOID-24884"></A
>The <code class="literal">pri=</CODE
> equate shows the initial priority assigned to
the message (see <a class="xref" href="ch35_08.htm#SML2-CH-35-SECT-8-1" title="Precedence">Section 35.8</A
>).
This value is calculated once when the message is first processed
and changed each time the queued file is tried. This <code class="literal">pri=</CODE
> equate
shows the initial value.</P
><p class="para">The <code class="literal">pri=</CODE
> <em class="emphasis">syslog</EM
> equate is displayed only for the
sender.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-8">26.1.3.8 proto= the protocol used in transmission</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24896"></A
><a class="indexterm" name="AUTOID-24898"></A
><a class="indexterm" name="AUTOID-24900"></A
><a class="indexterm" name="AUTOID-24902"></A
>The <code class="literal">$r</CODE
> macro (see <a class="xref" href="ch31_10.htm" title="">Section 31.10.31, $r</A
>) holds as its
value the protocol that was used when a mail message was first received.
That value is either SMTP, ESMTP, or internal
or is a protocol assigned with the <code class="literal">-p</CODE
> command-line
switch (see <a class="xref" href="ch36_07.htm" title="">Section 36.7.32, -p</A
>). If <code class="literal">$r</CODE
> lacks a value,
this <code class="literal">proto=</CODE
> equate is omitted. If <code class="literal">$r</CODE
> has a value,
the first 20 characters of that value are printed following
the <code class="literal">proto=</CODE
> in the <em class="emphasis">syslog</EM
> line:</P
><p class="para"><blockquote class="screen"><pre class="screen">proto=ESMTP</PRE
></BLOCKQUOTE
></P
><p class="para"></P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-9">26.1.3.9 relay= the host that sent or accepted the message</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24919"></A
><a class="indexterm" name="AUTOID-24921"></A
>When running as a daemon and listening for incoming connections,
<em class="emphasis">sendmail</EM
> attempts to look up the true identity of
connecting users and hosts. When it can find that information, it
saves it in the <code class="literal">$_</CODE
> macro (see <a class="xref" href="ch31_10.htm" title="">Section 31.10.1, $-</A
>).</P
><p class="para">When transporting mail to other hosts, <em class="emphasis">sendmail</EM
> looks up
the MX records for those hosts and connects to the MX
records when they are available. If MX records are not
available, <em class="emphasis">sendmail</EM
> connects to the
hostname that is specified in the recipient address.</P
><p class="para">If the <code class="literal">$_</CODE
> information is available, that information
appears following the <code class="literal">relay=</CODE
> equate:</P
><p class="para"><blockquote class="screen"><pre class="screen">relay=root@other.site.edu [123.45.67.89]</PRE
></BLOCKQUOTE
></P
><p class="para">If the sender is a local user, the login name and <em class="emphasis">localhost</EM
> will
appear in the <code class="literal">relay=</CODE
> equate:</P
><p class="para"><blockquote class="screen"><pre class="screen">relay=bob@localhost</PRE
></BLOCKQUOTE
></P
><p class="para">Otherwise, the canonical name of the host that actually accepted delivery
will appear here:</P
><p class="para"><blockquote class="screen"><pre class="screen">relay=mx.host.domain [123.45.67.89]</PRE
></BLOCKQUOTE
></P
><p class="para">In summary, the <code class="literal">relay=</CODE
> equate shows who <em class="emphasis">really</EM
> accepted
or sent the message. The <code class="literal">relay=</CODE
>  <em class="emphasis">syslog</EM
> equate
is included with both sender and recipient records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-10">26.1.3.10 size= the size of the message</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24950"></A
><a class="indexterm" name="AUTOID-24952"></A
><a class="indexterm" name="AUTOID-24955"></A
>The size of an incoming SMTP message is the number of
bytes sent during the DATA phase (see <a class="xref" href="ch34_08.htm" title="Timeout.datainit">Section 34.8.70.5, "Timeout.datainit"</A
>), including
end-of-line characters.
The size of a message received via <em class="emphasis">sendmail</EM
>'s standard input
is a count of the bytes received, including the newline characters.
In both instances the size is displayed with the <code class="literal">size=</CODE
>
equate:</P
><p class="para"><blockquote class="screen"><pre class="screen">size=23</PRE
></BLOCKQUOTE
></P
><p class="para">Note that this size is reported before <em class="emphasis">sendmail</EM
> adds or
deletes any headers. Therefore for mail being relayed through a site,
the size will usually be small coming in and somewhat larger going out.</P
><p class="para">The <code class="literal">size=</CODE
> <em class="emphasis">syslog</EM
> equate is produced only for sender
records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-11">26.1.3.11 stat= status of delivery</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24971"></A
>Whenever the delivery status of a mail message changes, <em class="emphasis">sendmail</EM
>
logs the event and includes the <code class="literal">status=</CODE
> to specify why
the change happened. For example, a mail message may initially
be queued because the recipient's host was down:</P
><p class="para"><blockquote class="screen"><pre class="screen">stat=queued</PRE
></BLOCKQUOTE
></P
><p class="para">Later it might change again because it succeeded in being
delivered:</P
><p class="para"><blockquote class="screen"><pre class="screen">stat=Sent (HAA03001 Message accepted for delivery)</PRE
></BLOCKQUOTE
></P
><p class="para">In transmitting a mail message via SMTP the <code class="literal">stat=</CODE
>
will include the actual text that the other host printed
when it accepted the mail message, as shown above. But in delivering locally,
the <code class="literal">stat=</CODE
> is more succinct:</P
><p class="para"><blockquote class="screen"><pre class="screen">stat=Sent</PRE
></BLOCKQUOTE
></P
><p class="para">In the case of bounced mail the <code class="literal">stat=</CODE
> will show the reason
for failure:</P
><p class="para"><blockquote class="screen"><pre class="screen">stat=User unknown</PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">stat=</CODE
> <em class="emphasis">syslog</EM
> equate is included only in recipient
records.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-12">26.1.3.12 to= show final recipient</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-24995"></A
><a class="indexterm" name="AUTOID-24997"></A
>As each recipient is delivered to, deferred, or bounced, <em class="emphasis">sendmail</EM
>
logs a line of information that includes the recipient
address:</P
><p class="para"><blockquote class="screen"><pre class="screen">to=bob@here.us.edu</PRE
></BLOCKQUOTE
></P
><p class="para">Each such address is that of a final recipient (from the point of
the view of the local host) after all aliasing, list expansions,
and processing of <em class="emphasis">~/.forward</EM
> files.&#13;</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-3-13">26.1.3.13 xdelay= transaction</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-25008"></A
><a class="indexterm" name="AUTOID-25010"></A
><a class="indexterm" name="AUTOID-25013"></A
>The <code class="literal">xdelay=</CODE
> equate shows the total amount of time the message
took to be transmitted during final delivery.
This differs from <code class="literal">delay=</CODE
> in that <code class="literal">delay=</CODE
> is 
computed from when the message was originally received (and can be days),
whereas this <code class="literal">xdelay=</CODE
> shows how fast the receiving host was
(and is usually seconds).</P
><p class="para">In the case of SMTP mail 
the <code class="literal">xdelay=</CODE
> computation starts when <em class="emphasis">sendmail</EM
> successfully
connects to the remote host.
In the case of locally delivered mail the computation starts when
<em class="emphasis">sendmail</EM
> executes the delivery agent.
The computation ends when the dot is accepted at the close of the
DATA SMTP phase or when the local delivery agent exits.</P
><p class="para">&#13;The form of the <code class="literal">xdelay=</CODE
> looks like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">xdelay=HH:MM:SS</PRE
></BLOCKQUOTE
></P
><p class="para">The time expression shows the hours (<code class="literal">HH</CODE
>), minutes (<code class="literal">MM</CODE
>),
and seconds (<code class="literal">SS</CODE
>) it took to perform delivery via the
final delivery agent. In the case of networked mail that interval
can be long:</P
><p class="para"><blockquote class="screen"><pre class="screen">xdelay=00:41:05</PRE
></BLOCKQUOTE
></P
><p class="para">But in the case of locally delivered mail this interval can
seem instantaneous:</P
><p class="para"><blockquote class="screen"><pre class="screen">xdelay=00:00:00</PRE
></BLOCKQUOTE
></P
><p class="para">Note that the <code class="literal">xdelay=</CODE
> equate is shown only for recipient records.<a class="indexterm" name="AUTOID-25038"></A
>&#13;</P
></DIV
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-26-SECT-1-4">26.1.4 Gathering Statistics from syslog</A
></H3
><p class="para"><a class="indexterm" name="SML2-CH-26-IX-STATISTICS-SYSLOG-UTILITY-AND"></A
><a class="indexterm" name="SML2-CH-26-IX-SYSTEM-ADMINISTRATION-STATISTICS"></A
>The log files that <em class="emphasis">syslog</EM
> creates provide a wealth of information
that can be used to examine and tune the performance of <em class="emphasis">sendmail</EM
>.
To illustrate, we will present a simple shell script for printing
daily total message volume.</P
><p class="para">In the following discussion
we will assume that <em class="emphasis">sendmail</EM
> logging is enabled
(the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option, see <a class="xref" href="ch34_08.htm" title="">Section 34.8.33</A
>,
is nonzero) and that
all <em class="emphasis">syslog</EM
>(8) messages for the facility <code class="literal">mail</CODE
>
at level LOG_INFO are being placed into the file <em class="emphasis">/var/log/syslog</EM
>.&#13;</P
><div class="sect3"><h4 class="sect3"><a class="title" name="SML2-CH-26-SECT-1-4-1">26.1.4.1 message_volume.sh</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-25061"></A
>Each mail message that <em class="emphasis">sendmail</EM
> receives for delivery (excluding
those processed from the queue) causes <em class="emphasis">sendmail</EM
> to log a message
like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">date host sendmail[pid]: quid: from=sender, size=bytes, ...</PRE
></BLOCKQUOTE
></P
><p class="para">That is, for each <code class="literal">sender</CODE
> that is logged (the <code class="literal">from=</CODE
>), <em class="emphasis">sendmail</EM
>
also logs the total received size of the message
in <code class="literal">bytes</CODE
> (the <code class="literal">size=</CODE
>).</P
><p class="para">By summing all the <code class="literal">size=</CODE
> lines in a <em class="emphasis">/var/log/syslog</EM
> file,
we can generate the total volume of all messages received for the period
represented by that file. One way to generate such a total is
shown in the following Bourne shell script:</P
><p class="para"><blockquote class="screen"><pre class="screen">#!/bin/sh
LOG=/var/log/syslog
TOTAL=`(echo 0;
        sed -e '/size=/!d' -e 's/.*size=//' -e 's/,.*/+/' $LOG;
        echo p;
       ) | dc`
echo Total characters sent: $TOTAL</PRE
></BLOCKQUOTE
></P
><p class="para">&#13;The <em class="emphasis">sed</EM
>(1) selects only the lines in <em class="emphasis">/var/log/syslog</EM
> that
contain the expression <code class="literal">size=</CODE
>.
[1]
It then throws away all but
the number immediately following each <code class="literal">size=</CODE
> (the actual
number of bytes of each message), and appends a <code class="literal">+</CODE
> to
each.</P
><blockquote class="footnote"><p class="para">[1] If other programs also put <code class="literal">size=</CODE
> expressions into the log file, you
may also want to screen for &quot;sendmail.&quot;</P
></BLOCKQUOTE
><p class="para">The entire sequence of processes is enclosed in parentheses. An <em class="emphasis">echo</EM
>
statement first prints a zero. Then the list of <code class="literal">+</CODE
>-suffixed
sizes is printed. Finally, another <em class="emphasis">echo</EM
>
prints a character <code class="literal">p</CODE
>. The resulting combined output
might look like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">123+
456+
7890+
p</PRE
></BLOCKQUOTE
></P
><p class="para">The leading <code class="literal">0</CODE
>, the <code class="literal">+</CODE
> suffixes, and the final
<code class="literal">p</CODE
> are commands for the <em class="emphasis">dc</EM
>(1) program, which adds
up all the numbers (the <code class="literal">+</CODE
> suffixes) and prints the
total (the <code class="literal">p</CODE
>). That total is saved in the variable
<code class="literal">TOTAL</CODE
> for later use in the final <em class="emphasis">echo</EM
> statement.
The output of this simple script might look something like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">Total characters sent: 8469</PRE
></BLOCKQUOTE
></P
><p class="para">More sophisticated scripts are possible, but the Bourne
shell's lack of arrays suggest that <em class="emphasis">perl</EM
>(1) would provide
a more powerful scripting environment. Most of the scripts that are available publicly are written in the <em class="emphasis">perl</EM
> scripting language.
<a class="indexterm" name="AUTOID-25108"></A
><a class="indexterm" name="AUTOID-25109"></A
>&#13;</P
></DIV
></DIV
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch25_08.htm" title="25.8 Pitfalls"><img src="../gifs/txtpreva.gif" alt="Previous: 25.8 Pitfalls" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="sendmail"><img src="../gifs/txthome.gif" alt="sendmail" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch26_02.htm#SML2-CH-26-SECT-2-2" title="26.2 Statistics"><img src="../gifs/txtnexta.gif" alt="Next: 26.2 Statistics" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">25.8 Pitfalls</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">26.2 Statistics</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
