<html><head>
<title>[Chapter 23] 23.9 The qf File Internals</TITLE>
<meta name="DC.title" content="sendmail"><meta name="DC.creator" content="Bryan Costales &amp; Eric Allman"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-01-06T19:35:12Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-222-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch23_01.htm" title="23. The Queue"><link rel="prev" href="ch23_08.htm" title="23.8 Pitfalls"><link rel="next" href="ch24_01.htm" title="24. Aliases"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="sendmail" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="sendmail"><area shape="RECT" coords="467,0,514,18" href="../search/ssrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch23_08.htm" title="23.8 Pitfalls"><img src="../gifs/txtpreva.gif" alt="Previous: 23.8 Pitfalls" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 23<br>The Queue</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="CHAPTER" href="ch24_01.htm" title="24. Aliases"><img src="../gifs/txtnexta.gif" alt="Next: 24. Aliases" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="SML2-CH-23-SECT-9">23.9 The qf File Internals</A
></H2
><p class="para"><a class="indexterm" name="SML2-CH-23-IX-QF-FILES"></A
>The <code class="literal">qf</CODE
> file holds all the information 
that is needed to perform delivery of a queued mail
message. The information contained in that file, and its appearance,
changes from release to release of <em class="emphasis">sendmail</EM
>.
Here, we document the <code class="literal">qf</CODE
> file that is used with V8.8 <em class="emphasis">sendmail</EM
>.
Note that as of V8.7 a <code class="literal">V</CODE
> version line has been introduced
to enable future versions to correctly process older version's queue files.</P
><p class="para">This section must be taken with a proverbial grain of salt. The internals
of the <code class="literal">qf</CODE
> file are essentially an internal interface
to <em class="emphasis">sendmail</EM
> and, as such, are subject to change without
notice. The information offered here is intended only to help
debug <em class="emphasis">sendmail</EM
> problems. It is <em class="emphasis">not</EM
> intended (and
we strongly discourage its use) as a 
guide for writing files directly to the queue.</P
><p class="para">The <code class="literal">qf</CODE
> file is line-oriented, containing one item of information per
line. Each line begins with a single uppercase character (the <em class="emphasis">code 
letter</EM
>), which
specifies the contents of the line. Each code letter is followed,
with no intervening space, by the information appropriate to
the letter. The complete list of code letters is shown in
<a class="xref" href="#SML2-CH-23-TAB-1" title="qf File Code Letters">Table 23.2</A
>.</P
><table class="table"><caption class="table"><a class="title" name="SML2-CH-23-TAB-1">Table 23.2: qf File Code Letters</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Code</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Meaning</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Version</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">How Many</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">B</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-1" title="">Section 23.9.1</A
></TD
><td class="entry" rowspan="1" colspan="1">Body type</TD
><td class="entry" rowspan="1" colspan="1">V8.6 and above</TD
><td class="entry" rowspan="1" colspan="1">At most one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">C</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-2" title="">Section 23.9.2</A
></TD
><td class="entry" rowspan="1" colspan="1">Controlling user</TD
><td class="entry" rowspan="1" colspan="1">V5.62 and above</TD
><td class="entry" rowspan="1" colspan="1">At most one per R line</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">D</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-3" title="">Section 23.9.3, D line</A
></TD
><td class="entry" rowspan="1" colspan="1">Data filename</TD
><td class="entry" rowspan="1" colspan="1">Obsolete as of V8.7</TD
><td class="entry" rowspan="1" colspan="1">Exactly one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">E</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-4" title="">Section 23.9.4, E line</A
></TD
><td class="entry" rowspan="1" colspan="1">Errors to</TD
><td class="entry" rowspan="1" colspan="1">V8.6 and earlier</TD
><td class="entry" rowspan="1" colspan="1">Many</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">F</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-5" title="">Section 23.9.5, F line</A
></TD
><td class="entry" rowspan="1" colspan="1">Flag bits</TD
><td class="entry" rowspan="1" colspan="1">V8.1 and above</TD
><td class="entry" rowspan="1" colspan="1">Many</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">H</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-6" title="">Section 23.9.6, H line</A
></TD
><td class="entry" rowspan="1" colspan="1">Header definition</TD
><td class="entry" rowspan="1" colspan="1">All versions</TD
><td class="entry" rowspan="1" colspan="1">Many</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">I</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-8" title="">Section 23.9.8, K line</A
></TD
><td class="entry" rowspan="1" colspan="1"><em class="emphasis">df</EM
> file's inode number</TD
><td class="entry" rowspan="1" colspan="1">V8.7 and above</TD
><td class="entry" rowspan="1" colspan="1">Exactly one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">K</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-8" title="">Section 23.9.8</A
></TD
><td class="entry" rowspan="1" colspan="1">Time last processed</TD
><td class="entry" rowspan="1" colspan="1">V8.7 and above</TD
><td class="entry" rowspan="1" colspan="1">Exactly one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">M</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-9" title="">Section 23.9.9</A
></TD
><td class="entry" rowspan="1" colspan="1">Message (why queued)</TD
><td class="entry" rowspan="1" colspan="1">All versions</TD
><td class="entry" rowspan="1" colspan="1">At most one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">N</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-10" title="">Section 23.9.10, N line</A
></TD
><td class="entry" rowspan="1" colspan="1">Number times tried</TD
><td class="entry" rowspan="1" colspan="1">V8.7 and above</TD
><td class="entry" rowspan="1" colspan="1">At most one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">P</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-11" title="">Section 23.9.11</A
></TD
><td class="entry" rowspan="1" colspan="1">Priority (current)</TD
><td class="entry" rowspan="1" colspan="1">All versions</TD
><td class="entry" rowspan="1" colspan="1">At most one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">Q</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-12" title="">Section 23.9.12, Q line</A
></TD
><td class="entry" rowspan="1" colspan="1">Original recipient</TD
><td class="entry" rowspan="1" colspan="1">V8.7 and above</TD
><td class="entry" rowspan="1" colspan="1">At most one per R line</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">R</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-13" title="">Section 23.9.13</A
></TD
><td class="entry" rowspan="1" colspan="1">Recipient address</TD
><td class="entry" rowspan="1" colspan="1">All versions</TD
><td class="entry" rowspan="1" colspan="1">Many</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">S</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-14" title="">Section 23.9.14</A
></TD
><td class="entry" rowspan="1" colspan="1">Sender address</TD
><td class="entry" rowspan="1" colspan="1">All versions</TD
><td class="entry" rowspan="1" colspan="1">Exactly one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">T</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-15" title="">Section 23.9.15</A
></TD
><td class="entry" rowspan="1" colspan="1">Time created</TD
><td class="entry" rowspan="1" colspan="1">All versions</TD
><td class="entry" rowspan="1" colspan="1">Exactly one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">V</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-16" title="">Section 23.9.16, V line</A
></TD
><td class="entry" rowspan="1" colspan="1">Version</TD
><td class="entry" rowspan="1" colspan="1">V8.7 and above</TD
><td class="entry" rowspan="1" colspan="1">Exactly one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">Z</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-17" title="">Section 23.9.17, Z line</A
></TD
><td class="entry" rowspan="1" colspan="1">DSN envelope ID</TD
><td class="entry" rowspan="1" colspan="1">V8.7 and above</TD
><td class="entry" rowspan="1" colspan="1">At most one</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">$</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-18" title="">Section 23.9.18, $ line</A
></TD
><td class="entry" rowspan="1" colspan="1">Restore macro value</TD
><td class="entry" rowspan="1" colspan="1">V8.6 and above</TD
><td class="entry" rowspan="1" colspan="1">At most one each</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">.</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><a class="xref" href="#SML2-CH-23-SECT-9-19" title="">Section 23.9.19, . line</A
></TD
><td class="entry" rowspan="1" colspan="1">End of <em class="emphasis">qf</EM
> file</TD
><td class="entry" rowspan="1" colspan="1">V8.7 and above</TD
><td class="entry" rowspan="1" colspan="1">At most one</TD
></TR
></TBODY
></TABLE
><p class="para">Some code letters may appear only once in a <code class="literal">qf</CODE
> file;
others may appear many times. Any line that begins
with a tab or space character is joined to the line above it.
Empty lines are ignored. The order in which these lines appear in the 
<code class="literal">qf</CODE
> file is important for the <em class="emphasis">mailq</EM
> command to work properly.</P
><p class="para">We discuss the individual lines in the <code class="literal">qf</CODE
>
file by code letters. Each letter is
presented in alphabetical order rather than the order in which they should appear
in the <code class="literal">qf</CODE
> file.</P
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-1">23.9.1 B line</A
></H3
><p class="refpurpose">Message body type</P
>(V8.6 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21257"></A
><a class="indexterm" name="AUTOID-21260"></A
><a class="indexterm" name="AUTOID-21263"></A
>The message body type is described under the <code class="literal">-B</CODE
> command-line switch
(see <a class="xref" href="ch36_07.htm" title="">Section 36.7.1</A
>).
The <code class="literal">B</CODE
> line in the <code class="literal">qf</CODE
> file stores whatever the body type was
set to, either from the command line or by the SMTP MAIL command.
The two usual body types are <code class="literal">8BITMIME</CODE
> or <code class="literal">7BIT</CODE
>.</P
><p class="para">The form of the <code class="literal">B</CODE
> line is</P
><p class="para"><blockquote class="screen"><pre class="screen">B<code class="replaceable"><i>type</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">There must be no space between the <code class="literal">B</CODE
> and the <code class="replaceable"><i>type</I
></CODE
>.
If the <code class="replaceable"><i>type</I
></CODE
> is missing, the body type becomes the character
value zero.
If the entire <code class="literal">B</CODE
> line is missing, the default is <code class="literal">7BIT</CODE
>.
If <code class="replaceable"><i>type</I
></CODE
> is longer than MAXNAME as defined in <em class="emphasis">conf.h</EM
>
(see <a class="xref" href="ch18_08.htm" title="">Section 18.8.19, MAX...</A
>) when compiling <em class="emphasis">sendmail</EM
>, it is truncated
to MAXNAME-1 characters when the <code class="literal">qf</CODE
> file is read.</P
><p class="para">Note that the <code class="replaceable"><i>type</I
></CODE
> must be either <code class="literal">7bit</CODE
> or <code class="literal">8bitmime</CODE
>.
Anything else will not be detected when the <code class="literal">qf</CODE
> file is read and
may eventually cause the ESMTP dialogue to fail:</P
><p class="para"><blockquote class="screen"><pre class="screen">501 &lt;<i class="lineannotation">sender</I
>&gt;... Unknown BODY type <i class="lineannotation">badtype</I
></PRE
></BLOCKQUOTE
></P
><p class="para">This error will be reproduced at every MX site for the recipient until
a site that does not speak ESMTP is found or until the MX list is exhausted.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-2">23.9.2 C line</A
></H3
><p class="refpurpose">Set controlling user</P
>(V5.62 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21305"></A
><a class="indexterm" name="AUTOID-21307"></A
>To ensure secure handling of delivery, recipient addresses that
are either a file or a program require that <em class="emphasis">sendmail</EM
>
perform delivery as the owner of the file or program rather
than as <em class="emphasis">root</EM
>. A file address is one that begins with
a <code class="literal">/</CODE
> character. A program address is one that begins 
with a <code class="literal">|</CODE
> character. Both characters are detected after  
quotation marks have been stripped from the address.</P
><p class="para"><a class="indexterm" name="AUTOID-21315"></A
><a class="indexterm" name="AUTOID-21317"></A
><a class="indexterm" name="AUTOID-21319"></A
>To prevent potential security violations, <em class="emphasis">sendmail</EM
> must take special
precautions when addresses in the <code class="literal">qf</CODE
> file result from reading a
<em class="emphasis">~/.forward</EM
> or <code class="literal">:include:</CODE
> file.
When such an address is to be placed into the <code class="literal">qf</CODE
> file
(whether as a recipient's address in an <code class="literal">R</CODE
> line or as an
error recipient's address in an <code class="literal">E</CODE
> line), <em class="emphasis">sendmail</EM
>
first places a <code class="literal">C</CODE
> line (for Controlling user) into the file
and then the recipient's address. The <code class="literal">C</CODE
> line specifies
the owner of the <em class="emphasis">~/.forward</EM
> or <code class="literal">:include:</CODE
> file:</P
><p class="para"><blockquote class="screen"><pre class="screen">Cgeorge
RPF:/u/users/george/mail/archive
Cben
RPF:|/u/users/ben/bin/mailfilter</PRE
></BLOCKQUOTE
></P
><p class="para">Here, when <em class="emphasis">sendmail</EM
> later delivers to the recipients
in this <code class="literal">qf</CODE
> file,
it first converts its user identity to that of the user <em class="emphasis">george</EM
>,
then resets itself back to being <em class="emphasis">root</EM
> again. 
The same process repeats
with the next recipient, except that <em class="emphasis">sendmail</EM
> changes
from <em class="emphasis">root</EM
> to <em class="emphasis">ben</EM
> and back again.
If there is no <code class="literal">C</CODE
> line preceding a <code class="literal">R</CODE
> line, the previous
<code class="literal">C</CODE
> line's value is carried down:</P
><p class="para"><blockquote class="screen"><pre class="screen">Cgeorge
RPF:/u/users/george/mail/archive
RPF:|/u/users/ben/bin/mailfilter          <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> controlling user is george</I
></PRE
></BLOCKQUOTE
></P
><p class="para">The form of the <code class="literal">C</CODE
> line in the <code class="literal">qf</CODE
> file is</P
><p class="para"><blockquote class="screen"><pre class="screen">C<code class="replaceable"><i>user                  </I
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> Prior to V8</I
>
C<code class="replaceable"><i>user:eaddr            </I
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> V8.1 through V8.7.5</I
>
C<code class="replaceable"><i>user:uid:gid:eaddr    </I
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> V8.7.6 and V8.8</I
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">C</CODE
> must begin the line and be immediately followed
by <code class="replaceable"><i>user</I
></CODE
>, with no intervening space.
If no <code class="replaceable"><i>user</I
></CODE
> follows the <code class="literal">C</CODE
>, any prior controlling user is cleared
and the identity that is used reverts to that specified by the <code class="literal">DefaultUser</CODE
>
(<code class="literal">u</CODE
>) option (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.15, DefaultUser (g)(u)</A
>).
If present, the <code class="replaceable"><i>user</I
></CODE
>
is the login name of the owner of the 
<em class="emphasis">~/.forward</EM
> or <code class="literal">:include:</CODE
> file
that yielded the address
in the next following <code class="literal">R</CODE
> or <code class="literal">E</CODE
> line. If <code class="literal">user</CODE
>
is the name of a user who is unknown to the system, prior to V8.7.6 and prior
to V8.8 the effect was the same as if it were missing.
Beginning with V8.8 and V8.7.6, an unknown <code class="replaceable"><i>user</I
></CODE
> causes the
identity to become that of the <code class="replaceable"><i>uid</I
></CODE
> and <code class="literal">gid</CODE
>.
Beginning with V8 <em class="emphasis">sendmail</EM
>, an optional <code class="replaceable"><i>eaddr</I
></CODE
> may
be last. If present, the <code class="replaceable"><i>eaddr</I
></CODE
> gives the address to use
for error messages.</P
><p class="para">There may be only one <code class="literal">C</CODE
> line immediately preceding each
<code class="literal">R</CODE
> and <code class="literal">E</CODE
> line. Two <code class="literal">C</CODE
> lines in a row
have the effect of the second superseding the first.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-3">23.9.3 D line</A
></H3
><p class="refpurpose">Data filename</P
>(Obsolete as of V8.7)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21394"></A
><a class="indexterm" name="AUTOID-21396"></A
>Beginning with V8.7 <em class="emphasis">sendmail</EM
> looks for its data file (the file
containing the message body) under the
same name as its <code class="literal">qf</CODE
> file, but with the <code class="literal">q</CODE
> changed into
a <code class="literal">d</CODE
>.
Prior to V8.7, the <code class="literal">D</CODE
> line in the <code class="literal">qf</CODE
> file contained
the name of the file that contained the message body.
If the <code class="literal">D</CODE
> line was missing, there was no message
body.  The form of the <code class="literal">qf</CODE
> file <code class="literal">D</CODE
> line was</P
><p class="para"><blockquote class="screen"><pre class="screen">D<code class="replaceable"><i>file</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">D</CODE
> must begin the line. The <code class="replaceable"><i>file</I
></CODE
> must immediately
follow with no intervening space. All text, from the first character
following the <code class="literal">D</CODE
> to the end of the line, is taken as the
name of the file. There is no default for <code class="replaceable"><i>file</I
></CODE
>; either it must
be present, or the entire <code class="literal">D</CODE
> line must be absent.</P
><p class="para">The <em class="emphasis">sendmail</EM
> program opens the
<code class="literal">df</CODE
> <code class="replaceable"><i>file</I
></CODE
> for reading. If that open fails, <em class="emphasis">sendmail</EM
>
<em class="emphasis">syslog</EM
>(3)'s the following error message at LOG_CRIT and continues
to process the <code class="literal">qf</CODE
> file:</P
><p class="para"><blockquote class="screen"><pre class="screen">readqf: cannot open dfAA12345</PRE
></BLOCKQUOTE
></P
><p class="para">Be aware that <em class="emphasis">sendmail</EM
> attempts to remove the
<code class="replaceable"><i>file</I
></CODE
> after it has been delivered to all recipients.
If <em class="emphasis">sendmail</EM
> is unable to remove the <code class="replaceable"><i>file</I
></CODE
>, and
if the <code class="literal">LogLevel</CODE
> (<code class="literal">L</CODE
>) option (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.33, LogLevel (L)</A
>) is greater than 97,
<em class="emphasis">sendmail</EM
> <em class="emphasis">syslog</EM
>(3)'s the following warning at LOG_DEBUG:</P
><p class="para"><blockquote class="screen"><pre class="screen"><em class="emphasis">file</EM
>: unlink-fail <i class="lineannotation">#</I
></PRE
></BLOCKQUOTE
></P
><p class="para">The <em class="emphasis">file</EM
> is the name of the file that could not be removed.
The <em class="emphasis">#</EM
> is the error number, as defined in <em class="emphasis">/usr/include/errno.h</EM
>.</P
><p class="para">The <code class="literal">df</CODE
> file is opened only
when processing the queue file, not when printing it.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-4">23.9.4 E line</A
></H3
><p class="refpurpose">Send errors to</P
>(V8.6 and earlier)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21453"></A
><a class="indexterm" name="AUTOID-21455"></A
>Notification of errors often requires special handling by <em class="emphasis">sendmail</EM
>.
When mail to a mailing list fails, for example, <em class="emphasis">sendmail</EM
> looks
for the owner of that list. If it finds one, the owner, not
the sender, receives
notification of the error. To differentiate
error notification addresses from ordinary sender and recipient addresses,
pre-V8.7 <em class="emphasis">sendmail</EM
> stored error addresses separately in the <code class="literal">qf</CODE
> file,
one per <code class="literal">E</CODE
> line.
Beginning with V8.7, this <code class="literal">E</CODE
> line is no longer used. Instead, <em class="emphasis">sendmail</EM
>
uses the <code class="literal">S</CODE
> line.</P
><p class="para">The form of the <code class="literal">E</CODE
> line in the <code class="literal">qf</CODE
> file looks like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">E<code class="replaceable"><i>addr         </I
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> V8.6 and earlier</I
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">E</CODE
> must begin the line. One or more addresses may be
entered on that same line. Whitespace and commas may surround
the individual addresses. Note, however, that <em class="emphasis">sendmail</EM
>
places only a single address on each <code class="literal">E</CODE
> line.
There may be multiple <code class="literal">E</CODE
> lines. Each is processed in turn.</P
><p class="para">Each line is fully processed as it is read. That is, the line is
scanned for multiple addresses. Each address that is found is alias-expanded.
Each resulting new address is processed by rule sets 3 and 0
to resolve a delivery agent for each.</P
><p class="para">If an alias expands to a program or a file (text that begins with
a <code class="literal">/</CODE
> or <code class="literal">|</CODE
> character), that text is sent out
in the delivered message's <code class="literal">Errors-To:</CODE
> line in that form.
This can cause confusion when the message is later processed and
bounced at the receiving site.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-5">23.9.5 F line</A
></H3
><p class="refpurpose">Saved flag bits</P
>(V8.1 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21491"></A
><a class="indexterm" name="AUTOID-21493"></A
><a class="indexterm" name="AUTOID-21495"></A
>Under V8 <em class="emphasis">sendmail</EM
> the <code class="literal">Timeout.queuewarn</CODE
> option (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.70</A
>)
can specify an interval
to wait before notifying the sender that a message could not immediately
be delivered. To keep track of whether such a notification has been
sent, <em class="emphasis">sendmail</EM
> stores the state of its EF_WARNING envelope
flag in the <code class="literal">qf</CODE
> file.
If that flag is set, notification has already been sent.</P
><p class="para">Error mail messages sent by <em class="emphasis">sendmail</EM
> may occasionally
be queued, rather than immediately delivered. The <code class="literal">Timeout.queuewarn</CODE
> option
notification should not be sent for such mail. If such mail remains
in the queue too long, it should be canceled rather than bounced.
V8 <em class="emphasis">sendmail</EM
> saves the state of the EF_RESPONSE envelope
flag in the <code class="literal">qf</CODE
> file.<a class="indexterm" name="AUTOID-21507"></A
>
If that flag is set, the message is an error notification.</P
><p class="para"><a class="indexterm" name="AUTOID-21510"></A
><a class="indexterm" name="AUTOID-21512"></A
>Beginning with V8.8, <em class="emphasis">sendmail</EM
> also records the state of the
EF_HAS8BIT flag (the message body contains 8-bit data)
and the EF_DELETE_BCC flag (delete empty <code class="literal">Bcc:</CODE
> headers;
see <a class="xref" href="ch35_10.htm" title="">Section 35.10.4, Bcc:</A
>).</P
><p class="para">All envelope flags are listed in <a class="xref" href="ch37_05.htm" title="Hexadecimal Envelope Flags">Table 37.3</A
> of <a class="xref" href="ch37_05.htm" title="">Section 37.5.12, -d2.1</A
>.
The <code class="literal">F</CODE
> line is used to save envelope flags for later
restoration. Its form looks like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">F<code class="replaceable"><i>flags</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">Here, the <code class="replaceable"><i>flags</I
></CODE
> are any combination of <code class="literal">w</CODE
>, which
restores (sets) the EF_WARNING flag; <code class="literal">r</CODE
>, which restores
the EF_RESPONSE flag; <code class="literal">8</CODE
>, which restores the EF_HAS8BIT flag;
and <code class="literal">b</CODE
>, which restores the EF_DELETE_BCC flag.
Only those letters are recognized. Other letters are silently
ignored.
Note that these flags may be done away with in later versions
of <em class="emphasis">sendmail</EM
> and new flags may be added without notice.</P
><p class="para">For security protection, V8 <em class="emphasis">sendmail</EM
> rejects and logs the
following flag sequence:</P
><p class="para"><blockquote class="screen"><pre class="screen">From
    <i class="lineannotation"><img src="../chars/uarr.gif" alt="-^"></I
>
    <i class="lineannotation">a space here</I
></PRE
></BLOCKQUOTE
></P
><p class="para">See <a class="xref" href="ch23_03.htm#SML2-CH-23-SECT-3-5" title="Funny Flag Bits in qf File">Section 23.3.5, "Funny Flag Bits in qf File"</A
> for more information about this.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-6">23.9.6 H line</A
></H3
><p class="refpurpose">Header line</P
>(All versions of sendmail)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21547"></A
><a class="indexterm" name="AUTOID-21549"></A
>The lines of text that form the message header are saved to
the <code class="literal">qf</CODE
> file, one per <code class="literal">H</CODE
> line. Any header lines added by
<em class="emphasis">sendmail</EM
> are also saved to <code class="literal">H</CODE
> lines
in the <code class="literal">qf</CODE
> file.</P
><p class="para">The form of the <code class="literal">H</CODE
> line is:</P
><p class="para"><blockquote class="screen"><pre class="screen">H<code class="replaceable"><i>definition</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">H</CODE
> must begin the line, and the <code class="replaceable"><i>definition</I
></CODE
> must
immediately follow with no intervening space. The <code class="replaceable"><i>definition</I
></CODE
>
is exactly the same as, and obeys the same rules as, the
<code class="literal">H</CODE
> commands in the configuration file (see <a class="xref" href="ch35_01.htm" title="The H Configuration Command">Section 35.1, "The H Configuration Command"</A
>).</P
><p class="para">When <em class="emphasis">sendmail</EM
> writes header lines to the <code class="literal">qf</CODE
> file,
it pre-expands macros (replaces expressions such as <code class="literal">$x</CODE
>
with their values) and preresolves conditionals (<code class="literal">$?</CODE
>, 
<code class="literal">$!</CODE
>, and <code class="literal">$.</CODE
>).</P
><p class="para">The order in which <code class="literal">H</CODE
> lines appear in the <code class="literal">qf</CODE
> file is
exactly the same as the order in which they appear in the delivered message.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-7">23.9.7 I line</A
></H3
><p class="refpurpose">Inode and device information for the df file</P
>(V8.7 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21586"></A
><a class="indexterm" name="AUTOID-21588"></A
><a class="indexterm" name="AUTOID-21590"></A
><a class="indexterm" name="AUTOID-21592"></A
><a class="indexterm" name="AUTOID-21595"></A
>When a machine crashes under UNIX, files in a directory may become detached
from that directory. When this happens, those orphaned files are saved in a directory
called <em class="emphasis">lost+found</EM
>. Because file names are saved only in directories, orphaned
files are nameless.  Consequently, UNIX stores them in <em class="emphasis">lost+found</EM
>
using their <em class="emphasis">inode</EM
> numbers as their names.</P
><p class="para">To illustrate, consider finding these four files in <em class="emphasis">lost+found</EM
> after a
crash:</P
><p class="para"><blockquote class="screen"><pre class="screen">#1528 #1200 #3124 #3125</PRE
></BLOCKQUOTE
></P
><p class="para">Two of these are <code class="literal">qf</CODE
> files, and two are <code class="literal">df</CODE
> files. Beginning with
V8.7 <em class="emphasis">sendmail</EM
> the <code class="literal">qf</CODE
> files contain a record of the inode
numbers for their corresponding <code class="literal">df</CODE
> files. That information is stored
in the <code class="literal">I</CODE
> line:</P
><p class="para"><blockquote class="screen"><pre class="screen">I<code class="replaceable"><i>major/minor/ino</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">&#13;Here, the <code class="replaceable"><i>major</I
></CODE
> and <code class="replaceable"><i>minor</I
></CODE
> are the major and minor device numbers
for the disk device that the <code class="literal">df</CODE
> file was stored on. The <code class="replaceable"><i>ino</I
></CODE
> is
the inode number for the <code class="literal">df</CODE
> file. In our above <em class="emphasis">lost+found</EM
> example
the following command could be run to pair up the orphaned files:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>grep &quot;^I.*/.*/&quot; *</B
></CODE
>
#1200:I123/45/3124
#1325:I123/45/1528</PRE
></BLOCKQUOTE
></P
><p class="para">This shows that the <code class="literal">qf</CODE
> file <em class="emphasis">#1200</EM
> has the <code class="literal">df</CODE
> file <em class="emphasis">#3124</EM
>
and that the <code class="literal">qf</CODE
> file <em class="emphasis">#1325</EM
> has the <code class="literal">df</CODE
> file <em class="emphasis">#1528</EM
>.</P
><p class="para">The <em class="emphasis">sendmail</EM
> program does not check the inode number in the <code class="literal">I</CODE
> line
against the actual inode number of the <code class="literal">df</CODE
> file. Instead, the <code class="literal">I</CODE
>
line is generated afresh each time the <code class="literal">qf</CODE
> file is processed.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-8">23.9.8 K line</A
></H3
><p class="refpurpose">The time last processed from the queue</P
>(V8.7 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21648"></A
><a class="indexterm" name="AUTOID-21650"></A
><a class="indexterm" name="AUTOID-21652"></A
><a class="indexterm" name="AUTOID-21656"></A
>The <code class="literal">MinQueueAge</CODE
> option (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.41</A
>) sets the length of time
a queued message must remain queued before delivery can again be tried.
Each time <em class="emphasis">sendmail</EM
> processes a <code class="literal">qf</CODE
> file, it subtracts 
the time stored in the <code class="literal">K</CODE
> line from the current time and compares the
result to the <code class="literal">MinQueueAge</CODE
>. If sufficient time has not passed,
the rest of processing is skipped. (Note that this test is performed only
if the <code class="literal">qf</CODE
> file has been processed at least once; see the <code class="literal">N</CODE
> line
in <a class="xref" href="#SML2-CH-23-SECT-9-10" title="">Section 23.9.10</A
>).</P
><p class="para">The time stored in the
<code class="literal">K</CODE
> line looks like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">K703531020</PRE
></BLOCKQUOTE
></P
><p class="para">This number represents the date and time in seconds.
Every time the <code class="literal">qf</CODE
> file is processed (delivery is attempted),
the <code class="literal">K</CODE
> line is updated with the current time.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-9">23.9.9 M line</A
></H3
><p class="refpurpose">The reason message was queued</P
>(All versions of sendmail)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21683"></A
><a class="indexterm" name="AUTOID-21686"></A
><a class="indexterm" name="AUTOID-21688"></A
>When a mail message is placed into the queue because of an error
during the delivery attempt, the nature of that error is stored
in the <code class="literal">M</CODE
> line of the <code class="literal">qf</CODE
> file. 
The error is usually prefixed with <code class="literal">Deferred</CODE
>:</P
><p class="para"><blockquote class="screen"><pre class="screen">Deferred: <em class="emphasis">reason</EM
></PRE
></BLOCKQUOTE
></P
><p class="para">Delivery can be deferred until a later queue run because
of a temporary lack of services. For example, the <em class="emphasis">reason</EM
>
may be &quot;remote host is down.&quot;</P
><p class="para">&#13;The form of the <code class="literal">qf</CODE
> file <code class="literal">M</CODE
> line is:</P
><p class="para"><blockquote class="screen"><pre class="screen">M<code class="replaceable"><i>msg</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">M</CODE
> must begin the line. It is immediately followed
by the <code class="replaceable"><i>msg</I
></CODE
> with no intervening space. The text of
<code class="replaceable"><i>msg</I
></CODE
> is everything up to the end of the line.
The <code class="replaceable"><i>msg</I
></CODE
> created by <em class="emphasis">sendmail</EM
> may include the
word <code class="literal">Deferred:</CODE
>, followed by a reason.
The <code class="literal">M</CODE
> line should appear before the <code class="literal">S</CODE
> line.</P
><p class="para">If the <code class="replaceable"><i>msg</I
></CODE
> is missing, <em class="emphasis">sendmail</EM
> simply
prints a blank line rather than a reason when showing the
queue with <em class="emphasis">mailq</EM
> or the <code class="literal">-bp</CODE
> command-line switch.
If the <code class="literal">M</CODE
> line is entirely missing, <em class="emphasis">sendmail</EM
>
prints nothing.</P
><p class="para">The maximum number of characters in <code class="replaceable"><i>msg</I
></CODE
> is defined by
MAXLINE in <em class="emphasis">conf.h</EM
> (see <a class="xref" href="ch18_08.htm" title="">Section 18.8.19</A
>). 
There should be only one <code class="literal">M</CODE
> line in a <code class="literal">qf</CODE
> file.
If there are multiple <code class="literal">M</CODE
> lines, only the last is used.
If multiple recipients produced error messages, only the last
one is stored in an <code class="literal">M</CODE
> line.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-10">23.9.10 N line</A
></H3
><p class="refpurpose">Number of times tried</P
>(V8.7 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21737"></A
><a class="indexterm" name="AUTOID-21739"></A
><a class="indexterm" name="AUTOID-21742"></A
><a class="indexterm" name="AUTOID-21745"></A
>Each time delivery is attempted for a message, the number stored
in its <code class="literal">qf</CODE
> file's <code class="literal">N</CODE
> line is incremented by one.
This number always begins at zero.</P
><p class="para">When delivering many messages to a single host, <em class="emphasis">sendmail</EM
>
remembers failures.  If one message fails to make it all the 
way through an SMTP dialogue, all the following messages
to that same host will be deferred (not attempted during
the current queue run). For those
deferred messages the number of tries is correctly
incremented as though the delivery was actually attempted.</P
><p class="para">The value in this <code class="literal">N</CODE
> line is used
to determine whether the delay of the <code class="literal">MinQueueAge</CODE
> option
(see <a class="xref" href="ch34_08.htm" title="">Section 34.8.41</A
>) should be triggered.
This value, when zero, can also be used
to enable a special first-time connection timeout (see
<a class="xref" href="ch34_08.htm" title="Timeout.iconnect">Section 34.8.70.9, "Timeout.iconnect"</A
>). </P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-11">23.9.11 P line</A
></H3
><p class="refpurpose">Priority when processed from queue</P
>(All versions of sendmail)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21765"></A
><a class="indexterm" name="AUTOID-21767"></A
>Not all messages need to be treated equally.
Messages that have failed often, for example, tend to
continue to fail. When sendmail processes the messages in its queue,
it sorts them by priority that was and attempts to deliver those most likely
to succeed first.</P
><p class="para">&#13;When a mail message is first placed into the queue, it is given an
initial priority calculated when it was first created (see
<a class="xref" href="ch34_08.htm" title="">Section 34.8.53</A
>), which is stored in the <code class="literal">P</CODE
> line:</P
><p class="para"><blockquote class="screen"><pre class="screen">P640561</PRE
></BLOCKQUOTE
></P
><p class="para">This number in the <code class="literal">qf</CODE
> file is really a cost.
The <em class="emphasis">lower</EM
> it is, the more preferentially the message
is treated by <em class="emphasis">sendmail</EM
>.
Each time the <code class="literal">qf</CODE
> file is read,
the number in the <code class="literal">P</CODE
> line
is incremented. The size of that increment is set by the value
of the <code class="literal">RetryFactor</CODE
> (<code class="literal">Z</CODE
>) option (see <a class="xref" href="ch34_08.htm" title="">Section 34.8.56, RetryFactor (Z)</A
>). If that option
is negative, the logic of &quot;what fails will continue to fail&quot; is
inverted.</P
><p class="para">The form of the <code class="literal">qf</CODE
> file <code class="literal">P</CODE
> line is</P
><p class="para"><blockquote class="screen"><pre class="screen">P<code class="replaceable"><i>pri</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">P</CODE
> must begin the line. The <code class="replaceable"><i>pri</I
></CODE
> is a text
representation of an integer value. The <code class="replaceable"><i>pri</I
></CODE
> must immediately
follow the <code class="literal">P</CODE
> with no intervening space. The text in
<code class="replaceable"><i>pri</I
></CODE
> is converted to an integer using the C library
routine <em class="emphasis">atol</EM
>(3). That routine allows <code class="replaceable"><i>pri</I
></CODE
> to
be represented in text as a signed decimal number, an octal number,
or a hexadecimal number.</P
><p class="para"><a class="indexterm" name="AUTOID-21799"></A
>If <code class="replaceable"><i>pri</I
></CODE
> is absent, the priority value used is that of the
configuration file <code class="literal">RetryFactor</CODE
> (<code class="literal">Z</CODE
>) option. If the entire <code class="literal">P</CODE
> line
is absent, the priority value begins as zero.</P
><p class="para">There should be only one <code class="literal">P</CODE
> line in any <code class="literal">qf</CODE
> file.
Multiple <code class="literal">P</CODE
> lines cause all but the last to be ignored.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-12">23.9.12 Q line</A
></H3
><p class="refpurpose">The DSN ORCPT address</P
>(V8.7 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21817"></A
><a class="indexterm" name="AUTOID-21819"></A
><a class="indexterm" name="AUTOID-21822"></A
><a class="indexterm" name="AUTOID-21824"></A
><a class="indexterm" name="AUTOID-21826"></A
><a class="indexterm" name="AUTOID-21828"></A
>When a mail message arrives that includes an ORCPT parameter for
the ESMTP RCPT command (see RFC1891),
<em class="emphasis">sendmail</EM
> needs to save that parameter's information separately from the RCPT
recipient address:</P
><p class="para"><blockquote class="screen"><pre class="screen">RCPT TO:&lt;gw@wash.dc.gov&gt; ORCPT=rfc822;gw@wash.dc.gov
         <i class="lineannotation"><img src="../chars/uarr.gif" alt="-^"></I
>                    <i class="lineannotation"><img src="../chars/uarr.gif" alt="-^"></I
>
         <i class="lineannotation">recipient address</I
>   <i class="lineannotation">parameter's information</I
></PRE
></BLOCKQUOTE
></P
><p class="para">Not all sites understand ESMTP. If
<em class="emphasis">sendmail</EM
> forwards the message to such a site, it needs
to omit the ORCPT parameter. Consequently, <em class="emphasis">sendmail</EM
> must not
store that parameter with the RCPT address.</P
><p class="para">The <code class="literal">Q</CODE
> line is used to separately store the ORCPT parameter
information:</P
><p class="para"><blockquote class="screen"><pre class="screen">Q<code class="replaceable"><i>type</I
></CODE
>;<code class="replaceable"><i>addr</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="replaceable"><i>type</I
></CODE
><code class="literal">;</CODE
><code class="replaceable"><i>addr</I
></CODE
> is defined by RFC1891. The
<em class="emphasis">sendmail</EM
> program checks the validity of <code class="replaceable"><i>addr</I
></CODE
> when that
information is received but otherwise merely stores <code class="replaceable"><i>type</I
></CODE
><code class="literal">;</CODE
><code class="replaceable"><i>addr</I
></CODE
>
as is in the <code class="literal">Q</CODE
> line.</P
><p class="para">There must be only a single <code class="literal">Q</CODE
> line for each recipient <code class="literal">R</CODE
> line, and
each such <code class="literal">Q</CODE
> line  must precede its corresponding <code class="literal">R</CODE
> line.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-13">23.9.13 R line</A
></H3
><p class="refpurpose">Recipient's address</P
>(All versions of sendmail)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21870"></A
><a class="indexterm" name="AUTOID-21872"></A
><a class="indexterm" name="AUTOID-21875"></A
>The <code class="literal">qf</CODE
> file lists all the recipients for a mail message.
There may be one recipient or many. When <em class="emphasis">sendmail</EM
> creates
the <code class="literal">qf</CODE
> file, it lists each recipient address on an individual
<code class="literal">R</CODE
> line.
The form of the <code class="literal">R</CODE
> line in the <code class="literal">qf</CODE
> file looks like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">R<code class="replaceable"><i>flags:addr</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">R</CODE
> must begin the line. 
Only a single address may appear on each <code class="literal">R</CODE
> line.
There may be multiple <code class="literal">R</CODE
> lines. Each is processed in turn.</P
><p class="para">If the colon is present and if the version of the <code class="literal">qf</CODE
> file
is greater than 0, the characters between the <code class="literal">R</CODE
> and the
colon are interpreted as flags that further define the nature
of the address:
<code class="literal">P</CODE
> 
(primary) Addresses can undergo many transformations prior to
delivery. When expanding aliases, for example, the address <em class="emphasis">george</EM
>
might be transformed into two addresses via a <em class="emphasis">~/.forward</EM
> file:
<em class="emphasis">george@here</EM
> and <em class="emphasis">george@there</EM
>. In this instance, <em class="emphasis">george</EM
>
is the primary address, and the aliases are secondary addresses.
If aliasing yields only a single transformation, the single new
address is considered primary.
Addresses that are received via a RCPT SMTP command are always considered
primary, as are all other recipient addressees prior to aliasing.
<code class="literal">N</CODE
> 
(notify) Recipient addresses can lead to various kinds of notification<a class="indexterm" name="AUTOID-21901"></A
>
based on the nature of the DSN NOTIFY extension to the
RCPT SMTP command. That notification can be either
NEVER or some combination of SUCCESS, FAILURE, or
DELAY. Internally, <em class="emphasis">sendmail</EM
> uses the absence of the
latter three to imply NEVER. This <code class="literal">N</CODE
> flag simply says
that the DSN NOTIFY extension appeared in the message.
If the  <code class="literal">N</CODE
> is absent, but an <code class="literal">S</CODE
>, <code class="literal">F</CODE
>, or <code class="literal">D</CODE
>
is present, DSN information will not be propagated.
Note that NOTIFY can also be specified by using
the <code class="literal">-N</CODE
> command line switch (see <a class="xref" href="ch36_07.htm" title="">Section 36.7.28, -N</A
>).</P
><dl class="variablelist"><dt class="term"><code class="literal">S</CODE
>, <code class="literal">F</CODE
>, <code class="literal">D</CODE
></DT
><dd class="listitem"><p class="para">(success, failure, delay)
The DSN NOTIFY extension to the
RCPT SMTP command will specify either NEVER
or some combination of SUCCESS, FAILURE, or
DELAY. When any of these is specified, its first letter is
used as a flag for the recipient address. SUCCESS means
to notify the sender that final delivery succeeded.
FAILURE is used to notify the sender that some step
toward delivery failed fatally. DELAY lets the sender
know that the message has been delayed but delivery will
continue to be attempted.</P
></DD
></DL
><p class="para">Each <code class="literal">R</CODE
> line is fully processed as it is read. That is, the line is
scanned for multiple addresses. Each address that is found is alias-expanded.
Each resulting new address is processed by rule sets 3 and 0
to resolve a delivery agent for each.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-14">23.9.14 S line</A
></H3
><p class="refpurpose">Sender's address</P
>(All versions of sendmail)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-21929"></A
><a class="indexterm" name="AUTOID-21931"></A
>Each mail message must have a sender. The <em class="emphasis">sendmail</EM
> program
can determine the sender in four ways:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">If the sender is specified in the envelope of an SMTP connection,
that sender's address is used.</P
></LI
><li class="listitem"><p class="para">If the <code class="literal">-f</CODE
> command-line argument is used to run <em class="emphasis">sendmail</EM
>,
the sender's address is the address following the <code class="literal">-f</CODE
>.</P
></LI
><li class="listitem"><p class="para">If the sender is not specified in the envelope, the address that is used
is that of the user who ran the <em class="emphasis">sendmail</EM
> program. If that
user is unknown, the sender is made to be <em class="emphasis">postmaster</EM
>.</P
></LI
><li class="listitem"><p class="para">When processing the queue, the sender's address is
specified in the <code class="literal">S</CODE
> line of the <code class="literal">qf</CODE
> file.</P
></LI
></UL
><p class="para">The form of the <code class="literal">S</CODE
> line in the <code class="literal">qf</CODE
> file looks like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">S<code class="replaceable"><i>addr</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">S</CODE
> must begin the line. Exactly one address must
follow on that same line. Whitespace may surround
that address.
There may be only one <code class="literal">S</CODE
> line in the <code class="literal">qf</CODE
> file.</P
><p class="para">If the <code class="replaceable"><i>addr</I
></CODE
> is missing, <em class="emphasis">sendmail</EM
> sets the sender
to be the user who ran <em class="emphasis">sendmail</EM
>. If that user is not known
in the <em class="emphasis">passwd</EM
> file (or database), <em class="emphasis">sendmail</EM
> <em class="emphasis">syslog</EM
>(3)'s
the following message 
and sets the sender to be <em class="emphasis">postmaster</EM
>:</P
><p class="para"><blockquote class="screen"><pre class="screen">Who are you?</PRE
></BLOCKQUOTE
></P
><p class="para">The resulting address is then processed to extract the user's full
name into <code class="literal">$x</CODE
> (see <a class="xref" href="ch31_10.htm" title="">Section 31.10.42, $x</A
>).
Finally, the sender's address is rewritten by rule sets 3, 1, and then 4.</P
><p class="para">Under all versions of
<em class="emphasis">sendmail</EM
> the address in the <code class="literal">S</CODE
> line
will include any RFC822 comment text that appeared with
the original message. Under V8.7, if the <code class="literal">F=c</CODE
> flag
(see <a class="xref" href="ch30_08.htm" title="">Section 30.8.14, F=c</A
>)
is set for the sender's delivery agent, all comment text
is stripped from the address.</P
><p class="para">If <em class="emphasis">sendmail</EM
> is compiled with USERDB defined (see <a class="xref" href="ch18_08.htm" title="">Section 18.8.54, USERDB</A
>),
the sender address can optionally be rewritten by the User
Database before it is placed into the <code class="literal">S</CODE
> line. Such
rewriting is allowed only if the delivery agent for the sender
includes the <code class="literal">F=i</CODE
> flag
(see <a class="xref" href="ch30_08.htm" title="">Section 30.8.24, F=i</A
>).</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-15">23.9.15 T line</A
></H3
><p class="refpurpose">Creation time</P
>(All versions of sendmail)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="SML2-CH-23-IX-T-LINE-QF-FILE"></A
><a class="indexterm" name="AUTOID-21994"></A
><a class="indexterm" name="AUTOID-21997"></A
><a class="indexterm" name="AUTOID-22000"></A
>To limit the amount of time a message can remain in
the queue before being bounced, <em class="emphasis">sendmail</EM
> must
know when that message was first placed in the queue.
That time of first placement is stored in the
<code class="literal">T</CODE
> line in the <code class="literal">qf</CODE
> file. For example,
the following number represents the date and time in seconds:</P
><p class="para"><blockquote class="screen"><pre class="screen">T703531020</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-22009"></A
><a class="indexterm" name="AUTOID-22011"></A
><a class="indexterm" name="AUTOID-22013"></A
>Each time <em class="emphasis">sendmail</EM
> fails to deliver a message from the
queue, it checks to see whether too much time has passed.
It adds the <code class="literal">T</CODE
> line value to the value specified
in the <code class="literal">Timeout.queuereturn</CODE
> (<code class="literal">T</CODE
>) option 
(see <a class="xref" href="ch34_08.htm" title="">Section 34.8.70</A
>). If that
sum is less than the current time, the message is bounced
instead of being left in the queue.</P
><p class="para">Messages are occasionally left in the queue
for longer than the normal timeout period. This might happen,
for example, if
a remote machine is down but you know that it will eventually be brought back
up.
There are two ways to lengthen the amount of time a message
may remain in the queue. </P
><p class="para">The preferred way is to create a temporary separate
queue directory and move the necessary queued file to that temporary
holding place. When the remote site comes back up, you can later
process the files in that other queue by running <em class="emphasis">sendmail</EM
> with
an artificially long <code class="literal">Timeout.queuereturn</CODE
> value
(see <a class="xref" href="ch23_07.htm#SML2-CH-23-SECT-7-1" title="Process Alternate Queues">Section 23.7</A
>).</P
><p class="para">A second way to extend the life of messages in the queue is to
edit the <code class="literal">qf</CODE
> file and change the value stored in the <code class="literal">T</CODE
>
line. Just add 86400 to that value for each day you want to extend.
Care is required 
to avoid editing a file that is currently being
processed by <em class="emphasis">sendmail</EM
>.
[8]</P
><blockquote class="footnote"><p class="para">[8] The <em class="emphasis">nvi</EM
>(1) editor uses the same file locking as <em class="emphasis">sendmail</EM
> and so
can safely be used to edit <code class="literal">qf</CODE
> files.</P
></BLOCKQUOTE
><p class="para">There is currently no plan to give <em class="emphasis">sendmail</EM
> the ability to
rejuvenate queued messages (make old messages appear young).</P
><p class="para">The form of the <code class="literal">T</CODE
> line in the <code class="literal">qf</CODE
> file is:</P
><p class="para"><blockquote class="screen"><pre class="screen">T<code class="replaceable"><i>secs</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">T</CODE
> begins the line, and the <code class="replaceable"><i>secs</I
></CODE
> must immediately
follow with no intervening space. The numeric text that forms
<code class="replaceable"><i>secs</I
></CODE
> is converted to an integer using the C library
routine <em class="emphasis">atol</EM
>(3). That routine allows <code class="replaceable"><i>secs</I
></CODE
> to
be represented in text as a signed decimal number, an octal number,
or a hexadecimal number.</P
><p class="para">If <code class="replaceable"><i>secs</I
></CODE
> is absent or the entire <code class="literal">T</CODE
> line
is absent, the time value is zero. A zero value causes the
mail message to time out immediately.</P
><p class="para">There should be only one <code class="literal">T</CODE
> line in any <code class="literal">qf</CODE
> file.
Multiple <code class="literal">T</CODE
> lines cause all but the last to be ignored.</P
><p class="para"><a class="indexterm" name="AUTOID-22056"></A
></P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-16">23.9.16 V line</A
></H3
><p class="refpurpose">Version of the qf file</P
>(V8.7 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-22065"></A
><a class="indexterm" name="AUTOID-22068"></A
><a class="indexterm" name="AUTOID-22071"></A
>s <em class="emphasis">sendmail</EM
> evolves, it will continue to add new abilities
to the <code class="literal">qf</CODE
> file. To protect old versions of <em class="emphasis">sendmail</EM
>
from wrongly misinterpreting new configuration files, the <code class="literal">V</CODE
> line
has been introduced. Prior to V8.7 <em class="emphasis">sendmail</EM
> there was
no <code class="literal">V</CODE
> line. For versions prior to 8.7.6 the version for
the <code class="literal">V</CODE
> line is 1:</P
><p class="para"><blockquote class="screen"><pre class="screen">V1            <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> V8.7.5 and earlier</I
></PRE
></BLOCKQUOTE
></P
><p class="para">For V8.7.6 and above, including V8.8, the version is 2 (where version 2
changes the layout of the <code class="literal">C</CODE
> line in the <code class="literal">qf</CODE
> file):</P
><p class="para"><blockquote class="screen"><pre class="screen">V2            <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> V8.7.6 and above and V8.8</I
></PRE
></BLOCKQUOTE
></P
><p class="para">If the version is greater than that currently supported, <em class="emphasis">sendmail</EM
>
will log this error and exit:</P
><p class="para"><blockquote class="screen"><pre class="screen">Version number in qf (<code class="replaceable"><i>bad</I
></CODE
>) greater than max (<code class="replaceable"><i>max</I
></CODE
>)</PRE
></BLOCKQUOTE
></P
><p class="para">A version 1 <code class="literal">qf</CODE
> file allows <code class="replaceable"><i>flags</I
></CODE
> to follow the
<code class="literal">R</CODE
> line.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-17">23.9.17 Z line</A
></H3
><p class="refpurpose">DSN ENVID envelope identifier</P
>(V8.7 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-22107"></A
><a class="indexterm" name="AUTOID-22109"></A
><a class="indexterm" name="AUTOID-22112"></A
><a class="indexterm" name="AUTOID-22115"></A
>The MAIL ESMTP command may optionally be followed by
an RFC1891 ENVID envelope identifier:</P
><p class="para"><blockquote class="screen"><pre class="screen">MAIL From: &lt;<code class="replaceable"><i>address</I
></CODE
>&gt; ENVID=<code class="replaceable"><i>envelopeID</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">ENVID is used to propagate a consistent envelope identifier
(distinct from the <code class="literal">Message-ID:</CODE
> header 
see <a class="xref" href="ch35_10.htm" title="">Section 35.10.19, Message-ID:</A
>) that
is permanently associated with a message.</P
><p class="para">The <code class="literal">Z</CODE
> line holds that ENVID envelope identifier
information:</P
><p class="para"><blockquote class="screen"><pre class="screen">Z<code class="replaceable"><i>envelopeID</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The ENVID information needs to be held
separately from the <code class="literal">S</CODE
> sender line because <em class="emphasis">sendmail</EM
>
has no way to determine in advance whether a recipient host speaks
ESMTP.</P
><p class="para">There must be only a single <code class="literal">Z</CODE
> line in any <code class="literal">qf</CODE
> file.
The <code class="literal">${envid}</CODE
> macro (see <a class="xref" href="ch31_10.htm" title="">Section 31.10.12, ${envid}</A
>) 
also stores the ENVID value.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-18">23.9.18 $ line</A
></H3
><p class="refpurpose">Restore macro value</P
>(V8.6 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-22146"></A
><a class="indexterm" name="AUTOID-22149"></A
><a class="indexterm" name="AUTOID-22152"></A
>The <em class="emphasis">sendmail</EM
> program uses the <code class="literal">$r</CODE
> macro (see <a class="xref" href="ch31_10.htm" title="">Section 31.10.31, $r</A
>)
to store the protocol used when <em class="emphasis">sendmail</EM
> first received a mail
message. If the message
was received by using SMTP, that protocol is <code class="literal">smtp</CODE
>.
Otherwise, it is NULL.</P
><p class="para"><a class="indexterm" name="AUTOID-22160"></A
>The <em class="emphasis">sendmail</EM
> program uses the <code class="literal">$s</CODE
> macro (see <a class="xref" href="ch31_10.htm" title="">Section 31.10.33, $s</A
>)
to store the full canonical name of the sender's machine.</P
><p class="para"><a class="indexterm" name="AUTOID-22166"></A
>The <em class="emphasis">sendmail</EM
> program uses the <code class="literal">$_</CODE
> macro (see <a class="xref" href="ch31_10.htm" title="">Section 31.10.1, $-</A
>)
to store RFC1413 <em class="emphasis">identd</EM
>(8) information and IP source routing
information.</P
><p class="para">When <em class="emphasis">sendmail</EM
> creates a <code class="literal">qf</CODE
> file, it saves the
values of the <code class="literal">$r</CODE
>, <code class="literal">$s</CODE
>, and <code class="literal">$_</CODE
> macros in lines that begin with
<code class="literal">$</CODE
>.</P
><p class="para">The form of the <code class="literal">$</CODE
> line in the <code class="literal">qf</CODE
> file looks like this:</P
><p class="para"><blockquote class="screen"><pre class="screen">$X<code class="replaceable"><i>value</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The <code class="literal">$</CODE
> must begin the line, and the macro's single-character name (the <code class="literal">X</CODE
>)
must immediately follow with no intervening space.
The <code class="literal">X</CODE
> is followed (again with no intervening space) by the
value of the macro.</P
><p class="para">If <code class="replaceable"><i>value</I
></CODE
> is missing, the value given to the macro is NULL.
If the <code class="literal">X</CODE
> and <code class="replaceable"><i>value</I
></CODE
> are missing, 
the macro <code class="literal">\0</CODE
> is given a value of NULL.
If both are present, the macro that is specified (<code class="literal">X</CODE
>) is given 
the value specified (<code class="replaceable"><i>value</I
></CODE
>).</P
><p class="para">There may be multiple <code class="literal">$</CODE
> lines.
The need to quickly process a <code class="literal">qf</CODE
> file requires that
only single-character macro names be used.</P
></DIV
></BLOCKQUOTE
></DIV
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="SML2-CH-23-SECT-9-19">23.9.19 . line</A
></H3
><p class="refpurpose">Mark EOF in qf file</P
>(V8.7 and above)</DIV
><blockquote><div class="refsect1"><p class="para"><a class="indexterm" name="AUTOID-22207"></A
><a class="indexterm" name="AUTOID-22210"></A
><a class="indexterm" name="AUTOID-22213"></A
><a class="indexterm" name="AUTOID-22217"></A
>One form of attack against <em class="emphasis">sendmail</EM
> involves appending information
to an existing <code class="literal">qf</CODE
> file. To prevent such attacks, V8.7 introduced
the dot line. In a <code class="literal">qf</CODE
> file, any line that begins with
a single dot:</P
><p class="para"><blockquote class="screen"><pre class="screen">.<i class="lineannotation">followed by anything</I
></PRE
></BLOCKQUOTE
></P
><p class="para">is considered to mark the end of the file's useful information. 
Upon encountering that dot, <em class="emphasis">sendmail</EM
> continues to read
the <code class="literal">qf</CODE
> file. If any line follows the dot line, <em class="emphasis">sendmail</EM
>
logs the following message and changes the <code class="literal">qf</CODE
> file into
a <code class="literal">Qf</CODE
> file (see <a class="xref" href="ch23_03.htm#SML2-CH-23-SECT-3-5" title="Extra Data at End of qf File">Section 23.3.3, "Extra Data at End of qf File"</A
>):</P
><p class="para"><blockquote class="screen"><pre class="screen">SECURITY ALERT: extra data in qf: <i class="lineannotation">bogus line here</I
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-22237"></A
><a class="indexterm" name="AUTOID-22238"></A
></P
></DIV
></BLOCKQUOTE
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch23_08.htm" title="23.8 Pitfalls"><img src="../gifs/txtpreva.gif" alt="Previous: 23.8 Pitfalls" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="sendmail"><img src="../gifs/txthome.gif" alt="sendmail" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="CHAPTER" href="ch24_01.htm" title="24. Aliases"><img src="../gifs/txtnexta.gif" alt="Next: 24. Aliases" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">23.8 Pitfalls</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">24. Aliases</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
