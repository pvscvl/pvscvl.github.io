<html><head>
<title>[Chapter 4] 4.2 Verbose (-v)</TITLE>
<meta name="DC.title" content="sendmail"><meta name="DC.creator" content="Bryan Costales &amp; Eric Allman"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-01-06T18:33:24Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-222-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch04_01.htm" title="4. How to Run sendmail"><link rel="prev" href="ch04_01.htm" title="4.1 Become a Mode (-b)"><link rel="next" href="ch04_03.htm" title="4.3 Debugging (-d)"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="sendmail" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="sendmail"><area shape="RECT" coords="467,0,514,18" href="../search/ssrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch04_01.htm" title="4.1 Become a Mode (-b)"><img src="../gifs/txtpreva.gif" alt="Previous: 4.1 Become a Mode (-b)" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 4<br>How to Run sendmail</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch04_03.htm" title="4.3 Debugging (-d)"><img src="../gifs/txtnexta.gif" alt="Next: 4.3 Debugging (-d)" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="SML2-CH-4-SECT-2">4.2 Verbose (-v)</A
></H2
><p class="para"><a class="indexterm" name="SML2-CH-4-IX-VERBOSE-MODE"></A
><a class="indexterm" name="SML2-CH-4-IX-V-SWITCH-SENDMAIL-V-SWITCH-1"></A
>The <code class="literal">-v</CODE
> command-line switch tells <em class="emphasis">sendmail</EM
> to run in <em class="emphasis">verbose</EM
>
mode. In that mode, <em class="emphasis">sendmail</EM
> prints a blow-by-blow
[4]
description
of all the steps it takes in 
delivering a mail message.
To watch <em class="emphasis">sendmail</EM
> run in verbose mode, send mail
to yourself 
as you did in
<a class="xref" href="ch01_04.htm" title="Run sendmail by Hand">Section 1.4, "Run sendmail by Hand"</A
>,
but this time add a <code class="literal">-v</CODE
> switch:</P
><blockquote class="footnote"><p class="para">[4] Verbose mode is actually far more powerful than we've shown here.</P
></BLOCKQUOTE
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>/usr/lib/sendmail -v </B
></CODE
><code class="replaceable"><i>you</I
></CODE
><code class="userinput"><b> &lt; sendstuff</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The output produced shows that <em class="emphasis">sendmail</EM
> delivers your mail locally:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="replaceable"><i>you</I
></CODE
><code class="literal">... Connecting to local...</CODE
>
<code class="replaceable"><i>you</I
></CODE
><code class="literal">... Sent</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-2480"></A
><a class="indexterm" name="AUTOID-2482"></A
>When <em class="emphasis">sendmail</EM
> forwards mail to another machine over a TCP/IP
network, it communicates with that other machine using
a protocol called SMTP (Simple Mail Transfer Protocol). To see
what SMTP looks like, run <em class="emphasis">sendmail</EM
>
again, but this time, instead of using <code class="replaceable"><i>you</I
></CODE
> as
the recipient, give <em class="emphasis">sendmail</EM
> your address on another
machine.</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>/usr/lib/sendmail -v </B
></CODE
><code class="replaceable"><i>you@remote.domain</I
></CODE
><code class="userinput"><b> &lt; sendstuff</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The output
produced by this command line will look similar to the following:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">you@remote.domain... Connecting to remote.domain via smtp...</CODE
>
<code class="literal">220-remote.Domain Sendmail 8.6.12/8.5 ready at Fri, 13 Dec 1996 06:36:12 -0800</CODE
>
<code class="literal">220 ESMTP spoken here</CODE
>
<code class="literal">&gt;&gt;&gt; EHLO here.us.edu</CODE
>
<code class="literal">250-remote.domain Hello here.us.edu, pleased to meet you</CODE
>
<code class="literal">250-EXPN</CODE
>
<code class="literal">250-SIZE</CODE
>
<code class="literal">250 HELP</CODE
>
<code class="literal">&gt;&gt;&gt; MAIL From:&lt;you@here.us.edu&gt;</CODE
>
<code class="literal">250 &lt;you@here.us.edu&gt;... Sender ok</CODE
>
<code class="literal">&gt;&gt;&gt; RCPT To:&lt;you@remote.domain&gt;</CODE
>
<code class="literal">250 &lt;you@remote.domain&gt;... Recipient ok</CODE
>
<code class="literal">&gt;&gt;&gt; DATA</CODE
>
<code class="literal">354 Enter mail, end with &quot;.&quot; on a line by itself</CODE
>
<code class="literal">&gt;&gt;&gt; .</CODE
>
<code class="literal">250 GAA20115 Message accepted for delivery</CODE
>
<code class="literal">you@remote.domain... Sent (GAA20115 Message accepted for delivery)</CODE
>
<code class="literal">Closing connection to remote.domain</CODE
>
<code class="literal">&gt;&gt;&gt; QUIT</CODE
>
<code class="literal">221 remote.domain closing connection</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The lines that begin with numbers and the lines that begin with
<code class="literal">&gt;&gt;&gt;</CODE
> characters constitute a record of the SMTP conversation.
We'll discuss those shortly.
The other lines are <em class="emphasis">sendmail</EM
> on your local machine
telling you what it is trying to do and what it has successfully done:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">you@remote.domain... Connecting to remote.domain via smtp...</CODE
>
...
<code class="literal">you@remote.domain... Sent (GAA20115 Message accepted for delivery)</CODE
>
<code class="literal">Closing connection to remote.domain</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The first line shows to whom the mail is addressed and
that the machine <code class="literal">remote.domain</CODE
> is on the network.
The last two lines show that the mail message was successfully sent.</P
><p class="para"><a class="indexterm" name="AUTOID-2528"></A
><a class="indexterm" name="AUTOID-2531"></A
>In the SMTP conversation your local machine displays what it is
saying to the remote host by preceding each line with  <code class="literal">&gt;&gt;&gt;</CODE
>
characters. The messages (replies) from the remote machine are
displayed with leading numbers.
We now explain that conversation.</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">220-remote.Domain Sendmail 8.6.12/8.5 ready at Fri, 13 Dec 1996 06:36:12 -0800</CODE
>
<code class="literal">220 ESMTP spoken here</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-2540"></A
>Once your <em class="emphasis">sendmail</EM
> has connected to the remote machine, your
<em class="emphasis">sendmail</EM
> waits
for the other machine to initiate the conversation. The other
machine says that it is ready by sending the number 220, a dash
(to say that it has more to say), and
its fully qualified hostname (the only required information).
If the other machine is running <em class="emphasis">sendmail</EM
>,
it also says the program name <em class="emphasis">sendmail</EM
>
and the version. It also states that
it is ready and gives its idea of the local date and time.</P
><p class="para">The second line also starts with a 220, but that 220
is not followed by a dash. A dash means that more lines will
follow, and the absence of a dash means that this is the last line.<a class="indexterm" name="AUTOID-2547"></A
><a class="indexterm" name="AUTOID-2549"></A
>
The &quot;ESMTP spoken here&quot; means that the remote site understands
the Extended SMTP protocol.
If the other machine were running V8.7 or later <em class="emphasis">sendmail</EM
>, the
ESMTP would precede <code class="literal">Sendmail</CODE
> in the first line, and there
would be no second line.</P
><p class="para"><a class="indexterm" name="AUTOID-2556"></A
>If sendmail waits too long for a connection without receiving
this initial message, it prints &quot;Connection timed out&quot; and
queues the mail message for later delivery.</P
><p class="para"><a class="indexterm" name="AUTOID-2559"></A
><a class="indexterm" name="AUTOID-2562"></A
>Next the local <em class="emphasis">sendmail</EM
> sends (the <code class="literal">&gt;&gt;&gt;</CODE
>) the word 
<code class="literal">EHLO</CODE
>, for Extended Hello, and its own hostname:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">&gt;&gt;&gt; EHLO here.us.edu</CODE
>
<code class="literal">250-remote.domain Hello here.us.edu, pleased to meet you</CODE
>
<code class="literal">250-EXPN</CODE
>
<code class="literal">250-SIZE</CODE
>
<code class="literal">250 HELP</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The E of the <code class="literal">EHLO</CODE
> says that the local <em class="emphasis">sendmail</EM
> speaks
ESMTP too.
The remote machine replies with <code class="literal">250</CODE
> and the acknowledgment
that your hostname is acceptable, then lists the ESMTP
services that it supports.</P
><p class="para">One problem that could occur
is your machine sending a short hostname (&quot;here&quot;)
in the <code class="literal">EHLO</CODE
> message.<a class="indexterm" name="AUTOID-2580"></A
><a class="indexterm" name="AUTOID-2582"></A
><a class="indexterm" name="AUTOID-2585"></A
>
This would cause an error because the remote machine wouldn't find
<code class="literal">here</CODE
> in its domain <code class="literal">remote.domain</CODE
>.
This is one reason why it is important for your <em class="emphasis">sendmail</EM
>
to always use your machine's fully qualified hostname. A fully qualified
name is one that begins with the host's name, 
followed by a dot, then the entire DNS domain.</P
><p class="para">If all has gone well so far, the local machine sends the name of
the sender of the mail message:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">&gt;&gt;&gt; MAIL From:&lt;you@here.us.edu&gt;</CODE
>
<code class="literal">250 &lt;you@here.us.edu&gt;... Sender ok</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">Here, that
sender address was accepted by the remote machine. </P
><p class="para">Next the local machine sends the name of the recipient:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">&gt;&gt;&gt; RCPT To:&lt;you@remote.domain&gt;</CODE
>
<code class="literal">250 &lt;you@remote.domain&gt;... Recipient ok</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-2604"></A
><a class="indexterm" name="AUTOID-2606"></A
>If the user <code class="literal">you</CODE
> were not known on
the remote machine, it would reply with an error of &quot;User unknown.&quot;
Here, the recipient is <code class="literal">ok</CODE
>. Note that <code class="literal">ok</CODE
> does not necessarily
mean that the address is good. It can still be bounced later. The <code class="literal">ok</CODE
>
means only that the address is acceptable.</P
><p class="para">After the envelope information has been sent, your <em class="emphasis">sendmail</EM
>
attempts to send the mail message (header and body combined).</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">&gt;&gt;&gt; DATA</CODE
>
<code class="literal">354 Enter mail, end with &quot;.&quot; on a line by itself</CODE
>
<code class="literal">&gt;&gt;&gt; .</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-2620"></A
><a class="indexterm" name="AUTOID-2623"></A
><code class="literal">DATA</CODE
> tells the remote host to &quot;get ready.&quot;
The remote machine says to send the message, and the local machine does so.
(The message is not printed as it is sent.)
A dot on a line by itself is used to
mark the end of a mail message. This is a convention of the
SMTP protocol. Because mail messages may contain lines that begin with dots
as a valid part of the message, <em class="emphasis">sendmail</EM
> doubles any dots at
the beginning of lines before they are sent.
[5]
For example, consider when the following
text is sent through the mail:</P
><blockquote class="footnote"><p class="para">[5] This is called the &quot;hidden dot algorithm&quot; and is documented in RFC821.<a class="indexterm" name="AUTOID-2629"></A
></P
></BLOCKQUOTE
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">My results matched yours at first:</CODE
>
<code class="literal">126.71</CODE
>
<code class="literal">126.72</CODE
>
<code class="literal">...</CODE
>
<code class="literal">126.79</CODE
>
<code class="literal">But then the numbers suddenly jumped high, looking like</CODE
>
<code class="literal">noise saturated the line.</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">To prevent any of these lines from being wrongly interpreted as
the end of the mail message, <em class="emphasis">sendmail</EM
> inserts an extra
dot at the beginning of any line that begins with a dot, so the
actual text transferred is</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">My results matched yours at first:</CODE
>
<code class="literal">126.71</CODE
>
<code class="literal">126.72</CODE
>
....                                                       <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note extra dot</I
>
<code class="literal">126.79</CODE
>
<code class="literal">But then the numbers suddenly jumped high, looking like</CODE
>
<code class="literal">noise saturated the line.</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The SMTP-server program running at the receiving end (for example, another <em class="emphasis">sendmail</EM
>)
strips those extra dots when it receives the message.</P
><p class="para"><a class="indexterm" name="AUTOID-2654"></A
>The remote <em class="emphasis">sendmail</EM
> shows the queue identification number that it
assigned to the mail it accepted:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="literal">250 GAA20115 Message accepted for delivery</CODE
>
<code class="literal">&gt;&gt;&gt; QUIT</CODE
>
<code class="literal">221 remote.domain closing connection</CODE
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-2663"></A
>The local <em class="emphasis">sendmail</EM
>
sends <code class="literal">QUIT</CODE
> to say
it is all done. The remote machine acknowledges by closing the
connection.</P
><p class="para">Note that the <code class="literal">-v</CODE
> (verbose) switch for <em class="emphasis">sendmail</EM
> is
most useful with mail sent to remote machines. It allows you
to watch SMTP conversations as they occur and can help in tracking
down why a mail message fails to reach its destination.<a class="indexterm" name="AUTOID-2670"></A
><a class="indexterm" name="AUTOID-2671"></A
>&#13;</P
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch04_01.htm" title="4.1 Become a Mode (-b)"><img src="../gifs/txtpreva.gif" alt="Previous: 4.1 Become a Mode (-b)" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="sendmail"><img src="../gifs/txthome.gif" alt="sendmail" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch04_03.htm" title="4.3 Debugging (-d)"><img src="../gifs/txtnexta.gif" alt="Next: 4.3 Debugging (-d)" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">4.1 Become a Mode (-b)</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">4.3 Debugging (-d)</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
