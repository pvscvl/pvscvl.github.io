<html><head>
<title>[Chapter 7] 7.3 Predefined Macros</TITLE>
<meta name="DC.title" content="sendmail"><meta name="DC.creator" content="Bryan Costales &amp; Eric Allman"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-01-06T18:35:12Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-222-0" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch07_01.htm" title="7. Macros"><link rel="prev" href="ch07_02.htm" title="7.2 Defining Macros"><link rel="next" href="ch07_04.htm" title="7.4 Things to Try"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="sendmail" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="sendmail"><area shape="RECT" coords="467,0,514,18" href="../search/ssrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_02.htm" title="7.2 Defining Macros"><img src="../gifs/txtpreva.gif" alt="Previous: 7.2 Defining Macros" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 7<br>Macros</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch07_04.htm" title="7.4 Things to Try"><img src="../gifs/txtnexta.gif" alt="Next: 7.4 Things to Try" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="SML2-CH-7-SECT-3">7.3 Predefined Macros</A
></H2
><p class="para"><a class="indexterm" name="SML2-CH-7-IX-PREDEFINED-MACROS"></A
><a class="indexterm" name="SML2-CH-7-IX-MACROS-PREDEFINED"></A
><a class="indexterm" name="SML2-CH-7-IX-INTERNAL-PREDEFINED-MACROS"></A
>The <em class="emphasis">sendmail</EM
> program internally defines many macros for you.
You have already seen <code class="literal">u</CODE
> (which contains the recipient's
username) and <code class="literal">h</CODE
> (which contains the recipient's hostname) 
in our delivery agent definitions.
They are given values by <em class="emphasis">sendmail</EM
> instead of
being given values with <code class="literal">D</CODE
> macro definitions in your
configuration file.
A short list of some of the more common predefined macros is shown in

<a class="xref" href="#SML2-CH-7-TAB-0" title="Some Predefined Macros">Table 7.1</A
>.</P
><table class="table"><caption class="table"><a class="title" name="SML2-CH-7-TAB-0">Table 7.1: Some Predefined Macros</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Macro</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Description</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">n</TD
><td class="entry" rowspan="1" colspan="1">Identity of the error message sender</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">v</TD
><td class="entry" rowspan="1" colspan="1">Version of the currently running <em class="emphasis">sendmail</EM
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">w</TD
><td class="entry" rowspan="1" colspan="1">The short hostname</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">j</TD
><td class="entry" rowspan="1" colspan="1">The canonical hostname</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">m</TD
><td class="entry" rowspan="1" colspan="1">The domain name</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">k</TD
><td class="entry" rowspan="1" colspan="1">The UUCP node name</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">b</TD
><td class="entry" rowspan="1" colspan="1">Date in RFC1123 format</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">_</TD
><td class="entry" rowspan="1" colspan="1">Identification information</TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1">opMode</TD
><td class="entry" rowspan="1" colspan="1">Current operating mode (beginning with V8.7)</TD
></TR
></TBODY
></TABLE
><p class="para"><a class="indexterm" name="AUTOID-4218"></A
><a class="indexterm" name="AUTOID-4221"></A
>To watch the processing of all the macro definitions,
run <em class="emphasis">sendmail</EM
> once again. This time, add a <code class="literal">-d35.9</CODE
>
debugging switch, which tells <em class="emphasis">sendmail</EM
> to print each macro
as it is defined:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>./sendmail -d35.9 -Cclient.cf -bt &lt; /dev/null</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">The output that is produced is surprisingly long, considering the small size of
the <em class="emphasis">client.cf</EM
> file:</P
><p class="para"><blockquote class="screen"><pre class="screen">define(* as $*)
define(+ as $+)
define(- as $-)
define(= as $=)
define(~ as $~)
define(# as $#)
define(@ as $@)
define(: as $:)
define(&gt; as $&gt;)
define(? as $?)
define(| as $|)
define(. as $.)
define([ as $[)
define(] as $])
define(( as $()
define() as $))
define(&amp; as $&amp;)
define(0 as $0)
define(1 as $1)
define(2 as $2)
define(3 as $3)
define(4 as $4)
define(5 as $5)
define(6 as $6)
define(7 as $7)
define(8 as $8)
define(9 as $9)
<code class="userinput"><b>define(n as MAILER-DAEMON)                             </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(v as 8.8.4)                                     </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(w as here.us.edu)                               </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(j as here.us.edu)                               </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(m as us.edu)                                    </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(k as here)                                      </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(b as Fri, 13 Dec 1996 07:11:47 -0700 (PDT))     </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(_ as you@localhost)                             </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(opMode as t)                                    </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>redefine(w as here)                                    </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
>
<code class="userinput"><b>define(REMOTE as mailhost)                             </B
></CODE
><i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> note</I
></PRE
></BLOCKQUOTE
></P
><p class="para">This output will differ from version to version. For example, <code class="literal">l</CODE
>, <code class="literal">o</CODE
>,
and <code class="literal">e</CODE
> were macros prior to V8.7 but, beginning with V8.7, are now options.
The first 27 lines of this output show <em class="emphasis">sendmail</EM
> reserving macro
names that will be used as operators. (Operators are introduced in
the next chapter.)
The last 11 definitions are the only ones we are interested in
for now. The first 10 of those are internally defined by <em class="emphasis">sendmail</EM
>
for your use. The last definition is caused by <em class="emphasis">sendmail</EM
>
processing the <code class="literal">D{REMOTE}mailhost</CODE
> line in the <em class="emphasis">client.cf</EM
> file.</P
><p class="para">This output demonstrates another concept. Some internal macros
are defined before the configuration file is read, 
so you can change them from inside your <em class="emphasis">client.cf</EM
>
file. To change <code class="literal">w</CODE
>, for example, you might place the
following into your configuration file:</P
><p class="para"><blockquote class="screen"><pre class="screen">Dwmyhost.my.domain</PRE
></BLOCKQUOTE
></P
><p class="para">Doing this would then cause the text <code class="literal">myhost.my.domain</CODE
> to replace
the text <code class="literal">here.us.edu</CODE
> as the value of the macro
named <code class="literal">w</CODE
>.</P
><p class="para"><a class="indexterm" name="AUTOID-4275"></A
><a class="indexterm" name="AUTOID-4277"></A
>Note that in the preceding output there were no
definitions for the <code class="literal">h</CODE
> and <code class="literal">u</CODE
> macros used in the
delivery agent definitions. 
These macros, although internally defined,
are not actually given values until mail is sent.
You cannot change their values from within
your configuration file, because they are not defined
until after the configuration file is read.</P
><p class="para"><a class="indexterm" name="AUTOID-4282"></A
>Finally, note that proper defaults are set only by V8 <em class="emphasis">sendmail</EM
>.
All older versions require you to manually provide defaults for the <code class="literal">e</CODE
>,
<code class="literal">l</CODE
>, <code class="literal">n</CODE
>, <code class="literal">o</CODE
>, and <code class="literal">q</CODE
> macros in your <em class="emphasis">client.cf</EM
>
file.&#13;</P
><div class="sect2"><h3 class="sect2"><a class="title" name="SML2-CH-7-SECT-3-1">7.3.1 The hostname</A
></H3
><p class="para"><a class="indexterm" name="SML2-CH-7-IX-HOSTNAMES"></A
>The name of your local machine is composed of two parts. The host part is the machine
name and never contains a dot (such as <em class="emphasis">here</EM
>).
The domain part is composed of at least two
parts separated from each other by dots (such as <em class="emphasis">us.edu</EM
>).<a class="indexterm" name="AUTOID-4299"></A
><a class="indexterm" name="AUTOID-4302"></A
>
The <em class="emphasis">fully qualified</EM
> name of your local machine is made
by specifying the host part, then a dot, and finally the domain part
(e.g., <em class="emphasis">here.us.edu</EM
>).
The machine's name needs to be 
fully qualified to uniquely identify it worldwide.</P
><p class="para"><a class="indexterm" name="AUTOID-4307"></A
><a class="indexterm" name="AUTOID-4310"></A
>The name of the local machine also needs to be <em class="emphasis">canonical</EM
>
(official and fully qualified). 
A machine can have multiple names (such as <em class="emphasis">mailhost</EM
>
or <em class="emphasis">printserver</EM
>), of which only one is official. The official name for the local machine
can be found by issuing the <em class="emphasis">hostname</EM
>(1) command:<a class="indexterm" name="AUTOID-4316"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>hostname</B
></CODE
>
here.us.edu</PRE
></BLOCKQUOTE
></P
><p class="para">The official name, when fully qualified with a domain, is the
<em class="emphasis">canonical</EM
> name of the machine. Any other names are aliases.
[3]</P
><blockquote class="footnote"><p class="para">[3] We are fudging for simplicity. The canonical name is the name
associated with the DNS A record. If a machine has multiple
network interfaces (and therefore multiple <code class="literal">A</CODE
> records),
it can have multiple canonical names.</P
></BLOCKQUOTE
><p class="para">To see how <em class="emphasis">sendmail</EM
> interprets your local hostname, enter
the following command, which uses the <code class="literal">-d0.1</CODE
> debugging
switch:<a class="indexterm" name="AUTOID-4329"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>./sendmail -Cclient.cf -d0.1 -bt &lt;/dev/null</B
></CODE
>
Version 8.8.4
 Compiled with: LOG NAMED_BIND NDBM NETINET NETUNIX NIS SCANF XDEBUG

============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = here
  (canonical domain name) $j = here.us.edu
         (subdomain name) $m = us.edu
              (node name) $k = here
========================================================</PRE
></BLOCKQUOTE
></P
><p class="para">Many things can go wrong here. For example, if you're not
on the Internet, you may not have assigned your machine a domain
name yet. Or you may be running NIS and have listed only the
short name in the <em class="emphasis">hosts.byname</EM
> map. The important thing
to observe in the above output is that <em class="emphasis">sendmail</EM
> correctly
found your short and canonical names:</P
><p class="para"><blockquote class="screen"><pre class="screen">      (short domain name) $w = here           <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> short hostname</I
>
  (canonical domain name) $j = here.us.edu    <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> fully qualified canonical name</I
>
         (subdomain name) $m = us.edu         <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> domain</I
></PRE
></BLOCKQUOTE
></P
><p class="para">If any are wrong, you need to fix the system problem that led
to the error.
At the system level, investigate:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">The <em class="emphasis">/etc/hosts</EM
> file.<a class="indexterm" name="AUTOID-4348"></A
><a class="indexterm" name="AUTOID-4350"></A
>
You may have wrongly listed only short names in it.
Prior to V8.7, a fully qualified name had to be listed first.
Beginning with V8.7, a fully qualified name can appear anywhere in a line.</P
></LI
><li class="listitem"><p class="para">The <em class="emphasis">nis</EM
> maps.<a class="indexterm" name="AUTOID-4356"></A
>
Make sure hostnames are looked up with DNS by specifying the <code class="literal">-b</CODE
> in
<em class="emphasis">/var/yp/Makefile</EM
>.</P
></LI
><li class="listitem"><p class="para">The <em class="emphasis">nsswitch.conf</EM
> or <em class="emphasis">svc.conf</EM
> files.<a class="indexterm" name="AUTOID-4364"></A
><a class="indexterm" name="AUTOID-4366"></A
>
Make sure the method used to look up hosts is correctly specified.</P
></LI
></UL
><p class="para">If you can't
find or don't have permission to fix things at the system level, you
can fix them in your <em class="emphasis">client.cf</EM
> file. Suppose, for example,
that the canonical name showed up as the short hostname:</P
><p class="para"><blockquote class="screen"><pre class="screen">  (canonical domain name) $j = here           <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> wrong</I
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-4374"></A
><a class="indexterm" name="AUTOID-4377"></A
>To fix this, you would need to redefine the <code class="literal">j</CODE
> macro with
a <code class="literal">D</CODE
> command in the <em class="emphasis">client.cf</EM
> file:</P
><p class="para"><blockquote class="screen"><pre class="screen">Dj$w.$m               # The local official domain name</PRE
></BLOCKQUOTE
></P
><p class="para">This defines the canonical (fully qualified official)
name to be the same as the local hostname (<code class="literal">$w</CODE
>) with
a dot and the domain name (<code class="literal">$m</CODE
>) appended.
Rerunning <em class="emphasis">sendmail</EM
> as above would now display the correct
information:</P
><p class="para"><blockquote class="screen"><pre class="screen">  (canonical domain name) $j = here.us.edu    <i class="lineannotation"><img src="../chars/larr.gif" alt="&lt;-"> correct</I
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-4392"></A
><a class="indexterm" name="AUTOID-4394"></A
><a class="indexterm" name="AUTOID-4396"></A
>In a similar manner you can fix <code class="literal">$w</CODE
> and <code class="literal">$m</CODE
> if 
either of them is wrong. But here we should stress that <em class="emphasis">sendmail</EM
>
goes to great lengths to get this information right.<a class="indexterm" name="AUTOID-4402"></A
><a class="indexterm" name="AUTOID-4403"></A
><a class="indexterm" name="AUTOID-4404"></A
><a class="indexterm" name="AUTOID-4405"></A
>&#13;</P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_02.htm" title="7.2 Defining Macros"><img src="../gifs/txtpreva.gif" alt="Previous: 7.2 Defining Macros" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="sendmail"><img src="../gifs/txthome.gif" alt="sendmail" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch07_04.htm" title="7.4 Things to Try"><img src="../gifs/txtnexta.gif" alt="Next: 7.4 Things to Try" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">7.2 Defining Macros</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">7.4 Things to Try</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="../dnsbind/index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
