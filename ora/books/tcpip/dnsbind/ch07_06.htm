<html><head>
<title>[Chapter 7] 7.6 Keeping Everything Running Smoothly</TITLE>
<meta name="DC.title" content="DNS &amp; BIND"><meta name="DC.creator" content="Cricket Liu &amp; Paul Albitz"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-01-06T18:31:48Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-512-2" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch07_01.htm" title="7. Maintaining BIND"><link rel="prev" href="ch07_05.htm" title="7.5 BIND 8 Logging"><link rel="next" href="ch08_01.htm" title="8. Growing Your Domain"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="DNS &amp; BIND" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="DNS &amp; BIND"><area shape="RECT" coords="467,0,514,18" href="../search/dsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_05.htm" title="7.5 BIND 8 Logging"><img src="../gifs/txtpreva.gif" alt="Previous: 7.5 BIND 8 Logging" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 7<br>Maintaining <span class="acronym">BIND</SPAN
></FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="CHAPTER" href="ch08_01.htm" title="8. Growing Your Domain"><img src="../gifs/txtnexta.gif" alt="Next: 8. Growing Your Domain" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="AUTOID-7430">7.6 Keeping Everything Running Smoothly</A
></H2
><p class="para"><a class="indexterm" name="DNS3-IDX-7-PERFORMANCE-MONITORING-NAME-SERVERS"></A
><a class="indexterm" name="AUTOID-7436"></A
><a class="indexterm" name="AUTOID-7439"></A
>A<a class="indexterm" name="DNS3-IDX-7-NAME-SERVERS-MAINTAINING-MONITORING-NAME-SERVERS"></A
><a class="indexterm" name="DNS3-IDX-7-ADMINISTRATION-NAME-SERVER-MAINTENANCE-MONITORING-NAME-SERVERS"></A
><a class="indexterm" name="DNS3-IDX-7-BIND-BERKELEY-INTERNET-NAME-DOMAIN-NAME-SERVER-MAINTAINENCE-MONITORING-NAME-SERVERS"></A
><a class="indexterm" name="DNS3-IDX-7-MONITORING-NAME-SERVERS"></A
>
significant part of maintenance is being aware when something has gone
wrong, before it becomes a real problem. If you catch a problem early,
chances are it'll be that much easier to fix. As the old adage says,
an ounce of prevention is worth a pound of cure.</P
><p class="para">This isn't quite troubleshooting&nbsp;- we'll devote an entire
chapter to troubleshooting later&nbsp;- think of it as
<span class="quote">"pre-troubleshooting."</SPAN
> Troubleshooting (the pound of
cure) is what you have to do if you ignore maintenance, after your
problem has developed complications, and you need to identify the
problem by its symptoms.</P
><p class="para">The next two sections deal with preventative maintenance:
looking periodically at the <kbd class="command">syslog</KBD
> file and at the
<span class="acronym">BIND</SPAN
> name server statistics to see whether any
problems are developing.  Consider this a name server's medical
checkup.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="AUTOID-7461">7.6.1 Common Syslog Messages</A
></H3
><p class="para"><a class="indexterm" name="DNS3-IDX-7-SYSLOG-MESSAGES"></A
><a class="indexterm" name="DNS3-IDX-7-NAMED-DAEMON-SYSLOG-MESSAGES"></A
><a class="indexterm" name="DNS3-IDX-7-ERRORS-COMMON-SYSLOG-MESSAGES"></A
>There are a large number of syslog messages <kbd class="command">named</KBD
>
can emit. In practice, you'll only see a few of them. We'll cover the
most common syslog messages here, excluding reports of syntax errors
in <span class="acronym">DNS</SPAN
> database files.</P
><p class="para">Every time you start <kbd class="command">named</KBD
>, it sends out this
message at priority <span class="acronym">LOG_NOTICE</SPAN
>:</P
><blockquote class="screen"><pre class="screen">Jan 10 20:48:32 terminator named[3221]: starting.  named 8.1.2</PRE
></BLOCKQUOTE
><p class="para"><a class="indexterm" name="AUTOID-7479"></A
>This message logs the fact that <kbd class="command">named</KBD
> started at
this time, and tells you the version of <span class="acronym">BIND</SPAN
> you're
running. This is, of course, nothing to be concerned about. It
<em class="emphasis">is</EM
> a good place to look if you're not sure what
version of <span class="acronym">BIND</SPAN
> your operating system supports.
(Older versions of <span class="acronym">BIND</SPAN
> used
<span class="quote">"restarted"</SPAN
> instead of <span class="quote">"starting."</SPAN
>)</P
><p class="para">Every time you send the name server a <span class="acronym">HUP</SPAN
>
signal, it sends out this message at priority
<span class="acronym">LOG_NOTICE</SPAN
>:</P
><blockquote class="screen"><pre class="screen">Jan 10 20:50:16 terminator named[3221]: reloading nameserver<a class="indexterm" name="AUTOID-7492"></A
></PRE
></BLOCKQUOTE
><p class="para">The <span class="quote">"reloading"</SPAN
> message just tells you that
<kbd class="command">named</KBD
> reloaded its database (as a result of a
<span class="acronym">HUP</SPAN
> signal) at this time. Again, this is nothing to
be concerned about. This message will most likely be of interest when
you are tracking down how long a bad resource record has been in your
name server data or how long a whole zone has been missing because of
a mistake during an update.</P
><p class="para">Another message you may see shortly after your name server
starts is:</P
><blockquote class="screen"><pre class="screen">Jan 10 20:50:20 terminator named[3221]: cannot set resource limits on
                this system<a class="indexterm" name="AUTOID-7500"></A
></PRE
></BLOCKQUOTE
><p class="para">This means that your name server thinks your operating system
does not support the <i class="function">getrlimit()</I
> and
<i class="function">setrlimit()</I
> system calls, which are used when you
try to define <i class="parameter">coresize</I
>, <i class="parameter">datasize</I
>, <i class="parameter">stacksize</I
> or <i class="parameter">files</I
> on a
<span class="acronym">BIND</SPAN
> 8 name server.  It doesn't matter whether
you're actually using any of these substatements in your configuration
file; <span class="acronym">BIND</SPAN
> will print the message anyway.  If
you're not <em class="emphasis">using</EM
> these substatements, ignore the message.  If you are,
and you think your operating system does support
<i class="function">getrlimit()</I
> and <i class="function">setrlimit()</I
>,
you'll have to recompile <span class="acronym">BIND</SPAN
> with
<i class="parameter">HAVE_GETRUSAGE</I
> defined.  This message in logged at
priority <span class="acronym">LOG_INFO</SPAN
>.</P
><p class="para">If you run your name server on a host with many network
interfaces, especially virtual network interfaces, you may see this
message soon after startup, or even after your name server has run
well for a while:</P
><blockquote class="screen"><pre class="screen">Jan 10 20:50:31 terminator named[3221]: fcntl(dfd, F_DUPFD, 20): Too
                many open files<a class="indexterm" name="AUTOID-7519"></A
><a class="indexterm" name="AUTOID-7521"></A
>
Jan 10 20:50:31 terminator named[3221]: fcntl(sfd, F_DUPFD, 20): Too
                many open files</PRE
></BLOCKQUOTE
><p class="para">This means that <span class="acronym">BIND</SPAN
> has run out of<a class="indexterm" name="AUTOID-7525"></A
>
file descriptors.  <span class="acronym">BIND</SPAN
> uses a fair number of file
descriptors: two for each network interface it's listening on (one for
<span class="acronym">UDP</SPAN
> and one for <span class="acronym">TCP</SPAN
>), and one
for opening zone data files.  If that's more than the limit your
operating system places on processes, <span class="acronym">BIND</SPAN
> won't be
able to get any more file descriptors and you'll see this message.
The priority will depend on which part of <span class="acronym">BIND</SPAN
>
fails to get the file descriptor: the more critical the subsystem, the
higher the priority.</P
><p class="para">The next step is to either get <span class="acronym">BIND</SPAN
> to use
fewer file descriptors, or to raise the limit the operating system
places on the number of file descriptors <span class="acronym">BIND</SPAN
> can
use:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">If you don't need <span class="acronym">BIND</SPAN
> listening on all of
your network interfaces (particularly the virtual ones), use the
<i class="function">listen-on</I
> substatement to configure <span class="acronym">BIND</SPAN
> to listen
only on those interfaces it needs to.  See <a class="xref" href="ch10_01.htm" title="Advanced Features and Security">Chapter 10</A
> for details on the syntax of <i class="function">listen-on</I
>.</P
></LI
><li class="listitem"><p class="para">If your operating system supports <i class="function">getrlimit()</I
> and <i class="function">setrlimit()</I
>
(see above), configure your name server to use a larger number of
files with the <i class="function">files</I
> substatement.  See <a class="xref" href="ch10_01.htm" title="Advanced Features and Security">Chapter 10</A
>
for details on using the <i class="function">files</I
> substatement.</P
></LI
><li class="listitem"><p class="para">If your operating system places too restrictive a limit on open
files, raise that limit before you start <kbd class="command">named</KBD
> with
the <kbd class="command">ulimit</KBD
> command.</P
></LI
></UL
><p class="para">Every time a <span class="acronym">BIND</SPAN
> 8 name server loads a zone,
it sends out a message at priority <span class="acronym">LOG_INFO</SPAN
>:</P
><blockquote class="screen"><pre class="screen">Jan 10 21:49:50 terminator named[3221]: master zone &quot;movie.edu&quot; (IN)
                loaded(serial 1996011000)<a class="indexterm" name="AUTOID-7558"></A
><a class="indexterm" name="AUTOID-7560"></A
></PRE
></BLOCKQUOTE
><p class="para">(<span class="acronym">BIND</SPAN
> 4.9 name servers call it a
<span class="quote">"primary zone"</SPAN
> instead of a <span class="quote">"master zone."</SPAN
>)
This tells you when the name server loaded the zone, the class (in
this case, <span class="acronym">IN</SPAN
>) of the zone, and the serial number
in the zone's <span class="acronym">SOA</SPAN
> record.</P
><p class="para"><a class="indexterm" name="AUTOID-7569"></A
><a class="indexterm" name="AUTOID-7571"></A
><a class="indexterm" name="AUTOID-7573"></A
><a class="indexterm" name="AUTOID-7575"></A
>About every hour, a <span class="acronym">BIND</SPAN
> 8 name server will send a
message at priority <span class="acronym">LOG_INFO</SPAN
> that snapshots the
current statistics:</P
><blockquote class="screen"><pre class="screen">Feb 18 14:09:02 terminator named[3565]: USAGE 824681342 824600158
                CPU=13.01u/3.26s CHILDCPU=9.99u/12.71s
Feb 18 14:09:02 terminator named[3565]: NSTATS 824681342 824600158
                A=4 PTR=2
Feb 18 14:09:02 terminator named[3565]: XSTATS 824681342 824600158
                RQ=6 RR=2 RIQ=0 RNXD=0 RFwdQ=0 RFwdR=0 RDupQ=0 RDupR=0
                RFail=0 RFErr=0 RErr=0 RTCP=0 RAXFR=0 RLame=0 Ropts=0
                SSysQ=2 SAns=6 SFwdQ=0 SFwdR=0 SDupQ=5 SFail=0 SFErr=0
                SErr=0 RNotNsQ=6 SNaAns=2 SNXD=1</PRE
></BLOCKQUOTE
><p class="para">(This feature was also present in <span class="acronym">BIND</SPAN
> 4.9
through 4.9.3, then turned off in the 4.9.4 server.) The first two
numbers for each message are time. If you subtract the second number
from the first number, you'll find out how many seconds your server
has been running.  (You'd think the name server could do that for
you.) The <code class="literal">CPU</CODE
> entry tells you how much time your
server has spent in user mode (13.01 seconds) and system mode (3.26
seconds). Then it tells you the same statistic for child
processes. The <code class="literal">NSTATS</CODE
> message lists the query types
your server has received and the counts for each. The
<code class="literal">XSTATS</CODE
> message lists additional statistics.  The
statistics under <code class="literal">NSTATS</CODE
> and
<code class="literal">XSTATS</CODE
> are explained in more detail later in this
chapter.</P
><p class="para"><a class="indexterm" name="AUTOID-7588"></A
><a class="indexterm" name="AUTOID-7591"></A
><a class="indexterm" name="AUTOID-7593"></A
>If <span class="acronym">BIND</SPAN
> version 4.9.4 or later finds a name that
doesn't conform to <span class="acronym">RFC</SPAN
> 952, it logs a syslog
error:</P
><blockquote class="screen"><pre class="screen">Jul 24 20:56:26 terminator named[1496]: owner name &quot;ID_4.movie.edu IN&quot;
                                      (primary) is invalid - rejecting</PRE
></BLOCKQUOTE
><p class="para">This message is logged at level
<span class="acronym">LOG_NOTICE</SPAN
>. See <a class="xref" href="ch04_01.htm" title="Setting Up BIND">Chapter 4</A
> for the
host naming rules.</P
><p class="para">Another syslog message, sent at priority
<span class="acronym">LOG_INFO</SPAN
>, is a warning message about the zone data:<a class="indexterm" name="AUTOID-7603"></A
><a class="indexterm" name="AUTOID-7606"></A
></P
><blockquote class="screen"><pre class="screen">Jan 10 20:48:38 terminator named[3221]: terminator2 has CNAME
                and other data (invalid)</PRE
></BLOCKQUOTE
><p class="para">This message means that there's a problem with your zone data.
For example, you may have entries like these:</P
><blockquote class="screen"><pre class="screen">terminator2  IN  CNAME t2
terminator2  IN  MX    10 t2
t2           IN  A     192.249.249.10
t2           IN  MX    10 t2</PRE
></BLOCKQUOTE
><p class="para">The <span class="acronym">MX</SPAN
> record for <i class="systemitem.sitename">terminator2</I
> is incorrect, and would cause
the message given above. <i class="systemitem.sitename">terminator2</I
> is an alias for <i class="systemitem.sitename">t2</I
>, which is the canonical name.  As
described earlier, when <span class="acronym">DNS</SPAN
> looks up a name and
finds a <span class="acronym">CNAME</SPAN
>, it replaces the original name with
the canonical name, and then tries looking up the canonical
name. Thus, when the server looks up the <span class="acronym">MX</SPAN
> data
for <i class="systemitem.sitename">terminator2</I
>, it finds a
<span class="acronym">CNAME</SPAN
> record and then looks up the
<span class="acronym">MX</SPAN
> record for <i class="systemitem.sitename">t2</I
>.  Since the server follows the
<span class="acronym">CNAME</SPAN
> record for <i class="systemitem.sitename">terminator2</I
>, it will never use the
<span class="acronym">MX</SPAN
> record for <i class="systemitem.sitename">terminator2</I
>; in fact, this record is
illegal. In other words, all resource records for a host have to use
the <em class="emphasis">canonical name</EM
>; it's an error to use
an alias in place of the canonical name.</P
><p class="para">The following message indicates that a slave was unable to reach
any master server when it tried to do a zone transfer:<a class="indexterm" name="AUTOID-7629"></A
><a class="indexterm" name="AUTOID-7632"></A
><a class="indexterm" name="AUTOID-7634"></A
></P
><blockquote class="screen"><pre class="screen">Jan 10 20:52:42 wormhole named[2813]: zoneref: Masters for
                secondary zone &quot;movie.edu&quot; unreachable</PRE
></BLOCKQUOTE
><p class="para">This message is sent at priority <span class="acronym">LOG_NOTICE</SPAN
>,
and is only sent the first time the zone transfer fails. When the zone
transfer finally succeeds, a 4.9 or later server will tell you that
the zone transferred by issuing another syslog message. Older servers
don't tell you when the zone transferred. When this message first
appears, you don't need to take any immediate action. The name server
will continue to attempt to transfer the zone, according to the retry
period in the <span class="acronym">SOA</SPAN
> record. After a few days (or half
the expire time), you might check that the server was able to transfer
the zone. On<a class="indexterm" name="AUTOID-7640"></A
><a class="indexterm" name="AUTOID-7643"></A
>
servers that don't issue the syslog message when the zone transfers,
you can verify that the zone transferred by checking the timestamp on
the backup file. When a zone transfer succeeds, a new backup file is
created. When a zone is found to be up to date, the backup file is
<em class="emphasis">touched</EM
> (à la the <span class="acronym">UNIX</SPAN
><a class="indexterm" name="AUTOID-7648"></A
>
<kbd class="command">touch</KBD
> command). In both cases, the timestamp on the
backup file is updated, so go to the slave and give the command
<kbd class="command">ls -l /usr/local/named/db.*</KBD
>. This will tell you
when the slave last synchronized each zone with the master server.
We'll cover how to troubleshoot slaves failing to transfer zones in
<a class="xref" href="ch13_01.htm" title="Troubleshooting DNS and BIND">Chapter 13</A
>.</P
><p class="para">If you are watching the syslog messages on your 4.9 or later
master server, you'll see a <span class="acronym">LOG_INFO</SPAN
> syslog message
when the slave does pick up the new zone data or when a tool, like
<kbd class="command">nslookup</KBD
>, transfers a zone:</P
><blockquote class="screen"><pre class="screen">Mar  7 07:30:04 terminator named[3977]: approved AXFR from
                           [192.249.249.1].2253 for &quot;movie.edu&quot;</PRE
></BLOCKQUOTE
><p class="para">If you are using the version 4 <kbd class="command">xfrnets</KBD
>
configuration file statement or version 8
<kbd class="command">allow-transfer</KBD
> option statement (explained in <a class="xref" href="ch10_01.htm" title="Advanced Features and Security">Chapter 10</A
>) to limit which servers can load zones, you may
see this message saying <kbd class="command">unapproved</KBD
> instead of
<kbd class="command">approved</KBD
>.</P
><p class="para">This syslog message is seen only if you capture
<span class="acronym">LOG_INFO</SPAN
> syslog messages:</P
><blockquote class="screen"><pre class="screen">Jan 10 20:52:42 wormhole named[2813]: Malformed response<a class="indexterm" name="AUTOID-7666"></A
>
                from 192.1.1.1</PRE
></BLOCKQUOTE
><p class="para">Most often, this message means that some bug in a name server
caused it to send an erroneous response packet. The error probably
occurred on the remote name server (192.1.1.1) rather than the local
server (<i class="systemitem.sitename">wormhole</I
>). Diagnosing
this kind of error involves capturing the response packet in a network
trace and decoding it. Decoding <span class="acronym">DNS</SPAN
> packets
manually is beyond the scope of this book, so we won't go into much
detail. You see this type of error when the response packet says it
has several answers in the answer section (like four address resource
records), and yet the answer section only contains a single
answer. The only course of action is to notify the hostmaster (or
root) of the offending host via email (assuming you can get the name
of the host by looking up the address). You would also see this
message if the underlying network altered (damaged) the<a class="indexterm" name="AUTOID-7671"></A
>
<span class="acronym">UDP</SPAN
> response packets in some way. Checksumming of
<span class="acronym">UDP</SPAN
> packets is optional, so this error might not be
caught at a lower level.</P
><p class="para"><kbd class="command">named</KBD
> logs this message when you try to sneak
into your zone file data that belongs in another zone:</P
><blockquote class="screen"><pre class="screen">Jun 13 08:02:03 terminator named[2657]: db.movie:28: data &quot;foo.bar.edu&quot;<a class="indexterm" name="AUTOID-7679"></A
>
                           outside zone &quot;movie.edu&quot; (ignored)</PRE
></BLOCKQUOTE
><p class="para">For instance, if we tried to use this zone data:</P
><blockquote class="screen"><pre class="screen">robocop       IN A  192.249.249.2
terminator    IN A  192.249.249.3

; Add this entry to the name server's cache
foo.bar.edu.  IN A  10.0.7.13</PRE
></BLOCKQUOTE
><p class="para">we'd be adding data for the <i class="systemitem.sitename">bar.edu</I
> zone into our <i class="systemitem.sitename">movie.edu</I
> zone file. A 4.8.3 vintage name
server would blindly add <i class="systemitem.sitename">foo.bar.edu</I
> to its cache. It wouldn't
check that all the data in the <i class="filename">db.movie</I
> file was
in the <i class="systemitem.sitename">movie.edu</I
> zone. You
can't fool a name server newer than 4.9, though. This
<kbd class="command">syslog</KBD
> message is logged at priority
<span class="acronym">LOG_INFO</SPAN
>.</P
><p class="para">Earlier in the book we said that you can't use a<a class="indexterm" name="AUTOID-7692"></A
><a class="indexterm" name="AUTOID-7695"></A
>
<span class="acronym">CNAME</SPAN
> in the data portion of a resource
record. <span class="acronym">BIND</SPAN
> versions 4.9 and later will catch this
misuse:</P
><blockquote class="screen"><pre class="screen">Jun 13 08:21:04 terminator named[2699]: &quot;movie.edu IN NS&quot; points to a
                                        CNAME (dh.movie.edu)</PRE
></BLOCKQUOTE
><p class="para">Here is an example of the guilty resource records:</P
><blockquote class="screen"><pre class="screen">@                      NS       terminator.movie.edu.
                       NS       dh.movie.edu.
terminator.movie.edu.  IN A     192.249.249.3
diehard.movie.edu.     IN A     192.249.249.4
dh                     IN CNAME diehard</PRE
></BLOCKQUOTE
><p class="para">The second <span class="acronym">NS</SPAN
> record should have listed
<i class="systemitem.sitename">diehard.movie.edu</I
> instead of
<i class="systemitem.sitename">dh.movie.edu</I
>. This syslog
message won't show up immediately when you start your name
server.</P
><blockquote class="note"><p class="para"><strong>NOTE:</STRONG
> You'll only see the syslog message when the offending data is
looked up. This syslog message is logged by a 4.9.3 or
<span class="acronym">BIND</SPAN
> 8 server at priority
<span class="acronym">LOG_INFO</SPAN
>, and by a 4.9.4 to 4.9.7 server at
priority <span class="acronym">LOG_DEBUG</SPAN
>.</P
></BLOCKQUOTE
><p class="para">This message indicates that your name server may be guarding
itself against one type of network attack:<a class="indexterm" name="AUTOID-7714"></A
><a class="indexterm" name="AUTOID-7717"></A
></P
><blockquote class="screen"><pre class="screen">Jun 11 11:40:54 terminator named[131]: Response from unexpected source
                                       ([204.138.114.3].53)</PRE
></BLOCKQUOTE
><p class="para">Your name server sent a query to a remote name server, and a
response came, but it wasn't from any of the addresses your name
server had listed for the remote name server. The potential security
breach is this: an intruder causes your name server to query a remote
name server, and at the same time the intruder sends responses
(pretending the responses are from the remote name server) that the
intruder hopes your name server will add to its cache. Perhaps he
sends along a false <span class="acronym">PTR</SPAN
> record, pointing the
<span class="acronym">IP</SPAN
> address of one of his hosts to the domain name
of a host you trust.  Once the false <span class="acronym">PTR</SPAN
> record is
in your cache, the intruder uses one of the <span class="acronym">BSD</SPAN
>
<span class="quote">"r"</SPAN
> commands (e.g., <kbd class="command">rlogin</KBD
>) to gain
access to your system.</P
><p class="para">Less paranoid admins will realize that this situation can also
happen if the parent name server only knows about one of the
<span class="acronym">IP</SPAN
> addresses of a multihomed name server host. The
parent tells your name server the one <span class="acronym">IP</SPAN
> address it
knows about, and when your server queries the remote name server, the
remote name server responds from the other <span class="acronym">IP</SPAN
>
address. This shouldn't happen if <span class="acronym">BIND</SPAN
> is running
on the remote name server host, because <span class="acronym">BIND</SPAN
> makes
every attempt to use the same <span class="acronym">IP</SPAN
> address in the
response as the query was sent to. This syslog message is logged at
priority <span class="acronym">LOG_INFO</SPAN
>.</P
><p class="para"><a class="indexterm" name="AUTOID-7736"></A
><a class="indexterm" name="AUTOID-7739"></A
><a class="indexterm" name="AUTOID-7741"></A
><a class="indexterm" name="AUTOID-7744"></A
>Here's an interesting syslog message:</P
><blockquote class="screen"><pre class="screen">Jun 10 07:57:28 terminator named[131]: No root nameservers for
                class 226</PRE
></BLOCKQUOTE
><p class="para">The only classes defined to date are: class 1, Internet
(<span class="acronym">IN</SPAN
>); class 3, Chaos (<span class="acronym">CH</SPAN
>);
and class 4, Hesiod (<span class="acronym">HS</SPAN
>). Where does class 226
come from? That's exactly the point your name server is making with
this syslog message. Something is wrong in the world because there is
no class 226. What can you do about it? Nothing, really. This message
doesn't give you enough information&nbsp;- you don't know who the query
is from or what the query was for. Then again, if the class field is
corrupted, the query name may be garbage too. The actual cause of the
problem could be a broken remote name server or resolver, or it could
be a corrupted <span class="acronym">UDP</SPAN
> datagram. This syslog message is
logged at priority <span class="acronym">LOG_INFO</SPAN
>.</P
><p class="para">This message might happen if you are backing up some other zone:<a class="indexterm" name="AUTOID-7756"></A
><a class="indexterm" name="AUTOID-7759"></A
></P
><blockquote class="screen"><pre class="screen">Jun  7 20:14:26 wormhole named[29618]: Zone &quot;253.253.192.in-addr.arpa&quot;
                (class 1) SOA serial# (3345) rcvd from [192.249.249.10]
                is &lt; ours (563319491)</PRE
></BLOCKQUOTE
><p class="para">Ah, the pesky admin for <i class="systemitem.sitename">253.253.192.in-addr.arpa</I
> changed the
serial number format and neglected to tell you about it. Some thanks
you get for running a slave for this zone, huh? Drop the admin a note
to see if this change was intentional or just a typo. If the change
was intentional, or you don't want to contact the admin, then you have
to deal with it locally&nbsp;- kill your slave, remove the backup copy
of this zone, and restart your server. This procedure removes all
knowledge your slave had of the old <span class="acronym">SOA</SPAN
> serial
number, at which point it is quite happy with the new serial
number. This syslog message is logged at priority
<span class="acronym">LOG_NOTICE</SPAN
>.</P
><p class="para">By the way, if that pesky admin was running a
<span class="acronym">BIND</SPAN
> 8 name server, then he must have missed (or
ignored) a message his server logged, telling him that he'd rolled the
zone's serial number back:</P
><blockquote class="screen"><pre class="screen">Jun 7 19:35:14 terminator named[3221]: WARNING: new serial number &lt; old
              (zp-&gt;z_serial &lt; serial)</PRE
></BLOCKQUOTE
><p class="para">This message is logged at <span class="acronym">LOG_NOTICE</SPAN
>.</P
><p class="para">You might want to remind him of the wisdom of checking syslog
after making any changes to the name server.</P
><p class="para">This message will undoubtedly become familiar to you:<a class="indexterm" name="AUTOID-7774"></A
><a class="indexterm" name="AUTOID-7776"></A
></P
><blockquote class="screen"><pre class="screen">Aug 21 00:59:06 jade named[12620]: Lame server on 'foo.movie.edu'
         (in 'MOVIE.EDU'?): [10.0.7.125].53 'NS.HOLLYWOOD.LA.CA.US':
         learnt (A=10.47.3.62,NS=10.47.3.62)</PRE
></BLOCKQUOTE
><p class="para"><span class="quote">"Aye, Captain, she's sucking mud!"</SPAN
> There's some mud
out there in the Internet waters in the form of bad delegations. A
parent name server is delegating a subdomain to a child name server,
and the child name server is not authoritative for the subdomain. In
this case, the <i class="systemitem.sitename">edu</I
> name
server is delegating <i class="systemitem.sitename">movie.edu</I
> to 10.0.7.125, and the name
server on this host is not authoritative for <i class="systemitem.sitename">movie.edu</I
>. Unless you know the admin for
<i class="systemitem.sitename">movie.edu</I
>, there's probably
nothing for you to do about this. The syslog message is logged by a
4.9.3 server at priority <span class="acronym">LOG_WARNING</SPAN
>, by a 4.9.4 to
4.9.7 server at priority <span class="acronym">LOG_DEBUG</SPAN
>, and by a
<span class="acronym">BIND</SPAN
> 8 server at
<span class="acronym">LOG_INFO</SPAN
>.</P
><p class="para">If your version 4.9 or later name server's configuration file
has:</P
><blockquote class="screen"><pre class="screen">options query-log<a class="indexterm" name="AUTOID-7792"></A
><a class="indexterm" name="AUTOID-7794"></A
><a class="indexterm" name="AUTOID-7797"></A
><a class="indexterm" name="AUTOID-7800"></A
></PRE
></BLOCKQUOTE
><p class="para">or your version 8 configuration file has:</P
><blockquote class="screen"><pre class="screen">logging { category queries { default_syslog; }; };</PRE
></BLOCKQUOTE
><p class="para">you will get a <span class="acronym">LOG_INFO</SPAN
> syslog message for
every query your name server receives:</P
><blockquote class="screen"><pre class="screen">Feb 20 21:43:25 terminator named[3830]:
            XX /192.253.253.2/carrie.movie.edu/A
Feb 20 21:43:32 terminator named[3830]:
            XX /192.253.253.2/4.253.253.192.in-addr.arpa/PTR</PRE
></BLOCKQUOTE
><p class="para">These messages include the <span class="acronym">IP</SPAN
> address of the
host that made the query and the query. Make sure you have lots of
disk space if you log all the queries to a busy name server. (On a
running server, you can toggle query logging on and off with the<a class="indexterm" name="AUTOID-7810"></A
>
<span class="acronym">WINCH</SPAN
> signal.)</P
><p class="para">Starting with version 8.1.2, you might see this set of syslog
messages:</P
><blockquote class="screen"><pre class="screen">May 19 11:06:08 named[21160]: bind(dfd=20, [10.0.0.1].53):
                Address already in use
May 19 11:06:08 named[21160]: deleting interface [10.0.0.1].53
May 19 11:06:08 named[21160]: bind(dfd=20, [127.0.0.1].53):
                Address already in use
May 19 11:06:08 named[21160]: deleting interface [127.0.0.1].53
May 19 11:06:08 named[21160]: not listening on any interfaces
May 19 11:06:08 named[21160]: Forwarding source address
                is [0.0.0.0].1835
May 19 11:06:08 named[21161]: Ready to answer queries.</PRE
></BLOCKQUOTE
><p class="para">What has happened is that you had a name server running and you
started up a second name server without killing the first one.  Unlike
what you might expect, the second name server continues to run; it
just isn't listening on any interfaces.<a class="indexterm" name="AUTOID-7817"></A
><a class="indexterm" name="AUTOID-7818"></A
><a class="indexterm" name="AUTOID-7819"></A
></P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="AUTOID-7820">7.6.2 Understanding the <span class="acronym">BIND</SPAN
> Statistics</A
></H3
><p class="para"><a class="indexterm" name="DNS3-IDX-7-STATISTICS"></A
><a class="indexterm" name="DNS3-IDX-7-NAME-SERVERS-STATISTICS-ON"></A
><a class="indexterm" name="DNS3-IDX-7-BIND-BERKELEY-INTERNET-NAME-DOMAIN-STATISTICS"></A
>Periodically, you should look over the statistics on some of your name
servers, if only to see how busy they are. We will show you an example
of the name server statistics and discuss what each line means.<a class="indexterm" name="DNS3-IDX-7-QUERIES-STATISTICS-ON"></A
>
Name servers handle many queries and responses during normal
operation, so first, we need to show you what a typical exchange might
look like.</P
><p class="para">Reading the explanations for the statistics is hard without a
mental picture of what goes on during a lookup. To help you understand
the name server's statistics, <a class="xref" href="#DNS3-CHP-7-FIG-2" title="Example query/response exchange">Figure 7.2</A
> shows
what might go on when an application tries to look up a name. The
application, <kbd class="command">ftp</KBD
>, queries a local name server. The
local name server had previously looked up data from this domain and
knows where the remote name servers are. It queries each of the remote
name servers&nbsp;- one of them twice&nbsp;- trying to find the
answer. In the meantime, the application times out and sends yet
another query, asking for the same information.</P
><p class="para">Keep in mind that even though a name server has sent a query to
a remote name server, the remote name server may not receive the query
right away. The query might be delayed or lost by the underlying
network, or perhaps the remote name server host might be busy with
another application.</P
><h4 class="figure"><a class="title" name="DNS3-CHP-7-FIG-2">Figure 7.2: Example query/response exchange</A
></H4
><img class="graphic" src="figs/dns3_0702.gif" alt="Figure 7.2"><p class="para">Notice that a <span class="acronym">BIND</SPAN
> name server is able to
detect duplicate queries only while it is still trying to answer the
original query.  The local name server detects the duplicate query
from the application because the local name server is still working on
it. But, remote name server 1 does not detect the duplicate query from
the local name server because it answered the previous query. After
the local name server receives the first response from remote name
server 1, all other responses are discarded as duplicates. This dialog
required the following exchanges:</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Exchange</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Number</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Application to local name server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">2 queries</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Local name server to application</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">1 response</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Local name server to remote name server
1</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">2 queries</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Remote name server 1 to local name server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">2 responses</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Local name server to remote name server
2</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">1 query</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Remote name server 2 to local name server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">1 response</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Local name server to remote name server
3</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">1 query</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">Remote name server 3 to local name server</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">0 responses</P
></TD
></TR
></TBODY
></TABLE
><p class="para">These exchanges would make the following contributions to the
local name server's statistics:</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Statistic</P
></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><p class="para">Cause</P
></TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">2 queries received</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">From the application on the local host</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">1 duplicate query</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">From the application on the local host</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">1 answer sent</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">To the application on the local host</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">3 responses received</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">From remote name servers</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">2 duplicate responses</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">From remote name servers</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><p class="para">2 A queries</P
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Queries for address information</P
></TD
></TR
></TBODY
></TABLE
><p class="para">In our example, the local name server received queries only from
an application, yet it sent queries to remote name servers.  Normally,
the local name server would also receive queries from remote name
servers (that is, in addition to asking remote servers for information
it needs to know, the local server would also be asked by remote
servers for information they need to know), but we didn't show any
remote queries, for the sake of simplicity.</P
><p class="para">Now that you've seen a typical exchange between applications and
name servers, and the statistics it generated, let's go over a more
extensive example of the statistics. To get the statistics from your
name server, send the version 4 name server an<a class="indexterm" name="AUTOID-7937"></A
>
<span class="acronym">ABRT</SPAN
> signal (on many systems, called
<span class="acronym">IOT</SPAN
>):</P
><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>kill -ABRT `cat /etc/named.pid`</B
></CODE
></PRE
></BLOCKQUOTE
><p class="para">Or send a version 8 name server an <span class="acronym">ILL</SPAN
> signal
instead of <span class="acronym">ABRT</SPAN
>:</P
><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>kill -ILL `cat /etc/named.pid`</B
></CODE
></PRE
></BLOCKQUOTE
><p class="para">(The process <span class="acronym">ID</SPAN
> is stored in
<i class="filename">/var/run/named.pid</I
> on an <span class="acronym">SVR</SPAN
>4
filesystem.) Wait a few seconds and look at the file<a class="indexterm" name="AUTOID-7953"></A
>
<i class="filename">/usr/tmp/named.stats</I
> (or
<i class="filename">/var/tmp/named.stats</I
>). A version 8 name server
leaves the file <i class="filename">named.stats</I
> in its current
directory (<i class="filename">/usr/local/named</I
> in most of our
examples).  If the statistics are not dumped to this file, your server
may not have been compiled with <span class="acronym">STATS</SPAN
> defined and,
thus, may not be collecting statistics. Following are the statistics
from one of Paul Vixie's name servers. These statistics came from a
4.9.3 name server. An 8.1.2 name server has all of the same items as
below except <span class="acronym">RN</SPAN
>otNsQ and the items are arranged in
a different order.  If your name server is newer than 8.1.2, the
statistics may not look at all like those shown here&nbsp;- the
<span class="acronym">BIND</SPAN
> statistics may be replaced with the
<span class="acronym">DNS</SPAN
> server and resolver <span class="acronym">MIB</SPAN
>
extensions defined in <span class="acronym">RFC</SPAN
> 1611 and
<span class="acronym">RFC</SPAN
> 1612.</P
><blockquote class="screen"><pre class="screen">+++ Statistics Dump +++ (800708260) Wed May 17 03:57:40 1995
746683    time since boot (secs)
392768    time since reset (secs)
14        Unknown query types
268459    A queries
3044      NS queries
5680      CNAME queries
11364     SOA queries
1008934   PTR queries
44        HINFO queries
680367    MX queries
2369      TXT queries
40        NSAP queries
27        AXFR queries
8336      ANY queries
++ Name Server Statistics ++
(Legend)
      RQ    RR    RIQ   RNXD    RFwdQ
      RFwdR RDupQ RDupR RFail   RFErr
      RErr  RTCP  RAXFR RLame   ROpts
      SSysQ SAns  SFwdQ SFwdR   SDupQ
      SFail SFErr SErr  RNotNsQ SNaAns
      SNXD
(Global)
   1992938 112600 0 19144 63462 60527 194 347 3420 0  5 2235 27 35289 0
   14886 1927930 63462 60527 107169  10025 119 0 1785426 805592  35863
[15.255.72.20]
   485 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 485 0 0 0  0 0 0 0 485  0
[15.255.152.2]
   441 137 0 1 2 108 0 0 0 0  0 0 0 0 0  13 439 85 7 84  0 0 0 0 431  0
[15.255.152.4]
   770 89 0 1 4  69 0 0 0 0  0 0 0 0 0  14 766 68 5 7  0 0 0 0 755  0
...  &lt;<b class="emphasis.bold">lots of entries deleted</B
>&gt;</PRE
></BLOCKQUOTE
><p class="para">Let's look at these statistics one line at a time:</P
><blockquote class="screen"><pre class="screen">746683    time since boot (secs)</PRE
></BLOCKQUOTE
><p class="para">This is how long the local name server has been running. To
convert to days, divide by 86400 (60x60x24, the number of seconds in a
day). This server has been running for about 8.5 days.</P
><blockquote class="screen"><pre class="screen">392768    time since reset (secs)</PRE
></BLOCKQUOTE
><p class="para">This is how long the local name server has run since the last<a class="indexterm" name="AUTOID-7973"></A
>
<span class="acronym">HUP</SPAN
> signal&nbsp;- i.e., the last time it loaded its
database. You'll probably see this number differ from the time since
boot only if the server is a primary master name server for some
zone. Name servers that are slaves for a zone automatically pick up
new data with zone transfers and are not usually sent
<span class="acronym">HUP</SPAN
> signals. Since <em class="emphasis">this</EM
> server
has been reset, it is probably a primary master name server for some
zone.<a class="indexterm" name="AUTOID-7979"></A
></P
><blockquote class="screen"><pre class="screen">14        Unknown query types</PRE
></BLOCKQUOTE
><p class="para">This name server received 14 queries for data of a type the name
server didn't recognize. Either someone is experimenting with new
types, or there is a defective implementation somewhere.</P
><blockquote class="screen"><pre class="screen">268459    A queries<a class="indexterm" name="AUTOID-7984"></A
><a class="indexterm" name="AUTOID-7987"></A
></PRE
></BLOCKQUOTE
><p class="para">There have been 268459 address lookups. Address queries are
normally the most common type of query.</P
><blockquote class="screen"><pre class="screen">3044      NS queries<a class="indexterm" name="AUTOID-7992"></A
><a class="indexterm" name="AUTOID-7996"></A
></PRE
></BLOCKQUOTE
><p class="para">There have been 3044 name server queries. Internally, name
servers generate <span class="acronym">NS</SPAN
> queries when they are trying to
look up servers for the root domain. Externally, applications like
<kbd class="command">dig</KBD
> or <kbd class="command">nslookup</KBD
> can also be used
to look up <span class="acronym">NS</SPAN
> records.</P
><blockquote class="screen"><pre class="screen">5680      CNAME queries<a class="indexterm" name="AUTOID-8006"></A
></PRE
></BLOCKQUOTE
><p class="para">Some versions of <kbd class="command">sendmail</KBD
> make
<span class="acronym">CNAME</SPAN
> queries in order to canonicalize a mail
address (replace an alias with the canonical name). Other versions of<a class="indexterm" name="AUTOID-8013"></A
>
<kbd class="command">sendmail</KBD
> use <span class="acronym">ANY</SPAN
> queries instead
(we'll get to those shortly). Otherwise, the <span class="acronym">CNAME</SPAN
>
lookups are most likely from <kbd class="command">dig</KBD
> or
<kbd class="command">nslookup</KBD
>.</P
><blockquote class="screen"><pre class="screen">11364     SOA queries<a class="indexterm" name="AUTOID-8021"></A
></PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">SOA</SPAN
> queries are made by slave name servers to
check if their zone data are current. If the data are not current, an
<span class="acronym">AXFR</SPAN
> query follows to cause the zone
transfer. Since this set of statistics does show<a class="indexterm" name="AUTOID-8028"></A
>
<span class="acronym">AXFR</SPAN
> queries, we can conclude that slave name
servers load zone data from this server.</P
><blockquote class="screen"><pre class="screen">1008934   PTR queries<a class="indexterm" name="AUTOID-8033"></A
></PRE
></BLOCKQUOTE
><p class="para">The pointer queries map addresses to names. Many kinds of
software look up <span class="acronym">IP</SPAN
> addresses:
<kbd class="command">inetd</KBD
>, <kbd class="command">rlogind</KBD
>,
<kbd class="command">rshd</KBD
>, network management software, and network
tracing software.</P
><blockquote class="screen"><pre class="screen">44        HINFO queries<a class="indexterm" name="AUTOID-8043"></A
></PRE
></BLOCKQUOTE
><p class="para">The host-information queries are most likely from someone
interactively looking up <span class="acronym">HINFO</SPAN
> records.</P
><blockquote class="screen"><pre class="screen">680367    MX queries<a class="indexterm" name="AUTOID-8050"></A
></PRE
></BLOCKQUOTE
><p class="para">Mail exchanger queries are made by mailers like
<kbd class="command">sendmail</KBD
> as part of the normal electronic mail
delivery process.</P
><blockquote class="screen"><pre class="screen">2369      TXT queries<a class="indexterm" name="AUTOID-8057"></A
></PRE
></BLOCKQUOTE
><p class="para">Some application must be making text queries for this number to
be this large. It might be a tool like <kbd class="command">Harvest</KBD
>,
which is an information search and retrieval technology developed at
the University of Colorado.</P
><blockquote class="screen"><pre class="screen">40        NSAP queries<a class="indexterm" name="AUTOID-8064"></A
></PRE
></BLOCKQUOTE
><p class="para">This is a relatively new data type used to map domain names to
<span class="acronym">OSI</SPAN
> Network Service Access Point addresses.</P
><blockquote class="screen"><pre class="screen">27        AXFR queries</PRE
></BLOCKQUOTE
><p class="para">An <span class="acronym">AXFR</SPAN
> query is made by a slave name server
to cause a zone transfer.</P
><blockquote class="screen"><pre class="screen">8336      ANY queries<a class="indexterm" name="AUTOID-8073"></A
></PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">ANY</SPAN
> queries request data of any type for a
name. This query type is used most often by
<kbd class="command">sendmail</KBD
>. Since <kbd class="command">sendmail</KBD
> looks
up <span class="acronym">CNAME</SPAN
>, <span class="acronym">MX</SPAN
>, and address
records for a mail destination, it will make a query for
<span class="acronym">ANY</SPAN
> data type so that all the resource records are
cached right away at the local name server.<a class="indexterm" name="AUTOID-8083"></A
></P
><p class="para"><a class="indexterm" name="DNS3-IDX-7-HOSTS-STATISTICS-FOR"></A
>The rest of the statistics are kept on a per-host basis. If you
look over the list of hosts your name server has exchanged packets
with, you'll find out just how garrulous your name server
is&nbsp;- you'll see hundreds or even thousands of hosts in the
list. While the size of the list is impressive, the statistics
themselves are only somewhat interesting. We will explain
<em class="emphasis">all</EM
> of the statistics, even the ones with zero
counts, although you'll probably only find a handful of the statistics
useful. To make the statistics easier to read, you'll need a tool to
expand the statistics because the output format is rather compact. We
wrote a tool, called<a class="indexterm" name="AUTOID-8089"></A
>
<kbd class="command">bstat</KBD
>, to do just this. Here's what its output
looks like:</P
><blockquote class="screen"><pre class="screen">hpcvsop.cv.hp.com
        485 queries received
        485 responses sent to this name server
        485 queries answered from our cache
relay.hp.com
        441 queries received
        137 responses received
          1 negative response received
          2 queries for data not in our cache or authoritative data
        108 responses from this name server passed to the querier
         13 system queries sent to this name server
        439 responses sent to this name server
         85 queries sent to this name server
          7 responses from other name servers sent to this name server
         84 duplicate queries sent to this name server
        431 queries answered from our cache
hp.com
        770 queries received
         89 responses received
          1 negative response received
          4 queries for data not in our cache or authoritative data
         69 responses from this name server passed to the querier
         14 system queries sent to this name server
        766 responses sent to this name server
         68 queries sent to this name server
          5 responses from other name servers sent to this name server
          7 duplicate queries sent to this name server
        755 queries answered from our cache</PRE
></BLOCKQUOTE
><p class="para">In the raw statistics (not the <kbd class="command">bstat</KBD
> output),
each host <span class="acronym">IP</SPAN
> address is followed by a table of
counts. The column heading for this table is the cryptic legend at the
beginning. The legend is broken into several lines, but the host
statistics are all on a single line. In the following section, we'll
explain briefly what each column means as we look at the statistics
for one of the hosts this server conversed with&nbsp;- 15.255.152.2
(<i class="systemitem.sitename">relay.hp.com</I
>). For the sake
of our explanation, we'll first show you the column heading from the
legend (e.g., <span class="acronym">RQ</SPAN
>) followed by the count for this
column for <i class="systemitem.sitename">relay</I
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8100"></A
>RQ 441</PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">RQ</SPAN
> is the count of queries received from
<i class="systemitem.sitename">relay</I
>.  These queries were
made because <i class="systemitem.sitename">relay</I
> needed
information about a domain served by this name server.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8108"></A
>RR 137</PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">RR</SPAN
> is the count of responses received from
<i class="systemitem.sitename">relay</I
>.  These are responses
to queries made from this name server.  Don't try to correlate this
number to <span class="acronym">RQ</SPAN
>, because they are not related.
<span class="acronym">RQ</SPAN
> counts questions <em class="emphasis">asked</EM
> by
<i class="systemitem.sitename">relay</I
>;
<span class="acronym">RR</SPAN
> counts <em class="emphasis">answers</EM
> <i class="systemitem.sitename">relay</I
> gave to this name server (because
this name server <em class="emphasis">asked</EM
> <i class="systemitem.sitename">relay</I
> for information).</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8124"></A
>RIQ 0</PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">RIQ</SPAN
> is the count of inverse queries received
from <i class="systemitem.sitename">relay</I
>.  Inverse queries
were originally intended to map addresses to names, but that function
is now handled by <span class="acronym">PTR</SPAN
> records. Older versions of
<kbd class="command">nslookup</KBD
> use an inverse query on startup, so you
may see a nonzero <span class="acronym">RIQ</SPAN
> count.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8134"></A
>RNXD 1</PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">RNXD</SPAN
> is the count of <span class="quote">"no such
domain"</SPAN
> answers received from <i class="systemitem.sitename">relay</I
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8142"></A
>RFwdQ 2</PRE
></BLOCKQUOTE
><p class="para">RFwdQ is the count of queries received (<span class="acronym">RQ</SPAN
>)
from <i class="systemitem.sitename">relay</I
> that needed
further processing before they could be answered. This count is much
higher for hosts that configure their resolver (with
<i class="filename">resolv.conf</I
>) to send all queries to your
name server.</P
><blockquote class="screen"><pre class="screen">RFwdR 108</PRE
></BLOCKQUOTE
><p class="para">RFwdR is the count of responses received (<span class="acronym">RR</SPAN
>)
from <i class="systemitem.sitename">relay</I
> that answered the
original query and were passed back to the application that made the
query.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8153"></A
>RDupQ 0</PRE
></BLOCKQUOTE
><p class="para">RDupQ is the count of duplicate queries from <i class="systemitem.sitename">relay</I
>.  You'll only see duplicates when
the resolver is configured (with
<i class="filename">resolv.conf</I
>) to query this name
server.</P
><blockquote class="screen"><pre class="screen">RDupR 0</PRE
></BLOCKQUOTE
><p class="para">RDupR is the count of duplicate responses from <i class="systemitem.sitename">relay</I
>.  A response is a duplicate when
the name server can no longer find the original query in its list of
pending queries that caused the response.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8162"></A
>RFail 0</PRE
></BLOCKQUOTE
><p class="para">RFail is the count of<a class="indexterm" name="AUTOID-8165"></A
><a class="indexterm" name="AUTOID-8168"></A
>
<span class="acronym">SERVFAIL</SPAN
> responses from <i class="systemitem.sitename">relay</I
>. A <span class="acronym">SERVFAIL</SPAN
>
response indicates some sort of server failure. Server failure
responses often occur because the remote server read a db file and
found a syntax error.  Any queries for data in that zone (the one from
the erroneous db file) will result in a server failure answer from the
remote name server. This is probably the most common bad
response. Server failure responses also occur when the remote name
server tries to allocate more memory and can't, or when the remote
name server's zone data expire.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8175"></A
>RFErr 0</PRE
></BLOCKQUOTE
><p class="para">RFErr is the count of<a class="indexterm" name="AUTOID-8178"></A
>
<span class="acronym">FORMERR</SPAN
> responses from <i class="systemitem.sitename">relay</I
>. <span class="acronym">FORMERR</SPAN
> means
that the remote name server said the local name server's query had a
format error.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8185"></A
>RErr  0</PRE
></BLOCKQUOTE
><p class="para">RErr is the count of errors that weren't either
<span class="acronym">SERVFAIL</SPAN
> or <span class="acronym">FORMERR</SPAN
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8191"></A
>RTCP  0</PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">RTCP</SPAN
> is the count of queries received on
<span class="acronym">TCP</SPAN
> connections from <i class="systemitem.sitename">relay</I
>.  (Most queries use
<span class="acronym">UDP</SPAN
>.)</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8200"></A
>RAXFR 0</PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">RAXFR</SPAN
> is the count of zone transfers
initiated. The 0 count indicates that <i class="systemitem.sitename">relay</I
> is not a slave for any zones served
by this name server.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8207"></A
>RLame 0</PRE
></BLOCKQUOTE
><p class="para"><a class="indexterm" name="AUTOID-8210"></A
><a class="indexterm" name="AUTOID-8213"></A
>RLame is the count of lame delegations received. If this count is not
0, it means that some zone is delegated to the name server at this
<span class="acronym">IP</SPAN
> address, and the name server is not
authoritative for the zone.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8217"></A
>ROpts 0</PRE
></BLOCKQUOTE
><p class="para">ROpts is the count of packets received with
<span class="acronym">IP</SPAN
> options.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8222"></A
>SSysQ 13</PRE
></BLOCKQUOTE
><p class="para"><a class="indexterm" name="AUTOID-8225"></A
><a class="indexterm" name="AUTOID-8228"></A
>SSysQ is the count of system queries sent to <i class="systemitem.sitename">relay</I
>.  System queries are queries
<em class="emphasis">initiated</EM
> by the local name server. Most system
queries will go to root name servers, because system queries are used
to keep up-to-date on who the root name servers are. But system
queries are also used to find out the address of a name server if the
address record timed out before the name server record did. Since
<i class="systemitem.sitename">relay</I
> is not a root name
server, these queries must have been sent for the latter
reason.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8235"></A
>SAns  439</PRE
></BLOCKQUOTE
><p class="para">SAns is the count of answers sent to <i class="systemitem.sitename">relay</I
>.  This name server answered 439 out
of the 441 (<span class="acronym">RQ</SPAN
>) queries <i class="systemitem.sitename">relay</I
> sent to it. I wonder what happened
to the 2 queries it didn't answer...</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8242"></A
>SFwdQ 85</PRE
></BLOCKQUOTE
><p class="para">SFwdQ is the count of queries that were sent (forwarded) to
<i class="systemitem.sitename">relay</I
> when the answer was not
in this name server's zone data or cache.</P
><blockquote class="screen"><pre class="screen">SFwdR 7</PRE
></BLOCKQUOTE
><p class="para">SFwdR is the count of responses from some name server that were
sent (forwarded) to <i class="systemitem.sitename">relay</I
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8250"></A
>SDupQ 84</PRE
></BLOCKQUOTE
><p class="para">SDupQ is the count of the<a class="indexterm" name="AUTOID-8253"></A
>
duplicate queries sent to <i class="systemitem.sitename">relay</I
>. It's not as bad as it looks,
though. The duplicate count is incremented if the query was sent to
any other name server first. So, <i class="systemitem.sitename">relay</I
> might have answered all the queries
it received the first time it received them, and the query still
counted as a duplicate because it was sent to some other name server
before <i class="systemitem.sitename">relay</I
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8259"></A
>SFail 0</PRE
></BLOCKQUOTE
><p class="para">SFail is the count of <span class="acronym">SERVFAIL</SPAN
> responses sent
to <i class="systemitem.sitename">relay</I
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8265"></A
>SFErr 0</PRE
></BLOCKQUOTE
><p class="para">SFErr is the count of<a class="indexterm" name="AUTOID-8268"></A
>
<span class="acronym">FORMERR</SPAN
> responses sent to <i class="systemitem.sitename">relay</I
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8274"></A
>SErr  0</PRE
></BLOCKQUOTE
><p class="para">SErr is the count of<a class="indexterm" name="AUTOID-8277"></A
>
<i class="function">sendto()</I
> system calls that failed when
the destination was <i class="systemitem.sitename">relay</I
>.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8282"></A
>RNotNsQ 0</PRE
></BLOCKQUOTE
><p class="para">RNotNsQ is the count of queries received that were not from port
53, the name server port. Prior to version 8, all name server queries
would come from port 53.  Any queries from ports other than 53 came
from a resolver. Now, name servers will query from ports other than
53, which makes this statistic useless since you can no longer
distinguish resolver queries from name server queries.  Hence, version
8 dropped RNotNsQ from its statistics.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8286"></A
>SNaAns 431</PRE
></BLOCKQUOTE
><p class="para">SNaAns is the count of nonauthoritative answers sent to
<i class="systemitem.sitename">relay</I
>.  Out of the 439
answers (SAns) sent to <i class="systemitem.sitename">relay</I
>,
431 were from cached data.</P
><blockquote class="screen"><pre class="screen"><a class="indexterm" name="AUTOID-8292"></A
>SNXD  0</PRE
></BLOCKQUOTE
><p class="para"><span class="acronym">SNXD</SPAN
> is the count of <span class="quote">"no such
domain"</SPAN
> answers sent to <i class="systemitem.sitename">relay</I
>.</P
><p class="para"><a class="indexterm" name="AUTOID-8300"></A
>Is this name server <span class="quote">"healthy"</SPAN
>?  How do you know what
<span class="quote">"healthy"</SPAN
> operation is? From this one snapshot, we really
couldn't say if the name server is healthy. You have to watch the
statistics generated by your server over a period of time to get a
feel for what sorts of numbers are normal for your configuration.
These numbers will vary markedly among servers, depending on the mix
of applications generating lookups, the type of server (primary,
slave, caching-only), and the level in the domain tree it is
serving.</P
><p class="para"><a class="indexterm" name="AUTOID-8306"></A
>One thing to watch for in the statistics is how many queries per
second your server receives. Take the number of queries received (from
the <span class="quote">"Global"</SPAN
> statistics) and divide by the number of
seconds the name server has been running. This server received 1992938
queries in 746683 seconds, or approximately 2.7 queries per
second&nbsp;- a pretty busy server.  If the number you come up with for
your server seems out of line, look at which hosts are making all the
queries and decide if it makes sense for them to be making all those
queries. At some point you may decide that you need more servers to
handle the load; we cover that situation in the<a class="indexterm" name="AUTOID-8310"></A
><a class="indexterm" name="AUTOID-8311"></A
><a class="indexterm" name="AUTOID-8312"></A
><a class="indexterm" name="AUTOID-8313"></A
>
next<a class="indexterm" name="AUTOID-8314"></A
><a class="indexterm" name="AUTOID-8315"></A
><a class="indexterm" name="AUTOID-8316"></A
><a class="indexterm" name="AUTOID-8317"></A
><a class="indexterm" name="AUTOID-8318"></A
>
chapter.<a class="indexterm" name="AUTOID-8319"></A
><a class="indexterm" name="AUTOID-8320"></A
><a class="indexterm" name="AUTOID-8321"></A
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_05.htm" title="7.5 BIND 8 Logging"><img src="../gifs/txtpreva.gif" alt="Previous: 7.5 BIND 8 Logging" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="DNS &amp; BIND"><img src="../gifs/txthome.gif" alt="DNS &amp; BIND" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="CHAPTER" href="ch08_01.htm" title="8. Growing Your Domain"><img src="../gifs/txtnexta.gif" alt="Next: 8. Growing Your Domain" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">7.5 BIND 8 Logging</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">8. Growing Your Domain</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
