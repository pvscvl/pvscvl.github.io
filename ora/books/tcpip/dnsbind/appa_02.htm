<html><head>
<title>[Appendix A] A.2 DNS Message</TITLE>
<meta name="DC.title" content="DNS &amp; BIND"><meta name="DC.creator" content="Cricket Liu &amp; Paul Albitz"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1999-01-06T18:45:18Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-512-2" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="appa_01.htm" title="A. DNS Message Format and Resource Records"><link rel="prev" href="appa_01.htm" title="A.1 Master File Format"><link rel="next" href="appa_03.htm#AUTOID-18674" title="A.3 Header Section Format"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" alt="DNS &amp; BIND" usemap="#srchmap" border="0"></H1
><map name=index.html"srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" alt="DNS &amp; BIND"><area shape="RECT" coords="467,0,514,18" href="../search/dsrch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appa_01.htm" title="A.1 Master File Format"><img src="../gifs/txtpreva.gif" alt="Previous: A.1 Master File Format" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Appendix A<br>DNS Message Format and Resource
Records</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="appa_03.htm#AUTOID-18674" title="A.3 Header Section Format"><img src="../gifs/txtnexta.gif" alt="Next: A.3 Header Section Format" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="AUTOID-18604">A.2 DNS Message</A
></H2
><p class="para"><a class="indexterm" name="DNS3-IDX-A-MESSAGES-FORMAT-OF"></A
><a class="indexterm" name="DNS3-IDX-A-PACKETS-MESSAGE-FORMAT"></A
><a class="indexterm" name="DNS3-IDX-A-FORMAT-PACKET-MESSAGE"></A
>In order to write programs that parse
DNS packets, you need to understand the message format. DNS queries
and responses are most often contained within UDP packets. Each
message is fully contained within a UDP packet. If the query and response
are sent over TCP, then they are prefixed with a two-byte value
indicating the length of the query or response, excluding the two-byte
length. The format and content of the DNS packet are as follows.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="AUTOID-18616">A.2.1 Format</A
></H3
><p class="para">(From RFC 1035, page 25)</P
><p class="para"><a class="indexterm" name="AUTOID-18620"></A
>All
communications inside of the domain protocol are carried in a single
format called a message. The top level format of message is divided into
5 sections (some of which are empty in certain cases) shown below:</P
><blockquote class="screen"><pre class="screen">    +---------------------+
    |        Header       |
    +---------------------+
    |       Question      | the question for the name server
    +---------------------+
    |        Answer       | RRs answering the question
    +---------------------+
    |      Authority      | RRs pointing toward an authority
    +---------------------+
    |      Additional     | RRs holding additional information
    +---------------------+</PRE
></BLOCKQUOTE
><p class="para">The header section is always present. The header
includes fields that specify which of the remaining sections are
present, and also specify whether the message is a query or a response,
a standard query or some other opcode, etc.</P
><p class="para">The names
of the sections after the header are derived from their use in standard
queries. The question section contains fields that describe a question
to a name server. These fields are a query type (QTYPE), a query
class (QCLASS), and a query domain name (QNAME). The last three
sections have the same format: a possibly empty list of concatenated
resource records (RRs). The answer section contains RRs that answer
the question; the authority section contains RRs that point toward
an authoritative name server; the additional records section contains
RRs which relate to the query, but are not strictly answers for
the question.</P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appa_01.htm" title="A.1 Master File Format"><img src="../gifs/txtpreva.gif" alt="Previous: A.1 Master File Format" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" title="DNS &amp; BIND"><img src="../gifs/txthome.gif" alt="DNS &amp; BIND" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="appa_03.htm#AUTOID-18674" title="A.3 Header Section Format"><img src="../gifs/txtnexta.gif" alt="Next: A.3 Header Section Format" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">A.1 Master File Format</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">A.3 Header Section Format</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><p class="nav"><font size="-1">[ <a href="../index.htm" title="The Networking CD Bookshelf">Library Home</A
> | <a href="index.htm" title="DNS &amp; BIND">DNS &amp; BIND</A
> | <a href="../tcpip/index.htm" title="TCP/IP Network Administration">TCP/IP</A
> | <a href="../sendmail/index.htm" title="sendmail">sendmail</A
> | <a href="../smdref/index.htm" title="sendmail Desktop Reference">sendmail Reference</A
> | <a href="../firewall/index.htm" title="Building Internet Firewalls">Firewalls</A
> | <a href="../puis/index.htm" title="Practical UNIX &amp; Internet Security">Practical Security</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
