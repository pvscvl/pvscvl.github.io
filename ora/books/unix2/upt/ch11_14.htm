<html><head><title>[Chapter 11] 11.14 More Ways to Do Interactive History Editing </TITLE
><meta name="DC.title" content="UNIX Power Tools"><meta name="DC.creator" content="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-08-04T21:36:17Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-260-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch11_01.htm" webstripperlinkwas="ch11_01.htm" title="11. The Lessons of History"><link rel="prev" href="ch11_13.htm" webstripperlinkwas="ch11_13.htm" title="11.13 Shell Command-Line Editing "><link rel="next" href="ch11_15.htm" webstripperlinkwas="ch11_15.htm" title="11.15 Changing C Shell History Characters with histchars "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="UNIX Power Tools" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,58" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch11_13.htm" webstripperlinkwas="ch11_13.htm" title="11.13 Shell Command-Line Editing "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 11.13 Shell Command-Line Editing " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 11<br>The Lessons of History</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch11_15.htm" webstripperlinkwas="ch11_15.htm" title="11.15 Changing C Shell History Characters with histchars "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 11.15 Changing C Shell History Characters with histchars " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="UPT-ART-9010">11.14 More Ways to Do Interactive History Editing </A
></H2
><p class="para"><a class="indexterm" name="AUTOID-13273"></A
><a class="indexterm" name="AUTOID-13275"></A
><span class="link"><em class="emphasis">tcsh</EM
> (<a class="linkend" href="ch08_03.htm" webstripperlinkwas="ch08_03.htm" title="Introduction to tcsh">8.3</A
>)</SPAN
>
is a version of <em class="emphasis">csh</EM
> that provides history editing (among other
things).
If you don't want to switch to <em class="emphasis">tcsh</EM
>, you can 
simulate history editing using <em class="emphasis">redo</EM
>.
If you're using <em class="emphasis">bash</EM
> or <em class="emphasis">ksh</EM
>, you probably already know about
your shell's editing&nbsp;- but you may not know about its <em class="emphasis">fc</EM
> command.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-9010-SECT-1.1">11.14.1 In the C Shell: redo </A
></H3
><p class="para"><a class="indexterm" name="AUTOID-13289"></A
><a class="indexterm" name="AUTOID-13291"></A
><em class="emphasis">redo</EM
> is a C shell script that is run by being
<span class="link">sourced (<a class="linkend" href="ch44_23.htm" webstripperlinkwas="ch44_23.htm" title="Reading Files with the . and source Commands ">44.23</A
>)</SPAN
>
into the current shell using an alias.
The original version was posted to Usenet in the 1980s, author unknown.
The version shown here was reposted in 1987 by Dave Patterson.
The alias puts you in an <em class="emphasis">ex</EM
>
<span class="link">open-mode (<a class="linkend" href="ch30_36.htm" webstripperlinkwas="ch30_36.htm" title="The ex Open Mode Can Be Handy ">30.36</A
>)</SPAN
>
editing buffer, 
a comfortable environment for <em class="emphasis">vi</EM
> users.
You can browse through the
previous 22 commands and press RETURN when you want
to execute the current line.
Before executing, you
can edit the commands as you would in <em class="emphasis">vi</EM
>.
You can even search 
for strings using 
<code class="literal">/</CODE
>; just remember to press ESC instead of 
RETURN after the search string.</P
><p class="para">To use <em class="emphasis">redo</EM
>, first install it 
<span class="link">read-only with <em class="emphasis">no</EM
> execute permission (<a class="linkend" href="ch22_02.htm" webstripperlinkwas="ch22_02.htm" title="Tutorial on File and Directory Permissions ">22.2</A
>)</SPAN
>,
and then create an alias 
with the script's
<span class="link">absolute pathname (<a class="linkend" href="ch14_02.htm" webstripperlinkwas="ch14_02.htm" title="Using Relative and Absolute Pathnames ">14.2</A
>)</SPAN
>
to execute it:</P
><p class="para"><blockquote class="screen"><pre class="screen">alias r source ~/.lib/redo</PRE
></BLOCKQUOTE
></P
><p class="para">When you run the alias, it reads a set of commands from the
<span class="link">sourceable script file (<a class="linkend" href="ch10_05.htm" webstripperlinkwas="ch10_05.htm" title="Sourceable Scripts ">10.5</A
>)</SPAN
>.</P
><p class="para">Here's the <em class="emphasis">redo</EM
> script:</P
><p class="para"><table class="screen.co" border="1"><tr><th valign="TOP"><pre class="calloutlist">
&#13;


<a class="co" href="ch45_35.htm" webstripperlinkwas="ch45_35.htm" title="45.35 Using a Control Character in a Script ">echo...33'</A
> 
<a class="co" href="ch31_02.htm" webstripperlinkwas="ch31_02.htm" title="31.2 Save Time and Typing with the vi map Commands ">map</A
> 


<a class="co" href="ch25_14.htm" webstripperlinkwas="ch25_14.htm" title="25.14 How to Look at the End of a File: tail ">tail</A
> 









<a class="co" href="ch11_07.htm" webstripperlinkwas="ch11_07.htm" title="11.7 History Substitutions ">!...</A
> </PRE
></TH
><td valign="TOP"><pre class="screen">
&#13;history -h 22 &gt;! /tmp/redo.$$

# Put CR in $c[1] and ESC in $c[2]:
set c=(`echo &quot;m e&quot; | tr me '\015\033'`)
# Make CR map to :wq! and start ex quietly at 2nd to last line in open mode.
(setenv EXINIT &quot;map $c[1] :.wq\!$c[2]|map! $c[1] ${c[2]}:.wq\!$c[2]&quot;;\
   ex '+$-1 open' /tmp/redo.$$)
tail -1 /tmp/redo.$$ &gt;! /tmp/cmd.$$

# Insert into history without executing.
source -h /tmp/cmd.$$

# Clear out temporaries.
/bin/rm -f /tmp/{cmd,redo}.$$
unset c

# If thing chosen to redo is the redo alias itself then DON'T redo it.
if (!-2:0 != !!:0) !!</PRE
></TD
></TR
></TABLE
></P
><p class="para">Type <code class="literal">r</CODE
> to invoke the alias.
Then use cursor motion keys (<code class="literal">jk</CODE
>) 
to get to the line you want to edit.
Edit the line (remember that 
you're in the
<span class="link">open mode (<a class="linkend" href="ch30_36.htm" webstripperlinkwas="ch30_36.htm" title="The ex Open Mode Can Be Handy ">30.36</A
>)</SPAN
>
of <em class="emphasis">ex</EM
>).
When you're done,
press RETURN. (Don't type <code class="literal">ZZ</CODE
> or <code class="literal">q</CODE
>.)</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-9010-SECT-1.2">11.14.2 In ksh and bash: fc </A
></H3
><p class="para"><a class="indexterm" name="AUTOID-13328"></A
><a class="indexterm" name="AUTOID-13330"></A
><a class="indexterm" name="AUTOID-13333"></A
><a class="indexterm" name="AUTOID-13336"></A
><em class="emphasis">ksh</EM
> and <em class="emphasis">bash</EM
> have a built-in command called <em class="emphasis">fc</EM
>
(for &quot;fix command&quot;).
It's like <em class="emphasis">redo</EM
>, but more powerful.
We'll cover the basics here; check your shell's manpage or its
Nutshell Handbook for details.</P
><p class="para">To see a list of your previous commands, use the option <code class="literal">-l</CODE
> (lowercase L,
for &quot;list&quot;):</P
><p class="para"><blockquote class="screen"><pre class="screen">$ <code class="userinput"><b>fc -l</B
></CODE
>
   ...
19      ls -F
20      less expn.c
21      vi $_
22      make
23      expn info@ora.com
24      fc -l</PRE
></BLOCKQUOTE
></P
><p class="para">To get a shorter list, give <em class="emphasis">fc</EM
> the first number or name you want
to list.
For instance, <code class="literal">fc&nbsp;-l&nbsp;vi</CODE
> or <code class="literal">fc&nbsp;-l 21</CODE
> would give the last
four lines above.</P
><p class="para"><em class="emphasis">fc</EM
> can call a UNIX editor (<em class="emphasis">vi</EM
>, <em class="emphasis">emacs</EM
>, <em class="emphasis">pico</EM
>, etc.)
to edit one or more of the previous commands.
You can name an editor with the <em class="emphasis">-e</EM
> option each time you use <em class="emphasis">fc</EM
>,
but it's probably easier to store the editor in the <em class="emphasis">FCEDIT</EM
> shell
variable (in your
<span class="link"><em class="emphasis">.profile</EM
> or <em class="emphasis">.bashrc</EM
> files (<a class="linkend" href="ch02_02.htm" webstripperlinkwas="ch02_02.htm" title="Shell Setup Files-Which, Where, and Why ">2.2</A
>)</SPAN
>).</P
><p class="para">To edit the commands above, between <code class="literal">vi</CODE
> and <code class="literal">expn</CODE
>,
you would type <code class="literal">fc&nbsp;v&nbsp;e</CODE
> or <code class="literal">fc&nbsp;21&nbsp;23</CODE
>.
Your editor will start with the three command lines in it.
You can make any changes you want: add commands, rearrange them,
and so on.
When you exit the editor, the commands you saved with your editor
will be executed.
If you change your mind and don't want to execute anything, just delete
all lines in your editor before you save&nbsp;- or replace them with a dummy
command like <code class="literal">echo&nbsp;hi</CODE
>.</P
></DIV
><div class="sect1info"><p class="SECT1INFO">- <span class="authorinitials">LM</SPAN
>, <span class="authorinitials">JP</SPAN
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch11_13.htm" webstripperlinkwas="ch11_13.htm" title="11.13 Shell Command-Line Editing "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 11.13 Shell Command-Line Editing " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" title="UNIX Power Tools"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="UNIX Power Tools" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch11_15.htm" webstripperlinkwas="ch11_15.htm" title="11.15 Changing C Shell History Characters with histchars "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 11.15 Changing C Shell History Characters with histchars " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">11.13 Shell Command-Line Editing </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">11.15 Changing C Shell History Characters with histchars </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
