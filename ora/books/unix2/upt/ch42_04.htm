<html><head><title>[Chapter 42] 42.4 Checklist for Resetting a Messed Up Terminal </TITLE
><meta name="DC.title" content="UNIX Power Tools"><meta name="DC.creator" content="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-08-04T21:52:26Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-260-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch42_01.htm" webstripperlinkwas="ch42_01.htm" title="42. Problems with Terminals"><link rel="prev" href="ch42_03.htm" webstripperlinkwas="ch42_03.htm" title="42.3 Why Changing TERM Sometimes Doesn't Work "><link rel="next" href="ch42_05.htm" webstripperlinkwas="ch42_05.htm" title="42.5 Checklist: Screen Size Messed Up? "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="UNIX Power Tools" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,58" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch42_03.htm" webstripperlinkwas="ch42_03.htm" title="42.3 Why Changing TERM Sometimes Doesn't Work "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 42.3 Why Changing TERM Sometimes Doesn't Work " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 42<br>Problems with Terminals</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch42_05.htm" webstripperlinkwas="ch42_05.htm" title="42.5 Checklist: Screen Size Messed Up? "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 42.5 Checklist: Screen Size Messed Up? " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="UPT-ART-0059">42.4 Checklist for Resetting a Messed Up Terminal </A
></H2
><p class="para"><a class="indexterm" name="AUTOID-46778"></A
><a class="indexterm" name="AUTOID-46781"></A
>Gremlins (like line noise on a modem, a bug in a program, a really long line
of output, non-printable characters in a file you <em class="emphasis">cat</EM
> to your
screen, etc.) can sneak into your system somewhere and mess up your
terminal screen or window.
The screen could have a bunch of flashing junk, the character set could
turn into hieroglyphics, words could start coming out underlined or in
inverse video, the line could lock up... well, there are lots of possibilities.</P
><p class="para">Here's a rough list of things to try.
This might be worth reading through right now.
Some things in here need to be ready <em class="emphasis">before</EM
> your terminal locks up.</P
><ul class="itemizedlist"><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-46789"></A
><a class="indexterm" name="AUTOID-46791"></A
>If you can get to a shell prompt (<code class="literal">%</CODE
> or <code class="literal">$</CODE
>),
the first command you should try is probably:</P
><p class="para"><table class="screen.co" border="1"><tr><th valign="TOP"><pre class="calloutlist">
<a class="co" href="ch22_18.htm" webstripperlinkwas="ch22_18.htm" title="22.18 Clear Your Terminal for Security, to Stop Burn-in ">clear</A
> 
<a class="co" href="ch41_10.htm" webstripperlinkwas="ch41_10.htm" title="41.10 Using terminfo Capabilities in Shell Programs ">tput</A
> </PRE
></TH
><td valign="TOP"><pre class="screen">
% <code class="userinput"><b>clear</B
></CODE
>   <i class="lineannotation">systems with termcap</I
>
% <code class="userinput"><b>tput clear</B
></CODE
>   <i class="lineannotation">systems with terminfo</I
></PRE
></TD
></TR
></TABLE
></P
><p class="para"><a class="indexterm" name="AUTOID-46804"></A
>That will try to erase the screen and may also cancel other problems like
inverse video.</P
></LI
><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-46808"></A
><a class="indexterm" name="AUTOID-46810"></A
>If running <em class="emphasis">clear</EM
> doesn't clear up your screen completely and your
terminal has a setup
menu, look for a &quot;clear screen&quot; function and try it.
(If you don't know how your terminal's setup mode works, find the
manual or find an expert.
Write down the steps and keep them close to your terminal.)</P
></LI
><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-46816"></A
><a class="indexterm" name="AUTOID-46818"></A
>If you have a shell prompt and you're on a system using <em class="emphasis">terminfo</EM
>, try
these commands.
Don't use <em class="emphasis">tput init</EM
> unless <em class="emphasis">tput reset</EM
> doesn't fix things:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>tput reset</B
></CODE
>
% <code class="userinput"><b>tput init</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">If you're using a <em class="emphasis">termcap</EM
> system, there's no command quite like
those two.
You can simulate them by making an
<span class="link">alias (<a class="linkend" href="ch10_02.htm" webstripperlinkwas="ch10_02.htm" title="Aliases for Common Commands ">10.2</A
>)</SPAN
>
that runs the
<span class="link"><em class="emphasis">tset</EM
> (<a class="linkend" href="ch05_04.htm" webstripperlinkwas="ch05_04.htm" title="Setting the TERMCAP Variable with tset ">5.4</A
>)</SPAN
>
command from your login setup files.
(Why not do it now, for the next time you get into this mess?)
Here's a simple alias:</P
><p class="para"><blockquote class="screen"><pre class="screen">alias newterm 'set noglob; eval `tset -srQ \!*`; unset noglob'</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-46835"></A
>The <em class="emphasis">tset</EM
> command usually sends resetting or initialization commands
to your terminal.</P
></LI
><li class="listitem"><p class="para">If every character you type shows up on a different line,
characters don't appear as you type them,
a 
RETURN
does nothing or prints a <code class="literal">^M</CODE
> on your screen,
the backspace, interrupt, and kill keys don't work, or lines</P
><p class="para"><blockquote class="screen"><pre class="screen">jump down
          the screen
                     like this</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-46844"></A
>you've probably got trouble with the settings of your port
(UNIX terminal device).
One of the following commands can make your terminal usable.
It might not be set up the way you're used to, but at least you'll 
be able to log out and log in again:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>reset</B
></CODE
>
% <code class="userinput"><b><kbd class="keycap">[CTRL-j]</KBD
> reset <kbd class="keycap">[CTRL-j]</KBD
></B
></CODE
>
% <code class="userinput"><b>stty sane</B
></CODE
>
% <code class="userinput"><b> <kbd class="keycap">[CTRL-j]</KBD
> stty sane <kbd class="keycap">[CTRL-j]</KBD
></B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-46858"></A
>(If your terminal has a <kbd class="keycap">[LINEFEED]</KBD
> key, you can use it instead of
<kbd class="keycap">[CTRL-j]</KBD
>.)</P
><p class="para">If the system says that those commands don't exist or are an &quot;unknown mode,&quot;
you should make yourself an
<span class="link">alias (<a class="linkend" href="ch10_02.htm" webstripperlinkwas="ch10_02.htm" title="Aliases for Common Commands ">10.2</A
>)</SPAN
>,
<span class="link">shell function (<a class="linkend" href="ch10_09.htm" webstripperlinkwas="ch10_09.htm" title="Shell Functions ">10.9</A
>)</SPAN
>,
or
<span class="link">shell script (<a class="linkend" href="ch44_02.htm" webstripperlinkwas="ch44_02.htm" title="Writing a Simple Shell Program ">44.2</A
>)</SPAN
>
that executes an <em class="emphasis">stty</EM
> command similar to the one below.
The exact parameters you use will depend on your normal UNIX setup:</P
><p class="para"><blockquote class="screen"><pre class="screen">stty echo -nl -cbreak</PRE
></BLOCKQUOTE
></P
><p class="para">Call it something like <em class="emphasis">sane</EM
>.
You may need to execute it by typing
LINEFEED
or
CTRL-j
before and
after.</P
><p class="para">If that doesn't work perfectly, here's what to do.
The next time you log in and your screen works just right,
typing <em class="emphasis">stty&nbsp;everything</EM
> or <em class="emphasis">stty -g</EM
> (see below) should
help you decide exactly what parameters to use in your <em class="emphasis">sane</EM
>
command.</P
></LI
><li class="listitem"><p class="para">If the system seems to treat every character you
type as a separate command (and you may not be able to see the
characters you type):</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>reset</B
></CODE
>
r: Command not found.
: No previous regular expression
: No current filename
: No lines in the buffer<code class="userinput"><b>q</B
></CODE
>
%</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-46882"></A
>
(It actually doesn't look quite like that, but the first <code class="userinput"><b>e</B
></CODE
> started
the editor named <em class="emphasis">e</EM
>.
The <code class="userinput"><b>s</B
></CODE
>, <code class="userinput"><b>e</B
></CODE
>, and <code class="userinput"><b>t</B
></CODE
> are all read as commands by
<em class="emphasis">e</EM
>.
You have to quit <em class="emphasis">e</EM
> by typing its <code class="literal">q</CODE
> command.
Sheesh!)</P
><p class="para">You should make a shell function or alias&nbsp;- or, put a
<span class="link">symbolic link (<a class="linkend" href="ch18_04.htm" webstripperlinkwas="ch18_04.htm" title="More About Links ">18.4</A
>)</SPAN
>
or
shell script in your
<span class="link"><em class="emphasis">bin</EM
> directory (<a class="linkend" href="ch04_02.htm" webstripperlinkwas="ch04_02.htm" title="A bin Directory for Your Programs and Scripts ">4.2</A
>)</SPAN
>-
that
lets you run the command from
the previous step (<em class="emphasis">reset</EM
>, <em class="emphasis">stty&nbsp;sane</EM
>, etc.) by typing a single
character.
I picked <code class="literal">]</CODE
> (right square bracket) as the name of mine.
To make mine, I made a symlink in my <em class="emphasis">bin</EM
>:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>ln -s /usr/ucb/reset ]</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">(Your system's <em class="emphasis">reset</EM
> command may have a different pathname.)
Now, to fix a goofed-up terminal, I just type a <code class="literal">]</CODE
> at a shell prompt
(it may need a
LINEFEED
or
CTRL-j
before and after).</P
></LI
><li class="listitem"><p class="para"><a class="indexterm" name="AUTOID-46909"></A
><a class="indexterm" name="AUTOID-46912"></A
>Best of all, if your system has the command <em class="emphasis">stty -g</EM
>, you can use it to
save your favorite terminal settings in a file.
Then, when your terminal is goofed up, read those settings in again from
the file.
Here's how.
First, when your terminal is working just the way you want it, type:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>stty -g &gt;$HOME/.stty</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">Then make your alias, shell script, or shell function named <em class="emphasis">sane</EM
>,
<code class="replaceable"><i>]</I
></CODE
>, etc. (previously explained) that runs the command:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>stty `cat $HOME/.stty`</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">This should restore your terminal the way it was when you first
ran the <em class="emphasis">stty -g</EM
> command.</P
><p class="para">If your system doesn't have <em class="emphasis">stty -g</EM
>, you can fake it.
Run the command <em class="emphasis">stty&nbsp;everything</EM
>
or <em class="emphasis">stty -a</EM
> and look at the settings:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>stty everything</B
></CODE
>
speed 38400 baud, 0 rows, 0 columns
parenb -parodd cs7 -cstopb -hupcl cread -clocal -crtscts
-ignbrk brkint ignpar -parmrk -inpck istrip -inlcr -igncr icrnl -iuclc
ixon -ixany -ixoff imaxbel
isig iexten icanon -xcase echo echoe echok -echonl -noflsh -tostop
echoctl -echoprt echoke
opost -olcuc onlcr -ocrnl -onocr -onlret -ofill -ofdel -tabs
erase  kill  werase rprnt  flush  lnext   susp   intr   quit  stop   eof
^?     ^U     ^W     ^R     ^O     ^V     ^Z/^Y  ^C     ^\   ^S/^Q  ^D</PRE
></BLOCKQUOTE
></P
><p class="para">Then check your <em class="emphasis">stty</EM
> manual page and read about those settings
(some of them, like the parity settings, might not be appropriate for all
your login sessions).
Put the settings in your <em class="emphasis">sane</EM
> or <code class="replaceable"><i>]</I
></CODE
> command:</P
><p class="para"><blockquote class="screen"><pre class="screen">stty icanon echo erase '^?' kill '^u' ...</PRE
></BLOCKQUOTE
></P
><p class="para">Note that if you use several different terminals, each may have different
settings.
Make yourself several <em class="emphasis">sane</EM
> commands; you might
<span class="link">select one automatically as you log in (<a class="linkend" href="ch02_12.htm" webstripperlinkwas="ch02_12.htm" title="Automatic Setups for Different Terminals ">2.12</A
>)</SPAN
>.</P
></LI
></UL
><p class="para">If worse comes to worst, try the steps from article
<a class="xref" href="ch42_02.htm" webstripperlinkwas="ch42_02.htm" title="Fixing a Hung Terminal or Job ">42.2</A
>.
Find another place to log in to your account.
Run <em class="emphasis">ps</EM
> to find your processes on the hung-up terminal or window
and kill them.
Then turn off the terminal or close the window and log in again.
(If you didn't have a way to kill the processes before you logged in
again, be sure to kill your old processes right away after you log in.)</P
><div class="sect1info"><p class="SECT1INFO">- <span class="authorinitials">JP</SPAN
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch42_03.htm" webstripperlinkwas="ch42_03.htm" title="42.3 Why Changing TERM Sometimes Doesn't Work "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 42.3 Why Changing TERM Sometimes Doesn't Work " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" title="UNIX Power Tools"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="UNIX Power Tools" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch42_05.htm" webstripperlinkwas="ch42_05.htm" title="42.5 Checklist: Screen Size Messed Up? "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 42.5 Checklist: Screen Size Messed Up? " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">42.3 Why Changing TERM Sometimes Doesn't Work </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">42.5 Checklist: Screen Size Messed Up? </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.htm" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
