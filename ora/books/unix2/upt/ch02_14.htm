<html><head><title>[Chapter 2] 2.14 motd.diff: Show New Lines in Login Messages</TITLE
><meta name="DC.title" content="UNIX Power Tools"><meta name="DC.creator" content="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-08-04T21:32:18Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-260-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch02_01.htm" webstripperlinkwas="ch02_01.htm" title="2. Logging In"><link rel="prev" href="ch02_13.htm" webstripperlinkwas="ch02_13.htm" title="2.13 A .cshrc.$HOST File for Per Host Setup "><link rel="next" href="ch02_15.htm" webstripperlinkwas="ch02_15.htm" title="2.15 Unclutter Logins: Show Login Messages Just Once "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="UNIX Power Tools" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,58" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch02_13.htm" webstripperlinkwas="ch02_13.htm" title="2.13 A .cshrc.$HOST File for Per Host Setup "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 2.13 A .cshrc.$HOST File for Per Host Setup " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 2<br>Logging In</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch02_15.htm" webstripperlinkwas="ch02_15.htm" title="2.15 Unclutter Logins: Show Login Messages Just Once "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 2.15 Unclutter Logins: Show Login Messages Just Once " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="UPT-ART-4400">2.14 motd.diff: Show New Lines in Login Messages</A
></H2
><p class="para"><a class="indexterm" name="AUTOID-3666"></A
><a class="indexterm" name="AUTOID-3668"></A
><a class="indexterm" name="AUTOID-3670"></A
>One UNIX system I worked on had a really lonnnnnnnng login message
that scrolled across my screen.
It had a lot of old stuff that I'd seen for the last three weeks.
For a while, I started ignoring it.
But I knew that some day the system manager would put a shutdown
notice in there that I wouldn't see...</P
><p class="para">This script solved the problem.
I run it from my <em class="emphasis">.login</EM
> file.
Each time I log in,
the script compares the current <em class="emphasis">/etc/motd</EM
> file to the one on my previous
login.
If lines were added, I see them; the script pauses to give me time to read:</P
><p class="para"><blockquote class="screen"><pre class="screen">login: <code class="userinput"><b>jpeek</B
></CODE
>
Password:

Additions to system message-of-the-day:
===== 9/5/91 =====
The system will be down for maintenance from 9 to 11 tonight.
Hit RETURN to continue:</PRE
></BLOCKQUOTE
></P
><p class="para">If there are no new lines, my login is nice and quiet.</P
><table class="para.programreference" border="1"><tr><th valign="TOP"><a class="programreference" href="examples/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/examples/index.htm" title="motd.diff">motd.diff</A
><br></TH
><td valign="TOP">This works best on systems that look for a file named <em class="emphasis">.hushlogin</EM
> 
in your home directory and don't print login messages if the file exists.
[2]

Install the program from the CD-ROM,
then add the command <em class="emphasis">motd.diff</EM
>
on a line in your <em class="emphasis">.login</EM
> or <em class="emphasis">.profile</EM
>.</TD
></TR
></TABLE
><blockquote class="footnote"><p class="para">[2] That also shuts off the message <code class="literal">You have mail</CODE
>.
But I <em class="emphasis">always</EM
> have mail, so I don't need that.&nbsp;<code class="literal">:-)</CODE
>
If you do, and you use a command like Berkeley <em class="emphasis">mail</EM
> or <em class="emphasis">mailx</EM
>,
add this line to your <em class="emphasis">.login</EM
> file:</P
><p class="para"><blockquote class="screen"><pre class="screen">if { mail -e } echo You have mail.</PRE
></BLOCKQUOTE
></P
><p class="para">Those <span class="link">curly brace (<code class="literal">{}</CODE
>) operators (<a class="linkend" href="ch47_04.htm" webstripperlinkwas="ch47_04.htm" title="C Shell Variable Operators and Expressions ">47.4</A
>)</SPAN
>
work with the
<span class="link"><em class="emphasis">if</EM
> (<a class="linkend" href="ch47_03.htm" webstripperlinkwas="ch47_03.htm" title="Conditional Statements with if ">47.3</A
>)</SPAN
>,
to test the
<span class="link">exit status (<a class="linkend" href="ch44_07.htm" webstripperlinkwas="ch44_07.htm" title="Exit Status of UNIX Processes ">44.7</A
>)</SPAN
>
of
<em class="emphasis">mail -e</EM
>.
If <em class="emphasis">mail -e</EM
> returns zero (&quot;success&quot;),
<span class="link"><em class="emphasis">echo</EM
> (<a class="linkend" href="ch08_06.htm" webstripperlinkwas="ch08_06.htm" title="Output Command-Line Arguments ">8.6</A
>)</SPAN
>
prints <code class="literal">You</CODE
>&nbsp;<code class="literal">have</CODE
>&nbsp;<code class="literal">mail.</CODE
></P
></BLOCKQUOTE
><p class="para"><a class="indexterm" name="AUTOID-3710"></A
><em class="emphasis">motd.diff</EM
> uses
<span class="link"><em class="emphasis">diff</EM
> (<a class="linkend" href="ch28_01.htm" webstripperlinkwas="ch28_01.htm#UPT-ART-2680" title="Checking Differences with diff ">28.1</A
>)</SPAN
>
to compare the system's current <em class="emphasis">motd</EM
> to the <em class="emphasis">motd</EM
> at your last
login on that host (stored in a file named <em class="emphasis">.last.motd.</EM
><code class="userinput"><b>hostname</B
></CODE
>
in your home directory).
The script finds whether lines have been added by <em class="emphasis">grep</EM
>ping for the
character <code class="literal">&gt;</CODE
> at the start of each line of <em class="emphasis">diff</EM
> output:</P
><p class="para"><blockquote class="screen"><pre class="screen">diff $lastmotd /etc/motd &gt; $temp
   ...
if grep &quot;^&gt;&quot; $temp &gt;/dev/null    # diff USES &gt; TO MARK NEW LINES
then
   <i class="lineannotation">...show lines...</I
></PRE
></BLOCKQUOTE
></P
><p class="para">The<a class="indexterm" name="AUTOID-3726"></A
>
<span class="link"><em class="emphasis">comm</EM
> (<a class="linkend" href="ch28_12.htm" webstripperlinkwas="ch28_12.htm" title="Comparing Two Files with comm ">28.12</A
>)</SPAN
>
command also shows lines that have been added to a file.  But
<em class="emphasis">comm</EM
> only handles sorted files; this trick works on unsorted
files. The
<span class="link"><code class="literal">if</CODE
> (<a class="linkend" href="ch44_08.htm" webstripperlinkwas="ch44_08.htm" title="Test Exit Status with the if Statement ">44.8</A
>)</SPAN
>
tests <em class="emphasis">grep</EM
>'s
<span class="link">exit status (<a class="linkend" href="ch44_07.htm" webstripperlinkwas="ch44_07.htm" title="Exit Status of UNIX Processes ">44.7</A
>)</SPAN
>

(<em class="emphasis">grep</EM
> returns a zero status when it finds matching lines).
<em class="emphasis">grep</EM
>'s output is &quot;thrown away&quot; into
<span class="link"><em class="emphasis">/dev/null</EM
> (<a class="linkend" href="ch13_14.htm" webstripperlinkwas="ch13_14.htm" title="What Can You Do with an Empty File? ">13.14</A
>)</SPAN
>-
some versions of grep have a <em class="emphasis">-s</EM
> (&quot;silent&quot;) option to do the same
thing.</P
><p class="para">This script is designed to work on networked filesystems where my same
home directory is mounted on more than one computer.
If your home directory isn't shared between computers, or if all systems
have the same system messages, you can edit the script to delete the
<em class="emphasis">hostname</EM
> variable and command.</P
><div class="sect1info"><p class="SECT1INFO">- <span class="authorinitials">JP</SPAN
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch02_13.htm" webstripperlinkwas="ch02_13.htm" title="2.13 A .cshrc.$HOST File for Per Host Setup "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 2.13 A .cshrc.$HOST File for Per Host Setup " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" title="UNIX Power Tools"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="UNIX Power Tools" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch02_15.htm" webstripperlinkwas="ch02_15.htm" title="2.15 Unclutter Logins: Show Login Messages Just Once "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 2.15 Unclutter Logins: Show Login Messages Just Once " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">2.13 A .cshrc.$HOST File for Per Host Setup </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">2.15 Unclutter Logins: Show Login Messages Just Once </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
