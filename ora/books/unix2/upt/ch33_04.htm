<html><head><title>[Chapter 33] 33.4 Useful ex Commands </TITLE
><meta name="DC.title" content="UNIX Power Tools"><meta name="DC.creator" content="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-08-04T21:46:48Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-260-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch33_01.htm" webstripperlinkwas="ch33_01.htm" title="33. Batch Editing"><link rel="prev" href="ch33_03.htm" webstripperlinkwas="ch33_03.htm" title="33.3 Line Addressing "><link rel="next" href="ch33_05.htm" webstripperlinkwas="ch33_05.htm" title="33.5 Running Editing Scripts Within vi "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="UNIX Power Tools" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,58" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch33_03.htm" webstripperlinkwas="ch33_03.htm" title="33.3 Line Addressing "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 33.3 Line Addressing " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 33<br>Batch Editing</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch33_05.htm" webstripperlinkwas="ch33_05.htm" title="33.5 Running Editing Scripts Within vi "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 33.5 Running Editing Scripts Within vi " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="UPT-ART-7997">33.4 Useful ex Commands </A
></H2
><p class="para">Many line editor commands are not particularly useful in scripts.<a class="indexterm" name="UPT-ART-7997-IX-EX-EDITOR-COMMAND-DESCRIPTIONS"></A
><a class="indexterm" name="UPT-ART-7997-IX-COMMANDS-EX-EDITOR"></A
>
The two commands that you will use far and away the most often are
<b class="emphasis.bold">s</B
> (substitute), to replace one pattern with another, and
<b class="emphasis.bold">d</B
> (delete) to delete one or more lines. On occasion, though,
you'll want to insert text from a script. 
(<span class="link">Editing scripts built
by <em class="emphasis">diff</EM
> (<a class="linkend" href="ch28_09.htm" webstripperlinkwas="ch28_09.htm" title="ex Scripts Built by diff ">28.9</A
>)</SPAN
>
make heavy use of insert,
append, delete, and change commands.)  And of course, you need
commands to write and quit the editor.</P
><p class="para">Here's the syntax of most of the commands you may encounter in
<em class="emphasis">ex</EM
> editing scripts.
(The <em class="emphasis">ed</EM
> editor understands the abbreviated versions of some,
but not all of, these commands.)
Elements in [brackets] are optional; don't type the <code class="literal">[</CODE
> or <code class="literal">]</CODE
>.
(The leading colon is the <em class="emphasis">ex</EM
> command character
used to issue an <em class="emphasis">ex</EM
> command
from <em class="emphasis">vi</EM
>; in a script, the colon would be omitted.)</P
><dl class="variablelist"><dt class="term"><b class="emphasis.bold">append</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">a</B
>[<b class="emphasis.bold">!</B
>]
<em class="emphasis">text</EM
>
<code class="userinput"><b>\.</B
></CODE
><a class="indexterm" name="AUTOID-36495"></A
>
Append <em class="emphasis">text</EM
> at specified <em class="emphasis">address</EM
>, or at present address if
none is specified. Add a <b class="emphasis.bold">!</B
> to switch the <b class="emphasis.bold">autoindent</B
>
setting that will be used during input. For example, if <b class="emphasis.bold">autoindent</B
>
was enabled, <b class="emphasis.bold">!</B
> disables it.</P
></DD
><dt class="term"><b class="emphasis.bold">change</B
></DT
><dd class="listitem"><p class="para">[address]  <b class="emphasis.bold">c</B
>[<b class="emphasis.bold">!</B
>]
<em class="emphasis">text</EM
>
<code class="userinput"><b>\.</B
></CODE
>
Replace the specified lines with <em class="emphasis">text</EM
>. Add a <b class="emphasis.bold">!</B
> to switch<a class="indexterm" name="AUTOID-36514"></A
>
the <b class="emphasis.bold">autoindent</B
> setting during input of <em class="emphasis">text</EM
>.</P
></DD
><dt class="term"><b class="emphasis.bold">copy</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">co</B
> destination
[address] <b class="emphasis.bold">t</B
> destination
Copy the lines included in <em class="emphasis">address</EM
> to the specified
<em class="emphasis">destination</EM
> address.<a class="indexterm" name="AUTOID-36527"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">:1,10 co 50
:1,10t50</PRE
></BLOCKQUOTE
></P
><p class="para"></P
></DD
><dt class="term"><b class="emphasis.bold">delete</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">d</B
> [buffer]

Delete the lines included in <em class="emphasis">address</EM
>.<a class="indexterm" name="AUTOID-36539"></A
>
If <em class="emphasis">buffer</EM
> is specified, save or append the text to the named buffer.</P
><p class="para"><blockquote class="screen"><pre class="screen">:/Part I/,/Part II/-1d   <em class="emphasis">Delete to line above &quot;Part II&quot;</EM
>
:/main/+d   <em class="emphasis">Delete line below &quot;main&quot;</EM
>
:.,$/d   <em class="emphasis">Delete from this line to last line</EM
></PRE
></BLOCKQUOTE
>&#13;</P
></DD
><dt class="term"><b class="emphasis.bold">global</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">g</B
>[<b class="emphasis.bold">!</B
>]<b class="emphasis.bold">/</B
><em class="emphasis">pattern</EM
><b class="emphasis.bold">/</B
>[<em class="emphasis">commands</EM
>]

Execute <em class="emphasis">commands</EM
> on all lines that contain <em class="emphasis">pattern</EM
> or, if<a class="indexterm" name="AUTOID-36560"></A
>
<em class="emphasis">address</EM
> is specified, on all lines within that range.
If <em class="emphasis">commands</EM
> are not specified, print all such lines.
(Exception: doesn't print when you use it from <em class="emphasis">vi</EM
> by typing
<code class="literal">:</CODE
> first. You'll need to add a <em class="emphasis">p</EM
>, as in the second example below).
If <b class="emphasis.bold">!</B
> is used, execute <em class="emphasis">commands</EM
> on all lines that <em class="emphasis">don't</EM
>
contain <em class="emphasis">pattern</EM
>.</P
><p class="para"><blockquote class="screen"><pre class="screen">:g/Unix/
:g/Unix/p
:g/Name:/s/tom/Tom/</PRE
></BLOCKQUOTE
></P
><p class="para"></P
></DD
><dt class="term"><b class="emphasis.bold">insert</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">i</B
>[<b class="emphasis.bold">!</B
>]

<em class="emphasis">text</EM
>

<code class="userinput"><b>\.</B
></CODE
>

Insert <em class="emphasis">text</EM
> at line before the specified <em class="emphasis">address</EM
>, or at present<a class="indexterm" name="AUTOID-36585"></A
>
address if none is specified. Add a <b class="emphasis.bold">!</B
> to switch the
<b class="emphasis.bold">autoindent</B
> setting during input of <em class="emphasis">text</EM
>.&#13;</P
></DD
><dt class="term"><b class="emphasis.bold">move</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">m</B
> destination

Move the lines specified by <em class="emphasis">address</EM
> to the <em class="emphasis">destination</EM
> address.</P
><p class="para"><blockquote class="screen"><pre class="screen">:.,/Note/m /END/          <em class="emphasis">Move block after line containing &quot;END&quot;</EM
></PRE
></BLOCKQUOTE
></P
><p class="para"></P
></DD
><dt class="term"><b class="emphasis.bold">print</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">p</B
> [count]

Print the lines specified by <em class="emphasis">address</EM
>.<a class="indexterm" name="AUTOID-36609"></A
>
<em class="emphasis">count</EM
> specifies the number of lines to print, starting with <em class="emphasis">address</EM
>.</P
><p class="para"><blockquote class="screen"><pre class="screen">:100;+5p                  <em class="emphasis">Show line 100 and the next five lines</EM
></PRE
></BLOCKQUOTE
></P
><p class="para"></P
></DD
><dt class="term"><b class="emphasis.bold">quit</B
></DT
><dd class="listitem"><p class="para"><b class="emphasis.bold">q</B
>[<b class="emphasis.bold">!</B
>]

Terminate current editing session. Use <b class="emphasis.bold">!</B
> to discard changes made<a class="indexterm" name="AUTOID-36625"></A
>
since the last save. If the editing session includes additional files
in the argument list that were never accessed, quit by typing
<b class="emphasis.bold">q!</B
> or by typing <b class="emphasis.bold">q</B
> twice.&#13;</P
></DD
><dt class="term"><b class="emphasis.bold">read</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">r</B
> <em class="emphasis">file</EM
>

Copy in the text from <em class="emphasis">file</EM
> on the line below the specified<a class="indexterm" name="AUTOID-36637"></A
>
<em class="emphasis">address</EM
>. If <em class="emphasis">file</EM
> is not specified, the current filename
is used.</P
><p class="para"><blockquote class="screen"><pre class="screen">:0r $HOME/data   <em class="emphasis">Read file in at top of current file</EM
></PRE
></BLOCKQUOTE
></P
><p class="para"></P
></DD
><dt class="term"><b class="emphasis.bold">read</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">r</B
>  <b class="emphasis.bold">!</B
><em class="emphasis">command</EM
>

Read the output of UNIX <em class="emphasis">command</EM
> into the text after the line
specified by <em class="emphasis">address</EM
>.</P
><p class="para"><table class="screen.co" border="1"><tr><th valign="TOP"><pre class="calloutlist">
<a class="co" href="ch48_06.htm" webstripperlinkwas="ch48_06.htm" title="48.6 Get Calendar for Any Month or Year: cal ">cal</A
> </PRE
></TH
><td valign="TOP"><pre class="screen">
:$r !cal   <em class="emphasis">Place a calendar at end of file</EM
></PRE
></TD
></TR
></TABLE
>&#13;</P
></DD
><dt class="term"><b class="emphasis.bold">source</B
></DT
><dd class="listitem"><p class="para"><b class="emphasis.bold">so</B
> file

Read and execute <em class="emphasis">ex</EM
> commands from <em class="emphasis">file</EM
>.<a class="indexterm" name="AUTOID-36667"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">:so $HOME/.exrc</PRE
></BLOCKQUOTE
></P
></DD
><dt class="term"><b class="emphasis.bold">substitute</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">s</B
> [<b class="emphasis.bold">/</B
><em class="emphasis">pattern</EM
><b class="emphasis.bold">/</B
><em class="emphasis">replacement</EM
><b class="emphasis.bold">/</B
>] [<em class="emphasis">options</EM
>] [<em class="emphasis">count</EM
>]

Replace first instance of <em class="emphasis">pattern</EM
> on each of the specified lines with<a class="indexterm" name="AUTOID-36685"></A
>
<em class="emphasis">replacement</EM
>.
If <em class="emphasis">pattern</EM
> and <em class="emphasis">replacement</EM
> are omitted, repeat last substitution.
<em class="emphasis">count</EM
> specifies the number of lines on which to substitute, starting
with <em class="emphasis">address</EM
>.

<em class="emphasis">Options</EM
></P
></DD
><dt class="term">&nbsp;&nbsp;&nbsp;<b class="emphasis.bold">c</B
></DT
><dd class="listitem"><p class="para">Prompt for confirmation before each change.</P
></DD
><dt class="term">&nbsp;&nbsp;&nbsp;<b class="emphasis.bold">g</B
></DT
><dd class="listitem"><p class="para">Substitute all instances of <em class="emphasis">pattern</EM
> on each line.</P
></DD
><dt class="term">&nbsp;&nbsp;&nbsp;<b class="emphasis.bold">p</B
></DT
><dd class="listitem"><p class="para">Print the last line on which a substitution was made.</P
><p class="para"><table class="screen.co" border="1"><tr><th valign="TOP"><pre class="calloutlist">
&#13;<a class="co" href="ch30_10.htm" webstripperlinkwas="ch30_10.htm" title="30.10 Confirming Substitutions in ex and vi">c</A
> 
<a class="co" href="ch30_15.htm" webstripperlinkwas="ch30_15.htm" title="30.15 Useful Global Commands (with Pattern Matches) ">\U</A
> </PRE
></TH
><td valign="TOP"><pre class="screen">
:1,10s/yes/no/g      <em class="emphasis">Substitute on first 10 lines</EM
>
:%s/[Hh]ello/Hi/gc   <em class="emphasis">Confirm global substitutions</EM
>
:s/Fortran/\U&amp;/ 3    <em class="emphasis">Uppercase &quot;Fortran&quot; on next 3 lines</EM
></PRE
></TD
></TR
></TABLE
></P
></DD
><dt class="term"><b class="emphasis.bold">write</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">w</B
>[<b class="emphasis.bold">!</B
>] [[<b class="emphasis.bold">&gt;&gt;</B
>] <em class="emphasis">file</EM
>]

Write lines specified by <em class="emphasis">address</EM
> to <em class="emphasis">file</EM
>,<a class="indexterm" name="AUTOID-36727"></A
>
or write full contents of buffer if <em class="emphasis">address</EM
> is not specified.
If <em class="emphasis">file</EM
> is also omitted, save the contents of the buffer
to the current filename.
If <b class="emphasis.bold">&gt;&gt; </B
><em class="emphasis">file</EM
> is used, write contents to the end of an existing
<em class="emphasis">file</EM
>. The <b class="emphasis.bold">!</B
> flag forces the editor to write over any current
contents of <em class="emphasis">file</EM
>.</P
><p class="para"><blockquote class="screen"><pre class="screen">:1,10w name_list   <em class="emphasis">Copy first 10 lines to</EM
> name_list
:50w &gt;&gt; name_list   <em class="emphasis">Now append line 50</EM
></PRE
></BLOCKQUOTE
></P
></DD
><dt class="term"><b class="emphasis.bold">write</B
></DT
><dd class="listitem"><p class="para">[address] <b class="emphasis.bold">w</B
>  <b class="emphasis.bold">!</B
><em class="emphasis">command</EM
>

Write lines specified by <em class="emphasis">address</EM
>, or write full contents of buffer
if <em class="emphasis">address</EM
> is not specified, to the
<span class="link">standard input (<a class="linkend" href="ch13_01.htm" webstripperlinkwas="ch13_01.htm#UPT-ART-1023" title="Using Standard Input and Output">13.1</A
>)</SPAN
>
of <em class="emphasis">command</EM
>.</P
><p class="para"><blockquote class="screen"><pre class="screen">:1,10w !spell   <em class="emphasis">Send first 10 lines to the </EM
>spell<em class="emphasis"> command</EM
>
:w !lpr   <em class="emphasis">Print entire buffer with </EM
>lpr<em class="emphasis"> command</EM
></PRE
></BLOCKQUOTE
></P
></DD
></DL
><a class="indexterm" name="AUTOID-36758"></A
><a class="indexterm" name="AUTOID-36759"></A
><a class="indexterm" name="AUTOID-36760"></A
><a class="indexterm" name="AUTOID-36761"></A
><div class="sect1info"><p class="SECT1INFO">- <span class="authorinitials">TOR</SPAN
>, <span class="authorinitials">DG</SPAN
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch33_03.htm" webstripperlinkwas="ch33_03.htm" title="33.3 Line Addressing "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 33.3 Line Addressing " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" title="UNIX Power Tools"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="UNIX Power Tools" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch33_05.htm" webstripperlinkwas="ch33_05.htm" title="33.5 Running Editing Scripts Within vi "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 33.5 Running Editing Scripts Within vi " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">33.3 Line Addressing </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">33.5 Running Editing Scripts Within vi </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
