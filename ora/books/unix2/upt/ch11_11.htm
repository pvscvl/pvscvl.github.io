<html><head><title>[Chapter 11] 11.11 Picking Up Where You Left Off </TITLE
><meta name="DC.title" content="UNIX Power Tools"><meta name="DC.creator" content="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-08-04T21:36:12Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-260-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch11_01.htm" webstripperlinkwas="ch11_01.htm" title="11. The Lessons of History"><link rel="prev" href="ch11_10.htm" webstripperlinkwas="ch11_10.htm" title="11.10 Check Your History First with :p "><link rel="next" href="ch11_12.htm" webstripperlinkwas="ch11_12.htm" title="11.12 Pass History to Another Shell "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="UNIX Power Tools" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,58" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch11_10.htm" webstripperlinkwas="ch11_10.htm" title="11.10 Check Your History First with :p "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 11.10 Check Your History First with :p " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 11<br>The Lessons of History</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch11_12.htm" webstripperlinkwas="ch11_12.htm" title="11.12 Pass History to Another Shell "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 11.12 Pass History to Another Shell " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="UPT-ART-7671">11.11 Picking Up Where You Left Off </A
></H2
><p class="para"><a class="indexterm" name="AUTOID-12958"></A
><a class="indexterm" name="AUTOID-12960"></A
><a class="indexterm" name="AUTOID-12962"></A
>If you want your command history to be remembered even when you log
out, set the C shell's <em class="emphasis">savehist</EM
>
<span class="link">shell variable (<a class="linkend" href="ch06_08.htm" webstripperlinkwas="ch06_08.htm" title="Shell Variables ">6.8</A
>)</SPAN
>
to the number of lines of history you want saved.
The Korn shell and <em class="emphasis">bash</EM
> save history automatically; you don't need
to set a variable.
(If you want to change the number of lines saved by <em class="emphasis">bash</EM
>,
set its <em class="emphasis">HISTFILESIZE</EM
> environment variable.
In the Korn shell, the <em class="emphasis">HISTSIZE</EM
> variable sets the number of commands
available to be recalled in your current shell as well the number saved
for other shells.)</P
><p class="para">When you log out, the specified number of lines from the <em class="emphasis">csh</EM
> history list 
will be saved in a file called<a class="indexterm" name="AUTOID-12972"></A
>
<em class="emphasis">.history</EM
> in your home directory.
<em class="emphasis">bash</EM
> and <em class="emphasis">ksh</EM
> use the filename given in the <em class="emphasis">HISTFILE</EM
>
environment variable; by default, <em class="emphasis">bash</EM
> calls the file
<em class="emphasis">.bash_history</EM
> and <em class="emphasis">ksh</EM
> uses <em class="emphasis">.sh_history</EM
>.</P
><p class="para">On modern windowing systems, this isn't as trivial as it sounds. On
an old-style terminal, people usually started only one main shell, 
so they could set the history-saving variable
in their <em class="emphasis">.login</EM
> or <em class="emphasis">.profile</EM
> file
and have it apply to their login shell.</P
><p class="para">However, under window systems like X or networked filesystems that share
your home directory between several hosts, you have multiple shells
saving into the same history file.
The sections below give some possible fixes.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-7671-SECT-1.1">11.11.1 bash and ksh </A
></H3
><p class="para"><a class="indexterm" name="AUTOID-12989"></A
><a class="indexterm" name="AUTOID-12992"></A
>Here's the basic way to give a separate history file to each Korn shell or
<em class="emphasis">bash</EM
>:
Customize your
<span class="link">setup file (<a class="linkend" href="ch02_02.htm" webstripperlinkwas="ch02_02.htm" title="Shell Setup Files-Which, Where, and Why ">2.2</A
>)</SPAN
>
to set a different <em class="emphasis">HISTFILE</EM
> on each host or each window.
Use names like
<em class="emphasis">$HOME/.sh_history.window</EM
><code class="replaceable"><i>n</I
></CODE
> or
<em class="emphasis">~/.bash_history.</EM
><code class="replaceable"><i>hostname</I
></CODE
>
to match each file to its window or host.
If your setup is always the same each time you log in, that should give
each window and/or host the same history it had on the last invocation.
(There are related tips in articles
<a class="xref" href="ch02_12.htm" webstripperlinkwas="ch02_12.htm" title="Automatic Setups for Different Terminals ">2.12</A
>
and
<a class="xref" href="ch02_13.htm" webstripperlinkwas="ch02_13.htm" title="A .cshrc.$HOST File for Per Host Setup ">2.13</A
>.)</P
><p class="para">If you open random windows, though, you'll have a harder time
automatically matching a history file to a shell the next time you
log in.
Cook up your own scheme.</P
><p class="para">The simplest fix is to use
<span class="link"><code class="literal">$$</CODE
> (<a class="linkend" href="ch08_19.htm" webstripperlinkwas="ch08_19.htm" title='"Special&quot; Characters and Operators '>8.19</A
>)</SPAN
>
-which
will probably expand differently in almost every shell you ever start&nbsp;- as
a unique part of the filename.
Here are two possibilities:</P
><p class="para"><blockquote class="screen"><pre class="screen">HISTFILE=/tmp/sh_hist.$$
HISTFILE=$HOME/.sh_hist.$$</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-13011"></A
>
The first example uses the system's temporary-file directory; article
<a class="xref" href="ch21_03.htm" webstripperlinkwas="ch21_03.htm" title="Unique Names for Temporary Files ">21.3</A
>
explains and shows one way to clean up.
If your system's <em class="emphasis">/tmp</EM
> is cleaned out often, you may be able to
leave your history files there and let the system remove them;
ask the administrator.
Note that the history file may be
<span class="link">world-readable (<a class="linkend" href="ch22_02.htm" webstripperlinkwas="ch22_02.htm" title="Tutorial on File and Directory Permissions ">22.2</A
>)</SPAN
>
if your
<span class="link">umask (<a class="linkend" href="ch22_04.htm" webstripperlinkwas="ch22_04.htm" title="Setting an Exact umask ">22.4</A
>)</SPAN
>
isn't set to protect your files.
If that matters to you, you could make the temporary files in your home
directory (or some protected directory), as in the second example shown earlier.
Article
<a class="xref" href="ch03_04.htm" webstripperlinkwas="ch03_04.htm" title="Automatic File Cleanup ">3.4</A
>
shows a way to delete those files.</P
><p class="para">Two more bits of trivia:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">The Korn shell maintains the history file constantly, adding a new line
to it as soon as you run a command.
This means you share history between all your current shells with the
same <em class="emphasis">HISTFILE</EM
> name,
which can be a benefit or a problem.</P
></LI
><li class="listitem"><p class="para">In <em class="emphasis">bash</EM
>, each shell process keeps its own history list
in memory. History isn't written to the history file (named by
the <em class="emphasis">HISTFILE</EM
> variable in each shell) until the shell exits.</P
><p class="para">You can force a write with the command <em class="emphasis">history -w</EM
>.
In the same way, if you have an existing history file (or, actually, any
file full of command lines), you can read it into your current
<em class="emphasis">bash</EM
> with <em class="emphasis">history -r</EM
>. Article
<a class="xref" href="ch11_12.htm" webstripperlinkwas="ch11_12.htm" title="Pass History to Another Shell ">11.12</A
> has another example.</P
></LI
></UL
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-7671-SECT-1.2">11.11.2 C Shell </A
></H3
><p class="para"><a class="indexterm" name="AUTOID-13035"></A
><a class="indexterm" name="AUTOID-13038"></A
>The C shell has only one possible filename for its automatic history
file: <em class="emphasis">.history</EM
>.
If you set the C shell variable
<em class="emphasis">savehist</EM
> in each of your windows (e.g., by setting it in your
<em class="emphasis">.cshrc</EM
>), they will all try to write <em class="emphasis">.history</EM
> at once,
leading to trouble.
And even if that weren't true, you get the
history from every window or host, which might not be what you want.</P
><p class="para">Of course, you could set <em class="emphasis">savehist</EM
> manually in a single window 
when you thought you might be doing work you might want to pick up
later. But there is another way:
use the C shell's command <em class="emphasis">history -h</EM
> (which prints the history list
without leading numbers, so it can be read back in later) and redirect
the output to a file. Then use <em class="emphasis">source -h</EM
> to read it back into
your history list when you log in.</P
><p class="para">Do you want to automate this?
First, you'll need to choose a system of filenames, like
<em class="emphasis">~/.history.window</EM
><code class="replaceable"><i>n</I
></CODE
> or <em class="emphasis">~/.history.</EM
><code class="replaceable"><i>hostname</I
></CODE
>,
to match each file to its window or host.
If each of your C shells is a
<span class="link">login shell\** (<a class="linkend" href="ch02_08.htm" webstripperlinkwas="ch02_08.htm" title="Identifying Login Shells ">2.8</A
>)</SPAN
>,
[1]
you can run <em class="emphasis">history -h</EM
> from your <em class="emphasis">.logout</EM
> file and
<em class="emphasis">source -h</EM
> from your <em class="emphasis">.login</EM
> file.
For non-login shells, automation is tougher&nbsp;- try this:</P
><blockquote class="footnote"><p class="para">[1] In the
<span class="link">X Window System (<a class="linkend" href="ch01_31.htm" webstripperlinkwas="ch01_31.htm" title="The X Window System ">1.31</A
>)</SPAN
>,
set the <em class="emphasis">xterm&nbsp;-ls</EM
> option
to force a login shell.</P
></BLOCKQUOTE
><ul class="itemizedlist"><li class="listitem"><p class="para">Set the
<span class="link"><em class="emphasis">ignoreeof</EM
> variable (<a class="linkend" href="ch03_05.htm" webstripperlinkwas="ch03_05.htm" title="Stop Accidental C Shell Logouts ">3.5</A
>)</SPAN
>
to force you to leave the shell with an
<span class="link"><em class="emphasis">exit</EM
> (<a class="linkend" href="ch38_04.htm" webstripperlinkwas="ch38_04.htm" title="Subshells ">38.4</A
>)</SPAN
>
command.</P
></LI
><li class="listitem"><p class="para">Set an
<span class="link">alias for <em class="emphasis">exit</EM
> (<a class="linkend" href="ch10_06.htm" webstripperlinkwas="ch10_06.htm" title="Avoiding C Shell Alias Loops ">10.6</A
>)</SPAN
>
that runs <em class="emphasis">history -h</EM
> before exiting.&#13;</P
></LI
><li class="listitem"><p class="para">Run <em class="emphasis">source -h</EM
> from your
<em class="emphasis">.cshrc</EM
> file.
Use a
<span class="link"><code class="literal">$?prompt</CODE
> test (<a class="linkend" href="ch02_09.htm" webstripperlinkwas="ch02_09.htm" title="Speeding Up Your C Shell with set prompt Test ">2.9</A
>)</SPAN
>
to be sure this only runs in interactive shells.</P
></LI
></UL
><p class="para">If you choose to run <em class="emphasis">history -h</EM
> and <em class="emphasis">source -h</EM
> by hand
occasionally, they will allow you the kind of control you need to
<span class="link">write a script (<a class="linkend" href="ch11_12.htm" webstripperlinkwas="ch11_12.htm" title="Pass History to Another Shell ">11.12</A
>)</SPAN
>
that saves and restores only what you want.</P
></DIV
><div class="sect1info"><p class="SECT1INFO">- <span class="authorinitials">JP</SPAN
>, <span class="authorinitials">TOR</SPAN
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch11_10.htm" webstripperlinkwas="ch11_10.htm" title="11.10 Check Your History First with :p "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 11.10 Check Your History First with :p " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" title="UNIX Power Tools"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="UNIX Power Tools" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch11_12.htm" webstripperlinkwas="ch11_12.htm" title="11.12 Pass History to Another Shell "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 11.12 Pass History to Another Shell " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">11.10 Check Your History First with :p </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">11.12 Pass History to Another Shell </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
