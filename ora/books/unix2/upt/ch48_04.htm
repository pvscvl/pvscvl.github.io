<html><head><title>[Chapter 48] 48.4 Automatic Reminders and More: calendar </TITLE
><meta name="DC.title" content="UNIX Power Tools"><meta name="DC.creator" content="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-10-23T15:55:26Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-260-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch48_01.htm" webstripperlinkwas="ch48_01.htm" title="48. Office Automation"><link rel="prev" href="ch48_03.htm" webstripperlinkwas="ch48_03.htm" title="48.3 A Scratchpad on Your Screen "><link rel="next" href="ch48_05.htm" webstripperlinkwas="ch48_05.htm" title="48.5 leave: A Maddening Aid to Quitting on Time "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="UNIX Power Tools" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,58" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch48_03.htm" webstripperlinkwas="ch48_03.htm" title="48.3 A Scratchpad on Your Screen "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 48.3 A Scratchpad on Your Screen " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 48<br>Office Automation</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch48_05.htm" webstripperlinkwas="ch48_05.htm" title="48.5 leave: A Maddening Aid to Quitting on Time "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 48.5 leave: A Maddening Aid to Quitting on Time " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="UPT-ART-3180">48.4 Automatic Reminders and More: calendar </A
></H2
><p class="para"><a class="indexterm" name="UPT-ART-3180-IX-CALENDAR-PROGRAM"></A
><a class="indexterm" name="AUTOID-57714"></A
>If you type the command <em class="emphasis">calendar</EM
>, you'll see lines
with &quot;to-do&quot; items for today and tomorrow from a file named
<em class="emphasis">calendar</EM
> in your current directory.
If you put that file in your home directory, your system administrator 
can run the command <em class="emphasis">calendar</EM
>-to
<span class="link">mail (<a class="linkend" href="ch01_33.htm" webstripperlinkwas="ch01_33.htm" title="UNIX Networking and Communications ">1.33</A
>)</SPAN
>
everyones' &quot;to-do&quot; items to them.
You can also automate your personal calendar setup by running <em class="emphasis">calendar</EM
>
yourself&nbsp;- the calendar can be mailed to you, sent to the printer, and so
on, first thing each morning.
See below for an example <em class="emphasis">calendar</EM
> file and more information.</P
><p class="para"><em class="emphasis">calendar</EM
> builds a complicated
<span class="link"><em class="emphasis">egrep</EM
> (<a class="linkend" href="ch27_05.htm" webstripperlinkwas="ch27_05.htm" title="Extended Searching for Text with egrep ">27.5</A
>)</SPAN
>
expression to search your <em class="emphasis">calendar</EM
> file.
You can see that expression yourself if you want to.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-3180-SECT-1.1">48.4.1 How calendar Works </A
></H3
><p class="para">Let's start by showing a few lines of a sample <em class="emphasis">calendar</EM
> file.
(Yours can be much longer.)
Then I'll run <em class="emphasis">calendar</EM
> to show what lines it picks:</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>cat calendar</B
></CODE
>
-- WORK --
12/28   Project report due tomorrow!
-- PERSONAL --
* 8       rub Lisa's feet
Take Lisa out to dinner on December 8
dec 9     buy Lisa lunch
On 12/10, Lisa will be hungry for ice cream
-- BIRTHDAYS --
1/1 Mom's birthday - make dinner reservations by 12/20!
% <code class="userinput"><b>date</B
></CODE
>
Tue Dec  8 08:43:40 PST 1992
% <code class="userinput"><b>calendar</B
></CODE
>
* 8       rub Lisa's feet
Take Lisa out to dinner on December 8
dec 9     buy Lisa lunch</PRE
></BLOCKQUOTE
></P
><p class="para"><a class="indexterm" name="AUTOID-57739"></A
><a class="indexterm" name="AUTOID-57742"></A
>Today is December&nbsp;8.
The <em class="emphasis">calendar</EM
> utility found lines in my <em class="emphasis">calendar</EM
> file for
today and tomorrow.
<em class="emphasis">calendar</EM
> understands lots of date formats.
The date can be anywhere on a line.
If you leave a line in your file for more than one year (like Mom's
birthday) <em class="emphasis">calendar</EM
> will show it every year.
If a line has more than one date, you'll see the line on both of those
dates (I'll be reminded before Mom's birthday and also in time to make a
dinner reservation).
An asterisk (<code class="literal">*</CODE
>) in place of a month means &quot;all months.&quot;</P
><p class="para">Many versions of <em class="emphasis">calendar</EM
> utility run your <em class="emphasis">calendar</EM
> file
through the C language preprocessor, <em class="emphasis">cpp</EM
>.
Among other things, this lets you include
several calendar files in your own calendar file.
Lines that start with a hash mark (<code class="literal">#</CODE
>) in column 1 are read by the
preprocessor.
For instance, this line in your <em class="emphasis">calendar</EM
> file would include all
the contents of the file <em class="emphasis">/usr/local/lib/office.calendar</EM
>
just as if you'd typed them into your own file:</P
><p class="para"><blockquote class="screen"><pre class="screen">#include &quot;/usr/local/lib/office.calendar&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">&#13;Someone (the office secretary) can maintain the <em class="emphasis">office.calendar</EM
> file.
People in the office who want reminders from it can put the
<code class="literal">#include</CODE
> line in their own <em class="emphasis">calendar</EM
> files.</P
><p class="para">By the way, if you start a line with <code class="literal">#</CODE
> and it's not for the
preprocessor, you'll get a mysterious error like
<code class="literal">calendar:</CODE
> <code class="literal">1:</CODE
> <code class="literal">undefined</CODE
> <code class="literal">control</CODE
>.
That means line 1 of the file had something the preprocessor couldn't
understand.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-3180-SECT-1.2">48.4.2 The egrep Expression calendar Uses </A
></H3
><p class="para">How can <em class="emphasis">calendar</EM
> find dates in all the formats it accepts&nbsp;- and
only for today and tomorrow?
It runs a system program, usually named <em class="emphasis">/usr/lib/calendar</EM
>,
that generates an expression for
<span class="link"><em class="emphasis">egrep -f</EM
> (<a class="linkend" href="ch27_07.htm" webstripperlinkwas="ch27_07.htm" title="grepping for a List of Patterns ">27.7</A
>)</SPAN
>.
The expression searches for the dates of today and tomorrow; if
today is a Friday, the expression includes dates on Saturday, Sunday, and
Monday.
Here's the expression I got by running <em class="emphasis">/usr/lib/calendar</EM
>
on Tuesday, December&nbsp;8.
TAB characters are shown as <code class="literal">T</CODE
>; spaces are shown as <img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">.</P
><p class="para"><blockquote class="screen"><pre class="screen">% <code class="userinput"><b>/usr/lib/calendar</B
></CODE
>
(^|[<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T(,;])((([Dd]ec[^<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T]*|\*)[<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T]*|(012|12|\*)/)0*8)([^0123456789]|$)
(^|[<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T(,;])((([Dd]ec[^<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T]*|\*)[<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T]*|(012|12|\*)/)0*9)([^0123456789]|$)</PRE
></BLOCKQUOTE
></P
><p class="para">I'll turn the first line of that into English.
I'm not writing this just for <em class="emphasis">egrep</EM
> fanatics <code class="literal">:-)</CODE
>; this is
also useful for understanding what kinds of dates <em class="emphasis">calendar</EM
> will
recognize.
I'm going to skip some not-so-subtle things like the nesting of the parentheses
and just give an overview.
If you haven't seen extended regular expressions before, see article
<a class="xref" href="ch26_04.htm" webstripperlinkwas="ch26_04.htm" title="Using Metacharacters in Regular Expressions ">26.4</A
>.
The expression finds lines in your <em class="emphasis">calendar</EM
> file that meet these
conditions, in order from left to right across the line:</P
><dl class="variablelist"><dt class="term"><code class="literal">(^|[<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T(,;])</CODE
></DT
><dd class="listitem"><p class="para">This matches whatever comes before the date.
Match at the beginning of a line (<code class="literal">^</CODE
>) or (<code class="literal">|</CODE
>) match
a space, TAB, opening parenthesis, comma, or semicolon
(<code class="literal">[<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T(,;]</CODE
>).
This keeps <em class="emphasis">egrep</EM
> from matching other words that start with or
contain the month abbreviation <code class="literal">[Dd]ec</CODE
>.</P
></DD
><dt class="term"><code class="literal">((([Dd]ec[^<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T]*|\*)[<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T]*|(012|12|\*)/)0*8)</CODE
></DT
><dd class="listitem"><p class="para">This matches the date.
Match <em class="emphasis">Dec</EM
> or <em class="emphasis">dec</EM
> with zero or more of any character besides
space or TAB after
that (<code class="literal">[Dd]ec[^<img src="../chars/squ.gif" webstripperlinkwas="../chars/squ.gif" alt=" ">T]*</CODE
>)-or (<code class="literal">|</CODE
>) have a literal asterisk
(<code class="literal">\*</CODE
>), which means &quot;match this on any month of the year.&quot;
Or (<code class="literal">|</CODE
>) match a numeric month like <em class="emphasis">012</EM
> or <em class="emphasis">12</EM
> or a literal
asterisk (<code class="literal">(012|12|\*)</CODE
>)-followed by a slash (<code class="literal">/</CODE
>).
Finally, you need today's date: it starts with any number of
zeros and ends with <em class="emphasis">8</EM
> (<code class="literal">)0*8)</CODE
>).</P
></DD
><dt class="term"><code class="literal">([^0123456789]|$)</CODE
></DT
><dd class="listitem"><p class="para">The end of the expression matches lines anything except a
digit&nbsp;- or matches the end of the line.
This keeps <em class="emphasis">egrep</EM
> from matching non-dates like <em class="emphasis">8.75</EM
>.</P
></DD
></DL
><p class="para">Whew.
That expression is repeated for every other day that needs to be matched.
On Fridays, the output of <em class="emphasis">/usr/lib/calendar</EM
> has four lines&nbsp;- one
each for Friday, Saturday, Sunday, and Monday.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-3180-SECT-1.3">48.4.3 Automating Your Own Calendar </A
></H3
><p class="para">If you want a calendar every weekday, put a line like the following into
your
<span class="link">personal <em class="emphasis">crontab</EM
> file (<a class="linkend" href="ch40_12.htm" webstripperlinkwas="ch40_12.htm" title="Periodic Program Execution: The cron Facility ">40.12</A
>)</SPAN
>.
We've split this onto two lines for printing, but you should type it all
on one line:</P
><p class="para"><table class="screen.co" border="1"><tr><th valign="TOP"><pre class="calloutlist">
<a class="co" href="ch06_03.htm" webstripperlinkwas="ch06_03.htm" title="6.3 Predefined Environment Variables ">$USER</A
> 
<a class="co" href="ch44_09.htm" webstripperlinkwas="ch44_09.htm" title="44.9 Testing Your Success ">&amp;&amp;</A
> <a class="co" href="ch13_01.htm" webstripperlinkwas="ch13_01.htm" title="13.1 Using Standard Input and Output">&lt;</A
> </PRE
></TH
><td valign="TOP"><pre class="screen">
<a class="indexterm" name="AUTOID-57831"></A
><a class="indexterm" name="AUTOID-57834"></A
><a class="indexterm" name="AUTOID-57837"></A
>6 6 * * 1-5 tf=/tmp/cal.$USER; umask 077; /bin/calendar &gt; $tf;
    test -s $tf &amp;&amp; mail -s 'Calendar for today' $USER &lt; $tf; rm -f $tf</PRE
></TD
></TR
></TABLE
></P
><p class="para">That runs <em class="emphasis">calendar</EM
> from my home directory at
<span class="link">6:06 a.m. (<a class="linkend" href="ch40_05.htm" webstripperlinkwas="ch40_05.htm" title="Avoiding Other at and cron Jobs ">40.5</A
>)</SPAN
>
every weekday morning.
It sets a
<span class="link">Bourne shell variable (<a class="linkend" href="ch06_08.htm" webstripperlinkwas="ch06_08.htm" title="Shell Variables ">6.8</A
>)</SPAN
>
named <em class="emphasis">tf</EM
> with the name of a temporary file in the
<span class="link"><em class="emphasis">/tmp</EM
> directory (<a class="linkend" href="ch21_03.htm" webstripperlinkwas="ch21_03.htm" title="Unique Names for Temporary Files ">21.3</A
>)</SPAN
>,
and sets a
<span class="link"><em class="emphasis">umask</EM
> (<a class="linkend" href="ch22_04.htm" webstripperlinkwas="ch22_04.htm" title="Setting an Exact umask ">22.4</A
>)</SPAN
>
to make the file private.
Then it runs <em class="emphasis">calendar</EM
> and saves the output in the temporary file.
If there's a calendar for today, the <em class="emphasis">mail</EM
> command sends the file
to me.
(The <em class="emphasis">-s</EM
> option on our <em class="emphasis">mail</EM
> command adds the <code class="literal">Subject:</CODE
>
line <em class="emphasis">Calendar for today</EM
> to the message.
It isn't required.)
Finally, the temporary file is removed.</P
><p class="para"><a class="indexterm" name="AUTOID-57859"></A
><a class="indexterm" name="AUTOID-57862"></A
><a class="indexterm" name="AUTOID-57865"></A
>If you don't have personal <em class="emphasis">crontab</EM
>s, you can use a
<span class="link">self-restarting <em class="emphasis">at</EM
> job (<a class="linkend" href="ch40_08.htm" webstripperlinkwas="ch40_08.htm" title="Automatically Restarting at Jobs ">40.8</A
>)</SPAN
>
and the
<span class="link"><em class="emphasis">nextweekday</EM
> script (<a class="linkend" href="ch40_10.htm" webstripperlinkwas="ch40_10.htm" title="nextday, nextweekday: Tomorrow or Next Weekday ">40.10</A
>)</SPAN
>
instead.<a class="indexterm" name="AUTOID-57873"></A
></P
></DIV
><div class="sect1info"><p class="SECT1INFO">- <span class="authorinitials">JP</SPAN
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch48_03.htm" webstripperlinkwas="ch48_03.htm" title="48.3 A Scratchpad on Your Screen "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 48.3 A Scratchpad on Your Screen " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" title="UNIX Power Tools"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="UNIX Power Tools" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch48_05.htm" webstripperlinkwas="ch48_05.htm" title="48.5 leave: A Maddening Aid to Quitting on Time "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 48.5 leave: A Maddening Aid to Quitting on Time " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">48.3 A Scratchpad on Your Screen </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">48.5 leave: A Maddening Aid to Quitting on Time </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
