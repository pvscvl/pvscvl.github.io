<html><head><title>[Chapter 30] 30.22 Filtering Text Through a UNIX Command </TITLE
><meta name="DC.title" content="UNIX Power Tools"><meta name="DC.creator" content="Jerry Peek, Tim O'Reilly &amp; Mike Loukides"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-08-04T21:45:38Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-260-3" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch30_01.htm" webstripperlinkwas="ch30_01.htm" title="30. vi Tips and Tricks"><link rel="prev" href="ch30_21.htm" webstripperlinkwas="ch30_21.htm" title="30.21 Per File Setups in Separate Files "><link rel="next" href="ch30_23.htm" webstripperlinkwas="ch30_23.htm" title="30.23 Safer vi Filter-Throughs "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="UNIX Power Tools" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,58" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch30_21.htm" webstripperlinkwas="ch30_21.htm" title="30.21 Per File Setups in Separate Files "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 30.21 Per File Setups in Separate Files " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Chapter 30<br>vi Tips and Tricks</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch30_23.htm" webstripperlinkwas="ch30_23.htm" title="30.23 Safer vi Filter-Throughs "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 30.23 Safer vi Filter-Throughs " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="UPT-ART-0139">30.22 Filtering Text Through a UNIX Command </A
></H2
><table class="para.programreference" border="1"><tr><th valign="TOP"><a class="xref.warning" href="ch30_23.htm" webstripperlinkwas="ch30_23.htm" title="30.23 Safer vi Filter-Throughs ">Warning!</A
> </TH
><td valign="TOP">When you're editing in <em class="emphasis">vi</EM
>, you can send a block of text as
standard input to a UNIX command. 
<a class="indexterm" name="AUTOID-33727"></A
><a class="indexterm" name="AUTOID-33730"></A
>
The output from this command replaces the block of text in the buffer.
You can filter text through a command from either <em class="emphasis">ex</EM
> or 
<em class="emphasis">vi</EM
>. The main difference between the two methods is that you indicate 
the block of text with line addresses in <em class="emphasis">ex</EM
> and
with text objects (movement commands) in <em class="emphasis">vi</EM
>.</TD
></TR
></TABLE
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-139-SECT-1.1">30.22.1 Filtering Text with ex </A
></H3
><p class="para">The first example demonstrates how to filter text with <em class="emphasis">ex</EM
>.
Assume that you're editing a file with a list of names and you
want to alphabetize (sort) lines&nbsp;96 through&nbsp;99.
You simply type the addresses of the lines you want to filter, followed
by an exclamation mark
and the UNIX command to be executed.
For example, the command:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="userinput"><b>:96,99!sort</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">will pass lines 96 through 99 through the
<span class="link"><em class="emphasis">sort</EM
> (<a class="linkend" href="ch36_01.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/ch36_01.htm" title="Putting Things in Order ">36.1</A
>)</SPAN
>
filter and replace
those lines with the output of <em class="emphasis">sort</EM
>.</P
><p class="para">The <em class="emphasis">ex</EM
> <code class="literal">%</CODE
> operator is the easiest way to filter all the lines in
your buffer.
If you're editing a C program, for instance, you could feed it all
through the
formatting program named <em class="emphasis">indent</EM
>
by typing:</P
><p class="para"><blockquote class="screen"><pre class="screen">:%!indent</PRE
></BLOCKQUOTE
></P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="UPT-ART-139-SECT-1.2">30.22.2 Filtering Text with vi </A
></H3
><p class="para"><a class="indexterm" name="UPT-ART-139-IX-VI-EDITOR-FILTERING-TEXT"></A
><a class="indexterm" name="UPT-ART-139-IX-FILTERS-VI-EDITOR"></A
>In <em class="emphasis">vi</EM
>, text is filtered through a UNIX command by typing an exclamation mark (<code class="literal">!</CODE
>)
followed by any of <em class="emphasis">vi</EM
>'s movement keystrokes
that indicate a block of text,
and then by the UNIX command line to be executed.
For example:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="userinput"><b>!)</B
></CODE
><code class="replaceable"><i>command</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">will pass the next sentence through <em class="emphasis">command</EM
>.</P
><p class="para">There are a couple of unusual features about how <em class="emphasis">vi</EM
> acts when
you use this structure.</P
><ul class="itemizedlist"><li class="listitem"><p class="para">First, the exclamation mark doesn't appear on your screen right away.  When
you type the keystroke(s) for the text object you want to filter, the
exclamation mark appears at the bottom of the screen, <em class="emphasis">but the
character you type to reference the object does not.</EM
></P
></LI
><li class="listitem"><p class="para">Second, text blocks must be more than one line, so you can use only
the keystrokes that would move more than one line ( <code class="literal">G</CODE
>, <code class="literal">{
}</CODE
>, <code class="literal">( )</CODE
>, <code class="literal">[[ ]]</CODE
>, <code class="literal">+</CODE
>, <code class="literal">-</CODE
>&nbsp;).  To repeat
the effect, a number may precede either the exclamation mark or the
text object.  (For example, both <code class="literal">!10+</CODE
> and <code class="literal">10!+</CODE
> would
indicate the next ten lines.)  Objects such as <code class="literal">w</CODE
> do not work
unless enough of them are specified so as to exceed a single line.
You can also use a slash (<code class="literal">/</CODE
>) followed by a <em class="emphasis">pattern</EM
> and a
carriage return to specify the object.  This takes the text up to the
pattern as input to the command.</P
></LI
><li class="listitem"><p class="para">Third, there is a special text object that can be used only with this command
syntax; you can specify the current line by entering a second
exclamation mark:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="userinput"><b>!!</B
></CODE
><code class="replaceable"><i>command</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">&#13;Remember that either the entire sequence or the text object 
can be preceded by a number to repeat the effect.
For instance, to change lines&nbsp;96 through&nbsp;99 as in the previous example,
you could position the cursor on line&nbsp;96 and enter either:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="userinput"><b>4!!sort</B
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">or:</P
><p class="para"><blockquote class="screen"><pre class="screen"><code class="userinput"><b>!4!sort</B
></CODE
></PRE
></BLOCKQUOTE
></P
></LI
></UL
><p class="para">As another example, assume you have a portion of text in a message that
you're going to send to the
<span class="link">Usenet (<a class="linkend" href="ch01_33.htm" webstripperlinkwas="ch01_33.htm" title="UNIX Networking and Communications ">1.33</A
>)</SPAN
>
&quot;net news.&quot;<a class="indexterm" name="AUTOID-33807"></A
>
On Usenet, text that might be offensive or would give away the answer to
a question is &quot;rotated.&quot;
The letter <em class="emphasis">a</EM
> is changed to <em class="emphasis">n</EM
>, <em class="emphasis">b</EM
> is changed to <em class="emphasis">o</EM
>,
and so on.
There are programs for rotating text,
but it's also easy to rotate text with the<a class="indexterm" name="AUTOID-33813"></A
>
<span class="link"><em class="emphasis">tr</EM
> (<a class="linkend" href="ch35_11.htm" webstripperlinkwas="ch35_11.htm" title="Hacking on Characters with tr ">35.11</A
>)</SPAN
>
command.
In this example, the second sentence is the block of text 
that will be filtered to the command.</P
><table class="informaltable"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1"></TH
><th class="entry" align="LEFT" rowspan="1" colspan="1"><blockquote class="screen"><pre class="screen"> One sentence before.
 <u class="cursor">W</U
>ith a screen editor you can scroll the page
 move the cursor, delete lines, insert characters, 
 and more, while seeing the results of your edits 
 as you make them.
 One sentence after.</PRE
></BLOCKQUOTE
></TH
></TR
><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Keystrokes</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Results</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">!)</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><blockquote class="screen"><pre class="screen"> One sentence after.
 ~
 ~
 ~
 !_</PRE
></BLOCKQUOTE
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">An exclamation mark appears on the last line to prompt you
for the UNIX command.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">tr '[a-z]' '[A-Z]'</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><blockquote class="screen"><pre class="screen"> One sentence before.  
 <u class="cursor">W</U
>ITH A SCREEN EDITOR YOU CAN SCROLL THE PAGE
 MOVE THE CURSOR, DELETE LINES, INSERT CHARACTERS, 
 AND MORE, WHILE SEEING THE RESULTS OF YOUR EDITS 
 AS YOU MAKE THEM.
 One sentence after.</PRE
></BLOCKQUOTE
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"></TD
><td class="entry" rowspan="1" colspan="1"><p class="para">Enter the UNIX command and press RETURN.  
The input is replaced by the output.</P
></TD
></TR
></TBODY
></TABLE
><p class="para">To repeat the previous command, the syntax is:</P
><p class="para"><blockquote class="screen"><pre class="screen">! <em class="emphasis">object</EM
> !</PRE
></BLOCKQUOTE
></P
><p class="para">It is sometimes useful to send sections of a coded document to
<em class="emphasis">nroff</EM
> to be replaced by formatted output.  
Remember that the &quot;original&quot; input is replaced 
by the output.  
Fortunately, if there is a mistake, such as an error 
message being sent instead of the expected output, 
you can undo the command and restore the lines.</P
></DIV
><div class="sect1info"><p class="SECT1INFO">- <span class="authorinitials">TOR</SPAN
> <span class="bibliomisc">from O'Reilly &amp; Associates' <cite class="citetitle">Learning the vi Editor</CITE
>, Chapter 7</SPAN
></P
></DIV
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch30_21.htm" webstripperlinkwas="ch30_21.htm" title="30.21 Per File Setups in Separate Files "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 30.21 Per File Setups in Separate Files " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" title="UNIX Power Tools"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="UNIX Power Tools" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch30_23.htm" webstripperlinkwas="ch30_23.htm" title="30.23 Safer vi Filter-Throughs "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 30.23 Safer vi Filter-Throughs " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">30.21 Per File Setups in Separate Files </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">30.23 Safer vi Filter-Throughs </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
