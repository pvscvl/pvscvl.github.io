<html><head><title>[Appendix C] C.3 Documentation for masterindex</TITLE
><meta name="DC.title" content="sed &amp; awk"><meta name="DC.creator" content="Dale Dougherty &amp; Arnold Robbins"><meta name="DC.publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.date" content="1998-08-03T21:07:11Z"><meta name="DC.type" content="Text.Monograph"><meta name="DC.format" content="text/html" scheme="MIME"><meta name="DC.source" content="1-56592-225-5" scheme="ISBN"><meta name="DC.language" content="en-US"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="appc_01.htm" webstripperlinkwas="appc_01.htm" title="C. Supplement for Chapter 12"><link rel="prev" href="appc_02.htm" webstripperlinkwas="appc_02.htm" title="C.2 Listing of masterindex Shell Script"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="sed &amp; awk" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appc_02.htm" webstripperlinkwas="appc_02.htm" title="C.2 Listing of masterindex Shell Script"><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: C.2 Listing of masterindex Shell Script" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1">Appendix C<br>Supplement for Chapter 12</FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172">&nbsp;</TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="SEDAWK-APP-C-SECT-3">C.3 Documentation for masterindex</A
></H2
><p class="para"><a class="indexterm" name="AUTOID-13388"></A
>This documentation, and the notes that follow, are by Dale Dougherty.</P
><div class="refentry"><div class="refnamediv"><h3 class="refname"><a class="refname" name="AUTOID-13391">C.3.1 masterindex</A
></H3
><p class="refpurpose">indexing program for single and multivolume indexing.</P
></DIV
><blockquote><div class="refsynopsisdiv"><h4>Synopsis</H4
><p class="synopsis"><code>masterindex [-master [volume]]  [-page] [-screen] [filename..]</CODE
></P
></DIV
><div class="refsect1"><h4 class="refsect1"><a class="title" name="AUTOID-13397">Description</A
></H4
><p class="para"><kbd class="command">masterindex</KBD
> generates a formatted index based 
on structured index entries output by <kbd class="command">troff</KBD
>.
Unless you redirect output, it comes to the screen. </P
></DIV
><div class="refsect1"><h4 class="refsect1"><a class="title" name="AUTOID-13402">Options</A
></H4
><p class="para"><i class="option">-m</I
> or <i class="option">-master</I
>
indicates that you are
compiling a multivolume index.  The index entries for each volume
should be in a single file and the filenames should be listed in
sequence.  If the first file is not the first volume, then specify the
volume number as a separate argument.  The volume number is converted
to a roman numeral and prepended to all the page numbers of entries
in that file.</P
><p class="para"><i class="option">-p</I
> or <i class="option">-page</I
> produces a listing of
index entries for each page number.  It can be used to proof the
entries against hardcopy.</P
><p class="para"><i class="option">-s</I
> or <i class="option">-screen</I
> specifies that the
unformatted index will be viewed on the &quot;screen&quot;.  The default is to
prepare output that contains <kbd class="command">troff</KBD
> macros for
formatting.</P
></DIV
><div class="refsect1"><h4 class="refsect1"><a class="title" name="AUTOID-13414">Files</A
></H4
><table class="simplelist"><tr><td class="member"><i class="filename">/work/bin/masterindex</I
></TD
></TR
><tr><td class="member"><i class="filename">/work/bin/page.idx</I
></TD
></TR
><tr><td class="member"><i class="filename">/work/bin/pagenums.idx</I
></TD
></TR
><tr><td class="member"><i class="filename">/work/bin/combine.idx</I
></TD
></TR
><tr><td class="member"><i class="filename">/work/bin/format.idx</I
></TD
></TR
><tr><td class="member"><i class="filename">/work/bin/rotate.idx</I
></TD
></TR
><tr><td class="member"><i class="filename">/work/bin/romanum</I
></TD
></TR
><tr><td class="member"><i class="filename">/work/macros/current/indexmacs</I
></TD
></TR
></TABLE
></DIV
><div class="refsect1"><h4 class="refsect1"><a class="title" name="AUTOID-13433">See Also</A
></H4
><p class="para">Note that these programs require &quot;nawk&quot; (new awk): <kbd class="command">nawk (1),</KBD
> and <kbd class="command">sed (1V)</KBD
>.</P
></DIV
><div class="refsect1"><h4 class="refsect1"><a class="title" name="AUTOID-13438">Bugs</A
></H4
><p class="para">The new index program is modular, invoking a series of smaller programs. 
This should allow me to connect different modules to implement
new features as well as isolate and fix problems more easily.
Index entries should not contain any
<kbd class="command">troff</KBD
> font changes.  The program does not handle them.
Roman numerals greater than eight will not be sorted
properly, thus imposing a limit of an eight-book index.  (The sort
program will sort the roman numerals 1-10 in the following order: I,
II, III, IV, IX, V, VI, VII, VIII, X.)</P
></DIV
></BLOCKQUOTE
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SEDAWK-APP-C-SECT-3.1">C.3.2 Background Details</A
></H3
><p class="para">Tim O'Reilly recommends <cite class="citetitle">The Joy of Cooking</CITE
>
(JofC) index as an ideal index.  I examined the JofC
index quite thoroughly and set out to write a new indexing program
that duplicated its features.  I did not wholly duplicate the
JofC format, but this could be done fairly easily if
desired.  Please look at the JofC index yourself to
examine its features.</P
><p class="para">I also tried to do a few other things to improve on the previous index
program and provide more support for the person coding
the index.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SEDAWK-APP-C-SECT-3.2">C.3.3 Coding Index Entries</A
></H3
><p class="para">This section describes the coding of index entries in the document
file.  We use the .XX macro for placing index entries in a file.  The
simplest case is:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;entry&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">If the entry consists of primary and secondary sort keys, then we can
code it as:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;primary, secondary&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">A comma delimits the two keys.  We also have a .XN macro for
generating &quot;See&quot; references without a page number.  It is specified
as:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XN &quot;entry (See anotherEntry)&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">While these coding forms continue to work as they have,
<kbd class="command">masterindex</KBD
> provides greater flexibility by
allowing three levels of keys: primary, secondary, and tertiary.  You'd
specify the entry like so:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;primary: secondary; tertiary&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">Note that the comma is not used as a delimiter.  A colon delimits the
primary and secondary entry; the semicolon delimits the secondary and
tertiary entry.  This means that commas can be a part of a key using
this syntax.  Don't worry, though, you can continue to use a comma to
delimit the primary and secondary keys.  (Be aware that the first
comma in a line is converted to a colon, if no colon delimiter is
found.)  I'd recommend that new books be coded using the above syntax,
even if you are only specifying a primary and secondary key.</P
><p class="para">Another feature is automatic rotation of primary and secondary keys if
a tilde (~) is used as the delimiter.  So the following entry:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;cat~command&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">is equivalent to the following two entries:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;cat command&quot;
.XX &quot;command: cat&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">You can think of the secondary key as a classification (command,
attribute, function, etc.) of the primary entry.  Be careful not to
reverse the two, as &quot;command cat&quot; does not make much sense.  To use a
tilde in an entry, enter &quot;~~&quot;.</P
><p class="para">I added a new macro, .XB, that is the same as .XX except that the page
number for this index entry will be output in bold to indicate that it
is the most significant page number in a range.  Here is an example:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XB &quot;cat command&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">When <kbd class="command">troff</KBD
> processes the index entries, it outputs
the page number followed by an asterisk.  This is how it appears when
output is seen in screen format.  When coded for
<kbd class="command">troff</KBD
> formatting, the page number is surrounded by
the bold font change escape sequences.  (By the way, in the
JofC index, I noticed that they allowed having the same page
number in roman and in bold.)  Also, this page number will not be
combined in a range of consecutive numbers.</P
><p class="para">One other feature of the JofC index is that the very first
secondary key appears on the same line with the primary key.  The old
index program placed any secondary key on the next line.  The one
advantage of doing it the JofC way is that entries containing
only one secondary key will be output on the same line and look much
better.  Thus, you'd have &quot;line justification, definition of&quot; rather
than having &quot;definition of&quot; indented on the next line.  The next
secondary key would be indented.  Note that if the primary key exists
as a separate entry (it has page numbers associated with it), the page
references for the primary key will be output on the same line and the
first secondary entry will be output on the next line.</P
><p class="para">To reiterate, while the syntax of the three-level entries is
different, this index entry is perfectly valid:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;line justification, definition of&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">It also produces the same result as:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;line justification: definition of&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">(The colon disappears in the output.)  Similarly, you could write an
entry, such as</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;justification, lines, defined&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">or</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;justification: lines, defined&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">where the comma between &quot;lines&quot; and &quot;defined&quot; does not serve as a
delimiter but is part of the secondary key.</P
><p class="para">The previous example could be written as an entry with three levels:</P
><p class="para"><blockquote class="screen"><pre class="screen">.XX &quot;justification: lines; defined&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">where the semicolon delimits the tertiary key.  The semicolon is
output with the key, and multiple tertiary keys may follow immediately
after the secondary key.</P
><p class="para">The main thing, though, is that page numbers are collected for
all primary, secondary, and tertiary keys.  Thus, you could have
output such as:</P
><blockquote class="screen"><pre class="screen">  justification  4-9
    lines 4,6; defined, 5</PRE
></BLOCKQUOTE
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SEDAWK-APP-C-SECT-3.3">C.3.4 Output Format</A
></H3
><p class="para">One thing I wanted to do that our previous program did not do is
generate an index without the <kbd class="command">troff</KBD
> codes.
<kbd class="command">masterindex</KBD
> has three output modes:
<kbd class="command">troff</KBD
>, <kbd class="command">screen</KBD
>, and
<kbd class="command">page</KBD
>.</P
><p class="para">The default output is intended for processing by
<kbd class="command">troff</KBD
> (via <kbd class="command">fmt</KBD
>).  It contains
macros that are defined in
<em class="emphasis">/work/macros/current/indexmacs</EM
>.  These macros
should produce the same index format as before, which was largely done
directly through <kbd class="command">troff</KBD
> requests.  Here are a few
lines off the top:</P
><p class="para"><blockquote class="screen"><pre class="screen">$ <code class="userinput"><b>masterindex ch01</B
></CODE
>
.so /work/macros/current/indexmacs
.Se &quot;&quot; &quot;Index&quot;
.XC
.XF A &quot;A&quot;
.XF 1 &quot;applications, structure of  2;  program  1&quot;
.XF 1 &quot;attribute, WIN_CONSUME_KBD_EVENTS  13&quot;
.XF 2 &quot;WIN_CONSUME_PICK_EVENTS  13&quot;
.XF 2 &quot;WIN_NOTIFY_EVENT_PROC  13&quot;
.XF 2 &quot;XV_ERROR_PROC  14&quot;
.XF 2 &quot;XV_INIT_ARGC_PTR_ARGV  5,6&quot;</PRE
></BLOCKQUOTE
></P
><p class="para">The top two lines should be obvious.  The .XC macro produces
multicolumn output.  (It will print out two columns for smaller
books.  It's not smart enough to take arguments specifying the width
of columns, but that should be done.)  The .XF macro has three
possible values for its first argument.  An &quot;A&quot; indicates that the
second argument is a letter of the alphabet that should be output as a
divider.  A &quot;1&quot; indicates that the second argument contains a primary
entry.  A &quot;2&quot; indicates that the entry begins with a secondary entry,
which is indented.</P
><p class="para">When invoked with the <i class="option">-s</I
> argument, the program
prepares the index for viewing on the screen (or printing as an ASCII
file).  Again, here are a few lines:</P
><p class="para"><blockquote class="screen"><pre class="screen">$ <code class="userinput"><b>masterindex -s ch01</B
></CODE
>
		A
applications, structure of  2;  program  1
attribute, WIN_CONSUME_KBD_EVENTS  13
  WIN_CONSUME_PICK_EVENTS  13
  WIN_NOTIFY_EVENT_PROC  13
  XV_ERROR_PROC  14
  XV_INIT_ARGC_PTR_ARGV  5,6
  XV_INIT_ARGS  6
  XV_USAGE_PROC  6</PRE
></BLOCKQUOTE
></P
><p class="para">Obviously, this is useful for quickly proofing the index.  The third
type of format is also used for proofing the index.  Invoked using
<i class="option">-p</I
>, it provides a page-by-page listing of the index
entries.</P
><p class="para"><blockquote class="screen"><pre class="screen">$ <code class="userinput"><b>masterindex -p ch01</B
></CODE
>
Page 1
        structure of XView applications
        applications, structure of; program
        XView applications
        XView applications, structure of
        XView interface
        compiling XView programs
        XView, compiling programs
Page 2
        XView libraries</PRE
></BLOCKQUOTE
></P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="SEDAWK-APP-C-SECT-3.4">C.3.5 Compiling a Master Index</A
></H3
><p class="para">A multivolume master index is invoked by specifying the
<i class="option">-m</I
> option.  Each set of index entries for a
particular volume must be placed in a separate file.</P
><p class="para"><blockquote class="screen"><pre class="screen">$ <code class="userinput"><b>masterindex -m -s book1 book2 book3</B
></CODE
>
xv_init() procedure  II: 4; III: 5
XV_INIT_ARGC_PTR_ARGV attribute  II: 5,6
XV_INIT_ARGS attribute  I: 6</PRE
></BLOCKQUOTE
></P
><p class="para">Files must be specified in consecutive order.  If the first file is
not Volume 1, you can specify the number as an argument.</P
><p class="para"><blockquote class="screen"><pre class="screen">$ <code class="userinput"><b>masterindex -m 4 -s book4 book5 </B
></CODE
></PRE
></BLOCKQUOTE
></P
></DIV
><a class="indexterm" name="AUTOID-13534"></A
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="appc_02.htm" webstripperlinkwas="appc_02.htm" title="C.2 Listing of masterindex Shell Script"><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: C.2 Listing of masterindex Shell Script" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" title="sed &amp; awk"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="sed &amp; awk" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">&nbsp;</TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">C.2 Listing of masterindex Shell Script</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">&nbsp;</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="../upt/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="../vi/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
