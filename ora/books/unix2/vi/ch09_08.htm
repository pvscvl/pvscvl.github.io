<html><head><title>[Chapter 9] 9.8 Improvements for Editing</TITLE
><meta name="DC.Creator" content="Linda Lamb &amp; Arnold Robbins"><meta name="DC.Date" content="1999-11-23T17:57:39Z"><meta name="DC.Format" content="text/html" scheme="MIME"><meta name="DC.Identifier" content="O'Reilly Unix CDROM-unknown"><meta name="DC.Language" content="en-US"><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.Source" content="unknown" scheme="ISBN"><meta name="DC.Subject.Keyword" content="Unix, vi, text, editor, tool"><meta name="DC.Title" content="Learning the vi Editor"><meta name="DC.Type" content="Text.Monograph"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch09_01.htm" webstripperlinkwas="ch09_01.htm" title="9. nvi&nbsp;-- New vi"><link rel="prev" href="ch09_07.htm" webstripperlinkwas="ch09_07.htm" title="9.7 Extended Regular Expressions"><link rel="next" href="ch09_09.htm" webstripperlinkwas="ch09_09.htm" title="9.9 Programming Assistance"></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="Learning the vi Editor" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch09_07.htm" webstripperlinkwas="ch09_07.htm" title="9.7 Extended Regular Expressions"><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 9.7 Extended Regular Expressions" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1"><a class="chapter" rel="up" href="ch09_01.htm" webstripperlinkwas="ch09_01.htm" title="9. nvi&nbsp;-- New vi">Chapter 9<br>nvi&nbsp;-- New vi</A
></FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch09_09.htm" webstripperlinkwas="ch09_09.htm" title="9.9 Programming Assistance"><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 9.9 Programming Assistance" border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="VI6-CH-9-SECT-7">9.8 Improvements for Editing</A
></H2
><p class="para"><a class="indexterm" name="CH09.FACIL1"></A
><a class="indexterm" name="CH09.FACIL2"></A
><a class="indexterm" name="CH09.FACIL3"></A
>This section describes the features of <kbd class="command">nvi</KBD
>
that make simple text editing easier and more powerful.</P
><div class="sect2"><h3 class="sect2"><a class="title" name="VI6-CH-9-SECT-7.1">9.8.1 Command-Line History and Completion</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-12218"></A
><a class="indexterm" name="AUTOID-12222"></A
><a class="indexterm" name="AUTOID-12226"></A
><a class="indexterm" name="AUTOID-12229"></A
><a class="indexterm" name="AUTOID-12232"></A
><a class="indexterm" name="AUTOID-12235"></A
><a class="indexterm" name="AUTOID-12238"></A
><kbd class="command">nvi</KBD
> saves your <kbd class="command">ex</KBD
> command
lines, and makes it possible to edit them for resubmission.</P
><p class="para">This facility is controlled with the <code class="literal">cedit</CODE
> option.</P
><p class="para">When you type the
first character of this string on the colon
command line, <kbd class="command">nvi</KBD
> opens a new window on the command
history that you can then edit. When you hit <kbd class="keycap">[RETURN]</KBD
>
on any given line, <kbd class="command">nvi</KBD
> executes that line.
<kbd class="keycap">[ESC]</KBD
> is a good choice for this option.
(Use <code class="literal">^V ^[</CODE
> to enter it.)</P
><p class="para">Because the <kbd class="keycap">[RETURN]</KBD
> key actually executes the
command, be careful to use either the <code class="literal">j</CODE
>
or <img src="../chars/darr.gif" webstripperlinkwas="../chars/darr.gif" alt="-v"> keys to move down from one line to the next.</P
><p class="para">In addition to being able to edit your command line, you can
also do filename expansion.
This feature is controlled with the <code class="literal">filec</CODE
> option.<a class="indexterm" name="AUTOID-12255"></A
></P
><p class="para">When you type the
first character of this string on the colon
command line, <kbd class="command">nvi</KBD
> treats the blank delimited word
in front of the cursor as if it had an <code class="literal">*</CODE
> appended
to it and does shell-style filename expansion.
<kbd class="keycap">[ESC]</KBD
> is also a good choice for this option.[<a class="footnote" href="#AUTOID-12261">4</A
>]
(Use <code class="literal">^V ^[</CODE
> to enter it.)
When this character is the same as for the <code class="literal">cedit</CODE
> option,
the command-line editing is performed only when it is entered
as the first character on the colon command line.</P
><blockquote class="footnote"><div class="footnote"><p class="para"><a class="footnote" name="AUTOID-12261">[4]</A
> Although the <kbd class="command">nvi</KBD
> documentation indicates that
<kbd class="keycap">[TAB]</KBD
> is another common choice, we could not get
that to work.
In practice, using <kbd class="keycap">[ESC]</KBD
> for both options
works well.</P
></DIV
></BLOCKQUOTE
><p class="para">It is easiest to set these options in your <i class="filename">.nexrc</I
> file:</P
><blockquote class="screen"><pre class="screen">set cedit=^[
set filec=^[</PRE
></BLOCKQUOTE
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="VI6-CH-9-SECT-7.2">9.8.2 Tag Stacks</A
></H3
><p class="para"><a class="indexterm" name="CH09.STACK1"></A
><a class="indexterm" name="CH09.STACK2"></A
><a class="indexterm" name="CH09.STACK3"></A
><a class="indexterm" name="CH09.STACK4"></A
>Tag stacking is described in <a class="xref" href="ch08_05.htm" webstripperlinkwas="ch08_05.htm#VI6-CH-8-SECT-5.2">Section 8.5.3, "Tag Stacks"</A
> in <a class="xref" href="ch08_01.htm" webstripperlinkwas="ch08_01.htm">Chapter 8</A
>.  <kbd class="command">nvi</KBD
>'s tag stack
is the simplest of the
four clones. <a class="xref" href="#VI6-CH-9-TAB-2">Table 9.2</A
> and 
<a class="xref" href="#VI6-CH-9-TAB-3">Table 9.3</A
> show the commands it uses.</P
><br><table class="table" border="1" cellpadding="3"><caption class="table"><a class="title" name="VI6-CH-9-TAB-2">Table 9.2: nvi Tag Commands</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Command</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Function</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">di</CODE
>[<code class="literal">splay</CODE
>] <code class="literal">t</CODE
>[<code class="literal">ags</CODE
>]</TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis"></EM
>Display the tag stack.<a class="indexterm" name="AUTOID-12310"></A
><a class="indexterm" name="AUTOID-12312"></A
></P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">ta</CODE
>[<code class="literal">g</CODE
>][<code class="literal">!</CODE
>] <code class="replaceable"><i>tagstring</I
></CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis"></EM
>Edit the file containing
<em class="emphasis">tagstring</EM
> as defined in the <i class="filename">tags</I
><a class="indexterm" name="AUTOID-12325"></A
>
file. The <code class="literal">!</CODE
> forces <kbd class="command">nvi</KBD
> to
switch to the new file if the current buffer has been modified
but not saved.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">Ta</CODE
>[<code class="literal">g</CODE
>][<code class="literal">!</CODE
>] <code class="replaceable"><i>tagstring</I
></CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis"></EM
>Just like <code class="literal">:tag</CODE
>,<a class="indexterm" name="AUTOID-12339"></A
>
except that the file is edited in a new window.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">tagp</CODE
>[<code class="literal">op</CODE
>][<code class="literal">!</CODE
>] <code class="replaceable"><i>tagloc</I
></CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis"></EM
>Pop to the given tag, or to the most<a class="indexterm" name="AUTOID-12350"></A
>
recently used tag if no <em class="emphasis">tagloc</EM
> is supplied. The
location may be either a filename of the tag of interest
or a number indicating a position in the stack.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">tagt</CODE
>[<code class="literal">op</CODE
>][<code class="literal">!</CODE
>]</TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis"></EM
>Pop to the oldest tag in the stack,<a class="indexterm" name="AUTOID-12361"></A
>
clearing the stack in the process.</P
></TD
></TR
></TBODY
></TABLE
><br><table class="table" border="1" cellpadding="3"><caption class="table"><a class="title" name="VI6-CH-9-TAB-3">Table 9.3: nvi Command Mode Tag Commands</A
></CAPTION
><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Command</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Function</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">^]</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis"></EM
>Look up the location of the identifier<a class="indexterm" name="AUTOID-12379"></A
>
under the cursor in the <i class="filename">tags</I
> file, and move to that
location. The current location is automatically pushed onto the
tag stack.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">^T</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><p class="para"><em class="emphasis"></EM
>Return to the previous location
in the tag stack, i.e., pop off one element.<a class="indexterm" name="AUTOID-12389"></A
></P
></TD
></TR
></TBODY
></TABLE
><p class="para"><a class="indexterm" name="AUTOID-12393"></A
>You can set the <code class="literal">tags</CODE
> option to a list of file names
where <kbd class="command">nvi</KBD
> should look for a tag. This provides a
simplistic search path mechanism. The default value is
<code class="literal">&quot;tags /var/db/libc.tags /sys/kern/tags&quot;</CODE
>, which on a
4.4<em class="emphasis">BSD</EM
> system looks in the current
directory, and then in the files for the C library and the
operating system source code.</P
><p class="para"><a class="indexterm" name="AUTOID-12400"></A
>The <code class="literal">taglength</CODE
> option controls how many
characters in a tagstring are significant. The default value of
zero means to use all the characters.</P
><p class="para"><kbd class="command">nvi</KBD
> behaves like <kbd class="command">vi</KBD
>; it uses
the &quot;word&quot;
under the cursor starting at the current cursor position.
If your cursor is on the <em class="emphasis">i</EM
> in <em class="emphasis">main</EM
>,
<kbd class="command">nvi</KBD
> will search for the identifier <em class="emphasis">in</EM
>,
not <em class="emphasis">main</EM
>.</P
><p class="para"><a class="indexterm" name="AUTOID-12412"></A
><kbd class="command">nvi</KBD
> relies on the traditional <i class="filename">tags</I
>
file format. Unfortunately, this format is very limited.
In particular, it has no concept of programming language
<em class="emphasis">scope</EM
>,
which allows the same identifier to be used in different contexts to
mean different things.
The problem is exacerbated by C++, which explicitly allows function
name <em class="emphasis">overloading</EM
>, i.e., the use of the same name
for different functions.</P
><p class="para"><kbd class="command">nvi</KBD
> gets around the <i class="filename">tags</I
> file
limitations by using a different mechanism entirely: the<a class="indexterm" name="AUTOID-12421"></A
>
<kbd class="command">cscope</KBD
> program.
<kbd class="command">cscope</KBD
> is a proprietary but relatively
inexpensive program available from
the Bell Labs Software Toolchest.
It reads C source files and builds a database
describing the program. <kbd class="command">nvi</KBD
> provides commands that
query the database and allow you to process the results.
Because <kbd class="command">cscope</KBD
> is not universally available,
we do not cover its use here.
Details of the <kbd class="command">nvi</KBD
> commands
are provided in the <kbd class="command">nvi</KBD
> documentation.</P
><p class="para"><a class="indexterm" name="AUTOID-12430"></A
><a class="indexterm" name="AUTOID-12432"></A
><a class="indexterm" name="AUTOID-12435"></A
>The extended <i class="filename">tags</I
> file format produced by
Exuberant <kbd class="command">ctags</KBD
> does not produce any errors with
<kbd class="command">nvi</KBD
> 1.79; however, <kbd class="command">nvi</KBD
> does
not take advantage of this format either.</P
><a class="indexterm" name="AUTOID-12441"></A
><a class="indexterm" name="AUTOID-12442"></A
><a class="indexterm" name="AUTOID-12443"></A
><a class="indexterm" name="AUTOID-12444"></A
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="VI6-CH-9-SECT-7.3">9.8.3 Infinite Undo</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-12448"></A
><a class="indexterm" name="AUTOID-12451"></A
><a class="indexterm" name="AUTOID-12455"></A
><a class="indexterm" name="AUTOID-12458"></A
>In <kbd class="command">vi</KBD
>, the dot (<code class="literal">.</CODE
>) command generally
acts as the &quot;do again&quot; command; it repeats the last
editing action you performed, be it a deletion, insertion, or
replacement.</P
><p class="para"><kbd class="command">nvi</KBD
> generalizes the dot command
into a full &quot;redo&quot; command, applying it even if the
last command was <code class="literal">u</CODE
> for &quot;undo.&quot;</P
><p class="para">Thus, to begin a series of &quot;undo&quot; commands, first type a
<code class="literal">u</CODE
>.  Then, for each <code class="literal">.</CODE
> (dot) that you
type, <kbd class="command">nvi</KBD
> will continue to undo changes, moving
the file progressively closer to its original state.</P
><p class="para">Eventually, you will reach the initial state of your file. At
that point, typing <code class="literal">.</CODE
> will just ring the bell
(or flash the screen). You can now begin redoing by typing
<code class="literal">u</CODE
> to &quot;undo the undos&quot; and then
using <code class="literal">.</CODE
> to reapply successive changes.</P
><p class="para"><kbd class="command">nvi</KBD
> does not allow you to provide a count to either
the <code class="literal">u</CODE
> or <code class="literal">.</CODE
> command.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="VI6-CH-9-SECT-7.4">9.8.4 Arbitrary Length Lines and Binary Data</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-12481"></A
><a class="indexterm" name="AUTOID-12484"></A
><a class="indexterm" name="AUTOID-12488"></A
><a class="indexterm" name="AUTOID-12492"></A
><a class="indexterm" name="AUTOID-12496"></A
><kbd class="command">nvi</KBD
> can edit files with arbitrary length
lines and with an arbitrary number of lines.</P
><p class="para"><kbd class="command">nvi</KBD
> automatically handles binary data.
No special command-line options
or <kbd class="command">ex</KBD
> options are required.
You use <code class="literal">^X</CODE
> followed by one or two
hexadecimal digits to enter any 8-bit character into your file.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="VI6-CH-9-SECT-7.5">9.8.5 Incremental Searching</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-12507"></A
><a class="indexterm" name="AUTOID-12510"></A
><a class="indexterm" name="AUTOID-12514"></A
><a class="indexterm" name="AUTOID-12518"></A
>As mentioned in
<a class="xref" href="ch08_06.htm" webstripperlinkwas="ch08_06.htm#VI6-CH-8-SECT-6.4">Section 8.6.4, "Incremental Searching"</A
> in <a class="xref" href="ch08_01.htm" webstripperlinkwas="ch08_01.htm">Chapter 8</A
>,
you enable
incremental searching in <kbd class="command">nvi</KBD
> using
<code class="literal">:set searchincr</CODE
>.</P
><p class="para">The cursor moves through the
file as you type, always being placed on the first character of
the text that matches.</P
></DIV
><div class="sect2"><h3 class="sect2"><a class="title" name="VI6-CH-9-SECT-7.6">9.8.6 Left-Right Scrolling</A
></H3
><p class="para"><a class="indexterm" name="AUTOID-12527"></A
><a class="indexterm" name="AUTOID-12530"></A
><a class="indexterm" name="AUTOID-12533"></A
><a class="indexterm" name="AUTOID-12536"></A
><a class="indexterm" name="AUTOID-12540"></A
><a class="indexterm" name="AUTOID-12543"></A
>As mentioned in
<a class="xref" href="ch08_06.htm" webstripperlinkwas="ch08_06.htm#VI6-CH-8-SECT-6.5">Section 8.6.5, "Left-Right Scrolling"</A
> in <a class="xref" href="ch08_01.htm" webstripperlinkwas="ch08_01.htm">Chapter 8</A
>,
you enable
left-right scrolling in <kbd class="command">nvi</KBD
> using<a class="indexterm" name="AUTOID-12548"></A
><a class="indexterm" name="AUTOID-12550"></A
>
<code class="literal">:set leftright</CODE
>. The value of
<code class="literal">sidescroll</CODE
> controls the number of characters
by which <kbd class="command">nvi</KBD
> shifts the screen when scrolling
left to right.</P
></DIV
><a class="indexterm" name="AUTOID-12555"></A
><a class="indexterm" name="AUTOID-12556"></A
><a class="indexterm" name="AUTOID-12557"></A
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch09_07.htm" webstripperlinkwas="ch09_07.htm" title="9.7 Extended Regular Expressions"><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 9.7 Extended Regular Expressions" border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" title="Learning the vi Editor"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="Learning the vi Editor" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch09_09.htm" webstripperlinkwas="ch09_09.htm" title="9.9 Programming Assistance"><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 9.9 Programming Assistance" border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">9.7 Extended Regular Expressions</TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">9.9 Programming Assistance</TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.htm" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="../upt/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>

