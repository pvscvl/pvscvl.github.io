<html><head><title>[Chapter 7] 7.2 Executing UNIX Commands </TITLE
><meta name="DC.Creator" content="Linda Lamb &amp; Arnold Robbins"><meta name="DC.Date" content="1999-11-23T17:56:50Z"><meta name="DC.Format" content="text/html" scheme="MIME"><meta name="DC.Identifier" content="O'Reilly Unix CDROM-unknown"><meta name="DC.Language" content="en-US"><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc."><meta name="DC.Source" content="unknown" scheme="ISBN"><meta name="DC.Subject.Keyword" content="Unix, vi, text, editor, tool"><meta name="DC.Title" content="Learning the vi Editor"><meta name="DC.Type" content="Text.Monograph"><meta name="generator" content="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><link rev="made" href="mailto:online-books@oreilly.com" title="Online Books Comments"><link rel="up" href="ch07_01.htm" webstripperlinkwas="ch07_01.htm" title="7. Advanced Editing"><link rel="prev" href="ch07_01.htm" webstripperlinkwas="ch07_01.htm" title="7.1 Customizing vi "><link rel="next" href="ch07_03.htm" webstripperlinkwas="ch07_03.htm" title="7.3 Saving Commands "></HEAD
><body bgcolor="#FFFFFF" text="#000000"><div class="htmlnav"><h1><img src="gifs/smbanner.gif" webstripperlinkwas="gifs/smbanner.gif" alt="Learning the vi Editor" usemap="#srchmap" border="0"></H1
><map name="srchmap"><area shape="RECT" coords="0,0,466,65" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="467,0,514,18" href="jobjects/fsearch.htm" webstripperlinkwas="jobjects/fsearch.htm" alt="Search this book"></MAP
><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_01.htm" webstripperlinkwas="ch07_01.htm" title="7.1 Customizing vi "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 7.1 Customizing vi " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><b><font face="ARIEL,HELVETICA,HELV,SANSERIF" size="-1"><a class="chapter" rel="up" href="ch07_01.htm" webstripperlinkwas="ch07_01.htm" title="7. Advanced Editing">Chapter 7<br>Advanced Editing</A
></FONT
></B
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch07_03.htm" webstripperlinkwas="ch07_03.htm" title="7.3 Saving Commands "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 7.3 Saving Commands " border="0"></A
></TD
></TR
></TABLE
>&nbsp;<hr align="LEFT" width="515" title="footer"></DIV
><div class="SECT1"><h2 class="sect1"><a class="title" name="VI6-CH-7-SECT-2">7.2 Executing UNIX Commands </A
></H2
><p class="para"><a class="indexterm" name="CH07.UNIX1"></A
><a class="indexterm" name="CH07.UNIX3"></A
>You can display or read in the results of any UNIX
command while you are editing in <kbd class="command">vi</KBD
>.
An exclamation mark (<code class="literal">!</CODE
>) tells
<kbd class="command">ex</KBD
> to create a shell and to regard what follows as a
UNIX command:<a class="indexterm" name="AUTOID-8495"></A
><a class="indexterm" name="AUTOID-8498"></A
><a class="indexterm" name="AUTOID-8501"></A
><a class="indexterm" name="AUTOID-8504"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">:!<code class="replaceable"><i>command</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">So if you are editing and you want to check the time or date
without exiting <kbd class="command">vi</KBD
>, you can enter:<a class="indexterm" name="AUTOID-8512"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">:!date</PRE
></BLOCKQUOTE
></P
><p class="para">The time and date will appear on your screen;  press
<kbd class="keycap">[RETURN]</KBD
>

to continue editing at the same place in your file.</P
><p class="para"><a class="indexterm" name="AUTOID-8519"></A
><a class="indexterm" name="AUTOID-8521"></A
>If you want to give several UNIX commands in a row without returning to
<kbd class="command">vi</KBD
> editing in between,
you can create a shell with the <kbd class="command">ex</KBD
>
command:</P
><p class="para"><blockquote class="screen"><pre class="screen">:sh</PRE
></BLOCKQUOTE
></P
><p class="para">&#13;When you want to exit the shell and return to <kbd class="command">vi</KBD
>, press
<kbd class="keycap">[CTRL-D]</KBD
>.</P
><p class="para"><a class="indexterm" name="AUTOID-8531"></A
><a class="indexterm" name="AUTOID-8534"></A
>You can combine <code class="literal">:read</CODE
> with a call to UNIX, to
read the results of a UNIX command into your file.
As a very simple example:</P
><p class="para"><blockquote class="screen"><pre class="screen">:r !date</PRE
></BLOCKQUOTE
></P
><p class="para">will read in the system's date information into the text of your file.
By preceding the <code class="literal">:r</CODE
> command with a line address, you can read
the result of the command in at any desired point in your file. By
default, it will appear after the current line.</P
><p class="para">Suppose you are editing a file and want to read in four phone
numbers from a file called <i class="filename">phone</I
>, but in alphabetical
order.
<i class="filename">phone</I
> reads:</P
><p class="para"><blockquote class="screen"><pre class="screen">  Willing, Sue  333-4444
  Walsh, Linda  555-6666
  Quercia, Valerie  777-8888
  Dougherty, Nancy  999-0000</PRE
></BLOCKQUOTE
></P
><p class="para">The command:<a class="indexterm" name="AUTOID-8547"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">  :r !sort phone</PRE
></BLOCKQUOTE
></P
><p class="para">reads in the contents of <i class="filename">phone</I
> after they have been passed
through the <kbd class="command">sort</KBD
> filter:</P
><p class="para"><blockquote class="screen"><pre class="screen">  Dougherty, Nancy  999-0000
  Quercia, Valerie  777-8888
  Walsh, Linda  555-6666
  Willing, Sue  333-4444</PRE
></BLOCKQUOTE
></P
><p class="para">Suppose you are editing a file and want to insert text from
another file in the directory, but you can't remember the new file's name.
You <em class="emphasis">could</EM
> perform this task the long way: exit your
file, give the <code class="literal">ls</CODE
> command, note the correct filename,
reenter your file, and search for your place.</P
><p class="para">Or you could do the task in fewer steps:</P
><p class="para"></P
><table class="informaltable" border="1" cellpadding="3"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Keystrokes</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Results</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">:!ls</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><img class="graphic" src="figs/vi.0701.gif" webstripperlinkwas="figs/vi.0701.gif" alt="Graphic"><p class="para">Display a list of files in the current directory.
Note the correct filename.
Press <kbd class="keycap">[RETURN]</KBD
> to continue editing.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">:r newfile</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><img class="graphic" src="figs/vi.0702.gif" webstripperlinkwas="figs/vi.0702.gif" alt="Graphic"><p class="para">Read in the new file.</P
></TD
></TR
></TBODY
></TABLE
><p class="para"></P
><div class="sect2"><h3 class="sect2"><a class="title" name="VI6-CH-7-SECT-2.1">7.2.1 Filtering Text Through a Command </A
></H3
><p class="para"><a class="indexterm" name="CH07.BLOCK1"></A
><a class="indexterm" name="CH07.BLOCK2"></A
><a class="indexterm" name="CH07.BLOCK3"></A
>You can also send a block of text as standard input to a UNIX command.
The output from this command replaces the block of text in the buffer.
You can filter text through a command from either <kbd class="command">ex</KBD
> or
<kbd class="command">vi</KBD
>.
The main difference between the two methods is that you indicate
the block of text with line addresses in <kbd class="command">ex</KBD
> and
with text objects (movement commands) in <kbd class="command">vi</KBD
>.</P
><div class="sect3"><h4 class="sect3"><a class="title" name="VI6-CH-7-SECT-2.1.1">7.2.1.1 Filtering text with ex</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-8601"></A
>The first example demonstrates how to filter text with <kbd class="command">ex</KBD
>.
Assume that the list of names in the preceding example,
instead of being contained in a separate file called <i class="filename">phone</I
>,
is already contained in the current file on lines 96 through 99.
You simply type the addresses of the lines you want to filter, followed
by an exclamation mark and the UNIX command to be executed.
For example, the command:</P
><p class="para"><blockquote class="screen"><pre class="screen">:96,99!sort</PRE
></BLOCKQUOTE
></P
><p class="para">will pass lines 96 through 99 through the <kbd class="command">sort</KBD
> filter and replace
those lines with the output of <kbd class="command">sort</KBD
>.</P
></DIV
><div class="sect3"><h4 class="sect3"><a class="title" name="VI6-CH-7-SECT-2.1.2">7.2.1.2 Filtering text with vi</A
></H4
><p class="para"><a class="indexterm" name="AUTOID-8614"></A
>In <kbd class="command">vi</KBD
>, text is filtered through a UNIX command by typing an exclamation mark
followed by any of <kbd class="command">vi</KBD
>'s movement keystrokes
that indicate a block of text,
and then by the UNIX command line to be executed.
For example:</P
><p class="para"><blockquote class="screen"><pre class="screen">!)<code class="replaceable"><i>command</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">will pass the next sentence through <em class="emphasis">command</EM
>.</P
><p class="para">There are a few unusual features about how <kbd class="command">vi</KBD
>
acts when you use this feature:</P
><ul class="itemizedlist"><li class="listitem"><p class="para">The exclamation mark doesn't appear on your
screen right away.
When you type the keystroke(s)
for the text object you want to filter, the
exclamation mark appears at the bottom of the screen, <em class="emphasis">but the
character you type to reference the object does not.</EM
></P
></LI
><li class="listitem"><p class="para">Text blocks must be more than one line, so
you can use only the keystrokes that would move more than one line
( <code class="literal">G</CODE
>, <code class="literal">{ }</CODE
>, <code class="literal">( )</CODE
>, <code class="literal">[[ ]]</CODE
>, <code class="literal">+</CODE
>, <code class="literal">-</CODE
> ).
To repeat the effect,
a number may precede either the exclamation mark or the text object.
(For example, both <code class="literal">!10+</CODE
> and <code class="literal">10!+</CODE
> would indicate the
next ten lines.)
Objects such as <code class="literal">w</CODE
> do not work unless
enough of them are specified so as to exceed a single line.
You can also use a slash (<code class="literal">/</CODE
>) followed by a <em class="emphasis">pattern</EM
> and
a carriage return to specify the object.
This takes the text up to the pattern as input to the command.</P
></LI
><li class="listitem"><p class="para">Entire lines are affected. For example, if your cursor is in the middle
of a line and you issue a command to go to the end of the next sentence,
the entire lines containing the beginning and end of the sentence will
be changed, not just the sentence itself.[<a class="footnote" href="#AUTOID-8645">4</A
>]</P
><blockquote class="footnote"><div class="footnote"><p class="para"><a class="footnote" name="AUTOID-8645">[4]</A
> Of course, there's always an exception. In this example,
<kbd class="command">vim</KBD
> 5.0 changes only the current line.</P
></DIV
></BLOCKQUOTE
></LI
><li class="listitem"><p class="para">There is a special text object that can be used only with
this command syntax: you can specify the current line
by entering a second exclamation mark:<a class="indexterm" name="AUTOID-8650"></A
><a class="indexterm" name="AUTOID-8653"></A
></P
><p class="para"><blockquote class="screen"><pre class="screen">!!<code class="replaceable"><i>command</I
></CODE
></PRE
></BLOCKQUOTE
></P
><p class="para">Remember that either the entire sequence or the text object
can be preceded by a number to repeat the effect.
For instance, to change lines 96 through 99 as in the above example,
you could position the cursor on line 96 and enter either:</P
><p class="para"><blockquote class="screen"><pre class="screen">4!!sort</PRE
></BLOCKQUOTE
></P
><p class="para">or:</P
><p class="para"><blockquote class="screen"><pre class="screen">!4!sort</PRE
></BLOCKQUOTE
></P
></LI
></UL
><p class="para">As another example, assume you have a portion of text in a file
that you want to change from lowercase to uppercase letters.
You could process that portion with the <code class="literal">tr</CODE
> command to change the case.
In this example, the second sentence is the block of text
that will be filtered through the command.</P
><img class="graphic" src="figs/vi.0703.gif" webstripperlinkwas="figs/vi.0703.gif" alt="Graphic"><table class="informaltable" border="1" cellpadding="3"><thead class="thead"><tr class="row" valign="TOP"><th class="entry" align="LEFT" rowspan="1" colspan="1">Keystrokes</TH
><th class="entry" align="LEFT" rowspan="1" colspan="1">Results</TH
></TR
></THEAD
><tbody class="tbody"><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">!)</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><img class="graphic" src="figs/vi.0704.gif" webstripperlinkwas="figs/vi.0704.gif" alt="Graphic"><p class="para">An exclamation mark appears on the last line to prompt you
for the UNIX command.
The <code class="literal">)</CODE
> indicates that a sentence is the unit
of text to be filtered.</P
></TD
></TR
><tr class="row" valign="TOP"><td class="entry" rowspan="1" colspan="1"><code class="literal">tr '[a-z]' '[A-Z]'</CODE
></TD
><td class="entry" rowspan="1" colspan="1"><img class="graphic" src="figs/vi.0705.gif" webstripperlinkwas="figs/vi.0705.gif" alt="Graphic"><p class="para">Enter the UNIX command and press <kbd class="keycap">[RETURN]</KBD
>.
The input is replaced by the output.</P
></TD
></TR
></TBODY
></TABLE
><p class="para">To repeat the previous command, the syntax is:</P
><p class="para"><blockquote class="screen"><pre class="screen">! <code class="replaceable"><i>object</I
></CODE
> !</PRE
></BLOCKQUOTE
></P
><p class="para">It is sometimes useful to send sections of a coded document to
<kbd class="command">nroff</KBD
> to be replaced by formatted output.
(Or when editing electronic mail, you
might use the <kbd class="command">fmt</KBD
> program to &quot;beautify&quot; your text
before sending the message.)
Remember that the &quot;original&quot; input is replaced
by the output.
Fortunately, if there is a mistake, such as an error
message being sent instead of the expected output,
you can undo the command and restore the lines.</P
></DIV
><a class="indexterm" name="AUTOID-8698"></A
><a class="indexterm" name="AUTOID-8699"></A
><a class="indexterm" name="AUTOID-8700"></A
></DIV
><a class="indexterm" name="AUTOID-8701"></A
><a class="indexterm" name="AUTOID-8702"></A
></DIV
><div class="htmlnav"><p></P
><hr align="LEFT" width="515" title="footer"><table width="515" border="0" cellspacing="0" cellpadding="0"><tr><td align="LEFT" valign="TOP" width="172"><a class="SECT1" href="ch07_01.htm" webstripperlinkwas="ch07_01.htm" title="7.1 Customizing vi "><img src="../gifs/txtpreva.gif" webstripperlinkwas="../gifs/txtpreva.gif" alt="Previous: 7.1 Customizing vi " border="0"></A
></TD
><td align="CENTER" valign="TOP" width="171"><a class="book" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" title="Learning the vi Editor"><img src="../gifs/txthome.gif" webstripperlinkwas="../gifs/txthome.gif" alt="Learning the vi Editor" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172"><a class="SECT1" href="ch07_03.htm" webstripperlinkwas="ch07_03.htm" title="7.3 Saving Commands "><img src="../gifs/txtnexta.gif" webstripperlinkwas="../gifs/txtnexta.gif" alt="Next: 7.3 Saving Commands " border="0"></A
></TD
></TR
><tr><td align="LEFT" valign="TOP" width="172">7.1 Customizing vi </TD
><td align="CENTER" valign="TOP" width="171"><a class="index" href="index/idx_0.htm" webstripperlinkwas="index/idx_0.htm" title="Book Index"><img src="../gifs/index.gif" webstripperlinkwas="../gifs/index.gif" alt="Book Index" border="0"></A
></TD
><td align="RIGHT" valign="TOP" width="172">7.3 Saving Commands </TD
></TR
></TABLE
><hr align="LEFT" width="515" title="footer"><img src="../gifs/smnavbar.gif" webstripperlinkwas="../gifs/smnavbar.gif" usemap="#map" border="0" alt="The UNIX CD Bookshelf Navigation"><map name="map"><area shape="RECT" coords="0,0,73,21" href="../index.html" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/index.html" alt="The UNIX CD Bookshelf"><area shape="RECT" coords="74,0,163,21" href="../upt/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/upt/index.htm" alt="UNIX Power Tools"><area shape="RECT" coords="164,0,257,21" href="../unixnut/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/unixnut/index.htm" alt="UNIX in a Nutshell"><area shape="RECT" coords="258,0,321,21" href="index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/vi/index.htm" alt="Learning the vi Editor"><area shape="RECT" coords="322,0,378,21" href="../sedawk/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/sedawk/index.htm" alt="sed &amp; awk"><area shape="RECT" coords="379,0,438,21" href="../ksh/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/ksh/index.htm" alt="Learning the Korn Shell"><area shape="RECT" coords="439,0,514,21" href="../lrnunix/index.htm" webstripperlinkwas="http://www.ms.itb.ac.id/buku/unix-bookshelf/lrnunix/index.htm" alt="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>

