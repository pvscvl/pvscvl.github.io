<!DOCTYPE HTML PUBLIC "html.dtd">
<HTML>

<!-- Mirrored from 63.227.213.92 by HTTrack/2.x [XR/YP'2000] -->
<HEAD>
<TITLE>
[Chapter 9] Troubleshooting Samba</TITLE><META NAME="DC.title" CONTENT=""><META NAME="DC.creator" CONTENT=""><META NAME="DC.publisher" CONTENT="O'Reilly &amp; Associates, Inc."><META NAME="DC.date" CONTENT="1999-11-05T21:36:14Z"><META NAME="DC.type" CONTENT="Text.Monograph"><META NAME="DC.format" SCHEME="MIME" CONTENT="text/html"><META NAME="DC.source" SCHEME="ISBN" CONTENT=""><META NAME="DC.language" CONTENT="en-US"><META NAME="generator" CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"></HEAD>
<BODY VLINK="#0000CC" TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#990000">
<TABLE WIDTH="90%" CELLSPACING="0" CELLPADDING="0" BORDER="0">
<TR>
<TD COLSPAN="2">
<IMG WIDTH="515" ALT="Search the Catalog" SRC="http://www.oreilly.com/graphics_new/catalog_header_buttons.gif" HEIGHT="37" ISMAP ALIGN="BOTTOM" USEMAP="#catalog_header_buttons" BORDER="0">
<MAP NAME="catalog_header_buttons">
<AREA SHAPE="Rect" HREF="http://www.oreilly.com/search.html" COORDS="407,17,512,32">
<AREA SHAPE="Rect" HREF="http://www.oreilly.com/catalog/prdindex.html" COORDS="431,3,512,18">
</MAP>
</TD>
</TR>
<TR>
<TD WIDTH="25%" VALIGN="TOP">
<A HREF="http://www.oreilly.com/catalog/samba/">
<IMG ALT="Using Samba" VALIGN="top" VSPACE="10" HSPACE="10" SRC="http://www.oreilly.com/catalog/covers/samba.s.gif" ALIGN="left" BORDER="0">
</A>
</TD>
<TD VALIGN="TOP" HEIGHT="105">
<BR>
<H2>Using Samba</H2>
<FONT SIZE="-1">
Robert Eckstein, David Collier-Brown, Peter Kelly
<BR>1st Edition November 1999
<BR>1-56592-449-5, Order Number: 4495
<BR>416 pages, $34.95
</FONT>
</TD>
</TR>
</TABLE>
<HR NOSHADE SIZE="1">
<!-- sample chapter begins -->

<CENTER>
<DIV CLASS="htmlnav">
<TABLE WIDTH="515" CELLSPACING="0" CELLPADDING="0" BORDER="0">
<TR>
<TD WIDTH="172" VALIGN="TOP" ALIGN="LEFT">
<A TITLE="8.7 Backups with smbtar" HREF="ch08_07.html" CLASS="sect1">
<IMG ALT="Previous: 8.7 Backups with smbtar" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtpreva.gif" BORDER="0"></A></TD><TD WIDTH="171" VALIGN="TOP" ALIGN="CENTER">
<B>
<FONT SIZE="-1" FACE="ARIEL,HELVETICA,HELV,SANSERIF">
Chapter 9</FONT></B></TD><TD WIDTH="172" VALIGN="TOP" ALIGN="RIGHT">
<A TITLE="9.2 The Fault Tree" HREF="ch09_02.html" CLASS="sect1">
<IMG ALT="Next: 9.2 The Fault Tree" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtnexta.gif" BORDER="0"></A></TD></TR></TABLE>&nbsp;<HR NOSHADE SIZE="1"></CENTER>
</DIV>
<BLOCKQUOTE>
<DIV CLASS="samplechapter">
<H1 CLASS="chapter">
<A NAME="ch09-80975" CLASS="title">
9. Troubleshooting Samba</A></H1><DIV CLASS="htmltoc">
<P>
<B>
Contents:</B><BR>
<A TITLE="9.1 The Tool Bag" HREF="#ch09-36385" CLASS="sect1">
The Tool Bag</A><BR>
<A TITLE="9.2 The Fault Tree" HREF="ch09_02.html" CLASS="sect1">
The Fault Tree</A><BR>
<A TITLE="9.3 Extra Resources" HREF="ch09_03.html" CLASS="sect1">
Extra Resources</A></P><P>
</P></DIV><P CLASS="para">Samba is extremely robust. Once you've got everything set up the way you want, you'll probably forget that it is running. When trouble occurs, it's typically during installation or when you're trying to add something new to the server. Fortunately, there are a wide variety of resources that you can use to diagnose these troubles. While we can't describe in detail the solution to every problem that you might encounter, you should be able to get a good start at a resolution by following the advice given in this chapter.</P><P CLASS="para">
The first section of the chapter lists the tool bag, a collection of tools available for troubleshooting Samba; the second section is a detailed how-to, and the last section lists extra resources you may need to track down particularly stubborn problems.</P><DIV CLASS="sect1">
<H2 CLASS="sect1">
<A NAME="ch09-36385" CLASS="title">
9.1 The Tool Bag</A></H2><P CLASS="para">Sometimes Unix seems to be made up of a handful of applications and tools. There are tools to troubleshoot tools. And of course, there are several ways to accomplish the same task. When you are trying to solve a problem related to Samba, a good plan of attack is to check the following:</P><OL CLASS="orderedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-944982" CLASS="listitem">
</A>Samba logs </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-944983" CLASS="listitem">
</A>Fault tree </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-944984" CLASS="listitem">
</A>Unix utilities </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-944985" CLASS="listitem">
</A>Samba test utilities </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-944986" CLASS="listitem">
</A>Documentation and FAQs </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-944987" CLASS="listitem">
</A>Searchable archives </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-944988" CLASS="listitem">
</A>Samba newsgroups</P></LI></OL><P CLASS="para">
Let's go over each of these one by one in the following sections.</P><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-950956" CLASS="title">
9.1.1 Samba Logs</A></H3><P CLASS="para">Your first line of attack should always be to check the log files. The Samba log files can help diagnose the vast majority of the problems that beginning to intermediate Samba administrators are likely to face. Samba is quite flexible when it comes to logging. You can set up the server to log as little or as much as you want. Substitution variables that allow you to isolate individual logs for each machine, share, or combination thereof.</P><P CLASS="para">
By default, logs are placed in <CODE CLASS="replaceable">
<I>
samba_directory</I></CODE><EM CLASS="emphasis">
/var/smbd.log</EM> and <CODE CLASS="replaceable">
<I>
samba_directory</I></CODE><EM CLASS="emphasis">
/var/nmbd.log</EM>, where <CODE CLASS="literal">
samba_directory</CODE> is the location where Samba was installed (typically, <I CLASS="filename">
/usr/local/samba</I>). As we mentioned in <B>Chapter 4, <CITE CLASS="chapter">
Disk Shares </CITE></B>, you can override the location and name using the <CODE CLASS="literal">
log</CODE> <CODE CLASS="literal">
file</CODE> configuration option in <I CLASS="filename">
smb.conf</I>. This option accepts all of the substitution variables mentioned in <B>Chapter 2, <CITE CLASS="chapter">
Installing Samba on a Unix System</CITE></B>, so you could easily have the server keep a separate log for each connecting client by specifying the following in the <CODE CLASS="literal">
[global]</CODE> section of <I CLASS="filename">
smb.conf </I>:</P><PRE CLASS="programlisting">
log file = %m.log</PRE><P CLASS="para">
Alternatively, you can specify a log directory to use with the <CODE CLASS="literal">
-l</CODE> flag on the command line. For example:</P><PRE CLASS="programlisting">
smbd -l /usr/local/var/samba</PRE><P CLASS="para">
Another useful trick is to have the server keep a log for each service (share) that is offered, especially if you suspect a particular share is causing trouble. Use the <CODE CLASS="literal">
%S</CODE> variable to set this up in the <CODE CLASS="literal">
[global]</CODE> section of the configuration file:</P><PRE CLASS="programlisting">
log file = %S.log</PRE><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-28969" CLASS="title">
9.1.1.1 Log levels</A></H4><P CLASS="para">The level of logging that Samba uses can be set in the <I CLASS="filename">
smb.conf</I> file using the global <CODE CLASS="literal">
log</CODE> <CODE CLASS="literal">
level</CODE> or <CODE CLASS="literal">
debug</CODE> <CODE CLASS="literal">
level</CODE> option; they are equivalent. The logging level is an integer which ranges from 0 (no logging), and increases the logging to voluminous by <CODE CLASS="literal">
log</CODE> <CODE CLASS="literal">
level</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
3</CODE>. For example, let's assume that we are going to use a Windows client to browse a directory on a Samba server. For a small amount of log information, you can use <CODE CLASS="literal">
log</CODE> <CODE CLASS="literal">
level</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
1</CODE>, which instructs Samba to show only cursory information, in this case only the connection itself: </P><PRE CLASS="programlisting">
105/25/98 22:02:11 server (192.168.236.86) connect to service public as user pcguest (uid=503,gid=100) (pid 3377) </PRE><P CLASS="para">
Higher debug levels produce more detailed information. Usually you won't need any more than level 3; this is more than adequate for most Samba administrators. Levels above 3 are for use by the developers and dump enormous amounts of cryptic information.</P><P CLASS="para">
Here is example output at levels 2 and 3 for the same operation. Don't worry if you don't understand the intricacies of an SMB connection; the point is simply to show you what types of information are shown at the different logging levels: </P><PRE CLASS="programlisting">
 /* Level 2 */
Got SIGHUP
Processing section &quot;[homes]&quot;
Processing section &quot;[public]&quot;
Processing section &quot;[temp]&quot;
Allowed connection from 192.168.236.86 (192.168.236.86) to IPC$
Allowed connection from 192.168.236.86 (192.168.236.86) to IPC/


/* Level 3 */
05/25/98 22:15:09 Transaction 63 of length 67
switch message SMBtconX (pid 3377)
Allowed connection from 192.168.236.86 (192.168.236.86) to IPC$
ACCEPTED: guest account and guest ok
found free connection number 105
Connect path is /tmp
chdir to /tmp
chdir to /
05/25/98 22:15:09 server (192.168.236.86) connect to service IPC$ as user pcguest (uid=503,gid=100) (pid 3377)
05/25/98 22:15:09 tconX service=ipc$ user=pcguest cnum=105
05/25/98 22:15:09 Transaction 64 of length 99
switch message SMBtrans (pid 3377)
chdir to /tmp
trans &lt;\PIPE\LANMAN&gt; data=0 params=19 setup=0
Got API command 0 of form &lt;WrLeh&gt; &lt;B13BWz&gt; (tdscnt=0,tpscnt=19,mdrcnt=4096,mprcnt=8)
Doing RNetShareEnum
RNetShareEnum gave 4 entries of 4 (1 4096 126 4096)
05/25/98 22:15:11 Transaction 65 of length 99
switch message SMBtrans (pid 3377)
chdir to /
chdir to /tmp
trans &lt;\PIPE\LANMAN&gt; data=0 params=19 setup=0
Got API command 0 of form &lt;WrLeh&gt; &lt;B13BWz&gt; (tdscnt=0,tpscnt=19,mdrcnt=4096,mprcnt=8)
Doing RNetShareEnum
RNetShareEnum gave 4 entries of 4 (1 4096 126 4096)
05/25/98 22:15:11 Transaction 66 of length 95
switch message SMBtrans2 (pid 3377)
chdir to /
chdir to /pcdisk/public
call_trans2findfirst: dirtype = 0, maxentries = 6, close_after_first=0, close_if_end = 0 requires_resume_key = 0 level = 260, max_data_bytes = 2432
unix_clean_name [./DESKTOP.INI]
unix_clean_name [desktop.ini]
unix_clean_name [./]
creating new dirptr 1 for path ./, expect_close = 1
05/25/98 22:15:11 Transaction 67 of length 53
switch message SMBgetatr (pid 3377)
chdir to /

[...]</PRE><P CLASS="para">
We cut off this listing after the first packet because it runs on for many pages. However, you should be aware that log levels above 3 will quickly fill your disk with megabytes of excruciating detail concerning Samba internal operations. Log level 3 is extremely useful for following exactly what the server is doing, and most of the time it will be obvious where an error is occurring by glancing through the log file.</P><P CLASS="para">
A word of warning: using a high log level (3 or above) will <EM CLASS="emphasis">
seriously</EM> slow down the Samba server. Remember that every log message generated causes a write to disk (an inherently slow operation) and log levels greater than 2 produce massive amounts of data. Essentially, you should turn on logging level 3 only when you're actively tracking a problem in the Samba server.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-946537" CLASS="title">9.1.1.2 Activating and deactivating logging</A></H4><P CLASS="para">To turn logging on and off, set the appropriate level in the <CODE CLASS="literal">
[global]</CODE> section of <I CLASS="filename">
smb.conf</I>. Then, you can either restart Samba, or force the current daemon to reprocess the configuration file. You also can send the <EM CLASS="emphasis">
smbd</EM> process a SIGUSR1 signal to increase its log level by one while it's running, and a SIGUSR2 signal to decrease it by one:</P><PRE CLASS="programlisting">
# Increase the logging level by 1
kill -SIGUSR1 1234

# Decrease the logging level by 1
kill -SIGUSR2 1234</PRE></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-34448" CLASS="title">
9.1.1.3 Logging by individual client machines or users</A></H4><P CLASS="para">An effective way to diagnose problems without hampering other users is to assign different log levels for different machines in <CODE CLASS="literal">
[global]</CODE> section of the <I CLASS="filename">
smb.conf</I> file. We can do this by building on the strategy we presented earlier:</P><PRE CLASS="programlisting">
[global]
	log level = 0
	log file = /usr/local/samba/lib/log.%m
	include = /usr/local/samba/lib/smb.conf.%m</PRE><P CLASS="para">
These options instruct Samba to use unique configuration and log files for each client that connects. Now all you have to do is create an <I CLASS="filename">
smb.conf</I> file for a specific client machine with a <CODE CLASS="literal">
log</CODE> <CODE CLASS="literal">
level</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
3</CODE> entry in it (the others will pick up the default log level of 0) and use that log file to track down the problem.</P><P CLASS="para">
Similarly, if only particular users are experiencing a problem, and it travels from machine to machine with them, you can isolate logging to a specific user by adding the following to the <I CLASS="filename">
smb.conf</I> file:</P><PRE CLASS="programlisting">
[global]
	log level = 0
	log file = /usr/local/samba/lib/log.%u
	include = /usr/local/samba/lib/smb.conf.%u</PRE><P CLASS="para">
Then you can create a unique <I CLASS="filename">
smb.conf</I> file for each user (e.g., <I CLASS="filename">
/usr/local/samba/lib/smb.conf.tim</I>) files containing the configuration option <CODE CLASS="literal">
log</CODE> <CODE CLASS="literal">
level</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
3</CODE> and only those users will get more detailed logging.</P></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-945079" CLASS="title">9.1.2 Samba Test Utilities</A></H3><P CLASS="para">A rigorous set of tests that exercise the major parts of Samba are described in various files in the <EM CLASS="emphasis">
/docs/textdocs</EM> directory of the Samba distribution kit, starting with <EM CLASS="emphasis">
DIAGNOSIS.TXT.</EM> The fault tree in this chapter is a more detailed version of the basic tests suggested by the Samba team, but covers only installation and reconfiguration diagnosis, like <EM CLASS="emphasis">
DIAGNOSIS.TXT.</EM> The other files in the <EM CLASS="emphasis">
/docs</EM> subdirectoryies address specific problems (such as Windows NT clients) and instruct you how to troubleshoot items not included in this book. If the fault tree doesn't suffice, be sure to look at <EM CLASS="emphasis">
DIAGNOSIS.TXT</EM> and its friends.</P></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-945083" CLASS="title">
9.1.3 Unix Utilities</A></H3><P CLASS="para">Sometimes it's useful to use a tool outside of the Samba suite to examine what's happening inside the server. Unix has always been a "kitchen-sink" operating system. Two diagnostic tools can be of particular help in debugging Samba troubles: <EM CLASS="emphasis">
trace</EM> and <EM CLASS="emphasis">
tcpdump</EM>.</P><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-945085" CLASS="title">
9.1.3.1 Using trace</A></H4><P CLASS="para">
The <EM CLASS="emphasis">
trace</EM> command masquerades under several different names, depending on the operating system that you are using. On Linux it will be <EM CLASS="emphasis">
strace</EM>, on Solaris you'll use <EM CLASS="emphasis">
truss</EM>, and SGI will have <EM CLASS="emphasis">
padc</EM> and <EM CLASS="emphasis">
par</EM>. All have essentially the same function, which is to display each operating system function call as it is executed. This allows you to follow the execution of a program, such as the Samba server, and will often pinpoint the exact call that is causing the difficulty.</P><P CLASS="para">
One problem that <EM CLASS="emphasis">
trace</EM> can highlight is the location of an incorrect version of a dynamically linked library. This can happen if you've downloaded prebuilt binaries of Samba. You'll typically see the offending call at the end of the <EM CLASS="emphasis">
trace</EM>, just before the program terminates.</P><P CLASS="para">
A sample <CODE CLASS="literal">
strace</CODE> output for the Linux operating system follows. This is a small section of a larger file created during the opening of a directory on the Samba server. Each line is a system-call name, and includes its parameters and the return value. If there was an error, the error value (e.g., <CODE CLASS="literal">
ENOENT</CODE>) and its explanation are also shown. You can look up the parameter types and the errors that can occur in the appropriate <CODE CLASS="literal">
trace</CODE> manual page for the operating system that you are using.</P><PRE CLASS="programlisting">
chdir(&quot;/pcdisk/public&quot;)                 = 0
stat(&quot;mini/desktop.ini&quot;, 0xbffff7ec)    = -1 ENOENT (No such file or directory)
stat(&quot;mini&quot;, {st_mode=S_IFDIR|0755, st_size=1024, ...}) = 0
stat(&quot;mini/desktop.ini&quot;, 0xbffff7ec)    = -1 ENOENT (No such file or directory)
open(&quot;mini&quot;, O_RDONLY)                  = 5
fcntl(5, F_SETFD, FD_CLOEXEC)           = 0
fstat(5, {st_mode=S_IFDIR|0755, st_size=1024, ...}) = 0
lseek(5, 0, SEEK_CUR)                   = 0
SYS_141(0x5, 0xbfffdbbc, 0xedc, 0xbfffdbbc, 0x80ba708) = 196
lseek(5, 0, SEEK_CUR)                   = 1024
SYS_141(0x5, 0xbfffdbbc, 0xedc, 0xbfffdbbc, 0x80ba708) = 0
close(5)                                = 0
stat(&quot;mini/desktop.ini&quot;, 0xbffff86c)    = -1 ENOENT (No such file or directory)
write(3, &quot;\0\0\0#\377SMB\10\1\0\2\0\200\1\0&quot;..., 39) = 39
SYS_142(0xff, 0xbffffc3c, 0, 0, 0xbffffc08) = 1
read(3, &quot;\0\0\0?&quot;, 4)                   = 4
read(3, &quot;\377SMBu\0\0\0\0\0\0\0\0\0\0\0\0&quot;..., 63) = 63
time(NULL)                              = 896143871</PRE><P CLASS="para">
This example shows several <CODE CLASS="literal">
stat</CODE> calls failing to find the files they were expecting. You don't have to be a expert to see that the file <EM CLASS="emphasis">
desktop.ini</EM> is missing from that directory. In fact, many difficult problems can be identified by looking for obvious, repeatable errors with <EM CLASS="emphasis">
trace</EM>. Often, you need not look farther than the last message before a crash.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-945114" CLASS="title">
9.1.3.2 Using tcpdump</A></H4><P CLASS="para">
The <EM CLASS="emphasis">
tcpdump</EM> program, written by Van Jacobson, Craig Leres, and Steven McCanne, and extended by Andrew Tridgell, allows you to monitor network traffic in real time. A variety of output formats are available and you can filter the output to look at only a particular type of traffic. The <EM CLASS="emphasis">
tcpdump</EM> program lets you examine all conversations between client and server, including SMB and NMB broadcast messages. While its troubleshooting capabilities lie mainly at the OSI network layer, you can still use its output to get a general idea of what the server and client are attempting to accomplish.</P><P CLASS="para">
A sample <EM CLASS="emphasis">
tcpdump</EM> log follows. In this instance, the client has requested a directory listing and the server has responded appropriately, giving the directory names <CODE CLASS="literal">
homes</CODE>, <CODE CLASS="literal">
public</CODE>, <CODE CLASS="literal">
IPC$</CODE>, and <CODE CLASS="literal">
temp</CODE> (we've added a few explanations on the right):</P><PRE CLASS="programlisting">
$<CODE CLASS="userinput">
<B>
tcpdump -v -s 255 -i eth0 port not telnet</B></CODE>
SMB PACKET: SMBtrans (REQUEST)	                        <CODE CLASS="replaceable">
<I>
Request packet</I></CODE>
SMB Command   =  0x25                                 <CODE CLASS="replaceable">
<I>
Request was ls or dir</I></CODE>.

[000] 01 00 00 10                                     ....


&gt;&gt;&gt; NBT Packet                                                                 <CODE CLASS="replaceable">
<I>
Outer frame of SMB packe</I></CODE>t
NBT Session Packet
Flags=0x0
Length=226
[lines skipped]
                         
SMB PACKET: SMBtrans (REPLY)	                           <CODE CLASS="replaceable">
<I>
Beginning of a reply to  request </I></CODE>
SMB Command   =  0x25			                                  <CODE CLASS="replaceable">
<I>
Command was an ls or dir</I></CODE>
Error class   =  0x0			 
Error code    =  0                                                                    <CODE CLASS="replaceable">
<I>
No errors</I></CODE>
Flags1        =  0x80
Flags2        =  0x1
Tree ID       =  105
Proc ID       =  6075
UID           =  100
MID           =  30337
Word Count    =  10
TotParamCnt=8 
TotDataCnt=163 
Res1=0
ParamCnt=8 
ParamOff=55 
Res2=0 
DataCnt=163 
DataOff=63 
Res3=0
Lsetup=0
Param Data: (8 bytes)
[000] 00 00 00 00 05 00 05 00                           ........ 

Data Data: (135 bytes)                                                        <CODE CLASS="replaceable">
<I>
			Actual directory contents:</I></CODE>
[000] 68 6F 6D 65 73 00 00 00  00 00 00 00 00 00 00 00  homes... ........
[010] 64 00 00 00 70 75 62 6C  69 63 00 00 00 00 00 00  d...publ ic......
[020] 00 00 00 00 75 00 00 00  74 65 6D 70 00 00 00 00  ....u... temp....
[030] 00 00 00 00 00 00 00 00  76 00 00 00 49 50 43 24  ........ v...IPC$
[040] 00 00 00 00 00 00 00 00  00 00 03 00 77 00 00 00  ........ ....w...
[050] 64 6F 6E 68 61 6D 00 00  00 00 00 00 00 00 00 00  donham.. ........
[060] 92 00 00 00 48 6F 6D 65  20 44 69 72 65 63 74 6F  ....Home  Directo
[070] 72 69 65 73 00 00 00 49  50 43 20 53 65 72 76 69  ries...I PC Servi
[080] 63 65 20 28 53 61 6D                              ce (Sam</PRE><P CLASS="para">
This is more of the same debugging session as with the <A HREF="trace.html" CLASS="systemitem.url">
trace</A> command; the listing of a directory. The options we used were <CODE CLASS="literal">
-v</CODE> (verbose), <CODE CLASS="literal">
-i</CODE> <CODE CLASS="literal">
eth0</CODE> to tell <EM CLASS="emphasis">
tcpdump</EM> the interface to listen on (an Ethernet port), and <CODE CLASS="literal">
-s</CODE> <CODE CLASS="literal">
255</CODE> to tell it to save the first 255 bytes of each packet instead of the default: the first 68. The option <CODE CLASS="literal">
port</CODE> <CODE CLASS="literal">
not</CODE> <CODE CLASS="literal">
telnet</CODE> is used to avoid screens of telnet traffic, since we were logged in to the server remotely. The <EM CLASS="emphasis">
tcpdump</EM> program actually has quite a number of options to filter just the traffic you want to look at. If you've used <EM CLASS="emphasis">
snoop</EM> or <EM CLASS="emphasis">
etherdump</EM>, they'll look vaguely familiar.</P><P CLASS="para">
You can download the modified <EM CLASS="emphasis">
tcpdump</EM> from the Samba FTP server at <I CLASS="filename">
ftp://samba.anu.edu.au/pub/samba/tcpdump-smb</I>. Other versions don't include support for the SMB protocol; if you don't see output such as that shown in the example, you'll need to<EM CLASS="emphasis">
</EM> use the SMB-enabled version.</P></DIV></DIV></DIV></DIV></BLOCKQUOTE>
<DIV>
<CENTER>
<HR NOSHADE SIZE="1"><TABLE WIDTH="515" CELLSPACING="0" CELLPADDING="0" BORDER="0">
<TR>
<TD WIDTH="172" VALIGN="TOP" ALIGN="LEFT">
<A TITLE="8.7 Backups with smbtar" HREF="ch08_07.html" CLASS="sect1">
<IMG ALT="Previous: 8.7 Backups with smbtar" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtpreva.gif" BORDER="0"></A></TD><TD WIDTH="171" VALIGN="TOP" ALIGN="CENTER">
<A TITLE="" HREF="index.html" CLASS="book">
<IMG ALT="" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txthome.gif" BORDER="0"></A></TD><TD WIDTH="172" VALIGN="TOP" ALIGN="RIGHT">
<A TITLE="9.2 The Fault Tree" HREF="ch09_02.html" CLASS="sect1">
<IMG ALT="Next: 9.2 The Fault Tree" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtnexta.gif" BORDER="0"></A></TD></TR><TR>
<TD WIDTH="172" VALIGN="TOP" ALIGN="LEFT">8.7 Backups with smbtar</TD><TD WIDTH="171" VALIGN="TOP" ALIGN="CENTER">
<A TITLE="Book Index" HREF="http://www.oreilly.com/catalog/samba/inx.html" CLASS="index">
<IMG ALT="Book Index" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/index.gif" BORDER="0"></A></TD><TD WIDTH="172" VALIGN="TOP" ALIGN="RIGHT">
9.2 The Fault Tree</TD></TR></TABLE><HR NOSHADE SIZE="1"></CENTER>
</DIV>

<!--  End of sample chapter -->
<P><B>Back to: <A HREF="http://www.oreilly.com/catalog/samba/noframes.html">Using Samba</A></B>
<CENTER>
<HR NOSHADE SIZE="1">
<FONT SIZE="1" FACE="Verdana, Arial, Helvetica">
<A HREF="http://www.oreilly.com/">
<B>O'Reilly Home</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/sales/bookstores">
<B>O'Reilly Bookstores</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/order_new/">
<B>How to Order</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/oreilly/contact.html">
<B>O'Reilly Contacts<BR></B></A>
<A HREF="http://www.oreilly.com/international/">
<B>International</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/oreilly/about.html">
<B>About O'Reilly</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/affiliates.html">
<B>Affiliated Companies</B></A><P>
<EM>&copy; 1999, O'Reilly &amp; Associates, Inc.</EM>
</FONT>
</CENTER>
</BODY>

<!-- Mirrored from 63.227.213.92 by HTTrack/2.x [XR/YP'2000] -->
</HTML>
