<!DOCTYPE HTML PUBLIC "html.dtd">
<HTML>

<!-- Mirrored from 63.227.213.92 by HTTrack/2.x [XR/YP'2000] -->
<HEAD>
<TITLE>
[Chapter 9] 9.2 The Fault Tree</TITLE><META NAME="DC.title" CONTENT=""><META NAME="DC.creator" CONTENT=""><META NAME="DC.publisher" CONTENT="O'Reilly &amp; Associates, Inc."><META NAME="DC.date" CONTENT="1999-11-05T21:36:27Z"><META NAME="DC.type" CONTENT="Text.Monograph"><META NAME="DC.format" SCHEME="MIME" CONTENT="text/html"><META NAME="DC.source" SCHEME="ISBN" CONTENT=""><META NAME="DC.language" CONTENT="en-US"><META NAME="generator" CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"></HEAD>
<BODY VLINK="#0000CC" TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#990000">
<TABLE WIDTH="90%" CELLSPACING="0" CELLPADDING="0" BORDER="0">
<TR>
<TD COLSPAN="2">
<IMG WIDTH="515" ALT="Search the Catalog" SRC="http://www.oreilly.com/graphics_new/catalog_header_buttons.gif" HEIGHT="37" ISMAP ALIGN="BOTTOM" USEMAP="#catalog_header_buttons" BORDER="0">
<MAP NAME="catalog_header_buttons">
<AREA SHAPE="Rect" HREF="http://www.oreilly.com/search.html" COORDS="407,17,512,32">
<AREA SHAPE="Rect" HREF="http://www.oreilly.com/catalog/prdindex.html" COORDS="431,3,512,18">
</MAP>
</TD>
</TR>
<TR>
<TD WIDTH="25%" VALIGN="TOP">
<A HREF="http://www.oreilly.com/catalog/samba/">
<IMG ALT="Using Samba" VALIGN="top" VSPACE="10" HSPACE="10" SRC="http://www.oreilly.com/catalog/covers/samba.s.gif" ALIGN="left" BORDER="0">
</A>
</TD>
<TD VALIGN="TOP" HEIGHT="105">
<BR>
<H2>Using Samba</H2>
<FONT SIZE="-1">
Robert Eckstein, David Collier-Brown, Peter Kelly
<BR>1st Edition November 1999
<BR>1-56592-449-5, Order Number: 4495
<BR>416 pages, $34.95
</FONT>
</TD>
</TR>
</TABLE>
<HR NOSHADE SIZE="1">
<!-- sample chapter begins -->

<CENTER>
<DIV CLASS="htmlnav">
<TABLE WIDTH="515" CELLSPACING="0" CELLPADDING="0" BORDER="0">
<TR>
<TD WIDTH="172" VALIGN="TOP" ALIGN="LEFT">
<A TITLE="9.1 The Tool Bag" HREF="ch09_01.html" CLASS="sect1">
<IMG ALT="Previous: 9.1 The Tool Bag" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtpreva.gif" BORDER="0"></A></TD><TD WIDTH="171" VALIGN="TOP" ALIGN="CENTER">
<B>
<FONT SIZE="-1" FACE="ARIEL,HELVETICA,HELV,SANSERIF">
<A TITLE="9. Troubleshooting Samba" REL="up" HREF="ch09_01.html" CLASS="chapter">
Chapter 9<BR>
Troubleshooting Samba</A></FONT></B></TD><TD WIDTH="172" VALIGN="TOP" ALIGN="RIGHT">
<A TITLE="9.3 Extra Resources" HREF="ch09_03.html" CLASS="sect1">
<IMG ALT="Next: 9.3 Extra Resources" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtnexta.gif" BORDER="0"></A></TD></TR></TABLE>&nbsp;<HR NOSHADE SIZE="1"></CENTER>
</DIV>
<BLOCKQUOTE>
<DIV>
<H2 CLASS="sect1">
<A NAME="ch09-29538" CLASS="title">
9.2 The Fault Tree</A></H2><P CLASS="para">The fault tree is for diagnosing and fixing problems that occur when you're installing and reconfiguring Samba. It's an expanded form of a trouble and diagnostic document that is part of the Samba distribution.</P><P CLASS="para">Before you set out to troubleshoot any part of the Samba suite, you should know the following information:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945178" CLASS="listitem">
</A> Your client IP address (we use 192.168.236.10) </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945179" CLASS="listitem">
</A> Your server IP address (we use 192.168.236.86) </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945180" CLASS="listitem">
</A> The netmask for your network (typically 255.255.255.0)</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945181" CLASS="listitem">
</A> Whether the machines are all on the same subnet (ours are)</P></LI></UL><P CLASS="para">
For clarity, we've renamed the server in the following examples to <EM CLASS="emphasis">
server.example.com</EM>, and the client machine to <EM CLASS="emphasis">
client.example.com</EM>.</P><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-945183" CLASS="title">
9.2.1 How to use the fault tree</A></H3><P CLASS="para">Start the tests here, without skipping forward; it won't take long (about five minutes) and may actually save you time backtracking. Whenever a test succeeds, you will be given a section name and page number to which you can safely skip.</P></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-953555" CLASS="title">
9.2.2 Troubleshooting Low-level IP </A></H3><P CLASS="para">The first series of tests is that of the low-level services that Samba needs in order to run. The tests in this section will verify that:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945191" CLASS="listitem">
</A> The IP software works</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945192" CLASS="listitem">
</A> The Ethernet hardware works</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945193" CLASS="listitem">
</A> Basic name service is in place</P></LI></UL><P CLASS="para">
Subsequent sections will add TCP software, the Samba daemons <EM CLASS="emphasis">
smbd</EM> and <EM CLASS="emphasis">
nmbd</EM>, host-based access control, authentication and per-user access control, file services, and browsing. The tests are described in considerable detail in order to make them understandable by both technically oriented end users and experienced systems and network administrators.</P><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-945197" CLASS="title">
9.2.2.1 Testing the networking software with ping </A></H4><P CLASS="para">
The first command to enter on both the server and the client is <CODE CLASS="literal">
ping 127.0.0.1</CODE>. This is the <I CLASS="firstterm">
loopback</I> <EM CLASS="emphasis">
address</EM> and testing it will indicate whether any networking support is functioning at all. On Unix, you can use <CODE CLASS="literal">
ping</CODE> <CODE CLASS="literal">
127.0.0.1</CODE> with the statistics option and interrupt it after a few lines. On Sun workstations, the command is typically <CODE CLASS="literal">
/usr/etc/ping</CODE> <CODE CLASS="literal">
-s</CODE> <CODE CLASS="literal">
127.0.0.1</CODE>; on Linux, just <CODE CLASS="literal">
ping</CODE> <CODE CLASS="literal">
127.0.0.1</CODE>. On Windows clients, run <CODE CLASS="literal">
ping</CODE> <CODE CLASS="literal">
127.0.0.1</CODE> in an MS-DOS window and it will stop by itself after four lines.</P><P CLASS="para">
Here is an example on a Linux server:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> ping 127.0.0.1 </B>
</PRE><PRE CLASS="programlisting">
PING localhost: 56 data bytes 64 bytes from localhost (127.0.0.1): 
icmp-seq=0. time=1. ms 64 bytes from localhost (127.0.0.1): 
icmp-seq=1. time=0. ms 64 bytes from localhost (127.0.0.1): 
icmp-seq=2. time=1. ms ^C 
----127.0.0.1 PING Statistics---- 
3 packets transmitted, 3 packets received, 0% packet loss round-trip (ms)  
min/avg/max = 0/0/1  </PRE><P CLASS="para">
If you get "ping: no answer from..." or "100% packet loss," you have no IP networking at all installed on the machine. The address <CODE CLASS="literal">
127.0.0.1</CODE> is the internal loopback address and doesn't depend on the computer being physically connected to a network. If this test fails, you have a serious local problem. TCP/IP either isn't installed or is seriously misconfigured. See your operating system documentation if it is a Unix server. If it is a Windows client, follow the instructions in <B>Chapter 3, <CITE CLASS="chapter">
Configuring Windows Clients</CITE></B>, to install networking support.</P><P CLASS="para">
If <EM CLASS="emphasis">
you're</EM> the network manager, some good references are Craig Hunt's <EM CLASS="emphasis">
TCP/IP Network Administration</EM>, Chapter 11, and Craig Hunt &amp; Robert Bruce Thompson's new book, <EM CLASS="emphasis">
Windows NT TCP/IP Network Administration, </EM>both published by O'Reilly.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-20350" CLASS="title">
9.2.2.2 Testing local name services with ping </A></H4><P CLASS="para">Next, try to ping <CODE CLASS="literal">
localhost</CODE> on the Samba server. <CODE CLASS="literal">
localhost</CODE> is the conventional hostname for the 127.0.0.1 loopback, and it should resolve to that address. After typing <CODE CLASS="literal">
ping</CODE> <CODE CLASS="literal">
localhost</CODE>, you should see output similar to the following:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE>  ping localhost  </B>
</PRE><PRE CLASS="programlisting">
PING localhost: 56 data bytes  64 bytes from localhost (127.0.0.1):
icmp-seq=0. time=0. ms  64 bytes from localhost (127.0.0.1): 
icmp-seq=1. time=0. ms  64 bytes from localhost (127.0.0.1): 
icmp-seq=2. time=0. ms  ^C</PRE><P CLASS="para">
If this succeeds, try the same test on the client. Otherwise:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-951025" CLASS="listitem">
</A>If you get "unknown host: localhost," there is a problem resolving the host name localhost into a valid IP address. (This may be as simple as a missing entry in a local <EM CLASS="emphasis">
hosts</EM> file.) From here, skip down to the section <A HREF="#ch09-23768" CLASS="xref">
Section 9.2.8, Troubleshooting Name Services</A>." </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946775" CLASS="listitem">
</A>If you get "ping: no answer," or "100% packet loss," but pinging 127.0.0.1 worked, then name services is resolving to an address, but it isn't the correct one. Check the file or database (typically <I CLASS="filename">
/etc/hosts</I> on a Unix system) that the name service is using to resolve addresses to ensure that the entry is corrected.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-946776" CLASS="title">
9.2.2.3 Testing the networking hardware with ping </A></H4><P CLASS="para">Next, ping the server's network IP address from itself. This should get you exactly the same results as pinging 127.0.0.1:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> ping 192.168.236.86 </B>
</PRE><PRE CLASS="programlisting">
PING 192.168.236.86: 56 data bytes 64 bytes from 192.168.236.86 (192.168.236.86): 
icmp-seq=0. time=1. ms 64 bytes from 192.168.236.86 (192.168.236.86): 
icmp-seq=1. time=0. ms 64 bytes from 192.168.236.86 (192.168.236.86): 
icmp-seq=2. time=1. ms ^C 
----192.168.236.86 PING Statistics---- 
3 packets transmitted, 3 packets received, 0% packet loss round-trip (ms)  
min/avg/max = 0/0/1</PRE><P CLASS="para">
If this works on the server, repeat it for the client. Otherwise:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945243" CLASS="listitem">
</A>If <CODE CLASS="literal">
ping</CODE> <CODE CLASS="replaceable">
<I>
network_ip</I></CODE> fails on either the server or client, but ping 127.0.0.1 works on that machine, you have a TCP/IP problem that is specific to the Ethernet network interface card on the computer. Check with the documentation for the network card or the host operating system to determine how to correctly configure it. However, be aware that on some operating systems, the <EM CLASS="emphasis">
ping</EM> command appears to work even if the network is disconnected, so this test doesn't always diagnose all hardware problems. </P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-84079" CLASS="title">
9.2.2.4 Testing connections with ping</A></H4><P CLASS="para">Now, ping the server by name (instead of its IP address), once from the server and once from the client. This is the general test for working network hardware:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> ping server </B>
</PRE><PRE CLASS="programlisting">
PING server.example.com: 56 data bytes 64 bytes from server.example.com (192.168.236.86): 
icmp-seq=0. time=1. ms 64 bytes from server.example.com (192.168.236.86): 
icmp-seq=1. time=0. ms 64 bytes from server.example.com (192.168.236.86): 
icmp-seq=2. time=1. ms ^C 
----server.example.com PING Statistics---- 
3 packets transmitted, 3 packets received, 0% packet loss round-trip (ms)  
min/avg/max = 0/0/1</PRE><P CLASS="para">
On Microsoft Windows, a ping of the server would look like <A HREF="#ch09-91668" CLASS="xref">
Figure 9.1</A>.  </P><H4 CLASS="figure">
<A NAME="ch09-91668" CLASS="title">
Figure 9.1: Pinging the Samba server from a Windows client</A></H4><IMG ALT="Figure 9.1" CLASS="graphic" SRC="figs/sam.0901.gif"><P CLASS="para">
If successful, this test tells us five things:</P><OL CLASS="orderedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946836" CLASS="listitem">
</A>The hostname (e.g., "server") is being found by your local nameserver.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946837" CLASS="listitem">
</A>The hostname has been expanded to the full name (e.g., <A TITLE="server.example.com" HREF="mailto:server.example.com" CLASS="email">
server.example.com</A>).</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945264" CLASS="listitem">
</A>Its address is being returned (192.168.236.86).</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945265" CLASS="listitem">
</A>The client has sent the Samba server four 56-byte UDP/IP packets.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945266" CLASS="listitem">
</A>The Samba server has replied to all four packets.</P></LI></OL><P CLASS="para">
If this test isn't successful, there can be one of several things wrong with the network:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945267" CLASS="listitem">
</A>First, if you get "ping: no answer," or "100% packet loss," you're not connecting to the network, the other machine isn't connecting, or one of the addresses is incorrect. Check the addresses that the <CODE CLASS="literal">
ping</CODE> command reports on each machine, and ensure that they match the ones you set up initially.</P><P CLASS="para">
If not, there is at least one mismatched address between the two machines. Try entering the command <CODE CLASS="literal">
arp</CODE> <CODE CLASS="literal">
-a</CODE>, and see if there is an entry for the other machine. The <CODE CLASS="literal">
arp</CODE> command stands for the Address Resolution Protocol. The <CODE CLASS="literal">
arp</CODE> <CODE CLASS="literal">
-a</CODE> command lists all the addresses known on the local machine. Here are some things to try:</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946854" CLASS="listitem">
</A>If you receive a message like "192.168.236.86 at (incomplete)," the Ethernet address of 192.168.236.86 is unknown. This indicates a complete lack of connectivity, and you're likely having a problem at the very bottom of the TCP/IP Network Administration protocol stack, at the Ethernet-interface layer. This is discussed in Chapters 5 and 6 of <CITE CLASS="citetitle">
TCP/IP Network Administration </CITE>(O'Reilly).</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945274" CLASS="listitem">
</A>If you receive a response similar to "server (192.168.236.86) at 8:0:20:12:7c:94," then the server has been reached at some time, or another machine is answering on its behalf. However, this means that <EM CLASS="emphasis">
ping</EM> should have worked: you may have an intermittent networking or ARP problem.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945275" CLASS="listitem">
</A>If the IP address from ARP doesn't match the addresses you expected, investigate and correct the addresses manually.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945284" CLASS="listitem">
</A>If each machine can ping itself but not another, something is wrong on the network between them.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945287" CLASS="listitem">
</A>If you get "ping: network unreachable" or "ICMP Host Unreachable," then you're not receiving an answer and there is likely more than one network involved.</P><P CLASS="para">
In principle, you shouldn't try to troubleshoot SMB clients and servers on different networks. Try to test a server and client on the same network. The three tests that follow assume you might be testing between two networks:</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-951057" CLASS="listitem">
</A>First, perform the tests for no answer described earlier in this section. If this doesn't identify the problem, the remaining possibilities are the following: an address is wrong, your netmask is wrong, a network is down, or just possibly you've been stopped by a firewall.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-951077" CLASS="listitem">
</A>Check both the address and the netmasks on source and destination machines to see if something is obviously wrong. Assuming both machines really are on the same network, they both should have the same netmasks and <EM CLASS="emphasis">
ping</EM> should report the correct addresses. If the addresses are wrong, you'll need to correct them. If they're right, the programs may be confused by an incorrect netmask. See <A HREF="#ch09-21203" CLASS="xref">
Section 9.2.9.1, Netmasks</A>," later in this chapter.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945300" CLASS="listitem">
</A>If the commands are still reporting that the network is unreachable and neither of the previous two conditions is in error, one network really may be unreachable from the other. This, too, is a network manager issue.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946936" CLASS="listitem">
</A>If you get "ICMP Administratively Prohibited," you've struck a firewall of some sort or a misconfigured router. You will need to speak to your network security officer.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946938" CLASS="listitem">
</A>If you get "ICMP Host redirect," and <EM CLASS="emphasis">
ping</EM> reports packets getting through, this is generally harmless: you're simply being rerouted over the network.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945305" CLASS="listitem">
</A>If you get a host redirect and no <EM CLASS="emphasis">
ping</EM> responses, you are being redirected, but no one is responding. Treat this just like the "Network unreachable" response   and check your addresses and netmasks.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945308" CLASS="listitem">
</A>If you get "ICMP Host Unreachable from gateway <EM CLASS="emphasis">
gateway_name</EM>," ping packets are being routed to another network, but the other machine isn't responding and the router is reporting the problem on its behalf. Again, treat this like a "Network unreachable" response and start checking addresses and netmasks.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946955" CLASS="listitem">
</A>If you get "ping: unknown host <EM CLASS="emphasis">
hostname</EM>," your machine's name is not known. This tends to indicate a name-service problem, which didn't affect <CODE CLASS="literal">
localhost</CODE>. Have a look at <A HREF="#ch09-23768" CLASS="xref">
Section 9.2.8</A>," later in this chapter.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946959" CLASS="listitem">
</A>If you get a partial success, with some pings failing but others succeeding, you either have an intermittent problem between the machines or an overloaded network. Ping for longer, and see if more than about 3 percent of the packets fail. If so, check it with your network manager: a problem may just be starting. However, if only a few fail, or if you happen to know some massive network program is running, don't worry unduly. Ping's ICMP (and UDP) are designed to drop occasional packets.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945319" CLASS="listitem">
</A>If you get a response like "smtsvr.antares.net is alive" when you actually pinged <EM CLASS="emphasis">
client.example.com</EM>, you're either using someone else's address or the machine has multiple names and addresses. If the address is wrong, name service is clearly the culprit; you'll need to change the address in the name service database to refer to the right machine. This is discussed in <A HREF="#ch09-23768" CLASS="xref">
Section 9.2.8</A>," later in this chapter.</P><P CLASS="para">
Server machines are often <EM CLASS="emphasis">
multihomed</EM> : connected to more than one network, with different names on each net. If you are getting a response from an unexpected name on a multihomed server, look at the address and see if it's on your network (see the section <A HREF="#ch09-21203" CLASS="xref">
Section 9.2.9.1</A>," later in this chapter). If so, you should use that address, rather than one on a different network, for both performance and reliability reasons.</P><P CLASS="para">
Servers may also have multiple names for a single Ethernet address, especially if they are web servers. This is harmless, if otherwise startling. You probably will want to use the official (and permanent) name, rather than an alias which may change.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945333" CLASS="listitem">
</A>If everything works, but the IP address reported is 127.0.0.1, you have a name service error. This typically occurs when a operating system installation program generates an <I CLASS="filename">
/etc/hosts</I> line similar to <CODE CLASS="literal">
127.0.0.1</CODE> <CODE CLASS="literal">
localhost</CODE> <EM CLASS="emphasis">
hostnamedomainname</EM>. The localhost line should say <CODE CLASS="literal">
127.0.0.1</CODE> <CODE CLASS="literal">
localhost</CODE> or <CODE CLASS="literal">
127.0.0.1</CODE> <CODE CLASS="literal">
localhost</CODE> <CODE CLASS="literal">
loghost</CODE>. Correct it, lest it cause failures to negotiate who is the master browse list holder and who is the master browser. It can, also cause (ambiguous) errors in later tests.</P></LI></UL><P CLASS="para">
If this worked from the server, repeat it from the client.</P></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-945336" CLASS="title">9.2.3 Troubleshooting TCP</A></H3><P CLASS="para">Now that you've tested IP, UDP, and a name service with <EM CLASS="emphasis">
ping</EM>, it's time to test TCP. <EM CLASS="emphasis">
ping</EM> and browsing use ICMP and UDP; file and print services (shares) use TCP. Both depend on IP as a lower layer and all four depend on name services. Testing TCP is most conveniently done using the FTP (file transfer protocol) program.</P><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-78512" CLASS="title">
9.2.3.1 Testing TCP with FTP </A></H4><P CLASS="para">
Try connecting via FTP, once from the server to itself, and once from the client to the server: </P><PRE CLASS="programlisting">
server%  <CODE CLASS="userinput">
<B>
ftp server</B></CODE>
Connected to server.example.com. 
220 server.example.com FTP server (Version 6.2/OpenBSD/Linux-0.10) ready.
 Name (server:davecb): 
331 Password required for davecb. 
Password: 
230 User davecb logged in.
 ftp&gt;<CODE CLASS="userinput">
<B>
 quit </B></CODE>
221 Goodbye. </PRE><P CLASS="para">
If this worked, skip to the section <A HREF="#ch09-88968" CLASS="xref">
Section 9.2.4, Troubleshooting Server Daemons</A>." Otherwise:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945357" CLASS="listitem">
</A>If you received the message "server: unknown host," then nameservice has failed. Go back to the corresponding <EM CLASS="emphasis">
ping</EM> step, <A HREF="#ch09-20350" CLASS="xref">
Section 9.2.2.2, Testing local name services with ping </A>,"  and rerun those tests to see why name lookup failed.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945362" CLASS="listitem">
</A>If you received "ftp: connect: Connection refused," the machine isn't running an FTP daemon. This is mildly unusual on Unix servers. Optionally, you might try this test by connecting to the machine using telnet instead of FTP; the messages are very similar and telnet uses TCP as well.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945364" CLASS="listitem">
</A>If there was a long pause, then "ftp: connect: Connection timed out," the machine isn't reachable. Return to the section <A HREF="#ch09-84079" CLASS="xref">
Section 9.2.2.4, Testing connections with ping</A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945369" CLASS="listitem">
</A>If you received "530 Logon Incorrect," you connected successfully, but you've just found a different problem. You likely provided an incorrect username or password. Try again, making sure you use your username from the Unix server and type your password correctly.</P></LI></UL></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-88968" CLASS="title">
9.2.4 Troubleshooting Server Daemons</A></H3><P CLASS="para">Once you've confirmed that TCP networking is working properly, the next step is to make sure the daemons are running on the server. This takes three separate tests because no single one of the following will decisively prove that they're working correctly.</P><P CLASS="para">
To be sure they're running, you need to find out if:</P><OL CLASS="orderedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945374" CLASS="listitem">
</A>The daemon has started</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945375" CLASS="listitem">
</A>The daemons are registered or bound to a TCP/IP port by the operating system</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945376" CLASS="listitem">
</A>They're actually paying attention</P></LI></OL><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-947020" CLASS="title">
9.2.4.1 Before you start</A></H4><P CLASS="para">
First, check the logs. If you've started the daemons, the message "smbd version <EM CLASS="emphasis">
some_number</EM> started" should appear. If it doesn't, you will need to restart the Samba daemons.</P><P CLASS="para">
If the daemon reports that it has indeed started, look out for "bind failed on port 139 socket_addr=0 (Address already in use)". This means another daemon has been started on port 139 (<EM CLASS="emphasis">
smbd </EM>). Also, <EM CLASS="emphasis">
nmbd</EM> will report a similar failure if it cannot bind to port 137. Either you've started them twice, or the <EM CLASS="emphasis">
inetd</EM> server has tried to provide a daemon for you. If it's the latter, we'll diagnose that in a moment.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-49239" CLASS="title">
9.2.4.2 Looking for daemon processes with ps</A></H4><P CLASS="para">
Next, you need to see if the daemons have been started. Use the <CODE CLASS="literal">
ps</CODE> command on the server with the <CODE CLASS="literal">
long</CODE> option for your machine type (commonly <CODE CLASS="literal">
ps</CODE> <CODE CLASS="literal">
ax</CODE> or <CODE CLASS="literal">
ps</CODE>    <CODE CLASS="literal">
-ef</CODE>), and see if you have either <EM CLASS="emphasis">
smbd</EM> and <EM CLASS="emphasis">
nmbd</EM> already running. This often looks like the following:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> ps ax</B>
</PRE><PRE CLASS="programlisting">
 PID TTY STAT TIME   COMMAND
 1   ?   S    0:03   init [2] 
 2   ?   SW   0:00   (kflushd)
<EM CLASS="emphasis">
(...many lines of processes...)</EM> 
 234 ?   S    0:14   nmbd -D3
 237 ?   S    0:11   smbd -D3
<EM CLASS="emphasis">
(...more lines, possibly including more smbd lines...) </EM></PRE><P CLASS="para">
This example illustrates that <EM CLASS="emphasis">
smbd</EM> and <EM CLASS="emphasis">
nmbd</EM> have already started as stand-alone daemons (the <CODE CLASS="literal">
-D</CODE> option) at log level 3.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-945392" CLASS="title">
9.2.4.3 Looking for daemons bound to ports</A></H4><P CLASS="para">
Next, the daemons have to be registered with the operating system so they can get access to TCP/IP ports. The <CODE CLASS="literal">
netstat</CODE> command will tell you if this has been done. Run the command <CODE CLASS="literal">
netstat</CODE> <CODE CLASS="literal">
-a</CODE> on the server, and look for lines mentioning <CODE CLASS="literal">
netbios</CODE>, <CODE CLASS="literal">
137</CODE> or <CODE CLASS="literal">
139</CODE>:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> netstat -a </B>
</PRE><PRE CLASS="programlisting">
Active Internet connections (including servers) 
Proto Recv-Q Send-Q  Local Address          Foreign Address      (state) 
udp   0      0       *.netbios-             *.* 
tcp   0      0       *.netbios-             *.*                                 LISTEN 
tcp   8370   8760    server.netbios-        client.1439               
ESTABLISHED </PRE><P CLASS="para">
or:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> netstat -a </B>
</PRE><PRE CLASS="programlisting">
Active Internet connections (including servers) 
Proto Recv-Q Send-Q  Local Address          Foreign Address        (state) 
udp   0      0       *.137                  *.* 
tcp   0      0       *.139                  *.*                                    LISTEN 
tcp   8370   8760    server.139             client.1439                 ESTABLISHED </PRE><P CLASS="para">
Among many similar lines, there should be at least one UDP line for <CODE CLASS="literal">
*.netbios-</CODE> or <CODE CLASS="literal">
*.137</CODE>. This indicates that the <EM CLASS="emphasis">
nmbd</EM> server is registered and (we hope) is waiting to answer requests. There should also be at least one TCP line mentioning    <CODE CLASS="literal">
*.netbios-</CODE> or <CODE CLASS="literal">
*.139</CODE>, and it will probably be in the LISTENING state. This means that <EM CLASS="emphasis">
smbd</EM> is up and listening for connections.</P><P CLASS="para">
There may be other TCP lines indicating connections from <EM CLASS="emphasis">
smbd</EM> to clients, one for each client. These are usually in the ESTABLISHED state. If there are <EM CLASS="emphasis">
smbd</EM> lines in the ESTABLISHED state, <EM CLASS="emphasis">
smbd</EM> is definitely running. If there is only one line in the LISTENING state, we're not sure yet. If both of the lines is missing, a daemon has not succeeded in starting, so it's time to check the logs and then go back to <B>Chapter 2</B>.</P><P CLASS="para">
If there is a line for each client, it may be coming either from a Samba daemon or from the master IP daemon, <EM CLASS="emphasis">
inetd</EM>. It's quite possible that your <EM CLASS="emphasis">
inetd</EM> startup file contains lines that start Samba daemons without your realizing it; for instance, the lines may have been placed there if you installed Samba as part of a Linux distribution. The daemons started by <EM CLASS="emphasis">
inetd</EM> prevent ours from running. This problem typically produces log messages such as "bind failed on port 139 socket_addr=0 (Address already in use)."</P><P CLASS="para">
Check your <I CLASS="filename">
/etc/inetd.conf</I> ; unless you're intentionally starting the daemons from there, there <EM CLASS="emphasis">
must not</EM> be any <CODE CLASS="literal">
netbios-ns</CODE> (udp port 137) or <CODE CLASS="literal">
netbios-ssn</CODE> (tcp port 139) servers mentioned there. <EM CLASS="emphasis">
inetd</EM> is a daemon that provides numerous services, controlled by entries in <EM CLASS="emphasis">
/etc/inetd.conf</EM>. If your system is providing an SMB daemon via <EM CLASS="emphasis">
inetd</EM>, there will be lines like the following in the file:</P><PRE CLASS="programlisting">
netbios-ssn stream tcp nowait root /usr/local/samba/bin/smbd smbd
netbios-ns dgram udp wait root /usr/local/samba/bin/nmbd nmbd</PRE></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-945425" CLASS="title">
9.2.4.4 Checking smbd with telnet</A></H4><P CLASS="para">
Ironically, the easiest way to test that the <EM CLASS="emphasis">
smbd</EM> server is actually working is to send it a meaningless message and see if it rejects it. Try something like the following:</P><PRE CLASS="programlisting">
<CODE CLASS="userinput">
<B>
echo hello | telnet localhost 139</B></CODE></PRE><P CLASS="para">
This sends an erroneous but harmless message to <EM CLASS="emphasis">
smbd</EM>. The <CODE CLASS="literal">
hello</CODE> message is important. Don't try telneting to the port and typing just anything; you'll probably just hang your process. <CODE CLASS="literal">
hello</CODE>, however, is generally a harmless message.</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> echo &quot;hello&quot; | telnet localhost 139 </B>
</PRE><PRE CLASS="programlisting">
Trying
Trying 192.168.236.86 ... 
Connected to localhost. Escape character is '^]'. 
Connection closed by foreign host. </PRE><P CLASS="para">
If you get a "Connected" message followed by a "Connection closed" message, the test was a success. You have an <EM CLASS="emphasis">
smbd</EM> daemon listening on the port and rejecting improper connection messages. On the other hand, if you get "telnet: connect: Connection refused," there is probably no daemon present. Check the logs and go back to <B>Chapter 2</B>.</P><P CLASS="para">
Regrettably, there isn't an easy test for <EM CLASS="emphasis">
nmbd</EM>. If the <CODE CLASS="literal">
telnet</CODE> test and the <CODE CLASS="literal">
netstat</CODE> test both say that there is an <EM CLASS="emphasis">
smbd</EM> running, there is a good chance that <CODE CLASS="literal">
netstat</CODE> will also be correct about <EM CLASS="emphasis">
nmbd</EM> running.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-67494" CLASS="title">
9.2.4.5 Testing daemons with testparm</A></H4><P CLASS="para">Once you know there's a daemon, you should always run <CODE CLASS="literal">
testparm</CODE>, in hopes of getting:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server%</CODE> testparm </B>
</PRE><PRE CLASS="programlisting">
Load smb config files from /opt/samba/lib/smb.conf
Processing section &quot;[homes]&quot; 
Processing section &quot;[printers]&quot; ... 
Processing section &quot;[tmp]&quot; 
Loaded services file OK. ... </PRE><P CLASS="para">
The <CODE CLASS="literal">
testparm</CODE> program normally reports processing a series of sections, and responds with "Loaded services file OK" if it succeeds. If not, it will report one or more of the following messages, which will also appear in the logs as noted:</P><DL CLASS="variablelist">
<DT CLASS="term">
<EM CLASS="emphasis">
"Allow/Deny connection from account (n) to service"</EM></DT><DD CLASS="listitem">
<P CLASS="para">
A <EM CLASS="emphasis">
testparm</EM>-only message produced if you have valid/invalid user options set in your <EM CLASS="emphasis">
smb.conf</EM>. You will want to make sure that you are on the valid user list, and that root, bin, etc., are on the invalid user list. If you don't, you will not be able to connect, or folks who shouldn't <EM CLASS="emphasis">
will</EM> be able to.</P></DD><DT CLASS="term">
<EM CLASS="emphasis">
"Warning: You have some share names that are longer than eight chars"</EM></DT><DD CLASS="listitem">
<P CLASS="para">
For anyone using Windows for Workgroups and older clients. They will fail to connect to shares with long names, producing an overflow message that sounds confusingly like a memory overflow.</P></DD><DT CLASS="term">
"Warning: [name] service MUST be printable!"</DT><DD CLASS="listitem">
<P CLASS="para">
A printer share lacks a <CODE CLASS="literal">
printable</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
yes</CODE> option.</P></DD><DT CLASS="term">
"No path in service name using [name]"</DT><DD CLASS="listitem">
<P CLASS="para">
A file share doesn't know which directory to provide to the user, or a print share doesn't know which directory to use for spooling. If no path is specified, the service will try to run with a path of <EM CLASS="emphasis">
/tmp</EM>, which may not be what you want.</P></DD><DT CLASS="term">
"Note: Servicename is flagged unavailable"</DT><DD CLASS="listitem">
<P CLASS="para">
Just a reminder that you have used the <CODE CLASS="literal">
available</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
no</CODE> option in a share.</P></DD><DT CLASS="term">
"Can't find include file [name]" </DT><DD CLASS="listitem">
<P CLASS="para">
A configuration file referred to by an <CODE CLASS="literal">
include</CODE> option did not exist. If you were including the file unconditionally, this is an error and probably a serious one: the share will not have the configuration you intended. If you were including it based one of the <CODE CLASS="literal">
%</CODE> variables, such as <CODE CLASS="literal">
%a</CODE> (architecture), you will need to decide if, for example, a missing Windows for Workgroups configuration file is a problem. It often isn't.</P></DD><DT CLASS="term">
"Can't copy service name, unable to copy to itself"</DT><DD CLASS="listitem">
<P CLASS="para">
You tried to copy a <I CLASS="filename">
smb.conf</I> section into itself.</P></DD><DT CLASS="term">
"Unable to copy service&nbsp;- source not found: [name]"</DT><DD CLASS="listitem">
<P CLASS="para">
Indicates a missing or misspelled section in a <CODE CLASS="literal">
copy</CODE> <CODE CLASS="literal">
=</CODE> option.</P></DD><DT CLASS="term">
"Ignoring unknown parameter name" </DT><DD CLASS="listitem">
<P CLASS="para">
Typically indicates an obsolete, misspelled or unsupported option.</P></DD><DT CLASS="term">
"Global parameter name found in service section" </DT><DD CLASS="listitem">
<P CLASS="para">
Indicates a global-only parameter has been used in an individual share. Samba will ignore the parameter.</P></DD></DL><P CLASS="para">
After the <CODE CLASS="literal">
testparm</CODE> test, repeat it with (exactly) three parameters: the name of your <I CLASS="filename">
smb.conf</I> file, the name of your client, and its IP address:</P><PRE CLASS="programlisting">
testparm <CODE CLASS="replaceable">
<I>
samba_directory</I></CODE>/lib/smb.conf client 192.168.236.10</PRE><P CLASS="para">
This will run one more test that checks the host name and address against <CODE CLASS="literal">
host</CODE> <CODE CLASS="literal">
allow</CODE> and <CODE CLASS="literal">
host</CODE> <CODE CLASS="literal">
deny</CODE> options and may produce the "Allow/Deny connection from account account_name" to service message for the client machine. This message indicates you have valid/invalid host options in your <I CLASS="filename">
smb.conf</I>, and they prohibit access from the client machine. Entering <CODE CLASS="literal">
testparm</CODE> <CODE CLASS="literal">
/usr/local/lib/experimental.conf</CODE> is also an effective way to test an experimental <I CLASS="filename">
smb.conf</I> file before putting it into production.</P></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-945478" CLASS="title">9.2.5 Troubleshooting SMB Connections</A></H3><P CLASS="para">Now that you know the servers are up, you need to make sure that they're running properly. We start with the <I CLASS="filename">
smb.conf</I> file in the <CODE CLASS="replaceable">
<I>
samba_directory</I></CODE><I CLASS="filename">
/lib</I> directory.</P><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-67928" CLASS="title">
9.2.5.1 A minimal smb.conf file</A></H4><P CLASS="para">
In the following tests, we assume you have a <CODE CLASS="literal">
[temp]</CODE> share suitable for testing, plus at least one account. An <I CLASS="filename">
smb.conf</I> file that includes just these is:</P><PRE CLASS="programlisting">
[global] 
    workgroup = <CODE CLASS="replaceable">
<I>
EXAMPLE</I></CODE> 
    security = user
    browsable = yes 
    local master = yes 
[homes] 
    guest ok = no 
    browseble = no
[temp] 
    path = /tmp 
    public = yes </PRE><P CLASS="para">
A word of warning: the <CODE CLASS="literal">
public</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
yes</CODE> option in the <CODE CLASS="literal">
[temp]</CODE> share is just for testing. You probably don't want people without accounts to be able to store things on your Samba server, so you should comment it out when you're done.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-40595" CLASS="title">
9.2.5.2 Testing locally with smbclient</A></H4><P CLASS="para">The first test is to ensure the server can list its own services (shares). Run the command <CODE CLASS="literal">
smbclient</CODE> with a <CODE CLASS="literal">
-L</CODE> option of <CODE CLASS="literal">
localhost</CODE> to connect to itself, and a <CODE CLASS="literal">
-U</CODE> option of just <CODE CLASS="literal">
%</CODE> to specify the guest user. You should see the following: </P><PRE CLASS="programlisting">
server% <CODE CLASS="userinput">
<B>
smbclient -L localhost -U% </B></CODE>
Server time is Wed May 27 17:57:40 1998 Timezone is UTC-4.0
Server=[localhost] 
User=[davecb] 
Workgroup=[EXAMPLE] 
Domain=[EXAMPLE]
	Sharename      Type      Comment 
	---------           -----       ----------
	temp               Disk
	IPC$               IPC       IPC Service (Samba 1.9.18) 
	homes            Disk       Home directories
This machine does not have a browse list </PRE><P CLASS="para">
If you received this output, move on to the next test, <A HREF="#ch09-77154" CLASS="xref">
Section 9.2.5.3, Testing connections with smbclient</A>." On the other hand, if you receive an error, check the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-950443" CLASS="listitem">
</A>If you get "Get_hostbyname: unknown host localhost," either you've spelled its name wrong or there actually is a problem (which should have been seen back in <A HREF="#ch09-20350" CLASS="xref">
Section 9.2.2.2</A>") In the latter case, move on to "Troubleshooting Name Services."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945526" CLASS="listitem">
</A>If you get "Connect error: Connection refused," the server machine was found, but it wasn't running an <EM CLASS="emphasis">
nmbd</EM> daemon. Skip back to "<A HREF="#ch09-88968" CLASS="xref">
Section 9.2.4</A>," and retest the daemons.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945531" CLASS="listitem">
</A>If you get the message "Your server software is being unfriendly," the initial session request packet got a garbage response from the server. The server may have crashed or started improperly. The common causes of this can be discovered by scanning the logs for:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945533" CLASS="listitem">
</A>Invalid command-line parameters to <EM CLASS="emphasis">
smbd </EM>; see the <EM CLASS="emphasis">
smbd</EM> manual page.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945534" CLASS="listitem">
</A>A fatal problem with the <I CLASS="filename">
smb.conf</I> file that prevents the startup of <EM CLASS="emphasis">
smbd</EM>. Always check your changes, as was done in the section "<A HREF="#ch09-67494" CLASS="xref">
Section 9.2.4.5, Testing daemons with testparm</A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947160" CLASS="listitem">
</A>The directories where Samba keeps its log and lock files are missing.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947165" CLASS="listitem">
</A>There is already a server on the port (139 for <EM CLASS="emphasis">
smbd</EM>, 137 for <EM CLASS="emphasis">
nmbd  </EM>), preventing it from starting.</P></LI></UL></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945543" CLASS="listitem">
</A>If you're using <EM CLASS="emphasis">
inetd</EM> instead of stand-alone daemons, check your <I CLASS="filename">
/etc/inetd.conf</I> and <I CLASS="filename">
/etc/services</I> entries against their manual pages for errors as well.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945544" CLASS="listitem">
</A>If you get a <CODE CLASS="literal">
Password:</CODE> prompt, your guest account is not set up properly. The <CODE CLASS="literal">
%U</CODE> option tells <EM CLASS="emphasis">
smbclient</EM> to do a "null login," which requires that the guest account be present but does not require it to have any privileges.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947172" CLASS="listitem">
</A>If you get the message "SMBtconX failed. ERRSRV&nbsp;- ERRaccess," you aren't permitted access to the server. This normally means you have a <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
hosts</CODE> option that doesn't include the server, or an <CODE CLASS="literal">
invalid</CODE> <CODE CLASS="literal">
hosts</CODE> option  that does. Recheck with the command <CODE CLASS="literal">
testparm</CODE> <CODE CLASS="literal">
smb.conf</CODE> <CODE CLASS="replaceable">
<I>
your_hostname</I></CODE> <CODE CLASS="replaceable">
<I>
your_ip_address</I></CODE> (see the section "<A HREF="#ch09-67494" CLASS="xref">
Section 9.2.4.5</A>") and correct any unintended prohibitions. </P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-77154" CLASS="title">
9.2.5.3 Testing connections with smbclient</A></H4><P CLASS="para">Run the command <CODE CLASS="literal">
smbclient</CODE> <CODE CLASS="literal">
\\</CODE><CODE CLASS="replaceable">
<I>
server</I></CODE><CODE CLASS="literal">
\temp</CODE>, which connects to your server's   <I CLASS="filename">
/tmp</I> share, to see if you can connect to a file service. You should get the following response:</P><PRE CLASS="programlisting">
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
server% </CODE>smbclient '\\server\temp' </B>
</PRE><PRE CLASS="programlisting">
Server time is Tue May  5 09:49:32 1998 Timezone is UTC-4.0 Password:
<B CLASS="emphasis.bold">
<CODE CLASS="literal">
smb: \&gt;</CODE> quit</B></PRE><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947183" CLASS="listitem">
</A>If you get "Get_Hostbyname: Unknown host name," "Connect error: Connection refused," or "Your server software is being unfriendly," see the section "<A HREF="#ch09-40595" CLASS="xref">
Section 9.2.5.2, Testing locally with smbclient</A>" for the diagnoses.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947188" CLASS="listitem">
</A>If you get the message "servertemp: Not enough `\' characters in service," you likely didn't quote the address, so Unix stripped off backslashes. You can also write the command:</P></LI></UL><PRE CLASS="programlisting">
<CODE CLASS="literal">
smbclient</CODE> <CODE CLASS="literal">
\\\\</CODE><CODE CLASS="replaceable">
<I>
server</I></CODE><CODE CLASS="literal">
\\temp</CODE> </PRE><P CLASS="para">
or: </P><PRE CLASS="programlisting">
smbclient //<CODE CLASS="replaceable">
<I>
server</I></CODE>/temp </PRE><P CLASS="para">
Now, provide your Unix account password to the <CODE CLASS="literal">
Password</CODE> prompt. If you then get an <CODE CLASS="literal">
smb\&gt;</CODE> prompt, it worked. Enter <CODE CLASS="literal">
quit</CODE>, and continue on to "<A HREF="#ch09-97081" CLASS="xref">
Section 9.2.5.4, Testing connections with NET USE</A>." If you then get "SMBtconX failed. ERRSRV&nbsp;- ERRinvnetname," the problem can be any of the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947201" CLASS="listitem">
</A>A wrong share name: you may have spelled it wrong, it may be too long, it may be in mixed case, or it may not be available. Check that it's what you expect with testparm (see the section <A HREF="#ch09-67494" CLASS="xref">
Section 9.2.4.5</A>.")</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947205" CLASS="listitem">
</A><CODE CLASS="literal">
security</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
share</CODE>, in which you may have to add <CODE CLASS="replaceable">
<I>
-U your_account</I></CODE> to the <EM CLASS="emphasis">
smbclient</EM> command, or know the password of a Unix account named temp. </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945578" CLASS="listitem">
</A>An erroneous username.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945579" CLASS="listitem">
</A>An erroneous password.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945580" CLASS="listitem">
</A>An <CODE CLASS="literal">
invalid</CODE> <CODE CLASS="literal">
users</CODE> or <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
users</CODE> option in your <EM CLASS="emphasis">
smb.conf</EM> file that doesn't allow your account to connect. Recheck with <CODE CLASS="literal">
testparm</CODE> <CODE CLASS="literal">
smb.conf</CODE> <CODE CLASS="replaceable">
<I>
your_hostname your_ip_address</I></CODE> (see "<A HREF="#ch09-67494" CLASS="xref">
Section 9.2.4.5</A>").</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945584" CLASS="listitem">
</A>A <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
hosts</CODE> option that doesn't include the server, or an <CODE CLASS="literal">
invalid</CODE> <CODE CLASS="literal">
hosts</CODE> option that does. Also test this with <EM CLASS="emphasis">
testparm</EM>.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945585" CLASS="listitem">
</A>A problem in authentication, such as if shadow passwords or the PAM (Password Authentication Module) is used on the server, but Samba is not compiled to use it. This is rare, but occasionally happens when a SunOS 4 Samba binary (no shadow passwords) is run without recompilation on a Solaris system (with shadow passwords).</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945586" CLASS="listitem">
</A>The <CODE CLASS="literal">
encrypted</CODE> <CODE CLASS="literal">
passwords</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
yes</CODE> option in the configuration file, but no password for your account in the <EM CLASS="emphasis">
smbpasswd</EM> file.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945587" CLASS="listitem">
</A>You have a null password entry, either in Unix <I CLASS="filename">
/etc/passwd</I> or in the <EM CLASS="emphasis">
smbpasswd</EM> file.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945588" CLASS="listitem">
</A>You are connecting to <CODE CLASS="literal">
[temp]</CODE>, and you do not have the <CODE CLASS="literal">
guest</CODE> <CODE CLASS="literal">
ok</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
yes</CODE> option in the <CODE CLASS="literal">
[temp]</CODE> section of the <EM CLASS="emphasis">
smb.conf</EM> file.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947992" CLASS="listitem">
</A>You are connecting to <CODE CLASS="literal">
[temp]</CODE> before connecting to your home directory, and your guest account isn't set up correctly. If you can connect to your home directory and then connect to <CODE CLASS="literal">
[temp]</CODE>, that's the problem. See <B>Chapter 2</B> for more information on creating a basic Samba configuration file.</P><P CLASS="para">
A bad guest account will also prevent you from printing or browsing until after you've logged in to your home directory. </P></LI></UL><P CLASS="para">
There is one more reason for this failure that has nothing at all to do with passwords: the <CODE CLASS="literal">
path</CODE> <CODE CLASS="literal">
=</CODE>  line in your <I CLASS="filename">
smb.conf</I> file may point somewhere that doesn't exist. This will not be diagnosed by <EM CLASS="emphasis">
testparm</EM>, and most SMB clients can't tell it from other types of bad user accounts. You will have to check it manually.</P><P CLASS="para">
Once you have connected to <CODE CLASS="literal">
[temp]</CODE> successfully, repeat the test, this time logging in to your home directory (e.g., map network drive <CODE CLASS="replaceable">
<I>
server</I></CODE><CODE CLASS="literal">
\davecb</CODE>) looking for failures in doing that. If you have to change anything to get that to work, re-test <CODE CLASS="literal">
[temp]</CODE> again afterwards.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-97081" CLASS="title">
9.2.5.4 Testing connections with NET USE</A></H4><P CLASS="para">Run the command <CODE CLASS="literal">
net</CODE> <CODE CLASS="literal">
use</CODE> <CODE CLASS="literal">
*</CODE> <CODE CLASS="literal">
\</CODE><CODE CLASS="replaceable">
<I>
server</I></CODE><CODE CLASS="literal">
\temp</CODE> on the DOS or Windows client to see if it can connect to the server. You should be prompted for a password, then receive the response "The command was completed successfully," as shown in <A HREF="#ch09-99328" CLASS="xref">
Figure 9.2</A>.    </P><H4 CLASS="figure">
<A NAME="ch09-99328" CLASS="title">
Figure 9.2: Results of the NET USE command</A></H4><IMG ALT="Figure 9.2" CLASS="graphic" SRC="figs/sam.0902.gif"><P CLASS="para">
If that succeeded, continue with the steps in the section <A HREF="#ch09-57065" CLASS="xref">
Section 9.2.5.5, Testing connections with Windows Explorer</A>." Otherwise:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945608" CLASS="listitem">
</A>If you get "The specified shared directory cannot be found," or "Cannot locate specified share name," the directory name is either misspelled or not in the <EM CLASS="emphasis">
smb.conf</EM> file. This message can also warn of a name in mixed case, including spaces, or is longer than eight characters.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945610" CLASS="listitem">
</A>If you get "The computer name specified in the network path cannot be located," or "Cannot locate specified computer," the directory name has been misspelled, the name service has failed, there is a networking problem, or the <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
deny</CODE> <CODE CLASS="literal">
=</CODE> option includes your host.</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945612" CLASS="listitem">
</A>If it is not a spelling mistake, you need to double back to at least the section <A HREF="#ch09-77154" CLASS="xref">
Section 9.2.5.3</A>," to investigate why it doesn't connect.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945617" CLASS="listitem">
</A>If <EM CLASS="emphasis">
smbclient</EM> does work, it's a name service problem with the client name service, and you need to go forward to the section <A HREF="#ch09-12446" CLASS="xref">
Section 9.2.6.2, Testing the server with nmblookup</A>," and see if you can look up both client and server with <EM CLASS="emphasis">
nmblookup</EM>.</P></LI></UL></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945622" CLASS="listitem">
</A>If you get "The password is invalid for <CODE CLASS="literal">
\</CODE><CODE CLASS="replaceable">
<I>
server</I></CODE><CODE CLASS="literal">
\</CODE><CODE CLASS="replaceable">
<I>
username</I></CODE>," your locally cached copy on the client doesn't match the one on the server. You will be prompted for a replacement.</P></LI></UL><P CLASS="para">
Windows 95 and 98 clients keep a local <EM CLASS="emphasis">
password</EM> file, but it's really just a cached copy of the password it sends to Samba and NT servers to authenticate you. That's what is being prompted for here. You can still log on to a Windows machine without a password (but not to NT).</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
If you provide your password, and it still fails, your password is not being matched on the server, you have a <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
users</CODE> or <CODE CLASS="literal">
invalid</CODE> <CODE CLASS="literal">
users</CODE> list denying you permission, NetBEUI is interfering, or the encrypted password problem described in the next paragraph exists.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945627" CLASS="listitem">
</A>If your client is NT 4.0, NT 3.5 with Patch 3, Windows 95 with Patch 3, Windows 98 or any of these with Internet Explorer 4.0, these default to using Microsoft encryption for passwords (discussed in <B>Chapter 6, <CITE CLASS="chapter">
Users, Security, and Domains </CITE></B>'s <B>Section 6.4, Passwords</B> in <B>Chapter 6</B>" section, along with the alternatives). In general, if you have installed a major Microsoft product recently, you may have applied an update and turned on encrypted passwords.</P></LI></UL><P CLASS="para">
Because of Internet Explorer's willingness to honor URLs such as <I CLASS="filename">
file://somehost/somefile</I> by making SMB connections, clients up to and including Windows 95 Patch Level 2 would happily send your password, in plaintext, to SMB servers anywhere on the Internet. This was considered a bad idea, and Microsoft quite promptly switched to using only encrypted passwords in the SMB protocol. All subsequent releases of their products have included this correction. Encrypted passwords aren't actually needed unless you're using Internet Explorer 4.0 without a firewall, so it's reasonable to keep using unencrypted passwords on your own networks.</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-953889" CLASS="listitem">
</A>If you have a mixed-case password on Unix, the client is probably sending it in all one case. If changing your password to all one case works, this was the problem. Regrettably, all but the oldest clients support uppercase passwords, so Samba will try once with it in uppercase and once in lower case. If you wish to use mixed-case passwords, see the <CODE CLASS="literal">
password</CODE> <CODE CLASS="literal">
level</CODE> option in  <B>Chapter 6</B> for a workaround.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-953895" CLASS="listitem">
</A>You may have a <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
users</CODE> problem, as tested with <EM CLASS="emphasis">
smbclient</EM> (see <A HREF="#ch09-77154" CLASS="xref">
Section 9.2.5.3</A>").</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945642" CLASS="listitem">
</A>You may have the NetBEUI protocol bound to the Microsoft client. This often produces long timeouts and erratic failures, and is known to have caused failures to accept passwords in the past.</P></LI></UL><P CLASS="para">
The term "bind" is used to mean connecting a piece of software to another in this case. The Microsoft SMB client is "bound to" TCP/IP in the bindings section of the TCP/IP properties panel under the Windows 95/98 Network icon in the Control Panel. TCP/IP in turn is bound to an Ethernet card. This is not the same sense of the word as binding an SMB daemon to a TCP/IP port.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-57065" CLASS="title">9.2.5.5 Testing connections with Windows Explorer</A></H4><P CLASS="para">Start Windows Explorer or NT Explorer (not Internet Explorer), select Tools&#8594;Map Network Drive and specify \\<CODE CLASS="replaceable">
<I>
server</I></CODE>\<CODE CLASS="literal">
temp</CODE> to see if you can make Explorer connect to the <I CLASS="filename">
/tmp</I> directory. You should see a screen similar to the one in <A HREF="#ch09-74414" CLASS="xref">
Figure 9.3</A>. If so, you've succeeded and can skip to <A HREF="#ch09-23573" CLASS="xref">
Section 9.2.6, Troubleshooting Browsing </A>."  </P><H4 CLASS="figure">
<A NAME="ch09-74414" CLASS="title">
Figure 9.3: Accessing the /tmp directory with Windows Explorer</A></H4><IMG ALT="Figure 9.3" CLASS="graphic" SRC="figs/sam.0903.gif"><P CLASS="para">
A word of caution: Windows Explorer and NT Explorer are rather poor as diagnostic tools: they do tell you that something's wrong, but rarely what it is. If you get a failure, you'll need to track it down with the NET USE command, which has far superior error reporting:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945661" CLASS="listitem">
</A>If you get "The password for this connection that is in your password file is no longer correct," you may have any of the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945662" CLASS="listitem">
</A>Your locally cached copy on the client doesn't match the one on the server.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945663" CLASS="listitem">
</A>You didn't provide a username and password when logging on to the client. Most Explorers will continue to send a username and password of null, even if you provide a password.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945664" CLASS="listitem">
</A>You have misspelled the password.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945665" CLASS="listitem">
</A>You have an <CODE CLASS="literal">
invalid</CODE> <CODE CLASS="literal">
users</CODE> or <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
users</CODE> list denying permission.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945666" CLASS="listitem">
</A>Your client is NT 4.0, NT 3.5 with Patch 3, Windows 95 with Patch 3, Windows 98, or any of these with Internet Explorer 4. They will all want encrypted passwords.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945667" CLASS="listitem">
</A>You have a mixed-case password, which the client is supplying in all one case.</P></LI></UL></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945669" CLASS="listitem">
</A>If you get "The network name is either incorrect, or a network to which you do not have full access," or "Cannot locate specified computer," you may have any of the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945671" CLASS="listitem">
</A> Misspelled name</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945672" CLASS="listitem">
</A> Malfunctioning service </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945673" CLASS="listitem">
</A> Failed share</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945674" CLASS="listitem">
</A> Networking problem</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945675" CLASS="listitem">
</A> Bad <CODE CLASS="literal">
path</CODE> line</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945676" CLASS="listitem">
</A> <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
deny</CODE> line that excludes you</P></LI></UL></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945677" CLASS="listitem">
</A>If you get "You must supply a password to make this connection," the password on the client is out of synchronization with the server, or this is the first time you've tried from this client machine and the client hasn't cached it locally yet.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945681" CLASS="listitem">
</A>If you get "Cannot locate specified share name," you have a wrong share name or a syntax error in specifying it, a share name longer than eight characters, or one containing spaces or in mixed case.</P></LI></UL><P CLASS="para">
Once you can reliably connect to the <CODE CLASS="literal">
[temp]</CODE> directory, try once again, this time using your home directory. If you have to change something to get home directories working, then retest with <CODE CLASS="literal">
[temp]</CODE>, and vice versa, as we showed in the section <A HREF="#ch09-97081" CLASS="xref">
Section 9.2.5.4</A>." As always, if Explorer fails, drop back to that section and debug it there.</P></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-23573" CLASS="title">9.2.6 Troubleshooting Browsing </A></H3><P CLASS="para">Finally, we come to browsing. This was left to last, not because it is hardest, but because it's both optional and partially dependent on a protocol that doesn't guarantee delivery of a packet. Browsing is hard to diagnose if you don't already know all the other services are running. </P><P CLASS="para">
Browsing is purely optional: it's just a way to find the servers on your net and the shares that they provide. Unix has nothing of the sort and happily does without. Browsing also assumes all your machines are on a local area network (LAN) where broadcasts are allowable.</P><P CLASS="para">
First, the browsing mechanism identifies a machine using the unreliable UDP protocol; then it makes a normal (reliable) TCP/IP connection to list the shares the machine provides.</P><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-96207" CLASS="title">
9.2.6.1 Testing browsing with smbclient </A></H4><P CLASS="para">We'll start with testing the reliable connection first. From the server, try listing its own shares via <EM CLASS="emphasis">
smbclient</EM> with a <CODE CLASS="literal">
-L</CODE> option of your server's name. You should get: </P><PRE CLASS="programlisting">
server% <CODE CLASS="userinput">
<B>
smbclient -L server</B></CODE> 
Added interface ip=192.168.236.86 bcast=192.168.236.255 nmask=255.255.255.0 Server time is Tue Apr 28 09:57:28 1998 Timezone is UTC-4.0 
Password: 
Domain=[EXAMPLE] 
OS=[Unix] 
Server=[Samba 1.9.18]
Server=[server] 
User=[davecb] 
Workgroup=[EXAMPLE] 
Domain=[EXAMPLE]
   Sharename      Type      Comment    
   ---------      ----      -------    
    cdrom          Disk      CD-ROM    
    cl             Printer   Color Printer 1    
    davecb         Disk      Home Directories

 This machine has a browse list:
   Server         Comment    
   ---------      -------    
   SERVER          Samba 1.9.18

 This machine has a workgroup list:
   Workgroup      Master    
    ---------      -------    
    EXAMPLE        SERVER</PRE><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-950922" CLASS="listitem">
</A>If you didn't get a Sharename list, the server is not allowing you to browse any shares. This should not be the case if you've tested any of the shares with Windows Explorer or the NET USE command. If you haven't done the <CODE CLASS="literal">
smbclient</CODE> <CODE CLASS="literal">
-L</CODE> <CODE CLASS="literal">
localhost</CODE> <CODE CLASS="literal">
-U%</CODE> test yet (see <A HREF="#ch09-40595" CLASS="xref">
Section 9.2.5.2</A>"), do it now. An erroneous guest account can prevent the shares from being seen. Also, check the <I CLASS="filename">
smb.conf</I> file to make sure you do not have the option <CODE CLASS="literal">
browsable</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
no</CODE> anywhere in it: we suggest a minimal <I CLASS="filename">
smb.conf</I> file (see <A HREF="#ch09-67928" CLASS="xref">
Section 9.2.5.1, A minimal smb.conf file</A>") for you to steal from. You need to have <CODE CLASS="literal">
browseable</CODE> enabled in order to be able to see at least the <CODE CLASS="literal">
[temp]</CODE> share.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945728" CLASS="listitem">
</A>If you didn't get a browse list, the server is not providing information about the machines on the network. At least one machine on the net must support browse lists. Make sure you have <CODE CLASS="literal">
local</CODE> <CODE CLASS="literal">
master</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
yes</CODE> in the <I CLASS="filename">
smb.conf</I> file if you want Samba be the local master browser.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945730" CLASS="listitem">
</A>If you got a browse list but didn't get <EM CLASS="emphasis">
/tmp</EM>, you probably have a <I CLASS="filename">
smb.conf</I> problem. Go back to <A HREF="#ch09-67494" CLASS="xref">
Section 9.2.4.5</A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945734" CLASS="listitem">
</A>If you didn't get a workgroup list with your workgroup name in it, it is possible that your workgroup is set incorrectly in the <I CLASS="filename">
smb.conf</I> file.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945735" CLASS="listitem">
</A>If you didn't get a workgroup list at all, ensure that <CODE CLASS="literal">
workgroup</CODE> <CODE CLASS="literal">
=EXAMPLE</CODE> is present in the <I CLASS="filename">
smb.conf</I> file.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945736" CLASS="listitem">
</A>If you get nothing, try once more with the options <CODE CLASS="literal">
-I</CODE> <CODE CLASS="replaceable">
<I>
ip_address</I></CODE> <CODE CLASS="literal">
-n</CODE> <CODE CLASS="replaceable">
<I>
netbios_name</I></CODE> <CODE CLASS="literal">
-W</CODE> <CODE CLASS="replaceable">
<I>
workgroup</I></CODE> <CODE CLASS="literal">
-d3</CODE> with the NetBIOS and workgroup name in uppercase. (The <CODE CLASS="literal">
-d</CODE> <CODE CLASS="literal">
3</CODE> option sets the log /debugging level to 3.)</P></LI></UL><P CLASS="para">
If you're still getting nothing, you shouldn't have gotten this far. Double back to at least <A HREF="#ch09-78512" CLASS="xref">
Section 9.2.3.1, Testing TCP with FTP </A>," or perhaps <A HREF="#ch09-84079" CLASS="xref">
Section 9.2.2.4</A>." On the other hand:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945746" CLASS="listitem">
</A>If you get "SMBtconX failed. ERRSRV&nbsp;- ERRaccess," you aren't permitted access to the server. This normally means you have a <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
hosts</CODE> option that doesn't include the server, or an invalid hosts option that does.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945748" CLASS="listitem">
</A> If you get "Bad password," then you presumably have one of the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945749" CLASS="listitem">
</A> An incorrect <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
allow</CODE> or <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
deny</CODE> line</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945750" CLASS="listitem">
</A> An incorrect <CODE CLASS="literal">
invalid</CODE> <CODE CLASS="literal">
users</CODE> or <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
users</CODE> line</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945751" CLASS="listitem">
</A> A lowercase password and OS/2 or Windows for Workgroups clients</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945752" CLASS="listitem">
</A> A missing or invalid guest account</P></LI></UL></LI><LI CLASS="listitem">
<P CLASS="para">
Check what your guest account is (see <A HREF="#ch09-40595" CLASS="xref">
Section 9.2.5.2</A>") and verify your <I CLASS="filename">
smb.conf</I> file with <CODE CLASS="literal">
testparm</CODE> <CODE CLASS="literal">
smb.conf</CODE> <CODE CLASS="replaceable">
<I>
your_hostname your_ip_address</I></CODE> (see <A HREF="#ch09-67494" CLASS="xref">
Section 9.2.4.5</A>") and change or comment out any <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
allow</CODE>, <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
deny</CODE>, <CODE CLASS="literal">
valid</CODE> <CODE CLASS="literal">
users</CODE> or <CODE CLASS="literal">
invalid</CODE> <CODE CLASS="literal">
users</CODE> lines.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945761" CLASS="listitem">
</A>If you get "Connection refused," the <EM CLASS="emphasis">
smbd</EM> server is not running or has crashed. Check that it's up, running, and listening to the network with <EM CLASS="emphasis">
netstat</EM>, see step <A HREF="#ch09-67494" CLASS="xref">
Section 9.2.4.5</A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-952948" CLASS="listitem">
</A>If you get "Get_Hostbyname: Unknown host name," you've made a spelling error, there is a mismatch between Unix and NetBIOS hostname, or there is a name service problem. Start nameservice debugging with <A HREF="#ch09-97081" CLASS="xref">
Section 9.2.5.4</A>." If this works, suspect a name mismatch and go to step <A HREF="#ch09-35552" CLASS="xref">
Section 9.2.10, Troubleshooting NetBIOS Names</A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945777" CLASS="listitem">
</A>If you get "Session request failed," the server refused the connection. This usually indicates an internal error, such as insufficient memory to fork a process.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945778" CLASS="listitem">
</A>If you get "Your server software is being unfriendly," the initial session request packet received a garbage response from the server. The server may have crashed or started improperly. Go back to <A HREF="#ch09-40595" CLASS="xref">
Section 9.2.5.2</A>," where the problem is first analyzed.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945785" CLASS="listitem">
</A>If you suspect the server is not running, go back to <A HREF="#ch09-49239" CLASS="xref">
Section 9.2.4.2, Looking for daemon processes with ps</A>" to see why the server daemon isn't responding.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-12446" CLASS="title">9.2.6.2 Testing the server with nmblookup</A></H4><P CLASS="para">
This will test the "advertising" system used for Windows name services and browsing. Advertising works by broadcasting one's presence or willingness to provide services. It is the part of browsing that uses an unreliable protocol (UDP), and works only on broadcast networks like Ethernets. The <EM CLASS="emphasis">
nmblookup</EM> program broadcasts name queries for the hostname you provide, and returns its IP address and the name of the machine, much like <EM CLASS="emphasis">
nslookup</EM> does with DNS. Here, the <CODE CLASS="literal">
-d</CODE> (debug- or log-level) option, and the <CODE CLASS="literal">
-B</CODE> (broadcast address) options direct queries to specific machines.</P><P CLASS="para">
First, we check the server from itself. Run <EM CLASS="emphasis">
nmblookup</EM> with a <CODE CLASS="literal">
-B</CODE> option of your server's name to tell it to send the query to the Samba server, and a parameter of  <CODE CLASS="literal">
_ _SAMBA_ _</CODE> as the symbolic name to look up. You should get: </P><PRE CLASS="programlisting">
server% <B CLASS="emphasis.bold">
nmblookup -B </B><CODE CLASS="replaceable">
<I>
server</I></CODE><B CLASS="emphasis.bold">
 _ _SAMBA_ _ </B>
Added interface ip=192.168.236.86 bcast=192.168.236.255 nmask=255.255.255.0 
Sending queries to 192.168.236.86 192.168.236.86 _ _SAMBA_ _ </PRE><P CLASS="para">
You should get the IP address of the server, followed by the name <CODE CLASS="literal">
_ _SAMBA_ _ </CODE>, which means that the server has successfully advertised that it has a service called <CODE CLASS="literal">
_ _SAMBA_ _ </CODE>, and therefore at least part of NetBIOS nameservice works.</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945802" CLASS="listitem">
</A>If you get "Name_query failed to find name _ _SAMBA_ _" you may have specified the wrong address to the <CODE CLASS="literal">
-B</CODE> option, or <EM CLASS="emphasis">
nmbd</EM> is not running. The <CODE CLASS="literal">
-B</CODE> option actually takes a broadcast address: we're using a machine-name to get a unicast address, and to ask server if it has claimed <CODE CLASS="literal">
_ _SAMBA_ _</CODE>.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947471" CLASS="listitem">
</A>Try again with <CODE CLASS="literal">
-B</CODE><CODE CLASS="replaceable">
<I>
 ip_address</I></CODE>, and if that fails too, <EM CLASS="emphasis">
nmbd</EM> isn't claiming the name. Go back briefly to "Testing daemons with testparm" to see if <EM CLASS="emphasis">
nmbd</EM> is running. If so, it may not claiming names; this means that Samba is not providing the browsing service&nbsp;- a configuratiuon problem. If that is the case, make sure that <I CLASS="filename">
smb.conf</I> doesn't contain the option <CODE CLASS="literal">
browsing</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
no</CODE>.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-32122" CLASS="title">
9.2.6.3 Testing the client with nmblookup</A></H4><P CLASS="para">
Next, check the IP address of the client from the server with <EM CLASS="emphasis">
nmblookup</EM> using <CODE CLASS="literal">
-B</CODE> option for the client's name and a parameter of <CODE CLASS="literal">
'*'</CODE> meaning "anything," as shown here: </P><PRE CLASS="programlisting">
server% <B CLASS="emphasis.bold">
nmblookup -B client '*'</B> 
Sending queries to 192.168.236.10 192.168.236.10 *
Got a positive name query response from 192.168.236.10 (192.168.236.10)</PRE><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945817" CLASS="listitem">
</A>If you receive "Name-query failed to find name *," you have made a spelling mistake, or the client software on the PC isn't installed, started, or bound to TCP/IP. Double back to <B>Chapter 2</B> or <B>Chapter 3</B> and ensure you have a client installed and listening to the network. </P></LI></UL><P CLASS="para">
Repeat the command with the following options if you had any failures:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945824" CLASS="listitem">
</A>If <CODE CLASS="literal">
nmblookup</CODE> <CODE CLASS="literal">
-B</CODE> <CODE CLASS="replaceable">
<I>
client_IP_address</I></CODE>  succeeds but <CODE CLASS="literal">
-B</CODE> <CODE CLASS="replaceable">
<I>
client_name</I></CODE> fails, there is a name service problem with the client's name; go to <A HREF="#ch09-23768" CLASS="xref">
Section 9.2.8</A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945825" CLASS="listitem">
</A>If <CODE CLASS="literal">
nmblookup</CODE> <CODE CLASS="literal">
-B</CODE> <CODE CLASS="literal">
127.0.0.1'*'</CODE> succeeds, but <CODE CLASS="literal">
-B</CODE> <CODE CLASS="replaceable">
<I>
client_IP_address</I></CODE> fails, there is a hardware problem and ping should have failed. See your network manager. </P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-98123" CLASS="title">
9.2.6.4 Testing the network with nmblookup</A></H4><P CLASS="para">
Run the command <EM CLASS="emphasis">
nmblookup</EM> again with a <CODE CLASS="literal">
-d</CODE> option (debug level) of 2 and a parameter of <CODE CLASS="literal">
'*'</CODE> again. This time we are testing the ability of programs (such as <EM CLASS="emphasis">
nmbd </EM>) to use broadcast. It's essentially a connectivity test, done via a broadcast to the default broadcast address. </P><P CLASS="para">
A number of NetBIOS/TCP-IP hosts on the network should respond with "got a positive name query response" messages. Samba may not catch all of the responses in the short time it listens, so you won't always see all the SMB clients on the network. However, you should see most of them:</P><PRE CLASS="programlisting">
server% <B CLASS="emphasis.bold">
nmblookup -d 2 '*' </B>
Added interface ip=192.168.236.86 bcast=192.168.236.255 nmask=255.255.255.0 Sending queries to 192.168.236.255 
Got a positive name query response from 192.168.236.191 (192.168.236.191) 
Got a positive name query response from 192.168.236.228 (192.168.236.228) 
Got a positive name query response from 192.168.236.75 (192.168.236.75) 
Got a positive name query response from 192.168.236.79 (192.168.236.79) 
Got a positive name query response from 192.168.236.206 (192.168.236.206) 
Got a positive name query response from 192.168.236.207 (192.168.236.207) 
Got a positive name query response from 192.168.236.217 (192.168.236.217) 
Got a positive name query response from 192.168.236.72 (192.168.236.72) 192.168.236.86 * </PRE><P CLASS="para">
However:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945841" CLASS="listitem">
</A>If this doesn't give at least the client address you previously tested, the default broadcast address is wrong. Try <CODE CLASS="literal">
nmblookup</CODE> <CODE CLASS="literal">
-B</CODE> <CODE CLASS="literal">
255.255.255.255</CODE> <CODE CLASS="literal">
-d</CODE> <CODE CLASS="literal">
2</CODE> <CODE CLASS="literal">
'*'</CODE>, which is a last-ditch variant (a broadcast address of all ones). If this draws responses, the broadcast address you've been using before is wrong. Troubleshooting these is discussed in the <A HREF="#ch09-45060" CLASS="xref">
Section 9.2.9.2, Broadcast addresses</A>" section, later in this chapter.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-951306" CLASS="listitem">
</A>If the address 255.255.255.255 fails too, check your notes to see if your PC and server are on different subnets, as discovered in <A HREF="#ch09-84079" CLASS="xref">
Section 9.2.2.4</A>." You should try to diagnose this with a server and client on the same subnet, but if you can't, you can try specifying the remote subnet's broadcast address with <CODE CLASS="literal">
-B</CODE>. Finding that address is discussed in the same place as troubleshooting broadcast addresses, in the section <A HREF="#ch09-45060" CLASS="xref">
Section 9.2.9.2</A>s," later in this chapter. The <CODE CLASS="literal">
-B</CODE> option will work if your router supports directed broadcasts; if it doesn't, you may be forced to test with a client on the same network.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-947520" CLASS="title">
9.2.6.5 Testing client browsing with net view</A></H4><P CLASS="para">On the client, run the command <CODE CLASS="replaceable">
<I>
net view \\server</I></CODE> in a DOS window to see if you can connect to the client and ask what shares it provides. You should get back a list of available shares on the server, as shown in <A HREF="#ch09-83710" CLASS="xref">
Figure 9.4</A>.   </P><H4 CLASS="figure">
<A NAME="ch09-83710" CLASS="title">
Figure 9.4: Using the net view command</A></H4><IMG ALT="Figure 9.4" CLASS="graphic" SRC="figs/sam.0904.gif"><P CLASS="para">
If you received this, continue with the section <A HREF="#ch09-21713" CLASS="xref">
Section 9.2.7, Other Things that Fail </A>."</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-953009" CLASS="listitem">
</A>If you get "Network name not found" for the name you just tested in the section "<A HREF="#ch09-32122" CLASS="xref">
Section 9.2.6.3, Testing the client with nmblookup</A>," there is a problem with the client software itself. Double-check this by running <EM CLASS="emphasis">
nmblookup</EM> on the client; if it works and NET VIEW doesn't, the client is at fault.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945868" CLASS="listitem">
</A>Of course, if <EM CLASS="emphasis">
nmblookup</EM> fails, there is a NetBIOS nameservice problem, as discussed in the section <A HREF="#ch09-35552" CLASS="xref">
Section 9.2.10</A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945874" CLASS="listitem">
</A>If you get "You do not have the necessary access rights," or "This server is not configured to list shared resources," either your guest account is misconfigured (see <A HREF="#ch09-40595" CLASS="xref">
Section 9.2.5.2</A>"), or you have a <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
allow</CODE> or <CODE CLASS="literal">
hosts</CODE> <CODE CLASS="literal">
deny</CODE> line that prohibits connections from your machine. These problems should have been detected by the <EM CLASS="emphasis">
smbclient</EM> tests starting in the section <A HREF="#ch09-96207" CLASS="xref">
Section 9.2.6.1, Testing browsing with smbclient </A>."</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945882" CLASS="listitem">
</A>If you get "The specified computer is not receiving requests," you have misspelled the name, the machine is unreachable by broadcast (tested in "Testing the network with nmblookup"), or it's not running <EM CLASS="emphasis">
nmbd</EM>.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-954090" CLASS="listitem">
</A>If you get "Bad password error," you're probably encountering the Microsoft-encrypted password problem, as discussed in <B>Chapter 6</B>, with its corrections.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-954094" CLASS="title">
9.2.6.6 Browsing the server from the client</A></H4><P CLASS="para">From the Network Neighborhood (File Manager in older releases), try to browse the server. Your Samba server should appear in the browse list of your local workgroup. You should be able to double click on the name of the server and get a list of shares, as illustrated in <A HREF="#ch09-60004" CLASS="xref">
Figure 9.5</A>.   </P><H4 CLASS="figure">
<A NAME="ch09-60004" CLASS="title">
Figure 9.5: List of shares on a server</A></H4><IMG ALT="Figure 9.5" CLASS="graphic" SRC="figs/sam.0905.gif"><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945897" CLASS="listitem">
</A>If you get an "Invalid password" error with NT 4.0, NT 3.5 with Patch 3, Windows 95 with Patch 3, Windows 98 or any of these with Internet Explorer 4.0, it's most likely the encryption problem again. All of these clients default to using Microsoft encryption for passwords (see <B>Chapter 6</B>).</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945903" CLASS="listitem">
</A>If you receive an "Unable to browse the network" error, one of the following has ocurred:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945904" CLASS="listitem">
</A>You have looked too soon, before the broadcasts and updates have completed; try waiting 30 seconds before re-attempting.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945905" CLASS="listitem">
</A>There is a network problem you've not yet diagnosed.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945906" CLASS="listitem">
</A>There is no browse master. Add the configuration option <CODE CLASS="literal">
local</CODE> <CODE CLASS="literal">
master</CODE> <CODE CLASS="literal">
=</CODE> <CODE CLASS="literal">
yes</CODE> to your <EM CLASS="emphasis">
smb.conf</EM> file.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945907" CLASS="listitem">
</A>No shares are marked <CODE CLASS="literal">
browsable</CODE> in the <EM CLASS="emphasis">
smb.conf</EM> file.</P></LI></UL></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945909" CLASS="listitem">
</A>If you receive the message "\\server is not accessible," then:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945910" CLASS="listitem">
</A> You have the encrypted password problem</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945911" CLASS="listitem">
</A> The machine really isn't accessible </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945912" CLASS="listitem">
</A> The machine doesn't support browsing</P></LI></UL></LI></UL></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-21713" CLASS="title">9.2.7 Other Things that Fail </A></H3><P CLASS="para">
If you've made it here, either the problem is solved or it's not one we've seen. The next sections cover troubleshooting tasks that are required to have the infrastructure to run Samba, not Samba itself.</P><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-945916" CLASS="title">
9.2.7.1 Not logging on</A></H4><P CLASS="para">An occasional problem is forgetting to log in to the client or logging in as a wrong (account-less) person. The former is not diagnosed at all: Windows tries to be friendly and lets you on. Locally! The only warning of the latter is that Windows welcomes you and asks about your new account. Either of these leads to repeated refusals to connect and endless requests for passwords. If nothing else seems to work, try logging out or shutting down and logging in again.</P></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-23768" CLASS="title">
9.2.8 Troubleshooting Name Services</A></H3><P CLASS="para">This section looks at simple troubleshooting of all the name services that you will encounter, but only for the common problems that affect Samba.</P><P CLASS="para">
There are several good references for troubleshooting particular name services: Paul Albitz and Cricket Liu's <EM CLASS="emphasis">
DNS and Bind</EM> covers the Domain Name Service (DNS), Hal Stern's <EM CLASS="emphasis">
NFS and NIS</EM> (both from O'Reilly) covers NIS ("Yellow pages") while WINS (Windows Internet Name Service), <I CLASS="filename">
hosts/LMHOSTS</I> files and NIS+ are best covered by their respective vendor's manuals.</P><P CLASS="para">
The problems addressed in this section are:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945926" CLASS="listitem">
</A>Identifying name services</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945927" CLASS="listitem">
</A>A hostname can't be looked up</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945928" CLASS="listitem">
</A>The long (FQDN) form of a hostname works but the short form doesn't </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945929" CLASS="listitem">
</A>The short form of the name works, but the long form doesn't</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945930" CLASS="listitem">
</A>A long delay ocurrs before the expected result </P></LI></UL><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-945931" CLASS="title">
9.2.8.1 Identifying what's in use</A></H4><P CLASS="para">First, see if both the server and the client are using DNS, WINS, NIS, or <I CLASS="filename">
hosts</I> files to look up IP addresses when you give them a name. Each kind of machine will have a different preference: </P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945934" CLASS="listitem">
</A>Windows 95 and 98 machines will look in WINS and <I CLASS="filename">
LMHOSTS</I> files first, then broadcast, and finally try DNS and <I CLASS="filename">
hosts</I> files.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945935" CLASS="listitem">
</A>NT will look in WINS, then broadcast, LMHOSTS files, and finally <I CLASS="filename">
hosts</I> and DNS.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945936" CLASS="listitem">
</A>Windows programs using the WINSOCK standard (like PC-NFSs) will use hosts files, DNS, WINS, and then broadcast. Don't assume that if a different program's name service works, the SMB client program's name service will!</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945937" CLASS="listitem">
</A>Samba daemons will use <I CLASS="filename">
LMHOSTS</I>, WINS, the Unix host's preference, and then broadcast.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945938" CLASS="listitem">
</A>Unix hosts can be configured to use any combination of DNS, <I CLASS="filename">
hosts</I> files, and NIS and NIS+, generally in any order.</P></LI></UL><P CLASS="para">
We recommend that the client machines be configured to use WINS and DNS, the Samba daemons to use WINS and DNS, and the Unix server to use DNS. You'll have to look at your notes and the actual machines to see which is in use.</P><P CLASS="para">
On the clients, the name services are all set in the TCP/IP Properties panel of the Networking Control Panel, as discussed in <B>Chapter 3</B>. You may need to check there to see what you've actually turned on. On the server, see if an <I CLASS="filename">
/etc/resolv.conf</I> file exists. If it does, you're using DNS. You may be using the others as well, though. You'll need to check for NIS and combinations of services.</P><P CLASS="para">
Check for an <I CLASS="filename">
/etc/nsswitch.conf</I> file on Solaris and other System V Unix operating systems. If you have one, look for a line that begins <CODE CLASS="literal">
host</CODE>:, followed by one or more of <CODE CLASS="literal">
files</CODE>, <CODE CLASS="literal">
bind</CODE>, <CODE CLASS="literal">
nis</CODE> or <CODE CLASS="literal">
nis+</CODE>. These are the name services to use, in order, with optional extra material in square brackets. <EM CLASS="emphasis">
files</EM> stands for using<EM CLASS="emphasis">
 hosts</EM> files, while <EM CLASS="emphasis">
bind</EM> (the Berkeley Internet Name Daemon) stands for using DNS.</P><P CLASS="para">
If the client and server differ, the first thing to do is to get them in sync. Clients can only use only DNS, WINS, <EM CLASS="emphasis">
hosts </EM>files and <EM CLASS="emphasis">
lmhosts</EM> files, not NIS or NIS+. Servers can use <EM CLASS="emphasis">
hosts</EM> files, DNS, and NIS or NIS+, but not WINS&nbsp;- even if your Samba server provides WINS services. If you can't get all the systems to use the same services, you'll have to carefully check the server and the client for the same data.</P><P CLASS="para">
Samba 2.0 (and late 1.9 versions) added a <CODE CLASS="literal">
-R</CODE><I CLASS="option">
 </I>(resolve order) option to <EM CLASS="emphasis">
smbclient</EM>. If you want to troubleshoot WINS, for example, you'd say:</P><PRE CLASS="programlisting">
smbclient -L <CODE CLASS="replaceable">
<I>
server</I></CODE> -R wins</PRE><P CLASS="para">
The possible settings are <CODE CLASS="literal">
hosts</CODE> (which means whatever the Unix machine is using, not just<I CLASS="filename">
 /etc/hosts</I> files), <CODE CLASS="literal">
lmhosts</CODE>, <CODE CLASS="literal">
wins</CODE> and <CODE CLASS="literal">
bcast</CODE> (broadcast).</P><P CLASS="para">
In the following sections, we use the term <EM CLASS="emphasis">
long name</EM> for a fully-qualified domain name (FQDN), like <CODE CLASS="literal">
server.example.com </CODE>, and the term <EM CLASS="emphasis">
short name</EM> for the host part of a FQDN, like <CODE CLASS="literal">
server</CODE>.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-947590" CLASS="title">
9.2.8.2 Cannot look up hostnames</A></H4><P CLASS="para">
 Try the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945950" CLASS="listitem">
</A>In DNS:</P><P CLASS="para">
Run <CODE CLASS="literal">
nslookup</CODE> <CODE CLASS="replaceable">
<I>
name</I></CODE>. If this fails, look for a <I CLASS="filename">
resolv.conf</I> error, a downed DNS server, or a short/long name problem (see the next section). Try the following:</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945952" CLASS="listitem">
</A>Your <I CLASS="filename">
/etc/resolv.conf</I> should contain one or more name-server lines, each with an IP address. These are the addresses of your DNS servers.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947597" CLASS="listitem">
</A>ping each of the server addresses you find. If this fails for one, suspect the machine. If it fails for each, suspect your network.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947600" CLASS="listitem">
</A>Retry the lookup using the full domain name (e.g., <EM CLASS="emphasis">
server.example.com</EM>) if you tried the short name first, or the short name if you tried the long name first. If results differ, skip to the next section. </P></LI></UL><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945958" CLASS="listitem">
</A>In Broadcast/ WINS:</P><P CLASS="para">
Broadcast/ WINS does only short names such as <CODE CLASS="literal">
server</CODE>, (not long ones, such as <CODE CLASS="literal">
server.example.com)</CODE>. Run <CODE CLASS="literal">
nmblookup</CODE> <CODE CLASS="literal">
-S</CODE> <CODE CLASS="replaceable">
<I>
server</I></CODE>.<CODE CLASS="replaceable">
<I>
 </I></CODE>This reports everything broadcast has registered for the name. In our example, it looks like this:</P></LI></UL><PRE CLASS="programlisting">
Looking up status of 192.168.236.86
received 10 names
        SERVER           &lt;00&gt; -         M &lt;ACTIVE&gt; 
        SERVER           &lt;03&gt; -         M &lt;ACTIVE&gt; 
        SERVER           &lt;1f&gt; -         M &lt;ACTIVE&gt; 
        SERVER           &lt;20&gt; -         M &lt;ACTIVE&gt; 
        .._ _MSBROWSE_ _.&lt;01&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt; 
        MYGROUP          &lt;00&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt; 
        MYGROUP          &lt;1b&gt; -         M &lt;ACTIVE&gt; 
        MYGROUP          &lt;1c&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt; 
        MYGROUP          &lt;1d&gt; -         M &lt;ACTIVE&gt; 
        MYGROUP          &lt;1e&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt;</PRE><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
The required entry is <CODE CLASS="literal">
SERVER</CODE> <CODE CLASS="literal">
&lt;00&gt;</CODE>, which identifies <CODE CLASS="replaceable">
<I>
server</I></CODE> as being this machine's NetBIOS name. You should also see your workgroup mentioned one or more times. If these lines are missing, Broadcast/WINS cannot look up names and will need attention.</P></LI></UL><P CLASS="para">
The numbers in angle brackets in the previous output identify NetBIOS names as being workgroups, workstations, and file users of the messenger service, master browsers, domain master browsers, domain controllers and a plethora of others. We primarily use <CODE CLASS="literal">
&lt;00&gt;</CODE> to identify machine and workgroup names and <CODE CLASS="literal">
&lt;20&gt;</CODE> to identify machines as servers. The complete list is available at <A HREF="http://support.microsoft.com/support/kb/articles/q163/4/09.asp." CLASS="systemitem.url">
http://support.microsoft.com/support/kb/articles/q163/4/09.asp.</A></P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945982" CLASS="listitem">
</A>In NIS:</P><P CLASS="para">
Try <CODE CLASS="literal">
ypmatch</CODE> <CODE CLASS="literal">
name</CODE> <CODE CLASS="literal">
hosts</CODE>. If this fails, NIS is down. Find out the NIS server's name by running<EM CLASS="emphasis">
 ypwhich</EM>, and ping the machine it to see if it's accessible.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945985" CLASS="listitem">
</A>In NIS+:</P><P CLASS="para">
If you're running NIS+, try <CODE CLASS="literal">
nismatch</CODE> <CODE CLASS="literal">
name</CODE> <CODE CLASS="literal">
hosts</CODE>. If this fails, NIS is down. Find out the NIS server's name by running <EM CLASS="emphasis">
niswhich</EM>, and ping that machine to see if it's accessible.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-945988" CLASS="listitem">
</A>In <I CLASS="filename">
hosts</I> files:</P><P CLASS="para">
Inspect <I CLASS="filename">
/etc/hosts</I> on the client (<CODE CLASS="literal">
C:\WINDOWS\HOSTS</CODE>). Each line should have an IP number and one or more names, the primary name first, then any optional aliases. An example follows:</P></LI></UL><PRE CLASS="programlisting">
        127.0.0.1         localhost
        192.168.236.1     dns.svc.example.com 
        192.168.236.10    client.example.com client 
        192.168.236.11    backup.example.com loghost 
        192.168.236.86    server.example.com server 
        192.168.236.254   router.svc.example.com </PRE><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
On Unix, <CODE CLASS="literal">
localhost</CODE> should always be 127.0.0.1, although it may be just an alias for a hostname on the PC. On the client, check that there are no <CODE CLASS="literal">
#XXX</CODE> directives at the ends of the lines; these are LAN Manager/NetBIOS directives, and should appear only in <EM CLASS="emphasis">
LMHOSTS</EM> files (<CODE CLASS="literal">
C:\WINDOWS\LMHOSTS</CODE>). </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946000" CLASS="listitem">
</A>In <EM CLASS="emphasis">
LMHOSTS</EM> files:</P><P CLASS="para">
This file is a local source for LAN Manager (NetBIOS) names. It has a format very similar to <I CLASS="filename">
/etc/hosts</I> files, but does not support long-form domain names (e.g., <CODE CLASS="literal">
server.example.com</CODE>), and may have a number of optional <CODE CLASS="literal">
#XXX</CODE> directives following the names. Note there usually is a <EM CLASS="emphasis">
lmhosts.sam</EM> (for sample) file in <CODE CLASS="literal">
C:\WINDOWS</CODE>, but it's not used unless renamed to <CODE CLASS="literal">
C:\WINDOWS\LMHOSTS</CODE>.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-946005" CLASS="title">
9.2.8.3 Long and short hostnames</A></H4><P CLASS="para">Where the long (FQDN) form of a hostname works but the short name doesn't (for example, <CODE CLASS="literal">
client.example.com</CODE> works but <CODE CLASS="literal">
client</CODE> doesn't), consider the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946007" CLASS="listitem">
</A>DNS: </P><P CLASS="para">
This usually indicates there is no default domain in which to look up the short names. Look for a <CODE CLASS="literal">
default</CODE> line in <I CLASS="filename">
/etc/resolv.conf</I> on the Samba server with your domain in it, or a <CODE CLASS="literal">
search</CODE> line with one or more domains in it. One or the other may need to be present to make short names usable; which one depends on vendor and version of the DNS resolver. Try adding <CODE CLASS="literal">
domain</CODE> <CODE CLASS="replaceable">
<I>
your domain</I></CODE> to <I CLASS="filename">
resolv.conf</I> and ask your network or DNS administrator what should have been in the file.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946010" CLASS="listitem">
</A>Broadcast/WINS: </P><P CLASS="para">
Broadcast/WINS doesn't support long names; it won't suffer from this problem. </P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946012" CLASS="listitem">
</A>NIS: </P><P CLASS="para">
Try the command <CODE CLASS="literal">
ypmatch</CODE> <CODE CLASS="literal">
hostname</CODE> <CODE CLASS="literal">
hosts</CODE>. If you don't get a match, your tables don't include short names. Speak to your network manager; short names may be missing by accident, or may be unsupported as a matter of policy. Some sites don't ever use (ambiguous) short names.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946014" CLASS="listitem">
</A>NIS+ :</P><P CLASS="para">
Try <CODE CLASS="literal">
nismatch</CODE> <CODE CLASS="replaceable">
<I>
hostname</I></CODE> <CODE CLASS="literal">
hosts</CODE>, and treat failure exactly as with NIS above.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946016" CLASS="listitem">
</A><EM CLASS="emphasis">
hosts:</EM> </P><P CLASS="para">
If the short name is not in <I CLASS="filename">
/etc/hosts</I>, consider adding it as an alias. Avoid, if you can, short names as primary names (the first one on a line). Have them as aliases if your system permits.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946018" CLASS="listitem">
</A><I CLASS="filename">
LMHOSTS</I>: </P><P CLASS="para">
LAN Manager doesn't support long names, so it won't suffer from this problem. </P></LI></UL><P CLASS="para">
On the other hand, if the short form of the name works and the long doesn't, consider the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946022" CLASS="listitem">
</A>DNS: </P><P CLASS="para">
This is bizarre; see your network or DNS administrator, as this is probably a DNS setup bug.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947697" CLASS="listitem">
</A>Broadcast/WINS: </P><P CLASS="para">
This is a normal bug; Broadcast/WINS can't use the long form. Optionally, consider DNS. Microsoft has stated that they will switch to DNS, though it's not providing name types like &lt;00&gt;.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947709" CLASS="listitem">
</A>NIS:</P><P CLASS="para">
If you can use <CODE CLASS="literal">
ypmatch</CODE> to look up the short form but not the long, consider adding the long form to the table as at least an alias.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947718" CLASS="listitem">
</A>NIS+: </P><P CLASS="para">
Same as NIS, except you use <CODE CLASS="literal">
nismatch</CODE> instead of <CODE CLASS="literal">
ypmatch</CODE> to look up names.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947720" CLASS="listitem">
</A><I CLASS="filename">
hosts:</I></P><P CLASS="para">
Add the long name as at least an alias, and preferably as the primary form. Also consider using DNS if it's practical.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947727" CLASS="listitem">
</A><I CLASS="filename">
LMHOSTS</I>: </P><P CLASS="para">
This is a normal bug. LAN Manager can't use the long form; consider switching to DNS or <I CLASS="filename">
hosts</I>.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-946040" CLASS="title">
9.2.8.4 Unusual delays</A></H4><P CLASS="para">When there is a long delay before the expected result: </P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-947733" CLASS="listitem">
</A>DNS: </P><P CLASS="para">
Test the same name with the <KBD CLASS="command">
nslookup</KBD> command on the machine (client or server) that is slow. If <KBD CLASS="command">
nslookup</KBD> is also slow, you have a DNS problem. If it's slower on a client, you have too many protocols bound to the Ethernet card. Eliminate NetBEUI, which is infamously slow, and optionally, Novel, assuming you don't need them. This is especially important on Windows 95, which is particularly sensitive to excess protocols.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946044" CLASS="listitem">
</A>Broadcast/ WINS:</P><P CLASS="para">
Test the client using <CODE CLASS="literal">
nmblookup</CODE>, and if it's faster, you probably have the protocols problem as  mentioned in the previous item.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946047" CLASS="listitem">
</A>NIS:</P><P CLASS="para">
Try <CODE CLASS="literal">
ypmatch</CODE>, and if it's slow, report the problem to your network manager.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946049" CLASS="listitem">
</A>NIS+: </P><P CLASS="para">
Try <CODE CLASS="literal">
nismatch</CODE>, similarly.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946051" CLASS="listitem">
</A><EM CLASS="emphasis">
hosts</EM>:</P><P CLASS="para">
<EM CLASS="emphasis">
hosts</EM> files, if of reasonable size, are always fast. You probably have the protocols problem mentioned under DNS, above.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946053" CLASS="listitem">
</A><EM CLASS="emphasis">
LMHOSTS</EM>:</P><P CLASS="para">
This is not a name lookup problem; <EM CLASS="emphasis">
LMHOSTS</EM> files are as fast as <EM CLASS="emphasis">
hosts</EM> files.</P></LI></UL></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-946055" CLASS="title">
9.2.8.5 Localhost issues</A></H4><P CLASS="para">When a localhost isn't 127.0.0.1, try the following:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946056" CLASS="listitem">
</A>DNS:</P><P CLASS="para">
There is probably no record for <CODE CLASS="literal">
localhost.</CODE> <CODE CLASS="literal">
A</CODE> <CODE CLASS="literal">
127.0.0.1</CODE>. Arrange to add one, and a reverse entry, <CODE CLASS="literal">
1.0.0.127.IN-ADDR.ARPA</CODE> <CODE CLASS="literal">
PTR</CODE> <CODE CLASS="literal">
127.0.0.1</CODE>.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946058" CLASS="listitem">
</A>Broadcast/WINS:</P><P CLASS="para">
Not applicable.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946060" CLASS="listitem">
</A>NIS:</P><P CLASS="para">
If <CODE CLASS="literal">
localhost</CODE> isn't in the table, add it.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946062" CLASS="listitem">
</A>NIS+: </P><P CLASS="para">
If <CODE CLASS="literal">
localhost</CODE> isn't in the table, add it.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946064" CLASS="listitem">
</A><I CLASS="filename">
hosts:</I></P><P CLASS="para">
Add a line is the <EM CLASS="emphasis">
hosts</EM> file that says <CODE CLASS="literal">
127.0.0.1</CODE> <CODE CLASS="literal">
localhost</CODE></P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946066" CLASS="listitem">
</A><I CLASS="filename">
LMHOSTS</I>:</P><P CLASS="para">
Not applicable.</P></LI></UL></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-pgfId-953970" CLASS="title">9.2.9 Troubleshooting Network Addresses</A></H3><P CLASS="para">
A number of common problems are caused by incorrect Internet address routing or the incorrect assignment of addresses. This section helps you determine what your addresses are.</P><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-21203" CLASS="title">
9.2.9.1 Netmasks</A></H4><P CLASS="para">The netmasks tell each machine which addresses can be reached directly (are on your local network) and which addresses require forwarding packets through a router. If the netmask is wrong, the machines will make one of two mistakes. One is to try to route local packets via a router, which is an expensive way to waste time&nbsp;- it may work reasonably fast, it may run slowly, or it may fail utterly. The second mistake is to fail to send packets for a remote machine to the router, which will prevent them from being forwarded to the remote machine.</P><P CLASS="para">
The netmask is a number like an IP address, with one-bits for the network part of an address and zero-bits for the host portion. The netmask is literally used to mask off parts of the address inside the TCP/IP code. If the mask is 255.255.0.0, the first 2 bytes are the network part and the last 2 are the host part. More common is 255.255.255.0, in which the first 3 bytes are the network part and the last one is the host part.</P><P CLASS="para">
For example, let's say your IP address is 192.168.0.10 and the Samba server is 192.168.236.86. If your netmask happens to be 255.255.255.0, the network part of the addresses is the first 3 bytes and the host part is the last byte. In this case, the network parts are different, and the machines are on different networks: </P><TABLE CLASS="informaltable" CELLPADDING="3" BORDER="1">
<THEAD CLASS="thead">
<TR VALIGN="TOP" CLASS="row">
<TH COLSPAN="1" CLASS="entry" ROWSPAN="1" ALIGN="LEFT">
<P CLASS="para">
Network Part</P></TH><TH COLSPAN="1" CLASS="entry" ROWSPAN="1" ALIGN="LEFT">
<P CLASS="para">
Host Part</P></TH></TR></THEAD><TBODY CLASS="tbody">
<TR VALIGN="TOP" CLASS="row">
<TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
192 168 000</P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
10</P></TD></TR><TR VALIGN="TOP" CLASS="row">
<TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
192 168 235</P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
86</P></TD></TR></TBODY></TABLE><P CLASS="para">
If your netmask happens to be 255.255.0.0, the network part is just the first two bytes. In this case, the network parts match and so the two machines are on the same network: </P><TABLE CLASS="informaltable" CELLPADDING="3" BORDER="1">
<THEAD CLASS="thead">
<TR VALIGN="TOP" CLASS="row">
<TH COLSPAN="1" CLASS="entry" ROWSPAN="1" ALIGN="LEFT">
<P CLASS="para">
Network Part</P></TH><TH COLSPAN="1" CLASS="entry" ROWSPAN="1" ALIGN="LEFT">
<P CLASS="para">
Host Part</P></TH></TR></THEAD><TBODY CLASS="tbody">
<TR VALIGN="TOP" CLASS="row">
<TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
192 168</P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
000 10</P></TD></TR><TR VALIGN="TOP" CLASS="row">
<TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
192 168</P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
236 86</P></TD></TR></TBODY></TABLE><P CLASS="para">
Of course, if your netmask says one thing and your network manager says another, the netmask is wrong.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-45060" CLASS="title">
9.2.9.2 Broadcast addresses</A></H4><P CLASS="para">
The broadcast address is a normal address, with the hosts part all one-bits. It means "all hosts on your network." You can compute it easily from your netmask and address: take the address and put one-bits in it for all the bits that are zero at the end of the netmask (the host part). The following table illustrates this: </P><TABLE CLASS="informaltable" CELLPADDING="3" BORDER="1">
<THEAD CLASS="thead">
<TR VALIGN="TOP" CLASS="row">
<TH COLSPAN="1" CLASS="entry" ROWSPAN="1" ALIGN="LEFT">
<P CLASS="para">
</P></TH><TH COLSPAN="1" CLASS="entry" ROWSPAN="1" ALIGN="LEFT">
<P CLASS="para">
Network Part</P></TH><TH COLSPAN="1" CLASS="entry" ROWSPAN="1" ALIGN="LEFT">
<P CLASS="para">
Host Part</P></TH></TR></THEAD><TBODY CLASS="tbody">
<TR VALIGN="TOP" CLASS="row">
<TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
<B CLASS="emphasis.bold">
IP address</B></P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
192 168 236</P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
86</P></TD></TR><TR VALIGN="TOP" CLASS="row">
<TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
<B CLASS="emphasis.bold">
Netmask</B></P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
255 255 255</P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
000</P></TD></TR><TR VALIGN="TOP" CLASS="row">
<TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
<B CLASS="emphasis.bold">
Broadcast</B></P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
192 168 236</P></TD><TD COLSPAN="1" CLASS="entry" ROWSPAN="1">
<P CLASS="para">
255</P></TD></TR></TBODY></TABLE><P CLASS="para">
In this example, the broadcast address on the 192.168.236 network is 192.168.236.255. There is also an old "universal" broadcast address, 255.255.255.255. Routers are prohibited from forwarding these, but most machines on your local network will respond to broadcasts to this address.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-946136" CLASS="title">
9.2.9.3 Network address ranges</A></H4><P CLASS="para">A number of address ranges have been reserved for testing and for non-connected networks; we use one of these for the book. If you don't have an address yet, feel free to use one of these to start with. They include one class A (large) network, 10.*.*.*, and 254 class C (smaller) networks, 192.168.1.* through to 192.168.254.*. In this book we use one of the latter, 192.168.236.*. The domain <I CLASS="filename">
example.com</I> is also reserved for unconnected networks, explanatory examples, and books.</P><P CLASS="para">
If you're actually connecting to the Internet, you'll need to get a real network and a domain name, probably through the same company that provides your connection.</P></DIV><DIV CLASS="sect3">
<H4 CLASS="sect3">
<A NAME="ch09-pgfId-947786" CLASS="title">
9.2.9.4 Finding your network address</A></H4><P CLASS="para">If you haven't recorded your IP address, it will be displayed by the <KBD CLASS="command">
ifconfig</KBD> command on Unix or by the IPCONFIG command on Windows 95 and NT. (Check your manual pages for any options required by your brand of Unix: Sun wants <CODE CLASS="literal">
ifconfig</CODE> <CODE CLASS="literal">
-a</CODE>). You should see output similar to the following:</P><PRE CLASS="programlisting">
server% ifconfig -a 
le0: flags=63&lt;UP,BROADCAST,NOTRAILERS,RUNNING &gt; 
      inet 192.168.236.11 netmask ffffff00 broadcast 192.168.236.255 
lo0: flags=49&lt;&amp;lt&gt;UP,LOOPBACK,RUNNING&lt;&amp;gt&gt; 		
      inet 127.0.0.1 netmask ff000000</PRE><P CLASS="para">
One of the interfaces will be loopback (in our examples <CODE CLASS="literal">
lo0</CODE>), and the other will be the regular IP interface. The flags should show that the interface is running, and Ethernet interfaces will also say they support broadcasts (PPP interfaces don't). The other places to look for IP addresses are <I CLASS="filename">
/etc/hosts</I> files, Windows <EM CLASS="emphasis">
HOSTS</EM> files, Windows <EM CLASS="emphasis">
LMHOSTS</EM> files, NIS, NIS+ and DNS.</P></DIV></DIV><DIV CLASS="sect2">
<H3 CLASS="sect2">
<A NAME="ch09-35552" CLASS="title">9.2.10 Troubleshooting NetBIOS Names</A></H3><P CLASS="para">Historically, SMB protocols have depended on the NetBIOS name system, also called the LAN Manager name system. This was a simple scheme where each machine had a unique 20-character name and broadcast it on the LAN for everyone to know. With TCP/IP, we tend to use names like <EM CLASS="emphasis">
client.example.com</EM> stored in <I CLASS="filename">
/etc/hosts</I> files, through DNS or WINS.</P><P CLASS="para">
The usual mapping to domain names such as <EM CLASS="emphasis">
server.example.com</EM> simply uses the <EM CLASS="emphasis">
server</EM> part as the NetBIOS name and converts it to uppercase. Alas, this doesn't always work, especially if you have a machine with a 21-character name; not everyone uses the same NetBIOS and DNS names. For example, <EM CLASS="emphasis">
corpvm1</EM> along with <EM CLASS="emphasis">
vm1.corp.com</EM> is not unusual.</P><P CLASS="para">
A machine with a different NetBIOS name and domain name is confusing when you're troubleshooting; we recommend that you try to avoid this wherever possible. NetBIOS names are discoverable with <EM CLASS="emphasis">
smbclient </EM>:</P><UL CLASS="itemizedlist">
<LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946160" CLASS="listitem">
</A>If you can list shares on your Samba server with <EM CLASS="emphasis">
smbclient</EM> and a <CODE CLASS="literal">
-L</CODE> option (list shares) of <CODE CLASS="replaceable">
<I>
short_name_of_server</I></CODE>, the short name is the NetBIOS name.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946161" CLASS="listitem">
</A>If you get "Get_Hostbyname: Unknown host name," there is probably a mismatch. Check in the <I CLASS="filename">
smb.conf</I> file to see if the NetBIOS name is explicitly set.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946162" CLASS="listitem">
</A>Try again, specifying <CODE CLASS="literal">
-I</CODE> and the IP address of the Samba server (e.g., <CODE CLASS="literal">
smbclient</CODE> <CODE CLASS="literal">
-L</CODE> <CODE CLASS="literal">
server</CODE> <CODE CLASS="literal">
-I</CODE> <CODE CLASS="literal">
192.168.236.86</CODE>). This overrides the name lookup and forces the packets to go to the IP address. If this works, there was a mismatch.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946163" CLASS="listitem">
</A>Try with <CODE CLASS="literal">
-I</CODE> and the full domain name of the server (e.g., <CODE CLASS="literal">
smbclient</CODE> <CODE CLASS="literal">
-L</CODE> <CODE CLASS="literal">
server</CODE> <CODE CLASS="literal">
-I</CODE> <CODE CLASS="literal">
server.example.com</CODE>). This tests the lookup of the domain name, using whatever scheme the Samba server uses (e.g., DNS). If it fails, you have a name service problem. You should reread the section <A HREF="#ch09-23768" CLASS="xref">
Section 9.2.8</A>" after you finish troubleshooting the NetBIOS names.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946168" CLASS="listitem">
</A>Try with <CODE CLASS="literal">
-n</CODE> (NetBIOS name) and the name you expect to work (e.g., <CODE CLASS="literal">
smbclient</CODE> <CODE CLASS="literal">
-n</CODE> <CODE CLASS="literal">
server</CODE> <CODE CLASS="literal">
-L</CODE> <CODE CLASS="literal">
server-12</CODE>) but without overriding the IP address through <CODE CLASS="literal">
-I</CODE>. If this works, the name you specified with <CODE CLASS="literal">
-n</CODE> is the actual NetBIOS name of the server. If you receive "Get-Hostbyname: Unknown host MARY," it's not the right server yet.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-946169" CLASS="listitem">
</A>If nothing is working so far, repeat the tests specifying <CODE CLASS="literal">
-U</CODE> <CODE CLASS="replaceable">
<I>
username</I></CODE> and <CODE CLASS="literal">
-W</CODE> <CODE CLASS="replaceable">
<I>
workgroup</I></CODE>, with the username and workgroup in uppercase, to make sure you're not being derailed by a user or workgroup mismatch.</P></LI><LI CLASS="listitem">
<P CLASS="para">
<A NAME="ch09-pgfId-953522" CLASS="listitem">
</A>If nothing works still and you had evidence of a name service problem, troubleshoot name service in the section <A HREF="#ch09-23768" CLASS="xref">
Section 9.2.8</A>," and then return to NetBIOS name service.</P></LI></UL></DIV></DIV></BLOCKQUOTE>
<DIV>
<CENTER>
<HR NOSHADE SIZE="1"><TABLE WIDTH="515" CELLSPACING="0" CELLPADDING="0" BORDER="0">
<TR>
<TD WIDTH="172" VALIGN="TOP" ALIGN="LEFT">
<A TITLE="9.1 The Tool Bag" HREF="ch09_01.html" CLASS="sect1">
<IMG ALT="Previous: 9.1 The Tool Bag" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtpreva.gif" BORDER="0"></A></TD><TD WIDTH="171" VALIGN="TOP" ALIGN="CENTER">
<A TITLE="" HREF="index.html" CLASS="book">
<IMG ALT="" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txthome.gif" BORDER="0"></A></TD><TD WIDTH="172" VALIGN="TOP" ALIGN="RIGHT">
<A TITLE="9.3 Extra Resources" HREF="ch09_03.html" CLASS="sect1">
<IMG ALT="Next: 9.3 Extra Resources" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/txtnexta.gif" BORDER="0"></A></TD></TR><TR>
<TD WIDTH="172" VALIGN="TOP" ALIGN="LEFT">9.1 The Tool Bag</TD><TD WIDTH="171" VALIGN="TOP" ALIGN="CENTER">
<A TITLE="Book Index" HREF="http://www.oreilly.com/catalog/samba/inx.html" CLASS="index">
<IMG ALT="Book Index" SRC="http://www.oreilly.com/catalog/samba/chapter/gifs/index.gif" BORDER="0"></A></TD><TD WIDTH="172" VALIGN="TOP" ALIGN="RIGHT">
9.3 Extra Resources</TD></TR></TABLE><HR NOSHADE SIZE="1"></CENTER>
</DIV>

<!--  End of sample chapter -->
<P><B>Back to: <A HREF="http://www.oreilly.com/catalog/samba/noframes.html">Using Samba</A></B>
<CENTER>
<HR NOSHADE SIZE="1">
<FONT SIZE="1" FACE="Verdana, Arial, Helvetica">
<A HREF="http://www.oreilly.com/">
<B>O'Reilly Home</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/sales/bookstores">
<B>O'Reilly Bookstores</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/order_new/">
<B>How to Order</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/oreilly/contact.html">
<B>O'Reilly Contacts<BR></B></A>
<A HREF="http://www.oreilly.com/international/">
<B>International</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/oreilly/about.html">
<B>About O'Reilly</B></A> <B> | </B>
<A HREF="http://www.oreilly.com/affiliates.html">
<B>Affiliated Companies</B></A><P>
<EM>&copy; 1999, O'Reilly &amp; Associates, Inc.</EM>
</FONT>
</CENTER>
</BODY>

<!-- Mirrored from 63.227.213.92 by HTTrack/2.x [XR/YP'2000] -->
</HTML>
